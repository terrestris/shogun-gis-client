{"version":3,"file":"6174.3e2a9cbe46f635e9.js","sources":["webpack://@terrestris/shogun-gis-client/./node_modules/ol/Image.js","webpack://@terrestris/shogun-gis-client/./node_modules/ol/structs/PriorityQueue.js","webpack://@terrestris/shogun-gis-client/./node_modules/ol/TileQueue.js","webpack://@terrestris/shogun-gis-client/./node_modules/ol/renderer/canvas/ImageLayer.js","webpack://@terrestris/shogun-gis-client/./node_modules/ol/layer/BaseImage.js","webpack://@terrestris/shogun-gis-client/./node_modules/ol/layer/Image.js","webpack://@terrestris/shogun-gis-client/./node_modules/ol/layer/BaseTile.js","webpack://@terrestris/shogun-gis-client/./node_modules/ol/layer/Tile.js","webpack://@terrestris/shogun-gis-client/./node_modules/ol/resolution.js","webpack://@terrestris/shogun-gis-client/./node_modules/ol/reproj/Image.js","webpack://@terrestris/shogun-gis-client/./node_modules/ol/source/Image.js","webpack://@terrestris/shogun-gis-client/./node_modules/ol/ImageCanvas.js","webpack://@terrestris/shogun-gis-client/./node_modules/ol/source/Raster.js","webpack://@terrestris/shogun-gis-client/./node_modules/ol/source/common.js"],"sourcesContent":["/**\n * @module ol/Image\n */\nimport ImageState from './ImageState.js';\nimport EventType from './events/EventType.js';\nimport EventTarget from './events/Target.js';\nimport {listenOnce, unlistenByKey} from './events.js';\nimport {toPromise} from './functions.js';\nimport {CREATE_IMAGE_BITMAP, IMAGE_DECODE} from './has.js';\n\n/**\n * A function that takes an {@link module:ol/Image~ImageWrapper} for the image and a\n * `{string}` for the src as arguments. It is supposed to make it so the\n * underlying image {@link module:ol/Image~ImageWrapper#getImage} is assigned the\n * content specified by the src. If not specified, the default is\n *\n *     function(image, src) {\n *       image.getImage().src = src;\n *     }\n *\n * Providing a custom `imageLoadFunction` can be useful to load images with\n * post requests or - in general - through XHR requests, where the src of the\n * image element would be set to a data URI when the content is loaded.\n *\n * @typedef {function(import(\"./Image.js\").default, string): void} LoadFunction\n * @api\n */\n\n/**\n * @typedef {Object} ImageObject\n * @property {import(\"./extent.js\").Extent} [extent] Extent, if different from the requested one.\n * @property {import(\"./resolution.js\").ResolutionLike} [resolution] Resolution, if different from the requested one.\n * When x and y resolution are different, use the array type (`[xResolution, yResolution]`).\n * @property {number} [pixelRatio] Pixel ratio, if different from the requested one.\n * @property {import('./DataTile.js').ImageLike} image Image.\n */\n\n/**\n * Loader function used for image sources. Receives extent, resolution and pixel ratio as arguments.\n * For images that cover any extent and resolution (static images), the loader function should not accept\n * any arguments. The function returns an {@link import(\"./DataTile.js\").ImageLike image}, an\n * {@link import(\"./Image.js\").ImageObject image object}, or a promise for the same.\n * For loaders that generate images, the promise should not resolve until the image is loaded.\n * If the returned image does not match the extent, resolution or pixel ratio passed to the loader,\n * it has to return an {@link import(\"./Image.js\").ImageObject image object} with the `image` and the\n * correct `extent`, `resolution` and `pixelRatio`.\n *\n * @typedef {function(import(\"./extent.js\").Extent, number, number, (function(HTMLImageElement, string): void)=): import(\"./DataTile.js\").ImageLike|ImageObject|Promise<import(\"./DataTile.js\").ImageLike|ImageObject>} Loader\n * @api\n */\n\n/**\n * Loader function used for image sources. Receives extent, resolution and pixel ratio as arguments.\n * The function returns a promise for an  {@link import(\"./Image.js\").ImageObject image object}.\n *\n * @typedef {function(import(\"./extent.js\").Extent, number, number, (function(HTMLImageElement, string): void)=): Promise<import(\"./DataTile.js\").ImageLike|ImageObject>} ImageObjectPromiseLoader\n */\n\nclass ImageWrapper extends EventTarget {\n  /**\n   * @param {import(\"./extent.js\").Extent} extent Extent.\n   * @param {number|Array<number>|undefined} resolution Resolution. If provided as array, x and y\n   * resolution will be assumed.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"./ImageState.js\").default|Loader} stateOrLoader State.\n   */\n  constructor(extent, resolution, pixelRatio, stateOrLoader) {\n    super();\n\n    /**\n     * @protected\n     * @type {import(\"./extent.js\").Extent}\n     */\n    this.extent = extent;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.pixelRatio_ = pixelRatio;\n\n    /**\n     * @protected\n     * @type {number|Array<number>|undefined}\n     */\n    this.resolution = resolution;\n\n    /**\n     * @protected\n     * @type {import(\"./ImageState.js\").default}\n     */\n    this.state =\n      typeof stateOrLoader === 'function' ? ImageState.IDLE : stateOrLoader;\n\n    /**\n     * @private\n     * @type {import('./DataTile.js').ImageLike|null}\n     */\n    this.image_ = null;\n\n    /**\n     * @protected\n     * @type {Loader|null}\n     */\n    this.loader = typeof stateOrLoader === 'function' ? stateOrLoader : null;\n  }\n\n  /**\n   * @protected\n   */\n  changed() {\n    this.dispatchEvent(EventType.CHANGE);\n  }\n\n  /**\n   * @return {import(\"./extent.js\").Extent} Extent.\n   */\n  getExtent() {\n    return this.extent;\n  }\n\n  /**\n   * @return {import('./DataTile.js').ImageLike} Image.\n   */\n  getImage() {\n    return this.image_;\n  }\n\n  /**\n   * @return {number} PixelRatio.\n   */\n  getPixelRatio() {\n    return this.pixelRatio_;\n  }\n\n  /**\n   * @return {number|Array<number>} Resolution.\n   */\n  getResolution() {\n    return /** @type {number} */ (this.resolution);\n  }\n\n  /**\n   * @return {import(\"./ImageState.js\").default} State.\n   */\n  getState() {\n    return this.state;\n  }\n\n  /**\n   * Load not yet loaded URI.\n   */\n  load() {\n    if (this.state == ImageState.IDLE) {\n      if (this.loader) {\n        this.state = ImageState.LOADING;\n        this.changed();\n        const resolution = this.getResolution();\n        const requestResolution = Array.isArray(resolution)\n          ? resolution[0]\n          : resolution;\n        toPromise(() =>\n          this.loader(\n            this.getExtent(),\n            requestResolution,\n            this.getPixelRatio(),\n          ),\n        )\n          .then((image) => {\n            if ('image' in image) {\n              this.image_ = image.image;\n            }\n            if ('extent' in image) {\n              this.extent = image.extent;\n            }\n            if ('resolution' in image) {\n              this.resolution = image.resolution;\n            }\n            if ('pixelRatio' in image) {\n              this.pixelRatio_ = image.pixelRatio;\n            }\n            if (\n              image instanceof HTMLImageElement ||\n              (CREATE_IMAGE_BITMAP && image instanceof ImageBitmap) ||\n              image instanceof HTMLCanvasElement ||\n              image instanceof HTMLVideoElement\n            ) {\n              this.image_ = image;\n            }\n            this.state = ImageState.LOADED;\n          })\n          .catch((error) => {\n            this.state = ImageState.ERROR;\n            console.error(error); // eslint-disable-line no-console\n          })\n          .finally(() => this.changed());\n      }\n    }\n  }\n\n  /**\n   * @param {import('./DataTile.js').ImageLike} image The image.\n   */\n  setImage(image) {\n    this.image_ = image;\n  }\n\n  /**\n   * @param {number|Array<number>} resolution Resolution.\n   */\n  setResolution(resolution) {\n    this.resolution = resolution;\n  }\n}\n\n/**\n * @param {import('./DataTile.js').ImageLike} image Image element.\n * @param {function():any} loadHandler Load callback function.\n * @param {function():any} errorHandler Error callback function.\n * @return {function():void} Callback to stop listening.\n */\nexport function listenImage(image, loadHandler, errorHandler) {\n  const img = /** @type {HTMLImageElement} */ (image);\n  let listening = true;\n  let decoding = false;\n  let loaded = false;\n\n  const listenerKeys = [\n    listenOnce(img, EventType.LOAD, function () {\n      loaded = true;\n      if (!decoding) {\n        loadHandler();\n      }\n    }),\n  ];\n\n  if (img.src && IMAGE_DECODE) {\n    decoding = true;\n    img\n      .decode()\n      .then(function () {\n        if (listening) {\n          loadHandler();\n        }\n      })\n      .catch(function (error) {\n        if (listening) {\n          if (loaded) {\n            loadHandler();\n          } else {\n            errorHandler();\n          }\n        }\n      });\n  } else {\n    listenerKeys.push(listenOnce(img, EventType.ERROR, errorHandler));\n  }\n\n  return function unlisten() {\n    listening = false;\n    listenerKeys.forEach(unlistenByKey);\n  };\n}\n\n/**\n * Loads an image.\n * @param {HTMLImageElement} image Image, not yet loaded.\n * @param {string} [src] `src` attribute of the image. Optional, not required if already present.\n * @return {Promise<HTMLImageElement>} Promise resolving to an `HTMLImageElement`.\n * @api\n */\nexport function load(image, src) {\n  return new Promise((resolve, reject) => {\n    function handleLoad() {\n      unlisten();\n      resolve(image);\n    }\n    function handleError() {\n      unlisten();\n      reject(new Error('Image load error'));\n    }\n    function unlisten() {\n      image.removeEventListener('load', handleLoad);\n      image.removeEventListener('error', handleError);\n    }\n    image.addEventListener('load', handleLoad);\n    image.addEventListener('error', handleError);\n    if (src) {\n      image.src = src;\n    }\n  });\n}\n\n/**\n * @param {HTMLImageElement} image Image, not yet loaded.\n * @param {string} [src] `src` attribute of the image. Optional, not required if already present.\n * @return {Promise<HTMLImageElement>} Promise resolving to an `HTMLImageElement`.\n */\nexport function decodeFallback(image, src) {\n  if (src) {\n    image.src = src;\n  }\n  return image.src && IMAGE_DECODE\n    ? new Promise((resolve, reject) =>\n        image\n          .decode()\n          .then(() => resolve(image))\n          .catch((e) =>\n            image.complete && image.width ? resolve(image) : reject(e),\n          ),\n      )\n    : load(image);\n}\n\n/**\n * Loads an image and decodes it to an `ImageBitmap` if `createImageBitmap()` is supported. Returns\n * the loaded image otherwise.\n * @param {HTMLImageElement} image Image, not yet loaded.\n * @param {string} [src] `src` attribute of the image. Optional, not required if already present.\n * @return {Promise<ImageBitmap|HTMLImageElement>} Promise resolving to an `ImageBitmap` or an\n * `HTMLImageElement` if `createImageBitmap()` is not supported.\n * @api\n */\nexport function decode(image, src) {\n  if (src) {\n    image.src = src;\n  }\n  return image.src && IMAGE_DECODE && CREATE_IMAGE_BITMAP\n    ? image\n        .decode()\n        .then(() => createImageBitmap(image))\n        .catch((e) => {\n          if (image.complete && image.width) {\n            return image;\n          }\n          throw e;\n        })\n    : decodeFallback(image);\n}\n\nexport default ImageWrapper;\n","/**\n * @module ol/structs/PriorityQueue\n */\nimport {assert} from '../asserts.js';\nimport {clear} from '../obj.js';\n\n/**\n * @type {number}\n */\nexport const DROP = Infinity;\n\n/**\n * @classdesc\n * Priority queue.\n *\n * The implementation is inspired from the Closure Library's Heap class and\n * Python's heapq module.\n *\n * See https://github.com/google/closure-library/blob/master/closure/goog/structs/heap.js\n * and https://hg.python.org/cpython/file/2.7/Lib/heapq.py.\n *\n * @template T\n */\nclass PriorityQueue {\n  /**\n   * @param {function(T): number} priorityFunction Priority function.\n   * @param {function(T): string} keyFunction Key function.\n   */\n  constructor(priorityFunction, keyFunction) {\n    /**\n     * @type {function(T): number}\n     * @private\n     */\n    this.priorityFunction_ = priorityFunction;\n\n    /**\n     * @type {function(T): string}\n     * @private\n     */\n    this.keyFunction_ = keyFunction;\n\n    /**\n     * @type {Array<T>}\n     * @private\n     */\n    this.elements_ = [];\n\n    /**\n     * @type {Array<number>}\n     * @private\n     */\n    this.priorities_ = [];\n\n    /**\n     * @type {!Object<string, boolean>}\n     * @private\n     */\n    this.queuedElements_ = {};\n  }\n\n  /**\n   * FIXME empty description for jsdoc\n   */\n  clear() {\n    this.elements_.length = 0;\n    this.priorities_.length = 0;\n    clear(this.queuedElements_);\n  }\n\n  /**\n   * Remove and return the highest-priority element. O(log N).\n   * @return {T} Element.\n   */\n  dequeue() {\n    const elements = this.elements_;\n    const priorities = this.priorities_;\n    const element = elements[0];\n    if (elements.length == 1) {\n      elements.length = 0;\n      priorities.length = 0;\n    } else {\n      elements[0] = /** @type {T} */ (elements.pop());\n      priorities[0] = /** @type {number} */ (priorities.pop());\n      this.siftUp_(0);\n    }\n    const elementKey = this.keyFunction_(element);\n    delete this.queuedElements_[elementKey];\n    return element;\n  }\n\n  /**\n   * Enqueue an element. O(log N).\n   * @param {T} element Element.\n   * @return {boolean} The element was added to the queue.\n   */\n  enqueue(element) {\n    assert(\n      !(this.keyFunction_(element) in this.queuedElements_),\n      'Tried to enqueue an `element` that was already added to the queue',\n    );\n    const priority = this.priorityFunction_(element);\n    if (priority != DROP) {\n      this.elements_.push(element);\n      this.priorities_.push(priority);\n      this.queuedElements_[this.keyFunction_(element)] = true;\n      this.siftDown_(0, this.elements_.length - 1);\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * @return {number} Count.\n   */\n  getCount() {\n    return this.elements_.length;\n  }\n\n  /**\n   * Gets the index of the left child of the node at the given index.\n   * @param {number} index The index of the node to get the left child for.\n   * @return {number} The index of the left child.\n   * @private\n   */\n  getLeftChildIndex_(index) {\n    return index * 2 + 1;\n  }\n\n  /**\n   * Gets the index of the right child of the node at the given index.\n   * @param {number} index The index of the node to get the right child for.\n   * @return {number} The index of the right child.\n   * @private\n   */\n  getRightChildIndex_(index) {\n    return index * 2 + 2;\n  }\n\n  /**\n   * Gets the index of the parent of the node at the given index.\n   * @param {number} index The index of the node to get the parent for.\n   * @return {number} The index of the parent.\n   * @private\n   */\n  getParentIndex_(index) {\n    return (index - 1) >> 1;\n  }\n\n  /**\n   * Make this a heap. O(N).\n   * @private\n   */\n  heapify_() {\n    let i;\n    for (i = (this.elements_.length >> 1) - 1; i >= 0; i--) {\n      this.siftUp_(i);\n    }\n  }\n\n  /**\n   * @return {boolean} Is empty.\n   */\n  isEmpty() {\n    return this.elements_.length === 0;\n  }\n\n  /**\n   * @param {string} key Key.\n   * @return {boolean} Is key queued.\n   */\n  isKeyQueued(key) {\n    return key in this.queuedElements_;\n  }\n\n  /**\n   * @param {T} element Element.\n   * @return {boolean} Is queued.\n   */\n  isQueued(element) {\n    return this.isKeyQueued(this.keyFunction_(element));\n  }\n\n  /**\n   * @param {number} index The index of the node to move down.\n   * @private\n   */\n  siftUp_(index) {\n    const elements = this.elements_;\n    const priorities = this.priorities_;\n    const count = elements.length;\n    const element = elements[index];\n    const priority = priorities[index];\n    const startIndex = index;\n\n    while (index < count >> 1) {\n      const lIndex = this.getLeftChildIndex_(index);\n      const rIndex = this.getRightChildIndex_(index);\n\n      const smallerChildIndex =\n        rIndex < count && priorities[rIndex] < priorities[lIndex]\n          ? rIndex\n          : lIndex;\n\n      elements[index] = elements[smallerChildIndex];\n      priorities[index] = priorities[smallerChildIndex];\n      index = smallerChildIndex;\n    }\n\n    elements[index] = element;\n    priorities[index] = priority;\n    this.siftDown_(startIndex, index);\n  }\n\n  /**\n   * @param {number} startIndex The index of the root.\n   * @param {number} index The index of the node to move up.\n   * @private\n   */\n  siftDown_(startIndex, index) {\n    const elements = this.elements_;\n    const priorities = this.priorities_;\n    const element = elements[index];\n    const priority = priorities[index];\n\n    while (index > startIndex) {\n      const parentIndex = this.getParentIndex_(index);\n      if (priorities[parentIndex] > priority) {\n        elements[index] = elements[parentIndex];\n        priorities[index] = priorities[parentIndex];\n        index = parentIndex;\n      } else {\n        break;\n      }\n    }\n    elements[index] = element;\n    priorities[index] = priority;\n  }\n\n  /**\n   * FIXME empty description for jsdoc\n   */\n  reprioritize() {\n    const priorityFunction = this.priorityFunction_;\n    const elements = this.elements_;\n    const priorities = this.priorities_;\n    let index = 0;\n    const n = elements.length;\n    let element, i, priority;\n    for (i = 0; i < n; ++i) {\n      element = elements[i];\n      priority = priorityFunction(element);\n      if (priority == DROP) {\n        delete this.queuedElements_[this.keyFunction_(element)];\n      } else {\n        priorities[index] = priority;\n        elements[index++] = element;\n      }\n    }\n    elements.length = index;\n    priorities.length = index;\n    this.heapify_();\n  }\n}\n\nexport default PriorityQueue;\n","/**\n * @module ol/TileQueue\n */\nimport TileState from './TileState.js';\nimport EventType from './events/EventType.js';\nimport PriorityQueue, {DROP} from './structs/PriorityQueue.js';\n\n/**\n * @typedef {function(import(\"./Tile.js\").default, string, import('./tilecoord.js').TileCoord, number): number} PriorityFunction\n */\n\n/**\n * @typedef {[import('./Tile.js').default, string, import('./tilecoord.js').TileCoord, number]} TileQueueElement\n */\n\n/**\n * @extends PriorityQueue<TileQueueElement>}\n */\nclass TileQueue extends PriorityQueue {\n  /**\n   * @param {PriorityFunction} tilePriorityFunction Tile priority function.\n   * @param {function(): ?} tileChangeCallback Function called on each tile change event.\n   */\n  constructor(tilePriorityFunction, tileChangeCallback) {\n    super(\n      (element) => tilePriorityFunction.apply(null, element),\n      (element) => element[0].getKey(),\n    );\n\n    /** @private */\n    this.boundHandleTileChange_ = this.handleTileChange.bind(this);\n\n    /**\n     * @private\n     * @type {function(): ?}\n     */\n    this.tileChangeCallback_ = tileChangeCallback;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.tilesLoading_ = 0;\n\n    /**\n     * @private\n     * @type {!Object<string,boolean>}\n     */\n    this.tilesLoadingKeys_ = {};\n  }\n\n  /**\n   * @param {TileQueueElement} element Element.\n   * @return {boolean} The element was added to the queue.\n   * @override\n   */\n  enqueue(element) {\n    const added = super.enqueue(element);\n    if (added) {\n      const tile = element[0];\n      tile.addEventListener(EventType.CHANGE, this.boundHandleTileChange_);\n    }\n    return added;\n  }\n\n  /**\n   * @return {number} Number of tiles loading.\n   */\n  getTilesLoading() {\n    return this.tilesLoading_;\n  }\n\n  /**\n   * @param {import(\"./events/Event.js\").default} event Event.\n   * @protected\n   */\n  handleTileChange(event) {\n    const tile = /** @type {import(\"./Tile.js\").default} */ (event.target);\n    const state = tile.getState();\n    if (\n      state === TileState.LOADED ||\n      state === TileState.ERROR ||\n      state === TileState.EMPTY\n    ) {\n      if (state !== TileState.ERROR) {\n        tile.removeEventListener(EventType.CHANGE, this.boundHandleTileChange_);\n      }\n      const tileKey = tile.getKey();\n      if (tileKey in this.tilesLoadingKeys_) {\n        delete this.tilesLoadingKeys_[tileKey];\n        --this.tilesLoading_;\n      }\n      this.tileChangeCallback_();\n    }\n  }\n\n  /**\n   * @param {number} maxTotalLoading Maximum number tiles to load simultaneously.\n   * @param {number} maxNewLoads Maximum number of new tiles to load.\n   */\n  loadMoreTiles(maxTotalLoading, maxNewLoads) {\n    let newLoads = 0;\n    while (\n      this.tilesLoading_ < maxTotalLoading &&\n      newLoads < maxNewLoads &&\n      this.getCount() > 0\n    ) {\n      const tile = this.dequeue()[0];\n      const tileKey = tile.getKey();\n      const state = tile.getState();\n      if (state === TileState.IDLE && !(tileKey in this.tilesLoadingKeys_)) {\n        this.tilesLoadingKeys_[tileKey] = true;\n        ++this.tilesLoading_;\n        ++newLoads;\n        tile.load();\n      }\n    }\n  }\n}\n\nexport default TileQueue;\n\n/**\n * @param {import('./Map.js').FrameState} frameState Frame state.\n * @param {import(\"./Tile.js\").default} tile Tile.\n * @param {string} tileSourceKey Tile source key.\n * @param {import(\"./coordinate.js\").Coordinate} tileCenter Tile center.\n * @param {number} tileResolution Tile resolution.\n * @return {number} Tile priority.\n */\nexport function getTilePriority(\n  frameState,\n  tile,\n  tileSourceKey,\n  tileCenter,\n  tileResolution,\n) {\n  // Filter out tiles at higher zoom levels than the current zoom level, or that\n  // are outside the visible extent.\n  if (!frameState || !(tileSourceKey in frameState.wantedTiles)) {\n    return DROP;\n  }\n  if (!frameState.wantedTiles[tileSourceKey][tile.getKey()]) {\n    return DROP;\n  }\n  // Prioritize the highest zoom level tiles closest to the focus.\n  // Tiles at higher zoom levels are prioritized using Math.log(tileResolution).\n  // Within a zoom level, tiles are prioritized by the distance in pixels between\n  // the center of the tile and the center of the viewport.  The factor of 65536\n  // means that the prioritization should behave as desired for tiles up to\n  // 65536 * Math.log(2) = 45426 pixels from the focus.\n  const center = frameState.viewState.center;\n  const deltaX = tileCenter[0] - center[0];\n  const deltaY = tileCenter[1] - center[1];\n  return (\n    65536 * Math.log(tileResolution) +\n    Math.sqrt(deltaX * deltaX + deltaY * deltaY) / tileResolution\n  );\n}\n","/**\n * @module ol/renderer/canvas/ImageLayer\n */\nimport ImageState from '../../ImageState.js';\nimport ViewHint from '../../ViewHint.js';\nimport {\n  containsCoordinate,\n  containsExtent,\n  getHeight,\n  getIntersection,\n  getWidth,\n  intersects as intersectsExtent,\n  isEmpty,\n} from '../../extent.js';\nimport {fromUserExtent} from '../../proj.js';\nimport {\n  apply as applyTransform,\n  compose as composeTransform,\n} from '../../transform.js';\nimport CanvasLayerRenderer from './Layer.js';\n\n/**\n * @classdesc\n * Canvas renderer for image layers.\n * @api\n */\nclass CanvasImageLayerRenderer extends CanvasLayerRenderer {\n  /**\n   * @param {import(\"../../layer/Image.js\").default} imageLayer Image layer.\n   */\n  constructor(imageLayer) {\n    super(imageLayer);\n\n    /**\n     * @protected\n     * @type {?import(\"../../Image.js\").default}\n     */\n    this.image = null;\n  }\n\n  /**\n   * @return {import('../../DataTile.js').ImageLike} Image.\n   */\n  getImage() {\n    return !this.image ? null : this.image.getImage();\n  }\n\n  /**\n   * Determine whether render should be called.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @return {boolean} Layer is ready to be rendered.\n   * @override\n   */\n  prepareFrame(frameState) {\n    const layerState = frameState.layerStatesArray[frameState.layerIndex];\n    const pixelRatio = frameState.pixelRatio;\n    const viewState = frameState.viewState;\n    const viewResolution = viewState.resolution;\n\n    const imageSource = this.getLayer().getSource();\n\n    const hints = frameState.viewHints;\n\n    let renderedExtent = frameState.extent;\n    if (layerState.extent !== undefined) {\n      renderedExtent = getIntersection(\n        renderedExtent,\n        fromUserExtent(layerState.extent, viewState.projection),\n      );\n    }\n\n    if (\n      !hints[ViewHint.ANIMATING] &&\n      !hints[ViewHint.INTERACTING] &&\n      !isEmpty(renderedExtent)\n    ) {\n      if (imageSource) {\n        const projection = viewState.projection;\n        const image = imageSource.getImage(\n          renderedExtent,\n          viewResolution,\n          pixelRatio,\n          projection,\n        );\n        if (image) {\n          if (this.loadImage(image)) {\n            this.image = image;\n          } else if (image.getState() === ImageState.EMPTY) {\n            this.image = null;\n          }\n        }\n      } else {\n        this.image = null;\n      }\n    }\n\n    return !!this.image;\n  }\n\n  /**\n   * @param {import(\"../../pixel.js\").Pixel} pixel Pixel.\n   * @return {Uint8ClampedArray} Data at the pixel location.\n   * @override\n   */\n  getData(pixel) {\n    const frameState = this.frameState;\n    if (!frameState) {\n      return null;\n    }\n\n    const layer = this.getLayer();\n    const coordinate = applyTransform(\n      frameState.pixelToCoordinateTransform,\n      pixel.slice(),\n    );\n\n    const layerExtent = layer.getExtent();\n    if (layerExtent) {\n      if (!containsCoordinate(layerExtent, coordinate)) {\n        return null;\n      }\n    }\n\n    const imageExtent = this.image.getExtent();\n    const img = this.image.getImage();\n\n    const imageMapWidth = getWidth(imageExtent);\n    const col = Math.floor(\n      img.width * ((coordinate[0] - imageExtent[0]) / imageMapWidth),\n    );\n    if (col < 0 || col >= img.width) {\n      return null;\n    }\n\n    const imageMapHeight = getHeight(imageExtent);\n    const row = Math.floor(\n      img.height * ((imageExtent[3] - coordinate[1]) / imageMapHeight),\n    );\n    if (row < 0 || row >= img.height) {\n      return null;\n    }\n\n    return this.getImageData(img, col, row);\n  }\n\n  /**\n   * Render the layer.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @param {HTMLElement} target Target that may be used to render content to.\n   * @return {HTMLElement} The rendered element.\n   * @override\n   */\n  renderFrame(frameState, target) {\n    const image = this.image;\n    const imageExtent = image.getExtent();\n    const imageResolution = image.getResolution();\n    const [imageResolutionX, imageResolutionY] = Array.isArray(imageResolution)\n      ? imageResolution\n      : [imageResolution, imageResolution];\n    const imagePixelRatio = image.getPixelRatio();\n    const layerState = frameState.layerStatesArray[frameState.layerIndex];\n    const pixelRatio = frameState.pixelRatio;\n    const viewState = frameState.viewState;\n    const viewCenter = viewState.center;\n    const viewResolution = viewState.resolution;\n    const scaleX =\n      (pixelRatio * imageResolutionX) / (viewResolution * imagePixelRatio);\n    const scaleY =\n      (pixelRatio * imageResolutionY) / (viewResolution * imagePixelRatio);\n\n    this.prepareContainer(frameState, target);\n\n    // desired dimensions of the canvas in pixels\n    const width = this.context.canvas.width;\n    const height = this.context.canvas.height;\n\n    const context = this.getRenderContext(frameState);\n\n    // clipped rendering if layer extent is set\n    let clipped = false;\n    let render = true;\n    if (layerState.extent) {\n      const layerExtent = fromUserExtent(\n        layerState.extent,\n        viewState.projection,\n      );\n      render = intersectsExtent(layerExtent, frameState.extent);\n      clipped = render && !containsExtent(layerExtent, frameState.extent);\n      if (clipped) {\n        this.clipUnrotated(context, frameState, layerExtent);\n      }\n    }\n\n    const img = image.getImage();\n\n    const transform = composeTransform(\n      this.tempTransform,\n      width / 2,\n      height / 2,\n      scaleX,\n      scaleY,\n      0,\n      (imagePixelRatio * (imageExtent[0] - viewCenter[0])) / imageResolutionX,\n      (imagePixelRatio * (viewCenter[1] - imageExtent[3])) / imageResolutionY,\n    );\n\n    this.renderedResolution = (imageResolutionY * pixelRatio) / imagePixelRatio;\n\n    const dw = img.width * transform[0];\n    const dh = img.height * transform[3];\n\n    if (!this.getLayer().getSource().getInterpolate()) {\n      context.imageSmoothingEnabled = false;\n    }\n\n    this.preRender(context, frameState);\n    if (render && dw >= 0.5 && dh >= 0.5) {\n      const dx = transform[4];\n      const dy = transform[5];\n      const opacity = layerState.opacity;\n      if (opacity !== 1) {\n        context.save();\n        context.globalAlpha = opacity;\n      }\n      context.drawImage(img, 0, 0, +img.width, +img.height, dx, dy, dw, dh);\n      if (opacity !== 1) {\n        context.restore();\n      }\n    }\n    this.postRender(this.context, frameState);\n\n    if (clipped) {\n      context.restore();\n    }\n    context.imageSmoothingEnabled = true;\n\n    return this.container;\n  }\n}\n\nexport default CanvasImageLayerRenderer;\n","/**\n * @module ol/layer/BaseImage\n */\nimport Layer from './Layer.js';\n\n/**\n * @template {import(\"../source/Image.js\").default} ImageSourceType\n * @typedef {Object} Options\n * @property {string} [className='ol-layer'] A CSS class name to set to the layer element.\n * @property {number} [opacity=1] Opacity (0, 1).\n * @property {boolean} [visible=true] Visibility.\n * @property {import(\"../extent.js\").Extent} [extent] The bounding extent for layer rendering.  The layer will not be\n * rendered outside of this extent.\n * @property {number} [zIndex] The z-index for layer rendering.  At rendering time, the layers\n * will be ordered, first by Z-index and then by position. When `undefined`, a `zIndex` of 0 is assumed\n * for layers that are added to the map's `layers` collection, or `Infinity` when the layer's `setMap()`\n * method was used.\n * @property {number} [minResolution] The minimum resolution (inclusive) at which this layer will be\n * visible.\n * @property {number} [maxResolution] The maximum resolution (exclusive) below which this layer will\n * be visible.\n * @property {number} [minZoom] The minimum view zoom level (exclusive) above which this layer will be\n * visible.\n * @property {number} [maxZoom] The maximum view zoom level (inclusive) at which this layer will\n * be visible.\n * @property {import(\"../Map.js\").default} [map] Sets the layer as overlay on a map. The map will not manage\n * this layer in its layers collection, and the layer will be rendered on top. This is useful for\n * temporary layers. The standard way to add a layer to a map and have it managed by the map is to\n * use {@link import(\"../Map.js\").default#addLayer map.addLayer()}.\n * @property {ImageSourceType} [source] Source for this layer.\n * @property {Object<string, *>} [properties] Arbitrary observable properties. Can be accessed with `#get()` and `#set()`.\n */\n\n/**\n * @classdesc\n * Server-rendered images that are available for arbitrary extents and\n * resolutions.\n * Note that any property set in the options is set as a {@link module:ol/Object~BaseObject}\n * property on the layer object; for example, setting `title: 'My Title'` in the\n * options means that `title` is observable, and has get/set accessors.\n *\n * @template {import(\"../source/Image.js\").default} ImageSourceType\n * @template {import(\"../renderer/Layer.js\").default} RendererType\n * @extends {Layer<ImageSourceType, RendererType>}\n * @api\n */\nclass BaseImageLayer extends Layer {\n  /**\n   * @param {Options<ImageSourceType>} [options] Layer options.\n   */\n  constructor(options) {\n    options = options ? options : {};\n    super(options);\n  }\n}\n\nexport default BaseImageLayer;\n","/**\n * @module ol/layer/Image\n */\nimport CanvasImageLayerRenderer from '../renderer/canvas/ImageLayer.js';\nimport BaseImageLayer from './BaseImage.js';\n\n/**\n * @classdesc\n * Server-rendered images that are available for arbitrary extents and\n * resolutions.\n * Note that any property set in the options is set as a {@link module:ol/Object~BaseObject}\n * property on the layer object; for example, setting `title: 'My Title'` in the\n * options means that `title` is observable, and has get/set accessors.\n *\n * @template {import(\"../source/Image.js\").default} ImageSourceType\n * @extends {BaseImageLayer<ImageSourceType, CanvasImageLayerRenderer>}\n * @api\n */\nclass ImageLayer extends BaseImageLayer {\n  /**\n   * @param {import(\"./BaseImage.js\").Options<ImageSourceType>} [options] Layer options.\n   */\n  constructor(options) {\n    super(options);\n  }\n\n  /**\n   * @override\n   */\n  createRenderer() {\n    return new CanvasImageLayerRenderer(this);\n  }\n\n  /**\n   * Get data for a pixel location.  A four element RGBA array will be returned.  For requests outside the\n   * layer extent, `null` will be returned.  Data for an image can only be retrieved if the\n   * source's `crossOrigin` property is set.\n   *\n   * ```js\n   * // display layer data on every pointer move\n   * map.on('pointermove', (event) => {\n   *   console.log(layer.getData(event.pixel));\n   * });\n   * ```\n   * @param {import(\"../pixel\").Pixel} pixel Pixel.\n   * @return {Uint8ClampedArray|Uint8Array|Float32Array|DataView|null} Pixel data.\n   * @api\n   * @override\n   */\n  getData(pixel) {\n    return super.getData(pixel);\n  }\n}\n\nexport default ImageLayer;\n","/**\n * @module ol/layer/BaseTile\n */\nimport Layer from './Layer.js';\nimport TileProperty from './TileProperty.js';\n\n/***\n * @template Return\n * @typedef {import(\"../Observable\").OnSignature<import(\"../Observable\").EventTypes, import(\"../events/Event.js\").default, Return> &\n *   import(\"../Observable\").OnSignature<import(\"./Base\").BaseLayerObjectEventTypes|\n *     import(\"./Layer.js\").LayerEventType|'change:preload'|'change:useInterimTilesOnError', import(\"../Object\").ObjectEvent, Return> &\n *   import(\"../Observable\").OnSignature<import(\"../render/EventType\").LayerRenderEventTypes, import(\"../render/Event\").default, Return> &\n *   import(\"../Observable\").CombinedOnSignature<import(\"../Observable\").EventTypes|import(\"./Base\").BaseLayerObjectEventTypes|\n *   import(\"./Layer.js\").LayerEventType|'change:preload'|'change:useInterimTilesOnError'|import(\"../render/EventType\").LayerRenderEventTypes, Return>} BaseTileLayerOnSignature\n */\n\n/**\n * @template {import(\"../source/Tile.js\").default} TileSourceType\n * @typedef {Object} Options\n * @property {string} [className='ol-layer'] A CSS class name to set to the layer element.\n * @property {number} [opacity=1] Opacity (0, 1).\n * @property {boolean} [visible=true] Visibility.\n * @property {import(\"../extent.js\").Extent} [extent] The bounding extent for layer rendering.  The layer will not be\n * rendered outside of this extent.\n * @property {number} [zIndex] The z-index for layer rendering.  At rendering time, the layers\n * will be ordered, first by Z-index and then by position. When `undefined`, a `zIndex` of 0 is assumed\n * for layers that are added to the map's `layers` collection, or `Infinity` when the layer's `setMap()`\n * method was used.\n * @property {number} [minResolution] The minimum resolution (inclusive) at which this layer will be\n * visible.\n * @property {number} [maxResolution] The maximum resolution (exclusive) below which this layer will\n * be visible.\n * @property {number} [minZoom] The minimum view zoom level (exclusive) above which this layer will be\n * visible.\n * @property {number} [maxZoom] The maximum view zoom level (inclusive) at which this layer will\n * be visible.\n * @property {number} [preload=0] Preload. Load low-resolution tiles up to `preload` levels. `0`\n * means no preloading.\n * @property {TileSourceType} [source] Source for this layer.\n * @property {import(\"../Map.js\").default} [map] Sets the layer as overlay on a map. The map will not manage\n * this layer in its layers collection, and the layer will be rendered on top. This is useful for\n * temporary layers. The standard way to add a layer to a map and have it managed by the map is to\n * use {@link import(\"../Map.js\").default#addLayer map.addLayer()}.\n * @property {import(\"./Base.js\").BackgroundColor} [background] Background color for the layer. If not specified, no background\n * will be rendered.\n * @property {boolean} [useInterimTilesOnError=true] Deprecated.  Use interim tiles on error.\n * @property {Object<string, *>} [properties] Arbitrary observable properties. Can be accessed with `#get()` and `#set()`.\n * @property {number} [cacheSize=512] The internal tile cache size.  This needs to be large enough to render\n * two zoom levels worth of tiles.\n */\n\n/**\n * @classdesc\n * For layer sources that provide pre-rendered, tiled images in grids that are\n * organized by zoom levels for specific resolutions.\n * Note that any property set in the options is set as a {@link module:ol/Object~BaseObject}\n * property on the layer object; for example, setting `title: 'My Title'` in the\n * options means that `title` is observable, and has get/set accessors.\n *\n * @template {import(\"../source/Tile.js\").default} TileSourceType\n * @template {import(\"../renderer/Layer.js\").default} RendererType\n * @extends {Layer<TileSourceType, RendererType>}\n * @api\n */\nclass BaseTileLayer extends Layer {\n  /**\n   * @param {Options<TileSourceType>} [options] Tile layer options.\n   */\n  constructor(options) {\n    options = options ? options : {};\n\n    const baseOptions = Object.assign({}, options);\n\n    const cacheSize = options.cacheSize;\n    delete options.cacheSize;\n\n    delete baseOptions.preload;\n    delete baseOptions.useInterimTilesOnError;\n    super(baseOptions);\n\n    /***\n     * @type {BaseTileLayerOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.on;\n\n    /***\n     * @type {BaseTileLayerOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.once;\n\n    /***\n     * @type {BaseTileLayerOnSignature<void>}\n     */\n    this.un;\n\n    /**\n     * @type {number|undefined}\n     * @private\n     */\n    this.cacheSize_ = cacheSize;\n\n    this.setPreload(options.preload !== undefined ? options.preload : 0);\n    this.setUseInterimTilesOnError(\n      options.useInterimTilesOnError !== undefined\n        ? options.useInterimTilesOnError\n        : true,\n    );\n  }\n\n  /**\n   * @return {number|undefined} The suggested cache size\n   * @protected\n   */\n  getCacheSize() {\n    return this.cacheSize_;\n  }\n\n  /**\n   * Return the level as number to which we will preload tiles up to.\n   * @return {number} The level to preload tiles up to.\n   * @observable\n   * @api\n   */\n  getPreload() {\n    return /** @type {number} */ (this.get(TileProperty.PRELOAD));\n  }\n\n  /**\n   * Set the level as number to which we will preload tiles up to.\n   * @param {number} preload The level to preload tiles up to.\n   * @observable\n   * @api\n   */\n  setPreload(preload) {\n    this.set(TileProperty.PRELOAD, preload);\n  }\n\n  /**\n   * Deprecated.  Whether we use interim tiles on error.\n   * @return {boolean} Use interim tiles on error.\n   * @observable\n   * @api\n   */\n  getUseInterimTilesOnError() {\n    return /** @type {boolean} */ (\n      this.get(TileProperty.USE_INTERIM_TILES_ON_ERROR)\n    );\n  }\n\n  /**\n   * Deprecated.  Set whether we use interim tiles on error.\n   * @param {boolean} useInterimTilesOnError Use interim tiles on error.\n   * @observable\n   * @api\n   */\n  setUseInterimTilesOnError(useInterimTilesOnError) {\n    this.set(TileProperty.USE_INTERIM_TILES_ON_ERROR, useInterimTilesOnError);\n  }\n\n  /**\n   * Get data for a pixel location.  The return type depends on the source data.  For image tiles,\n   * a four element RGBA array will be returned.  For data tiles, the array length will match the\n   * number of bands in the dataset.  For requests outside the layer extent, `null` will be returned.\n   * Data for a image tiles can only be retrieved if the source's `crossOrigin` property is set.\n   *\n   * ```js\n   * // display layer data on every pointer move\n   * map.on('pointermove', (event) => {\n   *   console.log(layer.getData(event.pixel));\n   * });\n   * ```\n   * @param {import(\"../pixel\").Pixel} pixel Pixel.\n   * @return {Uint8ClampedArray|Uint8Array|Float32Array|DataView|null} Pixel data.\n   * @api\n   * @override\n   */\n  getData(pixel) {\n    return super.getData(pixel);\n  }\n}\n\nexport default BaseTileLayer;\n","/**\n * @module ol/layer/Tile\n */\nimport CanvasTileLayerRenderer from '../renderer/canvas/TileLayer.js';\nimport BaseTileLayer from './BaseTile.js';\n\n/**\n * @classdesc\n * For layer sources that provide pre-rendered, tiled images in grids that are\n * organized by zoom levels for specific resolutions.\n * Note that any property set in the options is set as a {@link module:ol/Object~BaseObject}\n * property on the layer object; for example, setting `title: 'My Title'` in the\n * options means that `title` is observable, and has get/set accessors.\n *\n * @template {import(\"../source/Tile.js\").default} [TileSourceType=import(\"../source/Tile.js\").default]\n * @extends BaseTileLayer<TileSourceType, CanvasTileLayerRenderer>\n * @api\n */\nclass TileLayer extends BaseTileLayer {\n  /**\n   * @param {import(\"./BaseTile.js\").Options<TileSourceType>} [options] Tile layer options.\n   */\n  constructor(options) {\n    super(options);\n  }\n\n  /**\n   * @override\n   */\n  createRenderer() {\n    return new CanvasTileLayerRenderer(this, {\n      cacheSize: this.getCacheSize(),\n    });\n  }\n}\n\nexport default TileLayer;\n","/**\n * @module ol/resolution\n */\n\n/**\n * @typedef {number|Array<number>} ResolutionLike\n */\n\n/**\n * @param {ResolutionLike} resolution Resolution.\n * @return {number} Resolution.\n */\nexport function fromResolutionLike(resolution) {\n  if (Array.isArray(resolution)) {\n    return Math.min(...resolution);\n  }\n  return resolution;\n}\n","/**\n * @module ol/reproj/Image\n */\n\nimport ImageWrapper from '../Image.js';\nimport ImageState from '../ImageState.js';\nimport EventType from '../events/EventType.js';\nimport {listen, unlistenByKey} from '../events.js';\nimport {\n  getCenter,\n  getHeight,\n  getIntersection,\n  getWidth,\n  isEmpty,\n} from '../extent.js';\nimport {\n  calculateSourceResolution,\n  render as renderReprojected,\n} from '../reproj.js';\nimport {fromResolutionLike} from '../resolution.js';\nimport Triangulation from './Triangulation.js';\nimport {ERROR_THRESHOLD} from './common.js';\n\n/**\n * @typedef {function(import(\"../extent.js\").Extent, number, number) : import(\"../Image.js\").default} FunctionType\n */\n\n/**\n * @classdesc\n * Class encapsulating single reprojected image.\n * See {@link module:ol/source/Image~ImageSource}.\n */\nclass ReprojImage extends ImageWrapper {\n  /**\n   * @param {import(\"../proj/Projection.js\").default} sourceProj Source projection (of the data).\n   * @param {import(\"../proj/Projection.js\").default} targetProj Target projection.\n   * @param {import(\"../extent.js\").Extent} targetExtent Target extent.\n   * @param {number} targetResolution Target resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {FunctionType} getImageFunction\n   *     Function returning source images (extent, resolution, pixelRatio).\n   * @param {boolean} interpolate Use linear interpolation when resampling.\n   */\n  constructor(\n    sourceProj,\n    targetProj,\n    targetExtent,\n    targetResolution,\n    pixelRatio,\n    getImageFunction,\n    interpolate,\n  ) {\n    let maxSourceExtent = sourceProj.getExtent();\n    if (maxSourceExtent && sourceProj.canWrapX()) {\n      maxSourceExtent = maxSourceExtent.slice();\n      maxSourceExtent[0] = -Infinity;\n      maxSourceExtent[2] = Infinity;\n    }\n    let maxTargetExtent = targetProj.getExtent();\n    if (maxTargetExtent && targetProj.canWrapX()) {\n      maxTargetExtent = maxTargetExtent.slice();\n      maxTargetExtent[0] = -Infinity;\n      maxTargetExtent[2] = Infinity;\n    }\n\n    const limitedTargetExtent = maxTargetExtent\n      ? getIntersection(targetExtent, maxTargetExtent)\n      : targetExtent;\n\n    const targetCenter = getCenter(limitedTargetExtent);\n    const sourceResolution = calculateSourceResolution(\n      sourceProj,\n      targetProj,\n      targetCenter,\n      targetResolution,\n    );\n\n    const errorThresholdInPixels = ERROR_THRESHOLD;\n\n    const triangulation = new Triangulation(\n      sourceProj,\n      targetProj,\n      limitedTargetExtent,\n      maxSourceExtent,\n      sourceResolution * errorThresholdInPixels,\n      targetResolution,\n    );\n\n    const sourceExtent = triangulation.calculateSourceExtent();\n    const sourceImage = isEmpty(sourceExtent)\n      ? null\n      : getImageFunction(sourceExtent, sourceResolution, pixelRatio);\n    const state = sourceImage ? ImageState.IDLE : ImageState.EMPTY;\n    const sourcePixelRatio = sourceImage ? sourceImage.getPixelRatio() : 1;\n\n    super(targetExtent, targetResolution, sourcePixelRatio, state);\n\n    /**\n     * @private\n     * @type {import(\"../proj/Projection.js\").default}\n     */\n    this.targetProj_ = targetProj;\n\n    /**\n     * @private\n     * @type {import(\"../extent.js\").Extent}\n     */\n    this.maxSourceExtent_ = maxSourceExtent;\n\n    /**\n     * @private\n     * @type {!import(\"./Triangulation.js\").default}\n     */\n    this.triangulation_ = triangulation;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.targetResolution_ = targetResolution;\n\n    /**\n     * @private\n     * @type {import(\"../extent.js\").Extent}\n     */\n    this.targetExtent_ = targetExtent;\n\n    /**\n     * @private\n     * @type {import(\"../Image.js\").default}\n     */\n    this.sourceImage_ = sourceImage;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.sourcePixelRatio_ = sourcePixelRatio;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.interpolate_ = interpolate;\n\n    /**\n     * @private\n     * @type {HTMLCanvasElement}\n     */\n    this.canvas_ = null;\n\n    /**\n     * @private\n     * @type {?import(\"../events.js\").EventsKey}\n     */\n    this.sourceListenerKey_ = null;\n  }\n\n  /**\n   * Clean up.\n   * @override\n   */\n  disposeInternal() {\n    if (this.state == ImageState.LOADING) {\n      this.unlistenSource_();\n    }\n    super.disposeInternal();\n  }\n\n  /**\n   * @return {HTMLCanvasElement} Image.\n   * @override\n   */\n  getImage() {\n    return this.canvas_;\n  }\n\n  /**\n   * @return {import(\"../proj/Projection.js\").default} Projection.\n   */\n  getProjection() {\n    return this.targetProj_;\n  }\n\n  /**\n   * @private\n   */\n  reproject_() {\n    const sourceState = this.sourceImage_.getState();\n    if (sourceState == ImageState.LOADED) {\n      const width = getWidth(this.targetExtent_) / this.targetResolution_;\n      const height = getHeight(this.targetExtent_) / this.targetResolution_;\n      this.canvas_ = renderReprojected(\n        width,\n        height,\n        this.sourcePixelRatio_,\n        fromResolutionLike(this.sourceImage_.getResolution()),\n        this.maxSourceExtent_,\n        this.targetResolution_,\n        this.targetExtent_,\n        this.triangulation_,\n        [\n          {\n            extent: this.sourceImage_.getExtent(),\n            image: this.sourceImage_.getImage(),\n          },\n        ],\n        0,\n        undefined,\n        this.interpolate_,\n        true,\n      );\n    }\n    this.state = sourceState;\n    this.changed();\n  }\n\n  /**\n   * Load not yet loaded URI.\n   * @override\n   */\n  load() {\n    if (this.state == ImageState.IDLE) {\n      this.state = ImageState.LOADING;\n      this.changed();\n\n      const sourceState = this.sourceImage_.getState();\n      if (sourceState == ImageState.LOADED || sourceState == ImageState.ERROR) {\n        this.reproject_();\n      } else {\n        this.sourceListenerKey_ = listen(\n          this.sourceImage_,\n          EventType.CHANGE,\n          (e) => {\n            const sourceState = this.sourceImage_.getState();\n            if (\n              sourceState == ImageState.LOADED ||\n              sourceState == ImageState.ERROR\n            ) {\n              this.unlistenSource_();\n              this.reproject_();\n            }\n          },\n        );\n        this.sourceImage_.load();\n      }\n    }\n  }\n\n  /**\n   * @private\n   */\n  unlistenSource_() {\n    unlistenByKey(\n      /** @type {!import(\"../events.js\").EventsKey} */ (\n        this.sourceListenerKey_\n      ),\n    );\n    this.sourceListenerKey_ = null;\n  }\n}\n\nexport default ReprojImage;\n","/**\n * @module ol/source/Image\n */\nimport ImageWrapper from '../Image.js';\nimport ImageState from '../ImageState.js';\nimport {linearFindNearest} from '../array.js';\nimport Event from '../events/Event.js';\nimport EventType from '../events/EventType.js';\nimport {\n  containsExtent,\n  equals,\n  getCenter,\n  getForViewAndSize,\n  getHeight,\n  getWidth,\n} from '../extent.js';\nimport {ceil} from '../math.js';\nimport {equivalent} from '../proj.js';\nimport ReprojImage from '../reproj/Image.js';\nimport {fromResolutionLike} from '../resolution.js';\nimport Source from './Source.js';\nimport {DECIMALS} from './common.js';\n\n/**\n * @enum {string}\n */\nexport const ImageSourceEventType = {\n  /**\n   * Triggered when an image starts loading.\n   * @event module:ol/source/Image.ImageSourceEvent#imageloadstart\n   * @api\n   */\n  IMAGELOADSTART: 'imageloadstart',\n\n  /**\n   * Triggered when an image finishes loading.\n   * @event module:ol/source/Image.ImageSourceEvent#imageloadend\n   * @api\n   */\n  IMAGELOADEND: 'imageloadend',\n\n  /**\n   * Triggered if image loading results in an error.\n   * @event module:ol/source/Image.ImageSourceEvent#imageloaderror\n   * @api\n   */\n  IMAGELOADERROR: 'imageloaderror',\n};\n\n/**\n * @typedef {'imageloadend'|'imageloaderror'|'imageloadstart'} ImageSourceEventTypes\n */\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/source/Image~ImageSource} instances are instances of this\n * type.\n */\nexport class ImageSourceEvent extends Event {\n  /**\n   * @param {string} type Type.\n   * @param {import(\"../Image.js\").default} image The image.\n   */\n  constructor(type, image) {\n    super(type);\n\n    /**\n     * The image related to the event.\n     * @type {import(\"../Image.js\").default}\n     * @api\n     */\n    this.image = image;\n  }\n}\n\n/***\n * @template Return\n * @typedef {import(\"../Observable\").OnSignature<import(\"../Observable\").EventTypes, import(\"../events/Event.js\").default, Return> &\n *   import(\"../Observable\").OnSignature<import(\"../ObjectEventType\").Types, import(\"../Object\").ObjectEvent, Return> &\n *   import(\"../Observable\").OnSignature<ImageSourceEventTypes, ImageSourceEvent, Return> &\n *   import(\"../Observable\").CombinedOnSignature<import(\"../Observable\").EventTypes|import(\"../ObjectEventType\").Types\n *     |ImageSourceEventTypes, Return>} ImageSourceOnSignature\n */\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {import(\"../Image.js\").Loader} [loader] Loader. Can either be a custom loader, or one of the\n * loaders created with a `createLoader()` function ({@link module:ol/source/wms.createLoader wms},\n * {@link module:ol/source/arcgisRest.createLoader arcgisRest}, {@link module:ol/source/mapguide.createLoader mapguide},\n * {@link module:ol/source/static.createLoader static}).\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Projection.\n * @property {Array<number>} [resolutions] Resolutions.\n * @property {import(\"./Source.js\").State} [state] State.\n */\n\n/**\n * @classdesc\n * Base class for sources providing a single image.\n * @fires module:ol/source/Image.ImageSourceEvent\n * @api\n */\nclass ImageSource extends Source {\n  /**\n   * @param {Options} options Single image source options.\n   */\n  constructor(options) {\n    super({\n      attributions: options.attributions,\n      projection: options.projection,\n      state: options.state,\n      interpolate:\n        options.interpolate !== undefined ? options.interpolate : true,\n    });\n\n    /***\n     * @type {ImageSourceOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.on;\n\n    /***\n     * @type {ImageSourceOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.once;\n\n    /***\n     * @type {ImageSourceOnSignature<void>}\n     */\n    this.un;\n\n    /**\n     * @protected\n     * @type {import(\"../Image.js\").Loader}\n     */\n    this.loader = options.loader || null;\n\n    /**\n     * @private\n     * @type {Array<number>|null}\n     */\n    this.resolutions_ =\n      options.resolutions !== undefined ? options.resolutions : null;\n\n    /**\n     * @private\n     * @type {import(\"../reproj/Image.js\").default}\n     */\n    this.reprojectedImage_ = null;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.reprojectedRevision_ = 0;\n\n    /**\n     * @protected\n     * @type {import(\"../Image.js\").default}\n     */\n    this.image = null;\n\n    /**\n     * @private\n     * @type {import(\"../extent.js\").Extent}\n     */\n    this.wantedExtent_;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.wantedResolution_;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.static_ = options.loader ? options.loader.length === 0 : false;\n\n    /**\n     * @private\n     * @type {import(\"../proj/Projection.js\").default}\n     */\n    this.wantedProjection_ = null;\n  }\n\n  /**\n   * @return {Array<number>|null} Resolutions.\n   * @override\n   */\n  getResolutions() {\n    return this.resolutions_;\n  }\n\n  /**\n   * @param {Array<number>|null} resolutions Resolutions.\n   */\n  setResolutions(resolutions) {\n    this.resolutions_ = resolutions;\n  }\n\n  /**\n   * @protected\n   * @param {number} resolution Resolution.\n   * @return {number} Resolution.\n   */\n  findNearestResolution(resolution) {\n    const resolutions = this.getResolutions();\n    if (resolutions) {\n      const idx = linearFindNearest(resolutions, resolution, 0);\n      resolution = resolutions[idx];\n    }\n    return resolution;\n  }\n\n  /**\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {import(\"../Image.js\").default} Single image.\n   */\n  getImage(extent, resolution, pixelRatio, projection) {\n    const sourceProjection = this.getProjection();\n    if (\n      !sourceProjection ||\n      !projection ||\n      equivalent(sourceProjection, projection)\n    ) {\n      if (sourceProjection) {\n        projection = sourceProjection;\n      }\n\n      return this.getImageInternal(extent, resolution, pixelRatio, projection);\n    }\n    if (this.reprojectedImage_) {\n      if (\n        this.reprojectedRevision_ == this.getRevision() &&\n        equivalent(this.reprojectedImage_.getProjection(), projection) &&\n        this.reprojectedImage_.getResolution() == resolution &&\n        equals(this.reprojectedImage_.getExtent(), extent)\n      ) {\n        return this.reprojectedImage_;\n      }\n      this.reprojectedImage_.dispose();\n      this.reprojectedImage_ = null;\n    }\n\n    this.reprojectedImage_ = new ReprojImage(\n      sourceProjection,\n      projection,\n      extent,\n      resolution,\n      pixelRatio,\n      (extent, resolution, pixelRatio) =>\n        this.getImageInternal(extent, resolution, pixelRatio, sourceProjection),\n      this.getInterpolate(),\n    );\n    this.reprojectedRevision_ = this.getRevision();\n\n    return this.reprojectedImage_;\n  }\n\n  /**\n   * @abstract\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {import(\"../Image.js\").default} Single image.\n   * @protected\n   */\n  getImageInternal(extent, resolution, pixelRatio, projection) {\n    if (this.loader) {\n      const requestExtent = getRequestExtent(extent, resolution, pixelRatio, 1);\n      const requestResolution = this.findNearestResolution(resolution);\n      if (\n        this.image &&\n        (this.static_ ||\n          (this.wantedProjection_ === projection &&\n            ((this.wantedExtent_ &&\n              containsExtent(this.wantedExtent_, requestExtent)) ||\n              containsExtent(this.image.getExtent(), requestExtent)) &&\n            ((this.wantedResolution_ &&\n              fromResolutionLike(this.wantedResolution_) ===\n                requestResolution) ||\n              fromResolutionLike(this.image.getResolution()) ===\n                requestResolution)))\n      ) {\n        return this.image;\n      }\n      this.wantedProjection_ = projection;\n      this.wantedExtent_ = requestExtent;\n      this.wantedResolution_ = requestResolution;\n      this.image = new ImageWrapper(\n        requestExtent,\n        requestResolution,\n        pixelRatio,\n        this.loader,\n      );\n      this.image.addEventListener(\n        EventType.CHANGE,\n        this.handleImageChange.bind(this),\n      );\n    }\n    return this.image;\n  }\n\n  /**\n   * Handle image change events.\n   * @param {import(\"../events/Event.js\").default} event Event.\n   * @protected\n   */\n  handleImageChange(event) {\n    const image = /** @type {import(\"../Image.js\").default} */ (event.target);\n    let type;\n    switch (image.getState()) {\n      case ImageState.LOADING:\n        this.loading = true;\n        type = ImageSourceEventType.IMAGELOADSTART;\n        break;\n      case ImageState.LOADED:\n        this.loading = false;\n        type = ImageSourceEventType.IMAGELOADEND;\n        break;\n      case ImageState.ERROR:\n        this.loading = false;\n        type = ImageSourceEventType.IMAGELOADERROR;\n        break;\n      default:\n        return;\n    }\n    if (this.hasListener(type)) {\n      this.dispatchEvent(new ImageSourceEvent(type, image));\n    }\n  }\n}\n\n/**\n * Default image load function for image sources that use import(\"../Image.js\").Image image\n * instances.\n * @param {import(\"../Image.js\").default} image Image.\n * @param {string} src Source.\n */\nexport function defaultImageLoadFunction(image, src) {\n  /** @type {HTMLImageElement|HTMLVideoElement} */ (image.getImage()).src = src;\n}\n\n/**\n * Adjusts the extent so it aligns with pixel boundaries.\n * @param {import(\"../extent.js\").Extent} extent Extent.\n * @param {number} resolution Reolution.\n * @param {number} pixelRatio Pixel ratio.\n * @param {number} ratio Ratio between request size and view size.\n * @return {import(\"../extent.js\").Extent} Request extent.\n */\nexport function getRequestExtent(extent, resolution, pixelRatio, ratio) {\n  const imageResolution = resolution / pixelRatio;\n  const center = getCenter(extent);\n  const viewWidth = ceil(getWidth(extent) / imageResolution, DECIMALS);\n  const viewHeight = ceil(getHeight(extent) / imageResolution, DECIMALS);\n  const marginWidth = ceil(((ratio - 1) * viewWidth) / 2, DECIMALS);\n  const requestWidth = viewWidth + 2 * marginWidth;\n  const marginHeight = ceil(((ratio - 1) * viewHeight) / 2, DECIMALS);\n  const requestHeight = viewHeight + 2 * marginHeight;\n  return getForViewAndSize(center, imageResolution, 0, [\n    requestWidth,\n    requestHeight,\n  ]);\n}\n\nexport default ImageSource;\n","/**\n * @module ol/ImageCanvas\n */\nimport ImageWrapper from './Image.js';\nimport ImageState from './ImageState.js';\n\n/**\n * A function that is called to trigger asynchronous canvas drawing.  It is\n * called with a \"done\" callback that should be called when drawing is done.\n * If any error occurs during drawing, the \"done\" callback should be called with\n * that error.\n *\n * @typedef {function(function(Error=): void): void} Loader\n */\n\nclass ImageCanvas extends ImageWrapper {\n  /**\n   * @param {import(\"./extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {HTMLCanvasElement} canvas Canvas.\n   * @param {Loader} [loader] Optional loader function to\n   *     support asynchronous canvas drawing.\n   */\n  constructor(extent, resolution, pixelRatio, canvas, loader) {\n    const state = loader !== undefined ? ImageState.IDLE : ImageState.LOADED;\n\n    super(extent, resolution, pixelRatio, state);\n\n    /**\n     * Optional canvas loader function.\n     * @type {?Loader}\n     * @private\n     */\n    this.loader_ = loader !== undefined ? loader : null;\n\n    /**\n     * @private\n     * @type {HTMLCanvasElement}\n     */\n    this.canvas_ = canvas;\n\n    /**\n     * @private\n     * @type {?Error}\n     */\n    this.error_ = null;\n  }\n\n  /**\n   * Get any error associated with asynchronous rendering.\n   * @return {?Error} Any error that occurred during rendering.\n   */\n  getError() {\n    return this.error_;\n  }\n\n  /**\n   * Handle async drawing complete.\n   * @param {Error} [err] Any error during drawing.\n   * @private\n   */\n  handleLoad_(err) {\n    if (err) {\n      this.error_ = err;\n      this.state = ImageState.ERROR;\n    } else {\n      this.state = ImageState.LOADED;\n    }\n    this.changed();\n  }\n\n  /**\n   * Load not yet loaded URI.\n   * @override\n   */\n  load() {\n    if (this.state == ImageState.IDLE) {\n      this.state = ImageState.LOADING;\n      this.changed();\n      this.loader_(this.handleLoad_.bind(this));\n    }\n  }\n\n  /**\n   * @return {HTMLCanvasElement} Canvas element.\n   * @override\n   */\n  getImage() {\n    return this.canvas_;\n  }\n}\n\nexport default ImageCanvas;\n","/**\n * @module ol/source/Raster\n */\nimport Disposable from '../Disposable.js';\nimport ImageCanvas from '../ImageCanvas.js';\nimport TileQueue from '../TileQueue.js';\nimport {createCanvasContext2D} from '../dom.js';\nimport Event from '../events/Event.js';\nimport EventType from '../events/EventType.js';\nimport {equals, getCenter, getHeight, getWidth} from '../extent.js';\nimport ImageLayer from '../layer/Image.js';\nimport TileLayer from '../layer/Tile.js';\nimport {create as createTransform} from '../transform.js';\nimport {getUid} from '../util.js';\nimport ImageSource from './Image.js';\nimport Source from './Source.js';\nimport TileSource from './Tile.js';\n\n/**\n * @typedef {Object} MinionData\n * @property {Array<ArrayBuffer>} buffers Array of buffers.\n * @property {Object} meta Operation metadata.\n * @property {boolean} imageOps The operation is an image operation.\n * @property {number} width The width of the image.\n * @property {number} height The height of the image.\n */\n\n/* istanbul ignore next */\n/**\n * Create a function for running operations.  This function is serialized for\n * use in a worker.\n * @param {function(Array, Object):*} operation The operation.\n * @return {function(MinionData):ArrayBuffer} A function that takes an object with\n * buffers, meta, imageOps, width, and height properties and returns an array\n * buffer.\n */\nfunction createMinion(operation) {\n  return function (data) {\n    // bracket notation for minification support\n    const buffers = data['buffers'];\n    const meta = data['meta'];\n    const imageOps = data['imageOps'];\n    const width = data['width'];\n    const height = data['height'];\n\n    const numBuffers = buffers.length;\n    const numBytes = buffers[0].byteLength;\n\n    if (imageOps) {\n      const images = new Array(numBuffers);\n      for (let b = 0; b < numBuffers; ++b) {\n        images[b] = new ImageData(\n          new Uint8ClampedArray(buffers[b]),\n          width,\n          height,\n        );\n      }\n      const output = operation(images, meta).data;\n      return output.buffer;\n    }\n\n    const output = new Uint8ClampedArray(numBytes);\n    const arrays = new Array(numBuffers);\n    const pixels = new Array(numBuffers);\n    for (let b = 0; b < numBuffers; ++b) {\n      arrays[b] = new Uint8ClampedArray(buffers[b]);\n      pixels[b] = [0, 0, 0, 0];\n    }\n    for (let i = 0; i < numBytes; i += 4) {\n      for (let j = 0; j < numBuffers; ++j) {\n        const array = arrays[j];\n        pixels[j][0] = array[i];\n        pixels[j][1] = array[i + 1];\n        pixels[j][2] = array[i + 2];\n        pixels[j][3] = array[i + 3];\n      }\n      const pixel = operation(pixels, meta);\n      output[i] = pixel[0];\n      output[i + 1] = pixel[1];\n      output[i + 2] = pixel[2];\n      output[i + 3] = pixel[3];\n    }\n    return output.buffer;\n  };\n}\n\n/**\n * Create a worker for running operations.\n * @param {ProcessorOptions} config Processor options.\n * @param {function(MessageEvent): void} onMessage Called with a message event.\n * @return {Worker} The worker.\n */\nfunction createWorker(config, onMessage) {\n  const lib = Object.keys(config.lib || {}).map(function (name) {\n    return 'const ' + name + ' = ' + config.lib[name].toString() + ';';\n  });\n\n  const lines = lib.concat([\n    'const __minion__ = (' + createMinion.toString() + ')(',\n    config.operation.toString(),\n    ');',\n    'self.addEventListener(\"message\", function(event) {',\n    '  const buffer = __minion__(event.data);',\n    '  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);',\n    '});',\n  ]);\n\n  const worker = new Worker(\n    typeof Blob === 'undefined'\n      ? 'data:text/javascript;base64,' +\n        Buffer.from(lines.join('\\n'), 'binary').toString('base64')\n      : URL.createObjectURL(new Blob(lines, {type: 'text/javascript'})),\n  );\n  worker.addEventListener('message', onMessage);\n  return worker;\n}\n\n/**\n * @typedef {Object} FauxMessageEvent\n * @property {Object} data Message data.\n */\n\n/**\n * Create a faux worker for running operations.\n * @param {ProcessorOptions} config Configuration.\n * @param {function(FauxMessageEvent): void} onMessage Called with a message event.\n * @return {Object} The faux worker.\n */\nfunction createFauxWorker(config, onMessage) {\n  const minion = createMinion(config.operation);\n  let terminated = false;\n  return {\n    postMessage: function (data) {\n      setTimeout(function () {\n        if (terminated) {\n          return;\n        }\n        onMessage({data: {buffer: minion(data), meta: data['meta']}});\n      }, 0);\n    },\n    terminate: function () {\n      terminated = true;\n    },\n  };\n}\n\n/**\n * @typedef {function(Error, ImageData, (Object|Array<Object>)): void} JobCallback\n */\n\n/**\n * @typedef {Object} Job\n * @property {Object} meta Job metadata.\n * @property {Array<ImageData>} inputs Array of input data.\n * @property {JobCallback} callback Called when the job is complete.\n */\n\n/**\n * @typedef {Object} ProcessorOptions\n * @property {number} threads Number of workers to spawn.\n * @property {Operation} operation The operation.\n * @property {Object<string, Function>} [lib] Functions that will be made available to operations run in a worker.\n * @property {number} queue The number of queued jobs to allow.\n * @property {boolean} [imageOps=false] Pass all the image data to the operation instead of a single pixel.\n */\n\n/**\n * @classdesc\n * A processor runs pixel or image operations in workers.\n */\nexport class Processor extends Disposable {\n  /**\n   * @param {ProcessorOptions} config Configuration.\n   */\n  constructor(config) {\n    super();\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.imageOps_ = !!config.imageOps;\n    let threads;\n    if (config.threads === 0) {\n      threads = 0;\n    } else if (this.imageOps_) {\n      threads = 1;\n    } else {\n      threads = config.threads || 1;\n    }\n\n    /**\n     * @type {Array<Worker>}\n     */\n    const workers = new Array(threads);\n    if (threads) {\n      for (let i = 0; i < threads; ++i) {\n        workers[i] = createWorker(config, this.onWorkerMessage_.bind(this, i));\n      }\n    } else {\n      workers[0] = createFauxWorker(\n        config,\n        this.onWorkerMessage_.bind(this, 0),\n      );\n    }\n    /**\n     * @type {Array<Worker>}\n     * @private\n     */\n    this.workers_ = workers;\n\n    /**\n     * @type {Array<Job>}\n     * @private\n     */\n    this.queue_ = [];\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.maxQueueLength_ = config.queue || Infinity;\n    /**\n     * @type {number}\n     * @private\n     */\n    this.running_ = 0;\n\n    /**\n     * @type {Object<number, any>}\n     * @private\n     */\n    this.dataLookup_ = {};\n\n    /**\n     * @type {Job|null}\n     * @private\n     */\n    this.job_ = null;\n  }\n\n  /**\n   * Run operation on input data.\n   * @param {Array<ImageData>} inputs Array of image data.\n   * @param {Object} meta A user data object.  This is passed to all operations\n   *     and must be serializable.\n   * @param {function(Error, ImageData, Object): void} callback Called when work\n   *     completes.  The first argument is any error.  The second is the ImageData\n   *     generated by operations.  The third is the user data object.\n   */\n  process(inputs, meta, callback) {\n    this.enqueue_({\n      inputs: inputs,\n      meta: meta,\n      callback: callback,\n    });\n    this.dispatch_();\n  }\n\n  /**\n   * Add a job to the queue.\n   * @param {Job} job The job.\n   */\n  enqueue_(job) {\n    this.queue_.push(job);\n    while (this.queue_.length > this.maxQueueLength_) {\n      this.queue_.shift().callback(null, null);\n    }\n  }\n\n  /**\n   * Dispatch a job.\n   */\n  dispatch_() {\n    if (this.running_ || this.queue_.length === 0) {\n      return;\n    }\n\n    const job = this.queue_.shift();\n    this.job_ = job;\n    const width = job.inputs[0].width;\n    const height = job.inputs[0].height;\n    const buffers = job.inputs.map(function (input) {\n      return input.data.buffer;\n    });\n    const threads = this.workers_.length;\n    this.running_ = threads;\n    if (threads === 1) {\n      this.workers_[0].postMessage(\n        {\n          buffers: buffers,\n          meta: job.meta,\n          imageOps: this.imageOps_,\n          width: width,\n          height: height,\n        },\n        buffers,\n      );\n      return;\n    }\n\n    const length = job.inputs[0].data.length;\n    const segmentLength = 4 * Math.ceil(length / 4 / threads);\n    for (let i = 0; i < threads; ++i) {\n      const offset = i * segmentLength;\n      const slices = [];\n      for (let j = 0, jj = buffers.length; j < jj; ++j) {\n        slices.push(buffers[j].slice(offset, offset + segmentLength));\n      }\n      this.workers_[i].postMessage(\n        {\n          buffers: slices,\n          meta: job.meta,\n          imageOps: this.imageOps_,\n          width: width,\n          height: height,\n        },\n        slices,\n      );\n    }\n  }\n\n  /**\n   * Handle messages from the worker.\n   * @param {number} index The worker index.\n   * @param {MessageEvent} event The message event.\n   */\n  onWorkerMessage_(index, event) {\n    if (this.disposed) {\n      return;\n    }\n    this.dataLookup_[index] = event.data;\n    --this.running_;\n    if (this.running_ === 0) {\n      this.resolveJob_();\n    }\n  }\n\n  /**\n   * Resolve a job.  If there are no more worker threads, the processor callback\n   * will be called.\n   */\n  resolveJob_() {\n    const job = this.job_;\n    const threads = this.workers_.length;\n    let data, meta;\n    if (threads === 1) {\n      data = new Uint8ClampedArray(this.dataLookup_[0]['buffer']);\n      meta = this.dataLookup_[0]['meta'];\n    } else {\n      const length = job.inputs[0].data.length;\n      data = new Uint8ClampedArray(length);\n      meta = new Array(threads);\n      const segmentLength = 4 * Math.ceil(length / 4 / threads);\n      for (let i = 0; i < threads; ++i) {\n        const buffer = this.dataLookup_[i]['buffer'];\n        const offset = i * segmentLength;\n        data.set(new Uint8ClampedArray(buffer), offset);\n        meta[i] = this.dataLookup_[i]['meta'];\n      }\n    }\n    this.job_ = null;\n    this.dataLookup_ = {};\n    job.callback(\n      null,\n      new ImageData(data, job.inputs[0].width, job.inputs[0].height),\n      meta,\n    );\n    this.dispatch_();\n  }\n\n  /**\n   * Terminate all workers associated with the processor.\n   * @override\n   */\n  disposeInternal() {\n    for (let i = 0; i < this.workers_.length; ++i) {\n      this.workers_[i].terminate();\n    }\n    this.workers_.length = 0;\n  }\n}\n\n/**\n * A function that takes an array of input data, performs some operation, and\n * returns an array of output data.\n * For `pixel` type operations, the function will be called with an array of\n * pixels, where each pixel is an array of four numbers (`[r, g, b, a]`) in the\n * range of 0 - 255. It should return a single pixel array.\n * For `'image'` type operations, functions will be called with an array of\n * [ImageData](https://developer.mozilla.org/en-US/docs/Web/API/ImageData)\n * and should return a single\n * [ImageData](https://developer.mozilla.org/en-US/docs/Web/API/ImageData).\n * The operations\n * are called with a second \"data\" argument, which can be used for storage.  The\n * data object is accessible from raster events, where it can be initialized in\n * \"beforeoperations\" and accessed again in \"afteroperations\".\n *\n * @typedef {function((Array<Array<number>>|Array<ImageData>), Object):\n *     (Array<number>|ImageData)} Operation\n */\n\n/**\n * @enum {string}\n */\nconst RasterEventType = {\n  /**\n   * Triggered before operations are run.  Listeners will receive an event object with\n   * a `data` property that can be used to make data available to operations.\n   * @event module:ol/source/Raster.RasterSourceEvent#beforeoperations\n   * @api\n   */\n  BEFOREOPERATIONS: 'beforeoperations',\n\n  /**\n   * Triggered after operations are run.  Listeners will receive an event object with\n   * a `data` property.  If more than one thread is used, `data` will be an array of\n   * objects.  If a single thread is used, `data` will be a single object.\n   * @event module:ol/source/Raster.RasterSourceEvent#afteroperations\n   * @api\n   */\n  AFTEROPERATIONS: 'afteroperations',\n};\n\n/**\n * @typedef {'pixel' | 'image'} RasterOperationType\n * Raster operation type. Supported values are `'pixel'` and `'image'`.\n */\n\n/**\n * @typedef {import(\"./Image.js\").ImageSourceEventTypes|'beforeoperations'|'afteroperations'} RasterSourceEventTypes\n */\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/source/Raster~RasterSource} instances are instances of this\n * type.\n */\nexport class RasterSourceEvent extends Event {\n  /**\n   * @param {string} type Type.\n   * @param {import(\"../Map.js\").FrameState} frameState The frame state.\n   * @param {Object|Array<Object>} data An object made available to operations.  For \"afteroperations\" evenets\n   * this will be an array of objects if more than one thread is used.\n   */\n  constructor(type, frameState, data) {\n    super(type);\n\n    /**\n     * The raster extent.\n     * @type {import(\"../extent.js\").Extent}\n     * @api\n     */\n    this.extent = frameState.extent;\n\n    /**\n     * The pixel resolution (map units per pixel).\n     * @type {number}\n     * @api\n     */\n    this.resolution = frameState.viewState.resolution / frameState.pixelRatio;\n\n    /**\n     * An object made available to all operations.  This can be used by operations\n     * as a storage object (e.g. for calculating statistics).\n     * @type {Object}\n     * @api\n     */\n    this.data = data;\n  }\n}\n\n/**\n * @typedef {Object} Options\n * @property {Array<import(\"./Source.js\").default|import(\"../layer/Layer.js\").default>} sources Input\n * sources or layers.  For vector data, use an VectorImage layer.\n * @property {Operation} [operation] Raster operation.\n * The operation will be called with data from input sources\n * and the output will be assigned to the raster source.\n * @property {Object} [lib] Functions that will be made available to operations run in a worker.\n * @property {number} [threads] By default, operations will be run in a single worker thread.\n * To avoid using workers altogether, set `threads: 0`.  For pixel operations, operations can\n * be run in multiple worker threads.  Note that there is additional overhead in\n * transferring data to multiple workers, and that depending on the user's\n * system, it may not be possible to parallelize the work.\n * @property {RasterOperationType} [operationType='pixel'] Operation type.\n * Supported values are `'pixel'` and `'image'`.  By default,\n * `'pixel'` operations are assumed, and operations will be called with an\n * array of pixels from input sources.  If set to `'image'`, operations will\n * be called with an array of ImageData objects from input sources.\n * @property {Array<number>|null} [resolutions] Resolutions. If specified, raster operations will only\n * be run at the given resolutions.  By default, the resolutions of the first source with resolutions\n * specified will be used, if any. Set to `null` to use any view resolution instead.\n */\n\n/***\n * @template Return\n * @typedef {import(\"../Observable\").OnSignature<import(\"../Observable\").EventTypes, import(\"../events/Event.js\").default, Return> &\n *   import(\"../Observable\").OnSignature<import(\"../ObjectEventType\").Types, import(\"../Object\").ObjectEvent, Return> &\n *   import(\"../Observable\").OnSignature<import(\"./Image.js\").ImageSourceEventTypes, import(\"./Image.js\").ImageSourceEvent, Return> &\n *   import(\"../Observable\").OnSignature<RasterSourceEventTypes, RasterSourceEvent, Return> &\n *   import(\"../Observable\").CombinedOnSignature<import(\"../Observable\").EventTypes|import(\"../ObjectEventType\").Types\n *     |RasterSourceEventTypes, Return>} RasterSourceOnSignature\n */\n\n/**\n * @classdesc\n * A source that transforms data from any number of input sources using an\n * {@link module:ol/source/Raster~Operation} function to transform input pixel values into\n * output pixel values.\n *\n * @fires module:ol/source/Raster.RasterSourceEvent\n * @api\n */\nclass RasterSource extends ImageSource {\n  /**\n   * @param {Options} options Options.\n   */\n  constructor(options) {\n    super({\n      projection: null,\n    });\n\n    /***\n     * @type {RasterSourceOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.on;\n\n    /***\n     * @type {RasterSourceOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.once;\n\n    /***\n     * @type {RasterSourceOnSignature<void>}\n     */\n    this.un;\n\n    /**\n     * @private\n     * @type {Processor}\n     */\n    this.processor_ = null;\n\n    /**\n     * @private\n     * @type {RasterOperationType}\n     */\n    this.operationType_ =\n      options.operationType !== undefined ? options.operationType : 'pixel';\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.threads_ = options.threads !== undefined ? options.threads : 1;\n\n    /**\n     * @private\n     * @type {Array<import(\"../layer/Layer.js\").default>}\n     */\n    this.layers_ = createLayers(options.sources);\n\n    const changed = this.changed.bind(this);\n    for (let i = 0, ii = this.layers_.length; i < ii; ++i) {\n      this.layers_[i].addEventListener(EventType.CHANGE, changed);\n    }\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.useResolutions_ = options.resolutions !== null;\n\n    /**\n     * @private\n     * @type {import(\"../TileQueue.js\").default}\n     */\n    this.tileQueue_ = new TileQueue(function () {\n      return 1;\n    }, this.processSources_.bind(this));\n\n    /**\n     * The most recently requested frame state.\n     * @type {import(\"../Map.js\").FrameState}\n     * @private\n     */\n    this.requestedFrameState_;\n\n    /**\n     * The most recently rendered image canvas.\n     * @type {import(\"../ImageCanvas.js\").default}\n     * @private\n     */\n    this.renderedImageCanvas_ = null;\n\n    /**\n     * The most recently rendered revision.\n     * @type {number}\n     * @private\n     */\n    this.renderedRevision_;\n\n    /**\n     * @private\n     * @type {import(\"../Map.js\").FrameState}\n     */\n    this.frameState_ = {\n      animate: false,\n      coordinateToPixelTransform: createTransform(),\n      declutter: null,\n      extent: null,\n      index: 0,\n      layerIndex: 0,\n      layerStatesArray: getLayerStatesArray(this.layers_),\n      pixelRatio: 1,\n      pixelToCoordinateTransform: createTransform(),\n      postRenderFunctions: [],\n      size: [0, 0],\n      tileQueue: this.tileQueue_,\n      time: Date.now(),\n      usedTiles: {},\n      viewState: /** @type {import(\"../View.js\").State} */ ({\n        rotation: 0,\n      }),\n      viewHints: [],\n      wantedTiles: {},\n      mapId: getUid(this),\n      renderTargets: {},\n    };\n\n    this.setAttributions(function (frameState) {\n      /** @type {Array<string>} */\n      const attributions = [];\n      for (let i = 0, iMax = options.sources.length; i < iMax; ++i) {\n        const sourceOrLayer = options.sources[i];\n        const source =\n          sourceOrLayer instanceof Source\n            ? sourceOrLayer\n            : sourceOrLayer.getSource();\n        if (!source) {\n          continue;\n        }\n        const sourceAttributions = source.getAttributions()?.(frameState);\n        if (typeof sourceAttributions === 'string') {\n          attributions.push(sourceAttributions);\n        } else if (sourceAttributions !== undefined) {\n          attributions.push(...sourceAttributions);\n        }\n      }\n      return attributions;\n    });\n\n    if (options.operation !== undefined) {\n      this.setOperation(options.operation, options.lib);\n    }\n  }\n\n  /**\n   * Set the operation.\n   * @param {Operation} operation New operation.\n   * @param {Object} [lib] Functions that will be available to operations run\n   *     in a worker.\n   * @api\n   */\n  setOperation(operation, lib) {\n    if (this.processor_) {\n      this.processor_.dispose();\n    }\n\n    this.processor_ = new Processor({\n      operation: operation,\n      imageOps: this.operationType_ === 'image',\n      queue: 1,\n      lib: lib,\n      threads: this.threads_,\n    });\n    this.changed();\n  }\n\n  /**\n   * Update the stored frame state.\n   * @param {import(\"../extent.js\").Extent} extent The view extent (in map units).\n   * @param {number} resolution The view resolution.\n   * @param {import(\"../proj/Projection.js\").default} projection The view projection.\n   * @return {import(\"../Map.js\").FrameState} The updated frame state.\n   * @private\n   */\n  updateFrameState_(extent, resolution, projection) {\n    const frameState = /** @type {import(\"../Map.js\").FrameState} */ (\n      Object.assign({}, this.frameState_)\n    );\n\n    frameState.viewState = /** @type {import(\"../View.js\").State} */ (\n      Object.assign({}, frameState.viewState)\n    );\n\n    const center = getCenter(extent);\n\n    frameState.size[0] = Math.ceil(getWidth(extent) / resolution);\n    frameState.size[1] = Math.ceil(getHeight(extent) / resolution);\n    frameState.extent = [\n      center[0] - (frameState.size[0] * resolution) / 2,\n      center[1] - (frameState.size[1] * resolution) / 2,\n      center[0] + (frameState.size[0] * resolution) / 2,\n      center[1] + (frameState.size[1] * resolution) / 2,\n    ];\n    frameState.time = Date.now();\n\n    const viewState = frameState.viewState;\n    viewState.center = center;\n    viewState.projection = projection;\n    viewState.resolution = resolution;\n    return frameState;\n  }\n\n  /**\n   * Determine if all sources are ready.\n   * @return {boolean} All sources are ready.\n   * @private\n   */\n  allSourcesReady_() {\n    let ready = true;\n    let source;\n    for (let i = 0, ii = this.layers_.length; i < ii; ++i) {\n      source = this.layers_[i].getSource();\n      if (!source || source.getState() !== 'ready') {\n        ready = false;\n        break;\n      }\n    }\n    return ready;\n  }\n\n  /**\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {import(\"../ImageCanvas.js\").default} Single image.\n   * @override\n   */\n  getImage(extent, resolution, pixelRatio, projection) {\n    if (!this.allSourcesReady_()) {\n      return null;\n    }\n\n    this.tileQueue_.loadMoreTiles(16, 16);\n\n    resolution = this.findNearestResolution(resolution);\n    const frameState = this.updateFrameState_(extent, resolution, projection);\n    this.requestedFrameState_ = frameState;\n\n    // check if we can't reuse the existing ol/ImageCanvas\n    if (this.renderedImageCanvas_) {\n      const renderedResolution = this.renderedImageCanvas_.getResolution();\n      const renderedExtent = this.renderedImageCanvas_.getExtent();\n      if (\n        resolution !== renderedResolution ||\n        !equals(frameState.extent, renderedExtent)\n      ) {\n        this.renderedImageCanvas_ = null;\n      }\n    }\n\n    if (\n      !this.renderedImageCanvas_ ||\n      this.getRevision() !== this.renderedRevision_\n    ) {\n      this.processSources_();\n    }\n\n    if (frameState.animate) {\n      requestAnimationFrame(this.changed.bind(this));\n    }\n\n    return this.renderedImageCanvas_;\n  }\n\n  /**\n   * Start processing source data.\n   * @private\n   */\n  processSources_() {\n    const frameState = this.requestedFrameState_;\n    const len = this.layers_.length;\n    const imageDatas = new Array(len);\n    for (let i = 0; i < len; ++i) {\n      frameState.layerIndex = i;\n      frameState.renderTargets = {};\n      const imageData = getImageData(this.layers_[i], frameState);\n      if (imageData) {\n        imageDatas[i] = imageData;\n      } else {\n        return;\n      }\n    }\n\n    const data = {};\n    this.dispatchEvent(\n      new RasterSourceEvent(RasterEventType.BEFOREOPERATIONS, frameState, data),\n    );\n    this.processor_.process(\n      imageDatas,\n      data,\n      this.onWorkerComplete_.bind(this, frameState),\n    );\n  }\n\n  /**\n   * Called when pixel processing is complete.\n   * @param {import(\"../Map.js\").FrameState} frameState The frame state.\n   * @param {Error} err Any error during processing.\n   * @param {ImageData} output The output image data.\n   * @param {Object|Array<Object>} data The user data (or an array if more than one thread).\n   * @private\n   */\n  onWorkerComplete_(frameState, err, output, data) {\n    if (err || !output) {\n      return;\n    }\n\n    // do nothing if extent or resolution changed\n    const extent = frameState.extent;\n    const resolution = frameState.viewState.resolution;\n    if (\n      resolution !== this.requestedFrameState_.viewState.resolution ||\n      !equals(extent, this.requestedFrameState_.extent)\n    ) {\n      return;\n    }\n\n    let context;\n    if (this.renderedImageCanvas_) {\n      context = this.renderedImageCanvas_.getImage().getContext('2d');\n    } else {\n      const width = Math.round(getWidth(extent) / resolution);\n      const height = Math.round(getHeight(extent) / resolution);\n      context = createCanvasContext2D(width, height);\n      this.renderedImageCanvas_ = new ImageCanvas(\n        extent,\n        resolution,\n        1,\n        context.canvas,\n      );\n    }\n    context.putImageData(output, 0, 0);\n\n    if (frameState.animate) {\n      requestAnimationFrame(this.changed.bind(this));\n    } else {\n      this.changed();\n    }\n    this.renderedRevision_ = this.getRevision();\n\n    this.dispatchEvent(\n      new RasterSourceEvent(RasterEventType.AFTEROPERATIONS, frameState, data),\n    );\n  }\n\n  /**\n   * @param {import(\"../proj/Projection\").default} [projection] Projection.\n   * @return {Array<number>|null} Resolutions.\n   * @override\n   */\n  getResolutions(projection) {\n    if (!this.useResolutions_) {\n      return null;\n    }\n    let resolutions = super.getResolutions();\n    if (!resolutions) {\n      for (let i = 0, ii = this.layers_.length; i < ii; ++i) {\n        const source = this.layers_[i].getSource();\n        resolutions = source.getResolutions(projection);\n        if (resolutions) {\n          break;\n        }\n      }\n    }\n    return resolutions;\n  }\n\n  /**\n   * @override\n   */\n  disposeInternal() {\n    if (this.processor_) {\n      this.processor_.dispose();\n    }\n    super.disposeInternal();\n  }\n}\n\n/**\n * Clean up and unregister the worker.\n * @function\n * @api\n */\nRasterSource.prototype.dispose;\n\n/**\n * A reusable canvas context.\n * @type {CanvasRenderingContext2D}\n * @private\n */\nlet sharedContext = null;\n\n/**\n * Get image data from a layer.\n * @param {import(\"../layer/Layer.js\").default} layer Layer to render.\n * @param {import(\"../Map.js\").FrameState} frameState The frame state.\n * @return {ImageData} The image data.\n */\nfunction getImageData(layer, frameState) {\n  const renderer = layer.getRenderer();\n  if (!renderer) {\n    throw new Error('Unsupported layer type: ' + layer);\n  }\n\n  if (!renderer.prepareFrame(frameState)) {\n    return null;\n  }\n  const width = frameState.size[0];\n  const height = frameState.size[1];\n  if (width === 0 || height === 0) {\n    return null;\n  }\n  const container = renderer.renderFrame(frameState, null);\n  let element;\n  if (container instanceof HTMLCanvasElement) {\n    element = container;\n  } else {\n    if (container) {\n      element = container.firstElementChild;\n    }\n    if (!(element instanceof HTMLCanvasElement)) {\n      throw new Error('Unsupported rendered element: ' + element);\n    }\n    if (element.width === width && element.height === height) {\n      const context = element.getContext('2d');\n      return context.getImageData(0, 0, width, height);\n    }\n  }\n\n  if (!sharedContext) {\n    sharedContext = createCanvasContext2D(width, height, undefined, {\n      willReadFrequently: true,\n    });\n  } else {\n    const canvas = sharedContext.canvas;\n    if (canvas.width !== width || canvas.height !== height) {\n      sharedContext = createCanvasContext2D(width, height, undefined, {\n        willReadFrequently: true,\n      });\n    } else {\n      sharedContext.clearRect(0, 0, width, height);\n    }\n  }\n  sharedContext.drawImage(element, 0, 0, width, height);\n  return sharedContext.getImageData(0, 0, width, height);\n}\n\n/**\n * Get a list of layer states from a list of layers.\n * @param {Array<import(\"../layer/Layer.js\").default>} layers Layers.\n * @return {Array<import(\"../layer/Layer.js\").State>} The layer states.\n */\nfunction getLayerStatesArray(layers) {\n  return layers.map(function (layer) {\n    return layer.getLayerState();\n  });\n}\n\n/**\n * Create layers for all sources.\n * @param {Array<import(\"./Source.js\").default|import(\"../layer/Layer.js\").default>} sources The sources.\n * @return {Array<import(\"../layer/Layer.js\").default>} Array of layers.\n */\nfunction createLayers(sources) {\n  const len = sources.length;\n  const layers = new Array(len);\n  for (let i = 0; i < len; ++i) {\n    layers[i] = createLayer(sources[i]);\n  }\n  return layers;\n}\n\n/**\n * Create a layer for the provided source.\n * @param {import(\"./Source.js\").default|import(\"../layer/Layer.js\").default} layerOrSource The layer or source.\n * @return {import(\"../layer/Layer.js\").default} The layer.\n */\nfunction createLayer(layerOrSource) {\n  // @type {import(\"../layer/Layer.js\").default}\n  let layer;\n  if (layerOrSource instanceof Source) {\n    if (layerOrSource instanceof TileSource) {\n      layer = new TileLayer({source: layerOrSource});\n    } else if (layerOrSource instanceof ImageSource) {\n      layer = new ImageLayer({source: layerOrSource});\n    }\n  } else {\n    layer = layerOrSource;\n  }\n  return layer;\n}\n\nexport default RasterSource;\n","/**\n * @module ol/source/common\n */\n\n/**\n * Default WMS version.\n * @type {string}\n */\nexport const DEFAULT_WMS_VERSION = '1.3.0';\n\n/**\n * Number of decimal digits to consider in integer values when rounding.\n * @type {number}\n */\nexport const DECIMALS = 4;\n"],"names":["ImageWrapper","extent","resolution","pixelRatio","stateOrLoader","requestResolution","Array","image","HTMLImageElement","ImageBitmap","HTMLCanvasElement","HTMLVideoElement","error","console","listenImage","loadHandler","errorHandler","listening","decoding","loaded","listenerKeys","img","decodeFallback","src","Promise","resolve","reject","e","handleLoad","unlisten","handleError","Error","decode","createImageBitmap","DROP","Infinity","PriorityQueue","priorityFunction","keyFunction","elements","priorities","element","elementKey","priority","index","i","key","count","startIndex","lIndex","rIndex","smallerChildIndex","parentIndex","n","TileQueue","tilePriorityFunction","tileChangeCallback","added","tile","EventType","event","state","TileState","tileKey","maxTotalLoading","maxNewLoads","newLoads","getTilePriority","frameState","tileSourceKey","tileCenter","tileResolution","center","deltaX","deltaY","Math","CanvasImageLayerRenderer","imageLayer","layerState","viewState","viewResolution","imageSource","hints","renderedExtent","undefined","ViewHint","projection","ImageState","pixel","layer","coordinate","layerExtent","imageExtent","imageMapWidth","col","imageMapHeight","row","target","imageResolution","imageResolutionX","imageResolutionY","imagePixelRatio","viewCenter","width","height","context","clipped","render","transform","dw","dh","dx","dy","opacity","BaseImageLayer","options","BaseImage","BaseTileLayer","Layer","baseOptions","Object","cacheSize","TileProperty","preload","useInterimTilesOnError","BaseTile","fromResolutionLike","ReprojImage","Image","sourceProj","targetProj","targetExtent","targetResolution","getImageFunction","interpolate","maxSourceExtent","maxTargetExtent","limitedTargetExtent","targetCenter","sourceResolution","errorThresholdInPixels","triangulation","Triangulation","sourceExtent","sourceImage","sourcePixelRatio","sourceState","ImageSourceEventType","ImageSourceEvent","Event","type","ImageSource","Source","resolutions","idx","sourceProjection","requestExtent","getRequestExtent","defaultImageLoadFunction","ratio","viewWidth","viewHeight","marginWidth","marginHeight","ImageCanvas","canvas","loader","err","createMinion","operation","data","buffers","meta","imageOps","numBuffers","numBytes","images","b","ImageData","Uint8ClampedArray","output","arrays","pixels","j","array","Processor","Disposable","config","threads","workers","createWorker","onMessage","lines","lib","name","worker","Worker","Blob","Buffer","URL","createFauxWorker","minion","terminated","setTimeout","inputs","callback","job","input","segmentLength","length","offset","slices","jj","buffer","RasterSourceEvent","RasterSource","createLayers","sources","len","layers","createLayer","layerOrSource","Tile","changed","ii","getLayerStatesArray","Date","attributions","iMax","sourceOrLayer","source","sourceAttributions","ready","renderedResolution","requestAnimationFrame","imageDatas","imageData","getImageData","renderer","container","sharedContext","DECIMALS"],"mappings":"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"}