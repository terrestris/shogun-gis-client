"use strict";(self.webpackChunk_terrestris_shogun_gis_client=self.webpackChunk_terrestris_shogun_gis_client||[]).push([["2803"],{28799:function(e,t,r){r.r(t),r.d(t,{default:function(){return R}});var i=r("93564"),n=r("82928"),s=r("4722"),a=r("82777"),h=r("97208"),l=r("6908"),o=r("17356"),d=r("21915"),c=r("85386"),u=r("43631"),g=r("79682"),p=r("5374"),_=r("49179"),x=r("90728");class f extends s.Z{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=(0,d.createEmpty)(),this.wrappedRenderedExtent_=(0,d.createEmpty)(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(e,t,r){let i=t.extent,n=t.viewState,s=n.center,h=n.resolution,o=n.projection,c=n.rotation,u=o.getExtent(),g=this.getLayer().getSource(),p=this.getLayer().getDeclutter(),_=t.pixelRatio,x=t.viewHints,f=!(x[l.Z.ANIMATING]||x[l.Z.INTERACTING]),y=this.context,R=Math.round((0,d.getWidth)(i)/h*_),m=Math.round((0,d.getHeight)(i)/h*_),C=g.getWrapX()&&o.canWrapX(),D=C?(0,d.getWidth)(u):null,E=C?Math.ceil((i[2]-u[2])/D)+1:1,I=C?Math.floor((i[0]-u[0])/D):0;do{let i=this.getRenderTransform(s,h,0,_,R,m,I*D);t.declutter&&(i=i.slice(0)),e.execute(y,[y.canvas.width,y.canvas.height],i,c,f,void 0===r?a.QN:r?a.o5:a.eV,r?p&&t.declutter[p]:void 0)}while(++I<E)}setDrawContext_(){1!==this.opacity_&&(this.targetContext_=this.context,this.context=(0,c.E4)(this.context.canvas.width,this.context.canvas.height,s.r))}resetDrawContext_(){if(1!==this.opacity_){let e=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=e,(0,c.jy)(this.context),s.r.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(e){if(!!this.replayGroup_&&!!this.getLayer().getDeclutter())this.renderWorlds(this.replayGroup_,e,!0)}renderDeferredInternal(e){if(!!this.replayGroup_)this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_()}renderFrame(e,t){let r=e.layerStatesArray[e.layerIndex];this.opacity_=r.opacity;let i=e.viewState;this.prepareContainer(e,t);let n=this.context,s=this.replayGroup_,a=s&&!s.isEmpty();if(!a&&!(this.getLayer().hasListener(h.Z.PRERENDER)||this.getLayer().hasListener(h.Z.POSTRENDER)))return null;this.setDrawContext_(),this.preRender(n,e);let l=i.projection;if(this.clipped_=!1,a&&r.extent&&this.clipping){let t=(0,p.fromUserExtent)(r.extent,l);a=(0,d.intersects)(t,e.extent),this.clipped_=a&&!(0,d.containsExtent)(t,e.extent),this.clipped_&&this.clipUnrotated(n,e,t)}return a&&this.renderWorlds(s,e,!this.getLayer().getDeclutter()&&void 0),!e.declutter&&this.clipped_&&n.restore(),this.postRender(n,e),this.renderedRotation_!==i.rotation&&(this.renderedRotation_=i.rotation,this.hitDetectionImageData_=null),!e.declutter&&this.resetDrawContext_(),this.container}getFeatures(e){return new Promise(t=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){let e=this.frameState.size.slice(),t=this.renderedCenter_,r=this.renderedResolution_,i=this.renderedRotation_,n=this.renderedProjection_,s=this.wrappedRenderedExtent_,a=this.getLayer(),h=[],l=e[0]*o.UN,c=e[1]*o.UN;h.push(this.getRenderTransform(t,r,i,o.UN,l,c,0).slice());let g=a.getSource(),_=n.getExtent();if(g.getWrapX()&&n.canWrapX()&&!(0,d.containsExtent)(_,s)){let e,n=s[0],a=(0,d.getWidth)(_),u=0;for(;n<_[0];)e=a*--u,h.push(this.getRenderTransform(t,r,i,o.UN,l,c,e).slice()),n+=a;for(u=0,n=s[2];n>_[2];)e=a*++u,h.push(this.getRenderTransform(t,r,i,o.UN,l,c,e).slice()),n-=a}let x=(0,p.getUserProjection)();this.hitDetectionImageData_=(0,o.TU)(e,h,this.renderedFeatures_,a.getStyleFunction(),s,r,i,(0,u.se)(r,this.renderedPixelRatio_),x?n:null)}t((0,o.ix)(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,t,r,i,n){if(!this.replayGroup_)return;let s=t.viewState.resolution,a=t.viewState.rotation,h=this.getLayer(),l={},o=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(e,s,a,r,function(e,t,r){let s=(0,_.getUid)(e),a=l[s];if(a){if(!0!==a&&r<a.distanceSq){if(0===r)return l[s]=!0,n.splice(n.lastIndexOf(a),1),i(e,h,t);a.geometry=t,a.distanceSq=r}}else{if(0===r)return l[s]=!0,i(e,h,t);n.push(l[s]={feature:e,layer:h,geometry:t,distanceSq:r,callback:i})}},o?t.declutter[o].all().map(e=>e.value):null)}handleFontsChanged(){let e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){let t;let r=this.getLayer(),i=r.getSource();if(!i)return!1;let s=e.viewHints[l.Z.ANIMATING],h=e.viewHints[l.Z.INTERACTING],o=r.getUpdateWhileAnimating(),c=r.getUpdateWhileInteracting();if(this.ready&&!o&&s||!c&&h)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;let _=e.extent,f=e.viewState,y=f.projection,R=f.resolution,m=e.pixelRatio,C=r.getRevision(),D=r.getRenderBuffer(),E=r.getRenderOrder();void 0===E&&(E=u.eR);let I=f.center.slice(),w=(0,d.buffer)(_,D*R),v=w.slice(),S=[w.slice()],F=y.getExtent();if(i.getWrapX()&&y.canWrapX()&&!(0,d.containsExtent)(F,e.extent)){let e=(0,d.getWidth)(F),t=Math.max((0,d.getWidth)(w)/2,e);w[0]=F[0]-t,w[2]=F[2]+t,(0,x.wrapX)(I,y);let r=(0,d.wrapX)(S[0],y);r[0]<F[0]&&r[2]<F[2]?S.push([r[0]+e,r[1],r[2]+e,r[3]]):r[0]>F[0]&&r[2]>F[2]&&S.push([r[0]-e,r[1],r[2]-e,r[3]])}if(this.ready&&this.renderedResolution_==R&&this.renderedRevision_==C&&this.renderedRenderOrder_==E&&!!e.declutter===this.renderedFrameDeclutter_&&(0,d.containsExtent)(this.wrappedRenderedExtent_,w))return!(0,g.fS)(this.renderedExtent_,v)&&(this.hitDetectionImageData_=null,this.renderedExtent_=v),this.renderedCenter_=I,this.replayGroupChanged=!1,!0;this.replayGroup_=null;let G=new n.Z((0,u.Qz)(R,m),w,R,m),N=(0,p.getUserProjection)();if(N){for(let e=0,t=S.length;e<t;++e){let t=S[e],r=(0,p.toUserExtent)(t,y);i.loadFeatures(r,(0,p.toUserResolution)(R,y),N)}t=(0,p.getTransformFromProjections)(N,y)}else for(let e=0,t=S.length;e<t;++e)i.loadFeatures(S[e],R,y);let A=(0,u.se)(R,m),U=!0,W=(e,i)=>{let n;let s=e.getStyleFunction()||r.getStyleFunction();if(s&&(n=s(e,R)),n){let r=this.renderFeature(e,A,n,G,t,this.getLayer().getDeclutter(),i);U=U&&!r}},P=(0,p.toUserExtent)(w,y),L=i.getFeaturesInExtent(P);E&&L.sort(E);for(let e=0,t=L.length;e<t;++e)W(L[e],e);this.renderedFeatures_=L,this.ready=U;let b=G.finish(),T=new a.ZP(w,R,m,i.getOverlaps(),b,r.getRenderBuffer(),!!e.declutter);return this.renderedResolution_=R,this.renderedRevision_=C,this.renderedRenderOrder_=E,this.renderedFrameDeclutter_=!!e.declutter,this.renderedExtent_=v,this.wrappedRenderedExtent_=w,this.renderedCenter_=I,this.renderedProjection_=y,this.renderedPixelRatio_=m,this.replayGroup_=T,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,r,i,n,s,a){if(!r)return!1;let h=!1;if(Array.isArray(r))for(let l=0,o=r.length;l<o;++l)h=(0,u.Pn)(i,e,r[l],t,this.boundHandleStyleImageChange_,n,s,a)||h;else h=(0,u.Pn)(i,e,r,t,this.boundHandleStyleImageChange_,n,s,a);return h}}class y extends i.Z{constructor(e){super(e)}createRenderer(){return new f(this)}}var R=y}}]);
//# sourceMappingURL=2803.0c30c6279ed865cb.js.map