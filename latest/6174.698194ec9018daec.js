"use strict";(self.webpackChunk_terrestris_shogun_gis_client=self.webpackChunk_terrestris_shogun_gis_client||[]).push([["6174"],{2022:function(e,t,i){i.d(t,{Jx:function(){return g},Kp:function(){return u},Q9:function(){return d}});var s=i(11256),n=i(73381),r=i(66575),a=i(13002),o=i(64011),l=i(91358);class h extends r.Z{constructor(e,t,i,n){super(),this.extent=e,this.pixelRatio_=i,this.resolution=t,this.state="function"==typeof n?s.default.IDLE:n,this.image_=null,this.loader="function"==typeof n?n:null}changed(){this.dispatchEvent(n.default.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==s.default.IDLE&&this.loader){this.state=s.default.LOADING,this.changed();let e=this.getResolution(),t=Array.isArray(e)?e[0]:e;(0,o.toPromise)(()=>this.loader(this.getExtent(),t,this.getPixelRatio())).then(e=>{"image"in e&&(this.image_=e.image),"extent"in e&&(this.extent=e.extent),"resolution"in e&&(this.resolution=e.resolution),"pixelRatio"in e&&(this.pixelRatio_=e.pixelRatio),(e instanceof HTMLImageElement||l.CREATE_IMAGE_BITMAP&&e instanceof ImageBitmap||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement)&&(this.image_=e),this.state=s.default.LOADED}).catch(e=>{this.state=s.default.ERROR,console.error(e)}).finally(()=>this.changed())}}setImage(e){this.image_=e}setResolution(e){this.resolution=e}}function u(e,t,i){let s=!0,r=!1,o=!1,h=[(0,a.Vx)(e,n.default.LOAD,function(){o=!0,r||t()})];return e.src&&l.IMAGE_DECODE?(r=!0,e.decode().then(function(){s&&t()}).catch(function(e){s&&(o?t():i())})):h.push((0,a.Vx)(e,n.default.ERROR,i)),function(){s=!1,h.forEach(a.bN)}}function d(e,t){return t&&(e.src=t),new Promise(e.src&&l.IMAGE_DECODE?(t,i)=>e.decode().then(()=>t(e)).catch(s=>e.complete&&e.width?t(e):i(s)):(t,i)=>{function s(){r(),t(e)}function n(){r(),i(Error("Image load error"))}function r(){e.removeEventListener("load",s),e.removeEventListener("error",n)}e.addEventListener("load",s),e.addEventListener("error",n)})}function g(e,t){return t&&(e.src=t),e.src&&l.IMAGE_DECODE&&l.CREATE_IMAGE_BITMAP?e.decode().then(()=>createImageBitmap(e)).catch(t=>{if(e.complete&&e.width)return e;throw t}):d(e)}t.ZP=h},99674:function(e,t,i){i.d(t,{R:function(){return u},Z:function(){return h}});var s=i(59900),n=i(73381),r=i(38906),a=i(13580);let o=1/0;var l=class{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,(0,a.Z)(this.queuedElements_)}dequeue(){let e=this.elements_,t=this.priorities_,i=e[0];1==e.length?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));let s=this.keyFunction_(i);return delete this.queuedElements_[s],i}enqueue(e){(0,r.h)(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");let t=this.priorityFunction_(e);return t!=o&&(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0)}getCount(){return this.elements_.length}getLeftChildIndex_(e){return 2*e+1}getRightChildIndex_(e){return 2*e+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return 0===this.elements_.length}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){let t=this.elements_,i=this.priorities_,s=t.length,n=t[e],r=i[e],a=e;for(;e<s>>1;){let n=this.getLeftChildIndex_(e),r=this.getRightChildIndex_(e),a=r<s&&i[r]<i[n]?r:n;t[e]=t[a],i[e]=i[a],e=a}t[e]=n,i[e]=r,this.siftDown_(a,e)}siftDown_(e,t){let i=this.elements_,s=this.priorities_,n=i[t],r=s[t];for(;t>e;){let e=this.getParentIndex_(t);if(s[e]>r)i[t]=i[e],s[t]=s[e],t=e;else break}i[t]=n,s[t]=r}reprioritize(){let e,t,i;let s=this.priorityFunction_,n=this.elements_,r=this.priorities_,a=0,l=n.length;for(t=0;t<l;++t)(i=s(e=n[t]))==o?delete this.queuedElements_[this.keyFunction_(e)]:(r[a]=i,n[a++]=e);n.length=a,r.length=a,this.heapify_()}},h=class extends l{constructor(e,t){super(t=>e.apply(null,t),e=>e[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){let t=super.enqueue(e);return t&&e[0].addEventListener(n.default.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){let t=e.target,i=t.getState();if(i===s.default.LOADED||i===s.default.ERROR||i===s.default.EMPTY){i!==s.default.ERROR&&t.removeEventListener(n.default.CHANGE,this.boundHandleTileChange_);let e=t.getKey();e in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[e],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let i=0;for(;this.tilesLoading_<e&&i<t&&this.getCount()>0;){let e=this.dequeue()[0],t=e.getKey();e.getState()!==s.default.IDLE||t in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[t]=!0,++this.tilesLoading_,++i,e.load())}}};function u(e,t,i,s,n){if(!e||!(i in e.wantedTiles)||!e.wantedTiles[i][t.getKey()])return o;let r=e.viewState.center,a=s[0]-r[0],l=s[1]-r[1];return 65536*Math.log(n)+Math.sqrt(a*a+l*l)/n}},73406:function(e,t,i){i.r(t),i.d(t,{default:function(){return c}});var s=i(11256),n=i(6908),r=i(21915),a=i(5374),o=i(82359),l=i(4722);class h extends l.Z{constructor(e){super(e),this.image=null}getImage(){return this.image?this.image.getImage():null}prepareFrame(e){let t=e.layerStatesArray[e.layerIndex],i=e.pixelRatio,o=e.viewState,l=o.resolution,h=this.getLayer().getSource(),u=e.viewHints,d=e.extent;if(void 0!==t.extent&&(d=(0,r.getIntersection)(d,(0,a.fromUserExtent)(t.extent,o.projection))),!u[n.Z.ANIMATING]&&!u[n.Z.INTERACTING]&&!(0,r.isEmpty)(d)){if(h){let e=o.projection,t=h.getImage(d,l,i,e);t&&(this.loadImage(t)?this.image=t:t.getState()===s.default.EMPTY&&(this.image=null))}else this.image=null}return!!this.image}getData(e){let t=this.frameState;if(!t)return null;let i=this.getLayer(),s=(0,o.nn)(t.pixelToCoordinateTransform,e.slice()),n=i.getExtent();if(n&&!(0,r.containsCoordinate)(n,s))return null;let a=this.image.getExtent(),l=this.image.getImage(),h=(0,r.getWidth)(a),u=Math.floor(l.width*((s[0]-a[0])/h));if(u<0||u>=l.width)return null;let d=(0,r.getHeight)(a),g=Math.floor(l.height*((a[3]-s[1])/d));return g<0||g>=l.height?null:this.getImageData(l,u,g)}renderFrame(e,t){let i=this.image,s=i.getExtent(),n=i.getResolution(),[l,h]=Array.isArray(n)?n:[n,n],u=i.getPixelRatio(),d=e.layerStatesArray[e.layerIndex],g=e.pixelRatio,c=e.viewState,_=c.center,f=c.resolution;this.prepareContainer(e,t);let p=this.context.canvas.width,m=this.context.canvas.height,E=this.getRenderContext(e),I=!1,R=!0;if(d.extent){let t=(0,a.fromUserExtent)(d.extent,c.projection);(I=(R=(0,r.intersects)(t,e.extent))&&!(0,r.containsExtent)(t,e.extent))&&this.clipUnrotated(E,e,t)}let x=i.getImage(),v=(0,o.qC)(this.tempTransform,p/2,m/2,g*l/(f*u),g*h/(f*u),0,u*(s[0]-_[0])/l,u*(_[1]-s[3])/h);this.renderedResolution=h*g/u;let y=x.width*v[0],w=x.height*v[3];if(this.getLayer().getSource().getInterpolate()||(E.imageSmoothingEnabled=!1),this.preRender(E,e),R&&y>=.5&&w>=.5){let e=v[4],t=v[5],i=d.opacity;1!==i&&(E.save(),E.globalAlpha=i),E.drawImage(x,0,0,+x.width,+x.height,e,t,y,w),1!==i&&E.restore()}return this.postRender(this.context,e),I&&E.restore(),E.imageSmoothingEnabled=!0,this.container}}var u=i(77701);class d extends u.default{constructor(e){super(e=e||{})}}var g=d,c=class extends g{constructor(e){super(e)}createRenderer(){return new h(this)}getData(e){return super.getData(e)}}},13668:function(e,t,i){i.r(t),i.d(t,{default:function(){return l}});var s=i(68163),n=i(77701),r=i(71534);class a extends n.default{constructor(e){let t=Object.assign({},e=e||{}),i=e.cacheSize;delete e.cacheSize,delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=i,this.setPreload(void 0!==e.preload?e.preload:0),this.setUseInterimTilesOnError(void 0===e.useInterimTilesOnError||e.useInterimTilesOnError)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(r.Z.PRELOAD)}setPreload(e){this.set(r.Z.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(r.Z.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(r.Z.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}var o=a,l=class extends o{constructor(e){super(e)}createRenderer(){return new s.Z(this,{cacheSize:this.getCacheSize()})}}},54072:function(e,t,i){i.d(t,{Ps:function(){return y},ZP:function(){return w},r6:function(){return v}});var s=i(2022),n=i(11256),r=i(79682),a=i(9520),o=i(73381),l=i(21915),h=i(21882),u=i(5374),d=i(13002),g=i(52209);function c(e){return Array.isArray(e)?Math.min(...e):e}var _=i(56245),f=i(35211);class p extends s.ZP{constructor(e,t,i,s,r,a,o){let h=e.getExtent();h&&e.canWrapX()&&((h=h.slice())[0]=-1/0,h[2]=1/0);let u=t.getExtent();u&&t.canWrapX()&&((u=u.slice())[0]=-1/0,u[2]=1/0);let d=u?(0,l.getIntersection)(i,u):i,c=(0,l.getCenter)(d),p=(0,g.aA)(e,t,c,s),m=f.m,E=new _.Z(e,t,d,h,p*m,s),I=E.calculateSourceExtent(),R=(0,l.isEmpty)(I)?null:a(I,p,r),x=R?n.default.IDLE:n.default.EMPTY,v=R?R.getPixelRatio():1;super(i,s,v,x),this.targetProj_=t,this.maxSourceExtent_=h,this.triangulation_=E,this.targetResolution_=s,this.targetExtent_=i,this.sourceImage_=R,this.sourcePixelRatio_=v,this.interpolate_=o,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==n.default.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){let e=this.sourceImage_.getState();if(e==n.default.LOADED){let e=(0,l.getWidth)(this.targetExtent_)/this.targetResolution_,t=(0,l.getHeight)(this.targetExtent_)/this.targetResolution_;this.canvas_=(0,g.sY)(e,t,this.sourcePixelRatio_,c(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==n.default.IDLE){this.state=n.default.LOADING,this.changed();let e=this.sourceImage_.getState();e==n.default.LOADED||e==n.default.ERROR?this.reproject_():(this.sourceListenerKey_=(0,d.oL)(this.sourceImage_,o.default.CHANGE,e=>{let t=this.sourceImage_.getState();(t==n.default.LOADED||t==n.default.ERROR)&&(this.unlistenSource_(),this.reproject_())}),this.sourceImage_.load())}}unlistenSource_(){(0,d.bN)(this.sourceListenerKey_),this.sourceListenerKey_=null}}var m=i(71405),E=i(14431);let I={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class R extends a.default{constructor(e,t){super(e),this.image=t}}class x extends m.default{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:void 0===e.interpolate||e.interpolate}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=void 0!==e.resolutions?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=!!e.loader&&0===e.loader.length,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){let t=this.getResolutions();if(t){let i=(0,r.h7)(t,e,0);e=t[i]}return e}getImage(e,t,i,s){let n=this.getProjection();if(!n||!s||(0,u.equivalent)(n,s))return n&&(s=n),this.getImageInternal(e,t,i,s);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&(0,u.equivalent)(this.reprojectedImage_.getProjection(),s)&&this.reprojectedImage_.getResolution()==t&&(0,l.equals)(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new p(n,s,e,t,i,(e,t,i)=>this.getImageInternal(e,t,i,n),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,i,n){if(this.loader){let r=y(e,t,i,1),a=this.findNearestResolution(t);if(this.image&&(this.static_||this.wantedProjection_===n&&(this.wantedExtent_&&(0,l.containsExtent)(this.wantedExtent_,r)||(0,l.containsExtent)(this.image.getExtent(),r))&&(this.wantedResolution_&&c(this.wantedResolution_)===a||c(this.image.getResolution())===a)))return this.image;this.wantedProjection_=n,this.wantedExtent_=r,this.wantedResolution_=a,this.image=new s.ZP(r,a,i,this.loader),this.image.addEventListener(o.default.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){let t;let i=e.target;switch(i.getState()){case n.default.LOADING:this.loading=!0,t=I.IMAGELOADSTART;break;case n.default.LOADED:this.loading=!1,t=I.IMAGELOADEND;break;case n.default.ERROR:this.loading=!1,t=I.IMAGELOADERROR;break;default:return}this.hasListener(t)&&this.dispatchEvent(new R(t,i))}}function v(e,t){e.getImage().src=t}function y(e,t,i,s){let n=t/i,r=(0,l.getCenter)(e),a=(0,h.mD)((0,l.getWidth)(e)/n,E.L),o=(0,h.mD)((0,l.getHeight)(e)/n,E.L),u=(0,h.mD)((s-1)*a/2,E.L),d=(0,h.mD)((s-1)*o/2,E.L);return(0,l.getForViewAndSize)(r,n,0,[a+2*u,o+2*d])}var w=x},4705:function(e,t,i){i.r(t),i.d(t,{Processor:function(){return x},RasterSourceEvent:function(){return v},default:function(){return L}});var s=i(80967),n=i(2022),r=i(11256);class a extends n.ZP{constructor(e,t,i,s,n){super(e,t,i,void 0!==n?r.default.IDLE:r.default.LOADED),this.loader_=void 0!==n?n:null,this.canvas_=s,this.error_=null}getError(){return this.error_}handleLoad_(e){e?(this.error_=e,this.state=r.default.ERROR):this.state=r.default.LOADED,this.changed()}load(){this.state==r.default.IDLE&&(this.state=r.default.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}var o=i(99674),l=i(85386),h=i(9520),u=i(73381),d=i(21915),g=i(73406),c=i(13668),_=i(82359),f=i(49179),p=i(54072),m=i(71405),E=i(51626),I=i(48764).Buffer;function R(e){return function(t){let i=t.buffers,s=t.meta,n=t.imageOps,r=t.width,a=t.height,o=i.length,l=i[0].byteLength;if(n){let t=Array(o);for(let e=0;e<o;++e)t[e]=new ImageData(new Uint8ClampedArray(i[e]),r,a);return e(t,s).data.buffer}let h=new Uint8ClampedArray(l),u=Array(o),d=Array(o);for(let e=0;e<o;++e)u[e]=new Uint8ClampedArray(i[e]),d[e]=[0,0,0,0];for(let t=0;t<l;t+=4){for(let e=0;e<o;++e){let i=u[e];d[e][0]=i[t],d[e][1]=i[t+1],d[e][2]=i[t+2],d[e][3]=i[t+3]}let i=e(d,s);h[t]=i[0],h[t+1]=i[1],h[t+2]=i[2],h[t+3]=i[3]}return h.buffer}}class x extends s.Z{constructor(e){let t;super(),this.imageOps_=!!e.imageOps;let i=Array(t=0===e.threads?0:this.imageOps_?1:e.threads||1);if(t)for(let s=0;s<t;++s)i[s]=function(e,t){let i=Object.keys(e.lib||{}).map(function(t){return"const "+t+" = "+e.lib[t].toString()+";"}).concat(["const __minion__ = ("+R.toString()+")(",e.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),s=new Worker("undefined"==typeof Blob?"data:text/javascript;base64,"+I.from(i.join("\n"),"binary").toString("base64"):URL.createObjectURL(new Blob(i,{type:"text/javascript"})));return s.addEventListener("message",t),s}(e,this.onWorkerMessage_.bind(this,s));else i[0]=function(e,t){let i=R(e.operation),s=!1;return{postMessage:function(e){setTimeout(function(){!s&&t({data:{buffer:i(e),meta:e.meta}})},0)},terminate:function(){s=!0}}}(e,this.onWorkerMessage_.bind(this,0));this.workers_=i,this.queue_=[],this.maxQueueLength_=e.queue||1/0,this.running_=0,this.dataLookup_={},this.job_=null}process(e,t,i){this.enqueue_({inputs:e,meta:t,callback:i}),this.dispatch_()}enqueue_(e){for(this.queue_.push(e);this.queue_.length>this.maxQueueLength_;)this.queue_.shift().callback(null,null)}dispatch_(){if(this.running_||0===this.queue_.length)return;let e=this.queue_.shift();this.job_=e;let t=e.inputs[0].width,i=e.inputs[0].height,s=e.inputs.map(function(e){return e.data.buffer}),n=this.workers_.length;if(this.running_=n,1===n){this.workers_[0].postMessage({buffers:s,meta:e.meta,imageOps:this.imageOps_,width:t,height:i},s);return}let r=4*Math.ceil(e.inputs[0].data.length/4/n);for(let a=0;a<n;++a){let n=a*r,o=[];for(let e=0,t=s.length;e<t;++e)o.push(s[e].slice(n,n+r));this.workers_[a].postMessage({buffers:o,meta:e.meta,imageOps:this.imageOps_,width:t,height:i},o)}}onWorkerMessage_(e,t){!this.disposed&&(this.dataLookup_[e]=t.data,--this.running_,0===this.running_&&this.resolveJob_())}resolveJob_(){let e,t;let i=this.job_,s=this.workers_.length;if(1===s)e=new Uint8ClampedArray(this.dataLookup_[0].buffer),t=this.dataLookup_[0].meta;else{let n=i.inputs[0].data.length;e=new Uint8ClampedArray(n),t=Array(s);let r=4*Math.ceil(n/4/s);for(let i=0;i<s;++i){let s=this.dataLookup_[i].buffer,n=i*r;e.set(new Uint8ClampedArray(s),n),t[i]=this.dataLookup_[i].meta}}this.job_=null,this.dataLookup_={},i.callback(null,new ImageData(e,i.inputs[0].width,i.inputs[0].height),t),this.dispatch_()}disposeInternal(){for(let e=0;e<this.workers_.length;++e)this.workers_[e].terminate();this.workers_.length=0}}class v extends h.default{constructor(e,t,i){super(e),this.extent=t.extent,this.resolution=t.viewState.resolution/t.pixelRatio,this.data=i}}class y extends p.ZP{constructor(e){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=void 0!==e.operationType?e.operationType:"pixel",this.threads_=void 0!==e.threads?e.threads:1,this.layers_=function(e){let t=e.length,i=Array(t);for(let s=0;s<t;++s)i[s]=function(e){let t;return e instanceof m.default?e instanceof E.Z?t=new c.default({source:e}):e instanceof p.ZP&&(t=new g.default({source:e})):t=e,t}(e[s]);return i}(e.sources);let t=this.changed.bind(this);for(let e=0,i=this.layers_.length;e<i;++e)this.layers_[e].addEventListener(u.default.CHANGE,t);this.useResolutions_=null!==e.resolutions,this.tileQueue_=new o.Z(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:(0,_.Ue)(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:this.layers_.map(function(e){return e.getLayerState()}),pixelRatio:1,pixelToCoordinateTransform:(0,_.Ue)(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:(0,f.getUid)(this),renderTargets:{}},this.setAttributions(function(t){let i=[];for(let s=0,n=e.sources.length;s<n;++s){let n=e.sources[s],r=n instanceof m.default?n:n.getSource();if(!r)continue;let a=r.getAttributions()?.(t);"string"==typeof a?i.push(a):void 0!==a&&i.push(...a)}return i}),void 0!==e.operation&&this.setOperation(e.operation,e.lib)}setOperation(e,t){this.processor_&&this.processor_.dispose(),this.processor_=new x({operation:e,imageOps:"image"===this.operationType_,queue:1,lib:t,threads:this.threads_}),this.changed()}updateFrameState_(e,t,i){let s=Object.assign({},this.frameState_);s.viewState=Object.assign({},s.viewState);let n=(0,d.getCenter)(e);s.size[0]=Math.ceil((0,d.getWidth)(e)/t),s.size[1]=Math.ceil((0,d.getHeight)(e)/t),s.extent=[n[0]-s.size[0]*t/2,n[1]-s.size[1]*t/2,n[0]+s.size[0]*t/2,n[1]+s.size[1]*t/2],s.time=Date.now();let r=s.viewState;return r.center=n,r.projection=i,r.resolution=t,s}allSourcesReady_(){let e,t=!0;for(let i=0,s=this.layers_.length;i<s;++i)if(!(e=this.layers_[i].getSource())||"ready"!==e.getState()){t=!1;break}return t}getImage(e,t,i,s){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),t=this.findNearestResolution(t);let n=this.updateFrameState_(e,t,s);if(this.requestedFrameState_=n,this.renderedImageCanvas_){let e=this.renderedImageCanvas_.getResolution(),i=this.renderedImageCanvas_.getExtent();t===e&&(0,d.equals)(n.extent,i)||(this.renderedImageCanvas_=null)}return this.renderedImageCanvas_&&this.getRevision()===this.renderedRevision_||this.processSources_(),n.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){let e=this.requestedFrameState_,t=this.layers_.length,i=Array(t);for(let s=0;s<t;++s){e.layerIndex=s,e.renderTargets={};let t=function(e,t){let i;let s=e.getRenderer();if(!s)throw Error("Unsupported layer type: "+e);if(!s.prepareFrame(t))return null;let n=t.size[0],r=t.size[1];if(0===n||0===r)return null;let a=s.renderFrame(t,null);if(a instanceof HTMLCanvasElement)i=a;else{if(a&&(i=a.firstElementChild),!(i instanceof HTMLCanvasElement))throw Error("Unsupported rendered element: "+i);if(i.width===n&&i.height===r)return i.getContext("2d").getImageData(0,0,n,r)}if(w){let e=w.canvas;e.width!==n||e.height!==r?w=(0,l.E4)(n,r,void 0,{willReadFrequently:!0}):w.clearRect(0,0,n,r)}else w=(0,l.E4)(n,r,void 0,{willReadFrequently:!0});return w.drawImage(i,0,0,n,r),w.getImageData(0,0,n,r)}(this.layers_[s],e);if(!t)return;i[s]=t}let s={};this.dispatchEvent(new v("beforeoperations",e,s)),this.processor_.process(i,s,this.onWorkerComplete_.bind(this,e))}onWorkerComplete_(e,t,i,s){let n;if(t||!i)return;let r=e.extent,o=e.viewState.resolution;if(o===this.requestedFrameState_.viewState.resolution&&(0,d.equals)(r,this.requestedFrameState_.extent)){if(this.renderedImageCanvas_)n=this.renderedImageCanvas_.getImage().getContext("2d");else{let e=Math.round((0,d.getWidth)(r)/o),t=Math.round((0,d.getHeight)(r)/o);n=(0,l.E4)(e,t),this.renderedImageCanvas_=new a(r,o,1,n.canvas)}n.putImageData(i,0,0),e.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new v("afteroperations",e,s))}}getResolutions(e){if(!this.useResolutions_)return null;let t=super.getResolutions();if(!t)for(let i=0,s=this.layers_.length;i<s&&!(t=this.layers_[i].getSource().getResolutions(e));++i);return t}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}y.prototype.dispose;let w=null;var L=y},14431:function(e,t,i){i.d(t,{L:function(){return s}});let s=4}}]);
//# sourceMappingURL=6174.698194ec9018daec.js.map