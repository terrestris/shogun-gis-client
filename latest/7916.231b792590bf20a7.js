"use strict";(self.webpackChunk_terrestris_shogun_gis_client=self.webpackChunk_terrestris_shogun_gis_client||[]).push([["7916"],{41423:function(e,r,t){t.r(r),t.d(r,{App:function(){return aQ},default:function(){return aX}});var a=t(24464),n=t(62440),l=t(92819),i=t(34259),s=t(74848),o=t(76395),u=t.n(o),c=t(3371),d=t(28527),g=t(8674),m=t(80683),f=t(66672),p=t(44853),h=t(15307),y=t(38388),v=t(19142),b=t(94092),x=t(99138),j=t.n(x),w=t(24910),A=t.n(w),_=t(49994),S=t.n(_),C=t(43984),k=t(59648),E=t(69941),N=t(6273),L=t(18635),T=t(69844),F=t.n(T),P=t(30126),M=t(33639),D=()=>(0,M.useDispatch)(),O=M.useSelector,U=t(65350),B=e=>{var r=(0,a._)({},(0,n._)(e)),t=(0,d._)((0,o.useState)(!1),2),u=t[0],x=t[1],w=(0,d._)((0,o.useState)([]),2),_=w[0],T=w[1],M=(0,d._)((0,o.useState)([]),2),B=M[0],I=M[1],R=(0,d._)((0,o.useState)(""),2),$=R[0],V=R[1],Y=(0,d._)((0,o.useState)("https://sgx.geodatenzentrum.de/wms_topplus_open"),2),H=Y[0],z=Y[1],G=(0,d._)((0,o.useState)(),2),W=G[0],K=G[1],J=(0,d._)((0,o.useState)("1.3.0"),2),q=J[0],Q=J[1],X=O(e=>e.addLayerModal.visible),Z=D(),ee=(0,P.k)(),er=(0,C.useTranslation)().t;(0,o.useEffect)(()=>{X&&K(E.Q.createValidGetCapabilitiesRequest(H,"WMS",q))},[q,X,H]);var et=()=>{I([]),T([]),Z((0,U.jD)())},ea=e=>{if(ee){var r=er("AddLayerModal.externalWmsFolder"),t=L.B.getLayerByName(ee,r),a=!!t;if(t||(t=new(j())({layers:[]})).set("name",r),e.forEach(e=>{if(!t.getLayers().getArray().includes(e)){if(e.set("isExternalLayer",!0),e instanceof A()&&(a=null==(n=e.getSource())?void 0:n.getUrl()),e instanceof S()){var r,a,n,l,i=null==(l=e.getSource())?void 0:l.getUrls();a=(null==i?void 0:i.length)===1?i[0]:void 0}var s={name:e.get("name"),type:e instanceof S()?"TILEWMS":"WMS",opacity:e.getOpacity(),sourceConfig:{layerNames:null==(r=e.getSource())?void 0:r.getParams().LAYERS,url:a,useBearerToken:!1}};e.set("layerConfig",s),t.getLayers().push(e)}}),!a){var n=ee.getLayerGroup().getLayers();n.insertAt((null==n?void 0:n.getLength())||0,t)}et()}};return(0,s.jsxs)(f.A,(0,i._)((0,l._)({className:"add-layer-modal",title:er("AddLayerModal.title"),open:X,onCancel:et,width:600,footer:[(0,s.jsx)(F(),{"aria-label":"add-all",disabled:(null==_?void 0:_.length)<1,onClick:()=>{ea(_)},children:er("AddLayerModal.addAllLayers")},"add-all"),(0,s.jsx)(F(),{"aria-label":"add-selected",disabled:(null==B?void 0:B.length)<1,onClick:()=>{ea(_.filter(e=>B.includes((0,b.getUid)(e))))},children:er("AddLayerModal.addSelectedLayers")},"add-selected")]},r),{children:[(0,s.jsx)("span",{children:er("AddLayerModal.requestWmsGetCapabilitiesInstruction")}),(0,s.jsx)(p.A.Search,{"aria-label":"input-search",className:"url-input",placeholder:er("AddLayerModal.inputPlaceholder"),value:H,onChange:e=>{var r=e.target.value;V(E.Q.isValid(r.trim())?"":"error"),z(e.target.value)},onSearch:()=>(0,c._)(function(){var e,r;return(0,g.YH)(this,function(t){switch(t.label){case 0:if(!W)return[2];t.label=1;case 1:return t.trys.push([1,3,4,5]),x(!0),[4,N.A.getWmsCapabilities(W)];case 2:return e=t.sent(),T(N.A.getLayersFromWmsCapabilities(e,"Title")),[3,5];case 3:return r=t.sent(),m.Ay.error({message:er("AddLayerModal.errorMessage"),description:er("AddLayerModal.errorDescription")}),k.A.error(r),[3,5];case 4:return x(!1),[7];case 5:return[2]}})})(),status:$,enterButton:!0,addonBefore:(0,s.jsx)(h.A,{"aria-label":"select-version",defaultValue:"1.3.0",onChange:Q,options:[{value:"1.3.0",label:`${er("AddLayerModal.version")} 1.3.0`},{value:"1.1.1",label:`${er("AddLayerModal.version")} 1.1.1`}]})}),""!==$&&(0,s.jsx)(y.A,{className:"error",children:er("AddLayerModal.invalidUrlErrorMsg")}),(0,s.jsx)(v.A,{"aria-label":"wms-table",loading:u,columns:[{title:er("AddLayerModal.columnTitle"),render:(e,r)=>r.get("title")}],scroll:{y:250},rowKey:e=>(0,b.getUid)(e),rowSelection:{selectedRowKeys:B,onChange:I},pagination:!1,dataSource:_})]}))},I=t(59132),R=t(95430),$=t(63730),V=()=>(0,o.useContext)($.Ay),Y=e=>{var r=(0,a._)({},(0,n._)(e)),t=(0,P.k)(),u=V(),c=(0,C.useTranslation)(),d=c.t,g=c.i18n;(0,o.useEffect)(()=>{if(t){var e=L.B.getLayersByProperty(t,"isExternalLayerGroup",!0);if((null==e?void 0:e.length)===1){var r=e[0],a=e[0].get("name");r.set("name",d("AddLayerModal.externalWmsFolder"));var n=new I.ObjectEvent("change:layers","name",a);r.dispatchEvent(n)}}},[g.language,t,d]);var m=[];return(u&&u.forEach(e=>{var r;if((r=e.integration)&&"map"===r.placement){var t=e.key,a=e.wrappedComponent;m.push((0,s.jsx)(a,{},t))}}),t)?(0,s.jsx)(R.MapComponent,(0,i._)((0,l._)({map:t},r),{children:m})):(0,s.jsx)(s.Fragment,{})},H=t(24009),z=()=>{var e=V(),r=(0,C.useTranslation)().t,t=()=>{var r=null;return e.forEach(e=>{var t;if((t=e.integration)&&"cookie-banner"===t.placement){var a=e.key,n=e.wrappedComponent;r=(0,s.jsx)(n,{},a)}}),r};return(0,s.jsx)(H.Zd,{disableStyles:!0,location:"bottom",buttonText:r("CookieBanner.button"),cookieName:"SHOGun-Session-Cookie",buttonClasses:"cookie-button",containerClasses:"cookie-container",contentClasses:"cookie-content",expires:150,children:t()?t():r("CookieBanner.info")},"default-cookie-consent")},G=t(75974),W=t(98318),K=t.n(W),J=t(66046),q=t.n(J),Q=t(72251),X=t(20554),Z=t.n(X),ee=t(5988),er=t.n(ee),et=t(2129),ea=t(83029),en=()=>{var e=(0,ea.A)();return(0,o.useCallback)(r=>(0,c._)(function(){var t,a,n,i,s,o,u;return(0,g.YH)(this,function(c){switch(c.label){case 0:if((n=r.layer.getSource())instanceof Z()&&(a=n.getUrl()),n instanceof er()&&(a=(i=n.getUrls())?i[0]:void 0),!a)return[2];return a.endsWith("?")&&(a=a.slice(0,-1)),s={"Content-Type":"application/xml"},[4,fetch(a,{method:"POST",headers:(null==(t=r.layer)?void 0:t.get("useBearerToken"))?(0,l._)({},s,(0,et.M)(null==e?void 0:e.getKeycloak())):s,body:new XMLSerializer().serializeToString(r.transaction)})];case 1:if(!(o=c.sent()).ok)throw Error("No successful response while executing a WFS-Transaction");return[4,o.text()];case 2:var d;if(u=c.sent(),d=new DOMParser().parseFromString(u,"text/xml"),["wfs:FAILED","ows:ExceptionReport"].some(e=>d.getElementsByTagName(e).length>0))throw Error(`Something failed: ${u}`);return[2,u]}})})(),[e])},el=t(74353),ei=t.n(el),es=t(88055),eo=t.n(es),eu=t(51786),ec=t(38422),ed=t.n(ec),eg=t(85258),em=t(94020),ef=t(21476),ep=t(80848),eh=t(83583),ey=t(67639),ev=t(38221),eb=t.n(ev),ex=t(69843),ej=t.n(ex),ew=t(23805),eA=t.n(ew),e_=t(96689),eS=t(85015),eC=t.n(eS),ek=t(63579),eE=t(74097),eN=t(5624),eL=e=>{var r=e.readOnly,t=e.fieldConfig,a=(0,eg._)(e,["readOnly","fieldConfig"]),n=(0,ea.A)(),o=(0,C.useTranslation)().t;return n?(0,s.jsx)(ek.A,(0,i._)((0,l._)({multiple:!0,name:"file",action:"/files/uploadToFileSystem",withCredentials:!0,headers:(0,l._)({},(0,eN.T)(),(0,et.M)(n.getKeycloak())),onRemove:e=>(0,c._)(function(){var r,t;return(0,g.YH)(this,function(a){switch(a.label){case 0:if(!(t=null==e||null==(r=e.response)?void 0:r.fileUuid))return[3,2];return[4,fetch(`${null==n?void 0:n.getBasePath()}files/${t}`,{method:"DELETE",credentials:"same-origin",headers:(0,l._)({},(0,eN.T)(),(0,et.M)(null==n?void 0:n.getKeycloak()))})];case 1:return[2,a.sent()];case 2:return[2]}})})(),onPreview:e=>(0,c._)(function(){var r,t,a,i,s,o;return(0,g.YH)(this,function(u){switch(u.label){case 0:if(!n||(t=null==(r=e.response)?void 0:r.fileName,a=`/files/${null==r?void 0:r.fileUuid}`,ej()(t)||ej()(null==r?void 0:r.fileUuid)))return[2];return i=document.createElement("a"),document.body.appendChild(i),[4,fetch(a,{headers:(0,l._)({},(0,et.M)(n.getKeycloak()))})];case 1:return[4,u.sent().blob()];case 2:return s=u.sent(),o=window.URL.createObjectURL(s),i.href=o,i.download=t,i.click(),window.URL.revokeObjectURL(o),[2]}})})()},null==t?void 0:t.fieldProps,a),{children:!(void 0!==r&&r)&&(0,s.jsx)(eE.Ay,{children:o("FileUpload.upload")})})):(0,s.jsx)(s.Fragment,{})},eT=t(36693),eF=t(46103),eP=t(85344),eM=()=>{var e=(0,ea.A)();return(0,o.useCallback)(r=>(0,c._)(function(){var t;return(0,g.YH)(this,function(a){switch(a.label){case 0:if(ej()(r))return[2,Promise.reject(Error(`Passed url '${r}' is null or undefined`))];return[4,fetch(r,{credentials:"include",headers:(0,l._)({},(0,et.M)(null==e?void 0:e.getKeycloak()))})];case 1:return[4,a.sent().blob()];case 2:return t=a.sent(),[2,new Promise((e,r)=>{try{var a=new FileReader;a.onload=function(){e(this.result)},a.readAsDataURL(t)}catch(e){r(Error(`Error reading file: ${e}`))}})]}})})(),[e])},eD=e=>{var r=e.fieldConfig,t=e.readOnly,a=void 0!==t&&t,n=e.initialFileList,u=(0,eg._)(e,["fieldConfig","readOnly","initialFileList"]),m=(0,d._)((0,o.useState)(!1),2),p=m[0],h=m[1],y=(0,d._)((0,o.useState)(""),2),v=y[0],b=y[1],x=(0,d._)((0,o.useState)(),2),j=x[0],w=x[1],A=(0,ea.A)(),_=eM(),S=(0,C.useTranslation)().t;return((0,eP.Z)(()=>(0,c._)(function(){return(0,g.YH)(this,function(e){switch(e.label){case 0:if(!n||0===n.length)return[2];return[4,(0,c._)(function(){return(0,g.YH)(this,function(e){switch(e.label){case 0:return[4,Promise.all(n.map(e=>(0,c._)(function(){var r,t,a;return(0,g.YH)(this,function(n){switch(n.label){case 0:return t=[(0,l._)({},e)],a={},[4,_(`${null==A?void 0:A.getBasePath()}imagefiles/${null==e||null==(r=e.response)?void 0:r.fileUuid}/thumbnail`)];case 1:return[2,i._.apply(void 0,t.concat([(a.thumbUrl=n.sent(),a.url=void 0,a)]))]}})})()))];case 1:return[2,e.sent()]}})})()];case 1:return w(e.sent()),[2]}})})(),[null==n?void 0:n.length]),A)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ek.A,(0,i._)((0,l._)({accept:"image/*",multiple:!0,name:"file",action:`${A.getBasePath()}imagefiles/uploadToFileSystem`,withCredentials:!0,listType:"picture-card",headers:(0,l._)({},(0,eN.T)(),(0,et.M)(A.getKeycloak())),onRemove:e=>(0,c._)(function(){var r,t;return(0,g.YH)(this,function(a){switch(a.label){case 0:if(!(t=null==e||null==(r=e.response)?void 0:r.fileUuid))return[3,2];return[4,fetch(`${null==A?void 0:A.getBasePath()}imagefiles/${t}`,{method:"DELETE",credentials:"same-origin",headers:(0,l._)({},(0,eN.T)(),(0,et.M)(null==A?void 0:A.getKeycloak()))})];case 1:return[2,a.sent()];case 2:return[2]}})})(),onPreview:e=>(0,c._)(function(){var r;return(0,g.YH)(this,function(t){switch(t.label){case 0:if(r=e.response,ej()(r)||ej()(null==r?void 0:r.fileUuid))return[2];return[4,_(`${null==A?void 0:A.getBasePath()}imagefiles/${r.fileUuid}`)];case 1:return b(t.sent()),h(!0),[2]}})})(),fileList:a?j:void 0},null==r?void 0:r.fieldProps,u),{children:!a&&(0,s.jsxs)("div",{children:[(0,s.jsx)(eF.g,{icon:eT.QLR}),(0,s.jsx)("div",{style:{marginTop:8},children:S("ImageUpload.upload")})]})})),(0,s.jsx)(f.A,{open:p,footer:null,onCancel:()=>h(!1),children:(0,s.jsx)("img",{alt:"example",style:{width:"100%"},src:v})})]}):(0,s.jsx)(s.Fragment,{})},eO=t(45631),eU=e=>{var r=e.feature,t=e.formConfig,a=(0,eg._)(e,["feature","formConfig"]),n=(0,d._)((0,eO.useForm)(),1)[0];return(0,o.useEffect)(()=>{n.resetFields(),n.setFieldsValue(r.getProperties())},[r,n]),(0,s.jsx)(em.A,(0,i._)((0,l._)({className:"feature-info-form",form:n,labelCol:{span:8},labelAlign:"left",labelWrap:!0},a),{children:null==t?void 0:t.map(e=>{var r,t;return(0,s.jsx)(em.A.Item,{name:e.propertyName,label:null!=(r=e.displayName)?r:e.propertyName,children:(0,s.jsx)(eI,(0,l._)({label:null!=(t=e.displayName)?t:e.propertyName},e.fieldProps))},e.propertyName)})}))},eB=e=>{var r=e.value,t=e.referenceConfig,a=(0,eg._)(e,["value","referenceConfig"]),n=(0,d._)((0,o.useState)(!1),2),i=n[0],u=n[1],m=(0,d._)((0,o.useState)(),2),p=m[0],h=m[1],y=(0,C.useTranslation)().t,b=e=>{if(null==t?void 0:t.tablePropertyName){var r=/{{([^}]*)}}/g;if(null==t?void 0:t.tablePropertyName.match(r)){for(var a,n=null==t?void 0:t.tablePropertyName;a=r.exec(null==t?void 0:t.tablePropertyName);)n=n.replace(a[0],e[a[1]]);return n}return e[null==t?void 0:t.tablePropertyName]}if(e.id)return e.id},x=[{width:"100%",render:(e,r)=>b(r)?b(r):y("ReferenceTable.defaultRowPlaceholder")},{render:(e,r)=>(0,s.jsx)(eE.Ay,{onClick:()=>j(e,r),icon:(0,s.jsx)(eF.g,{icon:eT.LJS})})}],j=(e,r)=>{var t=new(q());t.setProperties(r),h(t),u(!0)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v.A,(0,l._)({size:"small",showHeader:!1,pagination:!1,columns:x,rowKey:"id",dataSource:(()=>{if(!r)return[];try{var e=JSON.parse(r);if(Array.isArray(e))return e;if(null==e||"number"==typeof e||"boolean"==typeof e||"string"==typeof e)return k.A.warn("Unsupported value given"),[];if("object"==typeof e)return[e]}catch(e){return k.A.warn("Error while parsing the table data ",e),[]}})()},a)),(0,s.jsx)(f.A,{className:"reference-table-modal",open:i,maskClosable:!1,footer:null,width:600,destroyOnClose:!0,title:(()=>{if(!p)return y("ReferenceTable.defaultModalTitle");var e=b(p.getProperties());return e?`${y("ReferenceTable.modalTitle",{referenceValue:e})}`:y("ReferenceTable.defaultModalTitle")})(),onCancel:()=>(0,c._)(function(){return(0,g.YH)(this,function(e){return u(!1),h(void 0),[2]})})(),children:p&&(0,s.jsx)(eU,{feature:p,formConfig:null==t?void 0:t.featureInfoFormConfig})})]})},eI=e=>{var r,t,a,n=e.dataType,o=void 0===n?"auto":n,u=e.valueMap,c=e.format,d=e.suffix,g=e.value,m=e.referenceConfig,f=e.urlDisplayValue,p=(0,eg._)(e,["dataType","valueMap","format","suffix","value","referenceConfig","urlDisplayValue"]),h=(0,C.useTranslation)().i18n,v="";if(g&&"string"==typeof g&&(null==u?void 0:u.hasOwnProperty(g))&&(g=u[g]),("string"===o||"auto"===o&&"string"==typeof g)&&g&&(v=null==g?void 0:g.toString()),"boolean"===o||"auto"===o&&"boolean"==typeof g||"false"===g||"true"===g)return(0,s.jsx)(ef.A,{checked:"false"!==g&&!1!==g,disabled:!0});("number"===o||"auto"===o&&Number.isFinite(g))&&g&&(v=new Intl.NumberFormat(h.language,{useGrouping:!1}).format(Number(g))),("date"===o||"auto"===o&&ei()(`${g}`).isValid())&&g&&((0,el.isDayjs)(g)||eC()(g)&&ei()(`${g}`).isValid())&&(v=ei()(g).format(void 0===c?"DD.MM.YYYY":c)),"auto"===o&&Array.isArray(g)&&(v=g.join(", ")),("url"===o||"auto"===o&&eC()(g)&&(r=g.toLowerCase(),["http://","https://","ftp://","mailto:"].some(e=>r.startsWith(e))))&&g&&(v=(0,s.jsx)("a",{href:null==g?void 0:g.toString(),target:"_blank",rel:"noreferrer",children:f||(null==g?void 0:g.toString())}));var b=g&&(e=>{if(!g)return null;var r="string"!=typeof e?JSON.stringify(e):e;try{r=JSON.parse(r)}catch(e){return k.A.trace(e),null}return"object"==typeof r&&null!==r&&ez(r[0])?r:null})(g);return"auto"===o&&b?(null==(a=b[0].response)||null==(t=a.fileType)?void 0:t.startsWith("image/"))?(0,s.jsx)(eD,{initialFileList:b,disabled:!0,readOnly:!0}):(0,s.jsx)(eL,{defaultFileList:b,disabled:!0,readOnly:!0}):"json"===o||"auto"===o&&g&&(e=>{var r="string"!=typeof e?JSON.stringify(e):e;try{r=JSON.parse(r)}catch(e){return k.A.trace(e),!1}return"object"==typeof r&&null!==r})(g)?(0,s.jsx)(eB,{value:"string"==typeof g?g:JSON.stringify(g),referenceConfig:m}):(d&&(v=(0,s.jsxs)(s.Fragment,{children:[v," ",d]})),(0,s.jsx)(y.A.Text,(0,i._)((0,l._)({className:"displayfield"},p),{children:v})))},eR=t(86235),e$=t(92297),eV=t.n(e$),eY=t(50858),eH=e=>{var r=e.parentForm,t=e.propertyName,a=e.value,n=e.tablePropertyName,u=e.formConfig,m=e.onChange,p=void 0===m?()=>{}:m,h=(0,eg._)(e,["parentForm","propertyName","value","tablePropertyName","formConfig","onChange"]),y=(0,d._)((0,o.useState)(!1),2),b=y[0],x=y[1],j=(0,d._)((0,o.useState)(),2),w=j[0],A=j[1],_=(0,d._)((0,eO.useForm)(),1)[0],S=(0,C.useTranslation)().t,E=eM(),N=(0,ea.A)(),L=e=>{if(!n)return null!=(r=e.id)?r:"";var r,t,a=/{{([^}]*)}}/g;if(!n.match(a))return e[n];for(var l=n;t=a.exec(n);)l=l.replace(t[0],e[t[1]]);return l},T=[{width:"100%",defaultSortOrder:"ascend",sorter:(e,r)=>{var t=L(e),a=L(r);return Number.isFinite(t)&&Number.isFinite(a)?t-a:"string"==typeof t&&"string"==typeof a?t.localeCompare(a):0},render:(e,r)=>L(r)},{render:(e,r)=>(0,s.jsx)(eE.Ay,{onClick:()=>P(r),icon:(0,s.jsx)(eF.g,{icon:eT.MT7})})},{render:(e,r)=>(0,s.jsx)(eR.A,{title:S("EditReferenceTable.confirmDeleteTitle"),onConfirm:()=>F(r),placement:"bottomRight",children:(0,s.jsx)(eE.Ay,{danger:!0,icon:(0,s.jsx)(eF.g,{icon:eT.yLS})})})}],F=e=>{var a=r.getFieldsValue();if(!a[t])return void k.A.warn(`Could not find the property ${t} in the form values`);var n=eo()(a[t]);if(!Array.isArray(n))return void k.A.warn("The delete candidate is not of required type array");var l=n.findIndex(r=>!!Number.isFinite(r.id)&&r.id===e.id||!!(r.internalId&&r.internalId===e.internalId));if(-1===l)return void k.A.warn(`Could not find the index (${e.id}) to delete`);n.splice(l,1),p(n)},P=e=>{var r=new(q());r.setProperties(e),_.setFieldsValue(r.getProperties()),A(r),x(!0)},M=()=>{_.resetFields(),x(!1),A(void 0)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eE.Ay,{className:"add-reference-button",onClick:()=>{var e=new(q());e.set("internalId",(0,eY.getUid)(e)),_.setFieldsValue(e.getProperties()),A(e),x(!0)},icon:(0,s.jsx)(eF.g,{icon:eT.QLR})}),(0,s.jsx)(v.A,(0,l._)({size:"small",showHeader:!1,pagination:!1,columns:T,rowKey:"id",dataSource:(()=>{if(a){if(!Array.isArray(a))return void k.A.warn("Reference value must be of of type array.");var e=eo()(a);return e.forEach(e=>{Object.entries(e).forEach(r=>{var t=(0,d._)(r,2),n=t[0],s=t[1];return(0,c._)(function(){var r;return(0,g.YH)(this,function(t){switch(t.label){case 0:if((null==u?void 0:u.some(e=>e.propertyName===n&&"DATE"===e.component))&&(eC()(s)||eV()(s))&&(eC()(a)||eV()(a))&&(ei()(`${a}`).isValid()?e[n]=ei()(`${s}`):(k.A.warn("Could not parse date"),e[n]=null)),!(null==u?void 0:u.some(e=>e.propertyName===n&&"UPLOAD"===e.component)))return[3,3];if(!Array.isArray(e[n]))return[3,2];return[4,Promise.all(null==(r=e[n])?void 0:r.map(e=>(0,c._)(function(){var r,t,a,n;return(0,g.YH)(this,function(s){switch(s.label){case 0:if(t=[(0,l._)({},e)],a={},!e.type.startsWith("image"))return[3,2];return[4,E(`${null==N?void 0:N.getBasePath()}imagefiles/${null==e||null==(r=e.response)?void 0:r.fileUuid}/thumbnail`)];case 1:return n=s.sent(),[3,3];case 2:n=void 0,s.label=3;case 3:return[2,i._.apply(void 0,t.concat([(a.thumbUrl=n,a.url=e.type.startsWith("image")?void 0:e.url,a)]))]}})})()))];case 1:return e[n]=t.sent(),[3,3];case 2:e[n]=[],t.label=3;case 3:return[2]}})})()})}),e.every(e=>!!Number.isFinite(e.id)||"string"==typeof e.id&&e.id.length>0)||k.A.warn("Not all elements in the referenced array contain an id value. This might result in unexpected behaviour"),e}})()},h)),(0,s.jsx)(f.A,{className:"edit-reference-table-modal",open:b,maskClosable:!1,width:600,destroyOnClose:!0,title:`${S("EditReferenceTable.modalTitle",{referenceValue:w?L(w.getProperties()):void 0})}`,onCancel:()=>{M()},onOk:()=>(0,c._)(function(){var e;return(0,g.YH)(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,_.validateFields()];case 1:return a.sent(),[3,3];case 2:return e=a.sent(),k.A.warn("Form validation failed: ",e),[2];case 3:var n,l,i;return n=eo()(_.getFieldsValue(!0)),l=[],Array.isArray(r.getFieldValue(t))&&(l=eo()(r.getFieldValue(t))),(i=l.findIndex(e=>!!Number.isFinite(e.id)&&e.id===n.id||!!(e.internalId&&e.internalId===n.internalId)))>-1?l[i]=n:l.push(n),_.isFieldsTouched()&&p(l),M(),[2]}})})(),children:w&&(0,s.jsx)(eG,{form:_,formConfig:u,applyFormDirty:!1})})]})};function ez(e){return!ej()(e)&&e.uid&&!ej()(e.name)&&!ej()(e.type)&&!ej()(e.uid)&&eA()(e.response)&&!ej()(e.response.id)&&!ej()(e.response.fileUuid)&&!ej()(e.response.fileName)&&!ej()(e.response.fileType)}var eG=e=>{var r=e.form,t=e.formConfig,a=e.applyFormDirty,n=void 0===a||a,o=(0,eg._)(e,["form","formConfig","applyFormDirty"]),u=(0,ea.A)(),d=D(),m=O(e=>e.editFeature.formDirty);return(0,s.jsx)(em.A,(0,i._)((0,l._)({className:"edit-feature-form",form:r,labelCol:{span:8},labelAlign:"left",labelWrap:!0,onValuesChange:eb()(e=>(0,c._)(function(){return(0,g.YH)(this,function(r){return n&&e&&!m&&d((0,e_.RB)(!0)),[2]})})(),250)},o),{children:null==t?void 0:t.map(e=>{let t;e.readOnly?(t=e,a=(0,s.jsx)(eI,(0,l._)({},t.fieldProps))):e.component?a=(e=>{if(u)switch(e.component){case"CHECKBOX":return(0,s.jsx)(ef.A,(0,l._)({},null==e?void 0:e.fieldProps));case"DATE":return(0,s.jsx)(ep.A,(0,l._)({},null==e?void 0:e.fieldProps));case"DISPLAY":return(0,s.jsx)("span",(0,l._)({},null==e?void 0:e.fieldProps));case"INPUT":return(0,s.jsx)(p.A,(0,l._)({},null==e?void 0:e.fieldProps));case"NUMBER":return(0,s.jsx)(eh.A,(0,l._)({},null==e?void 0:e.fieldProps));case"SELECT":return(0,s.jsx)(h.A,(0,l._)({allowClear:!0},null==e?void 0:e.fieldProps));case"SWITCH":return(0,s.jsx)(ey.A,(0,l._)({},null==e?void 0:e.fieldProps));case"TEXTAREA":return(0,s.jsx)(p.A.TextArea,(0,l._)({},null==e?void 0:e.fieldProps));case"UPLOAD":var t;if((null==e||null==(t=e.fieldProps)?void 0:t.type)==="IMAGE")return(0,s.jsx)(eD,(0,l._)({},null==e?void 0:e.fieldProps));return(0,s.jsx)(eL,(0,l._)({},null==e?void 0:e.fieldProps));case"REFERENCE_TABLE":return(0,s.jsx)(eH,(0,l._)({tablePropertyName:e.tablePropertyName,propertyName:e.propertyName,formConfig:e.editFormConfig,parentForm:r},e.fieldProps),e.propertyName);default:return k.A.error(`Component type "${null==e?void 0:e.component}" is not supported`),(0,s.jsx)(s.Fragment,{})}})(e):(k.A.warn("FieldConfig is missing `readOnly`, `component` or `dataType` property."),a=(0,s.jsx)(p.A,{placeholder:""},e.propertyName));var a,n,o={rules:[]};return o.rules=[{required:e.required}],"SWITCH"!==e.component&&"CHECKBOX"!==e.component||e.readOnly||(o.valuePropName="checked"),"UPLOAD"!==e.component||e.readOnly||(o.valuePropName="fileList",o.getValueFromEvent=e=>Array.isArray(e)?e:null==e?void 0:e.fileList),(0,s.jsx)(em.A.Item,(0,i._)((0,l._)({name:e.propertyName,label:null!=(n=e.displayName)?n:e.propertyName},o),{children:a}),e.propertyName)})}))},eW=e=>["gml:MultiPoint","gml:Point","gml:MultiLineString","gml:LineString","gml:MultiPolygon","gml:Polygon"].includes(e),eK=()=>{var e=(0,ea.A)(),r="describeFeatureTypeCache";return(0,o.useCallback)(t=>(0,c._)(function(){var a,n,i,s,o,u,c,d,m,f,p;return(0,g.YH)(this,function(g){switch(g.label){case 0:if((i=t.getSource())instanceof Z()&&(n=i.getUrl()),i instanceof er()&&(n=(s=i.getUrls())?s[0]:void 0),!n||(n.endsWith("?")&&(n=n.slice(0,-1)),!(o=null==(a=t.getSource())?void 0:a.getParams().LAYERS)))return[2];if(c=(u=JSON.parse(sessionStorage.getItem(r)||"{}"))[o])return[2,c];return d={SERVICE:"WFS",REQUEST:"DescribeFeatureType",VERSION:"2.0.0",OUTPUTFORMAT:"application/json",TYPENAMES:o},m={"Content-Type":"application/json"},[4,fetch(`${n}?${E.Q.objectToRequestString(d)}`,{method:"GET",headers:t.get("useBearerToken")?(0,l._)({},m,(0,et.M)(null==e?void 0:e.getKeycloak())):m})];case 1:if(!(f=g.sent()).ok)throw Error("No successful response while executing a WFS-DescribeFeature");return[4,f.json()];case 2:return p=g.sent(),u[o]=p,sessionStorage.setItem(r,JSON.stringify(u)),[2,p]}})})(),[e])},eJ=()=>{var e=(0,P.k)(),r=eK(),t=(0,ea.A)(),a=O(e=>e.editFeature.userEditMode),n=(0,o.useCallback)((e,r,a)=>{var l=!0,i=!1,s=void 0;try{for(var o,u=Object.entries(e)[Symbol.iterator]();!(l=(o=u.next()).done);l=!0)!function(){var l=(0,d._)(o.value,2),i=l[0],s=l[1];if(Array.isArray(s)){var u=s.map(e=>n(e,r));e[i]=a?JSON.stringify(u):u}if(void 0===s&&(e[i]=null),r.some(e=>{var r;return null==(r=e.children)?void 0:r.some(e=>e.propertyName===i&&e.readOnly)})&&delete e[i],ei()(s).isValid()&&(e[i]=s.toISOString()),Array.isArray(s)&&s.length>0&&ez(s[0])){var c,g,m=(null==(g=s[0].response)||null==(c=g.fileType)?void 0:c.startsWith("image/"))?"imagefiles/":"files/",f=s.map(e=>{var r,a,n,l,i;return{uid:e.uid,lastModified:e.lastModified,name:e.name,type:e.type,url:`${null==t?void 0:t.getBasePath()}${m}${e.response.fileUuid}`,response:{id:null==(r=e.response)?void 0:r.id,created:null==(a=e.response)?void 0:a.created,fileName:null==(n=e.response)?void 0:n.fileName,fileType:null==(l=e.response)?void 0:l.fileType,fileUuid:null==(i=e.response)?void 0:i.fileUuid}}});e[i]=JSON.stringify(f)}}()}catch(e){i=!0,s=e}finally{try{l||null==u.return||u.return()}finally{if(i)throw s}}return e},[t]);return(0,o.useCallback)(t=>(0,c._)(function(){var l,i,s,o,u,c,d,m,f,p,h,y,v,b,x;return(0,g.YH)(this,function(g){switch(g.label){case 0:if(!e)return[2];return u=[],c=[],d=[],[4,r(t.layer)];case 1:if(!(m=g.sent()))return[2];return f=t.layer.get("editFormConfig"),p=null==(i=m.featureTypes[0])||null==(l=i.properties)?void 0:l.find(e=>eW(e.type)),h=!1,null==(s=t.upsertFeatures)||s.forEach(e=>{var r=new(q()),l=null==(i=e.getGeometry())?void 0:i.clone();if(l&&!(0,eu.isEmpty)(l.getExtent())&&(null==a?void 0:a.includes("EDIT_GEOMETRY"))){var i,s,o=null!=(s=null==p?void 0:p.name)?s:"geom";r.set(o,l),r.setGeometryName(o)}t.form&&r.setProperties(n(eo()(t.form.getFieldsValue()),f,!0));var d=!!e.getId();h||(h=d),d&&r.setId(e.getId()),(d?c:u).push(r)}),y={featureNS:m.targetNamespace,featurePrefix:m.targetPrefix,featureType:null==(o=t.layer.getSource())?void 0:o.getParams().LAYERS,srsName:e.getView().getProjection().getCode(),version:"1.1.0",nativeElements:[]},v=new(ed())().writeTransaction(u,c,d,y),h&&K().wfsLockFeatureEnabled&&((x=document.createElementNS("https://www.opengis.net/wfs","LockId")).appendChild(document.createTextNode("GeoServer")),null==(b=v.getRootNode())||b.appendChild(x)),[2,v]}})})(),[e,a,r,n])},eq=t(91300),eQ=t(94748),eX=e=>{var r=e.open,t=e.children,a=(0,eg._)(e,["open","children"]),n=(0,P.k)();return(0,o.useEffect)(()=>{var e;null==(e=document.querySelectorAll("#map")[0])||e.classList.toggle("bisected",!!r)},[r]),(0,s.jsx)(eQ.A,(0,i._)((0,l._)({rootClassName:"map-drawer",mask:!1,open:r,placement:"right",width:getComputedStyle(document.documentElement).getPropertyValue("--drawerWidth"),afterOpenChange:()=>{null==n||n.updateSize()}},a),{children:t}))},eZ=t(50364),e0=t.n(eZ),e1=()=>{var e=(0,ea.A)(),r=(0,P.k)(),t=eK();return(0,o.useCallback)(function(a){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"1.1.0";return(0,c._)(function(){var i,s,o,u,c,d,m,f,p,h,y;return(0,g.YH)(this,function(g){switch(g.label){case 0:if(!r)return[2];return[4,t(a.layer)];case 1:if(!(u=g.sent())||((d=a.layer.getSource())instanceof Z()&&(c=d.getUrl()),d instanceof er()&&(c=(m=d.getUrls())?m[0]:void 0),!c))return[2];return c.endsWith("?")&&(c=c.slice(0,-1)),f=null==(s=u.featureTypes[0])||null==(i=s.properties)?void 0:i.find(e=>eW(e.type)),(p=new(ed())({version:n}).writeGetFeature({srsName:r.getView().getProjection().getCode(),featureNS:u.targetNamespace,featurePrefix:u.targetPrefix,featureTypes:[null==d?void 0:d.getParams().LAYERS],outputFormat:"application/json",maxFeatures:a.maxFeatures,propertyNames:a.propertyNames&&(null==f?void 0:f.name)?[...a.propertyNames,null==f?void 0:f.name]:void 0,bbox:a.bbox,filter:a.filter instanceof e0()?a.filter:void 0,geometryName:null==f?void 0:f.name}))instanceof Element&&a.filter instanceof Element&&p.getElementsByTagName("Query")[0].appendChild(a.filter),h={"Content-Type":"application/json"},[4,fetch(c,{method:"POST",headers:(null==(o=a.layer)?void 0:o.get("useBearerToken"))?(0,l._)({},h,(0,et.M)(null==e?void 0:e.getKeycloak())):h,body:new XMLSerializer().serializeToString(p)})];case 2:if(!(y=g.sent()).ok)throw Error("No successful response while executing a WFS-GetFeature");return[4,y.json()];case 3:return[2,g.sent()]}})})()},[e,t,r])},e2=t(82526),e3=t(62193),e4=t.n(e3),e5=t(58980),e8=t.n(e5),e6=t(59804),e7=t(14592),e9=t.n(e7),re=t(37720),rr=t(25108),rt=t(63322),ra=()=>{var e=(0,o.useCallback)((e,r)=>Number(getComputedStyle(document.body).getPropertyValue(e).replace("px",""))||r,[]);return(0,o.useCallback)(function(){var r,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=document.querySelector(".tool-menu"),n=null!=(r=null==a?void 0:a.clientWidth)?r:0,l=e("--headerHeight",50),i=e("--footerHeight",40),s=0;return t&&(s=e("--drawerWidth",450)),[l,s,i,n]},[e])},rn=e=>{var r=e.alignment,t=e.className,a=void 0===t?"":t,n=e.children,o=(0,eg._)(e,["alignment","className","children"]),u="toolbar",c=a?`${a} ${u}`:u;return(0,s.jsx)("div",(0,i._)((0,l._)({className:`${c} ${void 0===r?"horizontal":r}-toolbar`,role:"toolbar"},o),{children:n}))},rl=e=>{var r,t,a=e.feature,n=e.historyLength,u=void 0===n?10:n,c=(0,o.useRef)({past:[],future:[]}),g=(0,P.k)(),m=D(),f=ra(),p=(0,d._)((0,o.useState)(),2),h=p[0],y=p[1],v=(0,d._)((0,o.useState)(0),2)[1],b=(0,d._)((0,o.useState)(void 0),2),x=b[0],j=b[1],w=(0,o.useMemo)(()=>new(e8()),[]),A=O(e=>e.editFeature.userEditMode),_=O(e=>e.editFeature.formDirty);(0,o.useEffect)(()=>{if(g)return h||y(rt.y.getDigitizeLayer(g)),()=>{h&&(null==g||g.removeLayer(h))}},[h,g]),(0,o.useEffect)(()=>{c.current.past.length>0&&!_&&m((0,e_.RB)(!0))},[m,c.current.past]),(0,o.useEffect)(()=>{if(h&&(null==a?void 0:a.id)){null==(e=h.getSource())||e.clear();var e,r=w.readFeature(a);if(!Array.isArray(r)){var t=h.getSource();t&&(t.addFeature(r),v(e=>e+1),(0,eu.isEmpty)(t.getExtent())||null==g||g.getView().fit(t.getExtent(),{padding:f(!0)}))}}},[a,h,w,g,f]);var S=()=>{var e,r=null==h||null==(e=h.getSource())?void 0:e.getFeatures();if(r){var t=w.writeFeaturesObject(r);c.current=(0,i._)((0,l._)({},c.current),{past:[...c.current.past,t].slice(-10)}),v(e=>e+1)}},C={tooltipPlacement:"left",tooltipProps:{mouseEnterDelay:.5}};return h&&A.includes("EDIT_GEOMETRY")?(0,s.jsxs)(rn,{className:"geometry-edit-tb",alignment:"vertical",children:[(0,s.jsxs)(rr.ToggleGroup,{selected:x,onChange:(e,r)=>{j(r)},children:[A.includes("CREATE")?(0,s.jsx)(e9(),(0,l._)({value:"create",icon:(0,s.jsx)(eF.g,{icon:eT.zLW}),pressedIcon:(0,s.jsx)(eF.g,{icon:eT.zLW}),name:"draw",digitizeLayer:h,tooltip:(0,e2.t)("EditFeatureGeometryToolbar.draw"),drawType:a.geometry.type,onDrawEnd:e=>{if(!a.geometry.type.toLocaleLowerCase().startsWith("multi")){var r=null==h?void 0:h.getSource(),t=null==r?void 0:r.getFeatures()[0];t&&(null==r||r.once("addfeature",e=>r.removeFeature(e.feature)),t.setGeometry(e.feature.getGeometry()))}S()}},C)):(0,s.jsx)(s.Fragment,{}),A.includes("UPDATE")?(0,s.jsx)(re.ModifyButton,(0,l._)({value:"update",icon:(0,s.jsx)(eF.g,{icon:eT.mSI}),pressedIcon:(0,s.jsx)(eF.g,{icon:eT.mSI}),name:"edit",digitizeLayer:h,tooltip:(0,e2.t)("EditFeatureGeometryToolbar.edit"),onModifyStart:S,onModifyEnd:S,onTranslateEnd:S},C)):(0,s.jsx)(s.Fragment,{}),A.includes("DELETE")?(0,s.jsx)(e6.DeleteButton,(0,l._)({value:"delete",icon:(0,s.jsx)(eF.g,{icon:eT.yLS}),pressedIcon:(0,s.jsx)(eF.g,{icon:eT.yLS}),name:"delete",digitizeLayer:h,tooltip:(0,e2.t)("EditFeatureGeometryToolbar.delete"),onFeatureRemove:S},C)):(0,s.jsx)(s.Fragment,{})]}),(0,s.jsx)(F(),(0,l._)({icon:(0,s.jsx)(eF.g,{icon:eT.U23}),tooltip:(0,e2.t)("EditFeatureGeometryToolbar.undo"),onClick:()=>{var e=null==h?void 0:h.getSource(),r=null==e?void 0:e.getFeatures();if(r){var t=w.writeFeaturesObject(r),a=c.current.past[c.current.past.length-1];e4()(a)||(null==e||e.clear(),null==e||e.addFeatures(w.readFeatures(a)),c.current={past:c.current.past.slice(0,-1),future:[...c.current.future,t].slice(-u)},v(e=>e+1))}},disabled:(null==(r=c.current.past)?void 0:r.length)===0},C)),(0,s.jsx)(F(),(0,l._)({icon:(0,s.jsx)(eF.g,{icon:eT.U23,flip:"horizontal"}),tooltip:(0,e2.t)("EditFeatureGeometryToolbar.redo"),onClick:()=>{var e=null==h?void 0:h.getSource(),r=null==e?void 0:e.getFeatures();if(r){var t=w.writeFeaturesObject(r),a=c.current.future[c.current.future.length-1];e4()(a)||(null==e||e.clear(),null==e||e.addFeatures(w.readFeatures(a)),c.current={future:c.current.future.slice(0,-1),past:[...c.current.past,t].slice(-u)},v(e=>e+1))}},disabled:(null==(t=c.current.future)?void 0:t.length)===0},C))]}):(0,s.jsx)(s.Fragment,{})},ri=t(1415),rs=e=>{var r=e.tabConfig,t=e.form,a=e.initialValues,n=(0,eg._)(e,["tabConfig","form","initialValues"]),i=null==r?void 0:r.map((e,r)=>({label:e.title,key:`${r}`,forceRender:!0,children:(0,s.jsx)(eG,{name:e.title,form:t,initialValues:a,formConfig:e.children})}));return(0,s.jsx)(ri.A,(0,l._)({items:i},n))},ro=e=>{var r=e.feature,t=e.layer,a=e.onError,n=void 0===a?()=>{}:a,u=e.onSuccess,m=void 0===u?()=>{}:u,f=(0,eg._)(e,["feature","layer","onError","onSuccess"]),p=(0,d._)((0,o.useState)(!1),2),h=p[0],y=p[1],v=(0,C.useTranslation)().t,b=(0,P.k)(),x=eJ(),j=en();return(0,s.jsx)(eR.A,{title:v("DeleteButton.confirm"),onConfirm:()=>(0,c._)(function(){var e,a,l,i;return(0,g.YH)(this,function(s){switch(s.label){case 0:if(!b||!t||!(0,Q.lb)(t))return[2];s.label=1;case 1:return s.trys.push([1,4,5,6]),y(!0),[4,x({deleteFeatures:Array.isArray(a=new(e8())().readFeature(r))?a:[a],layer:t})];case 2:if(!(l=s.sent()))return[2];return[4,j({layer:t,transaction:l})];case 3:return s.sent(),null==(e=t.getSource())||e.refresh(),m(),[3,6];case 4:return i=s.sent(),k.A.error(i),n(i),[3,6];case 5:return y(!1),[7];case 6:return[2]}})})(),placement:"bottomRight",children:(0,s.jsx)(eE.Ay,(0,i._)((0,l._)({type:"primary",loading:h,disabled:!r.id,danger:!0,icon:(0,s.jsx)(eF.g,{icon:eT.yLS})},f),{children:v("DeleteButton.title")}))})},ru=e=>{var r=e.feature,t=e.form,a=(0,eg._)(e,["feature","form"]),n=(0,C.useTranslation)().t,o=(0,P.k)(),u=D();return(0,s.jsx)(eE.Ay,(0,i._)((0,l._)({type:"primary",onClick:()=>{if(t.resetFields(),u((0,e_.RB)(!1)),o){var e=rt.y.getDigitizeLayer(o);if(e){null==(a=e.getSource())||a.clear();var a,n,l=new(e8())().readFeature(r);if(Array.isArray(l))return;null==(n=e.getSource())||n.addFeature(l)}}},icon:(0,s.jsx)(eF.g,{icon:eT.ub2})},a),{children:n("ResetButton.title")}))},rc=e=>{var r=e.loadComplete,t=void 0!==r&&r;return(0,s.jsx)("div",{className:t?"feedback-icon":"feedback-icon hidden",children:(0,s.jsx)("div",{className:t?"checkmark":"checkmark-hidden"})})},rd=e=>{var r=e.form,t=e.layer,a=e.onError,n=void 0===a?()=>{}:a,u=e.onSuccess,m=void 0===u?()=>{}:u,f=(0,eg._)(e,["form","layer","onError","onSuccess"]),p=(0,d._)((0,o.useState)(!1),2),h=p[0],y=p[1],v=(0,d._)((0,o.useState)(!1),2),b=v[0],x=v[1],j=(0,P.k)(),w=eJ(),A=en(),_=D(),S=O(e=>e.editFeature.formDirty),E=(0,C.useTranslation)().t;return(0,s.jsxs)(eE.Ay,(0,i._)((0,l._)({className:"save-button",type:"primary",onClick:()=>(0,c._)(function(){var e,a,l,i,s,o,u,c;return(0,g.YH)(this,function(d){switch(d.label){case 0:if(!j||!t||!(0,Q.lb)(t))return[2];if(!(a=rt.y.getDigitizeLayer(j)))return k.A.error("Cannot find the digitize layer"),n(),[2];if(!(l=null==(e=a.getSource())?void 0:e.getFeatures())||0===l.length)return k.A.error("Cannot save feature without geometry"),n(E("SaveButton.errorNoGeometry")),[2];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,r.validateFields()];case 2:return d.sent(),[3,4];case 3:return n(i=d.sent()),k.A.warn("Validation has failed: ",i),[2];case 4:return d.trys.push([4,7,8,9]),y(!0),[4,w({upsertFeatures:l,form:r,layer:t})];case 5:if(!(o=d.sent()))return[2];return[4,A({layer:t,transaction:o})];case 6:return u=d.sent(),null==(s=t.getSource())||s.refresh(),x(!0),setTimeout(()=>{x(!1)},3e3),_((0,e_.RB)(!1)),m(u),[3,9];case 7:return c=d.sent(),k.A.error(c),n(c),[3,9];case 8:return y(!1),[7];case 9:return[2]}})})(),loading:h,disabled:!S,icon:(0,s.jsx)(eF.g,{icon:eT.jkA})},f),{children:[E("SaveButton.title"),(0,s.jsx)(rc,{loadComplete:b})]}))},rg=e=>{var r=e.feature,t=e.layer,a=e.form,n=e.onSaveSuccess,l=e.onSaveError,i=e.onDeleteSuccess,o=e.onDeleteError,u=O(e=>e.editFeature.userEditMode);return(0,s.jsxs)("div",{className:"edit-feature-toolbar",children:[u.includes("CREATE")||u.includes("UPDATE")?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ru,{feature:r,form:a}),(0,s.jsx)(rd,{form:a,layer:t,onSuccess:void 0===n?()=>{}:n,onError:void 0===l?()=>{}:l})]}):(0,s.jsx)(s.Fragment,{}),u.includes("DELETE")&&(0,s.jsx)(ro,{feature:r,layer:t,onSuccess:void 0===i?()=>{}:i,onError:void 0===o?()=>{}:o})]})},rm=e=>{var r=e.feature,t=e.layer,a=(0,C.useTranslation)().t,n=e1(),m=eM(),f=(0,d._)((0,o.useState)(),2),p=f[0],h=f[1],y=(0,d._)((0,o.useState)(),2),v=y[0],b=y[1],x=(0,d._)((0,o.useState)(),2),j=x[0],w=x[1],A=(0,d._)((0,eO.useForm)(),1)[0],_=(0,P.k)(),S=D(),E=(0,ea.A)(),N=(0,o.useCallback)(e=>(0,c._)(function(){var r,a,l,i;return(0,g.YH)(this,function(s){switch(s.label){case 0:if(!t||!(0,Q.lb)(t))return[2];return a=(r=document.implementation.createDocument(null,"root")).createElement("Filter"),(l=r.createElement("ResourceId")).setAttribute("rid",e),a.appendChild(l),r.documentElement.appendChild(a),[4,n({layer:t,filter:a},"2.0.0")];case 1:return(null==(i=s.sent())?void 0:i.features[0])&&S((0,e_.J7)(null==i?void 0:i.features[0])),[2]}})})(),[S,n,t]),L=(0,o.useCallback)(()=>(0,c._)(function(){var e,a;return(0,g.YH)(this,function(n){switch(n.label){case 0:if(!_||!E)return[2];if((null==(e=t.get("editFormConfig"))?void 0:e.length)===0)return k.A.warn(`Layer ${t.get("name")} has no 'editFormConfig' set`),[2];return[4,Promise.all(Object.entries(a=structuredClone(null==r?void 0:r.properties)||{}).map(r=>{var t=(0,d._)(r,2),n=t[0],s=t[1];return(0,c._)(function(){var r,t,o,u,d,f,p,h;return(0,g.YH)(this,function(y){switch(y.label){case 0:if((null==(r=null==e?void 0:e.filter(e=>{var r;return null==(r=e.children)?void 0:r.find(e=>e.propertyName===n)}))?void 0:r.length)>1&&k.A.warn(`Property ${n} is configured in multiple tabs. Is this intended?`),!(r&&r[0]))return[3,7];if((null==(t=r[0].children)?void 0:t.some(e=>e.propertyName===n&&"DATE"===e.component))&&((d=ei()(s)).isValid()?a[n]=d:(k.A.warn("Could not parse date"),a[n]=null)),!(null==(o=r[0].children)?void 0:o.some(e=>e.propertyName===n&&"UPLOAD"===e.component)))return[3,6];if(!s)return[3,5];y.label=1;case 1:if(y.trys.push([1,3,,4]),!ez((f=JSON.parse(s))[0]))throw Error("File config is no valid SHOGun file.");return p=f,a[n]=p,[4,Promise.all(p.map(e=>(0,c._)(function(){var r,t,a,n,s,o;return(0,g.YH)(this,function(u){switch(u.label){case 0:if(!(n=null==(t=p[0].response)||null==(r=t.fileType)?void 0:r.startsWith("image/")))return[3,2];return[4,m(`${E.getBasePath()}imagefiles/${null==e||null==(a=e.response)?void 0:a.fileUuid}/thumbnail`)];case 1:return o=u.sent(),[3,3];case 2:o=void 0,u.label=3;case 3:return s=o,[2,(0,i._)((0,l._)({},e),{thumbUrl:s,url:n?void 0:e.url})]}})})()))];case 2:return a[n]=y.sent(),[3,4];case 3:return h=y.sent(),k.A.error("Could not parse file list from JSON config: ",h),a[n]=[],[3,4];case 4:return[3,6];case 5:a[n]=[],y.label=6;case 6:if(null==(u=r[0].children)?void 0:u.some(e=>e.propertyName===n&&"REFERENCE_TABLE"===e.component))try{a[n]=JSON.parse(a[n])}catch(e){k.A.warn("Could not parse the input for the REFERENCE_TABLE",e)}y.label=7;case 7:return[2]}})})()}))];case 1:return n.sent(),b(a),A.resetFields(),A.setFieldsValue(a),h(e),[2]}})})(),[_,E,t,null==r?void 0:r.properties,A,m]);return(0,o.useEffect)(()=>{L()},[L]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(rl,{feature:r}),j&&(0,s.jsx)(G.A,{className:"error-alert",message:j,type:"error",showIcon:!0}),(0,s.jsx)(rg,{feature:r,layer:t,form:A,onSaveSuccess:e=>{if(e){w(void 0);var t,a=null==(t=new DOMParser().parseFromString(e,"text/xml").getElementsByTagName("ogc:FeatureId").item(0))?void 0:t.getAttribute("fid");if("none"===a){var n=r.id;if(!n)return;N(n)}else a&&N(a)}},onSaveError:e=>{if("object"==typeof e&&null!==e&&"errorFields"in e){var r;w((r=[],(e.errorFields||[]).forEach(e=>{Array.isArray(e.errors)&&r.push(...e.errors)}),r.map((e,t)=>(0,s.jsxs)(u().Fragment,{children:[e,t!==r.length-1&&(0,s.jsx)("br",{})]},t))))}else"string"==typeof e?w(e):w(a("EditFeatureFullForm.saveErrorMsg"))},onDeleteSuccess:()=>{w(void 0),S((0,e_.J7)(null))},onDeleteError:()=>{w(a("EditFeatureFullForm.deleteErrorMsg"))}}),(0,s.jsx)(rs,{tabConfig:p,initialValues:v,form:A})]})},rf=e=>{var r,t,a,n,i,u,m,f=e.layer,p=e.onLockSuccess,h=void 0===p?()=>{}:p,y=e.onLockError,v=void 0===y?()=>{}:y,b=e.onCreate,x=void 0===b?()=>{}:b,j=(0,d._)((0,o.useState)(!1),2),w=j[0],A=j[1],_=eK(),S=(r=(0,ea.A)(),(0,o.useCallback)(e=>(0,c._)(function(){var t,a,n,i,s,o,u,c;return(0,g.YH)(this,function(g){switch(g.label){case 0:if((n=e.layer.getSource())instanceof Z()&&(a=n.getUrl()),n instanceof er()&&(a=(i=n.getUrls())?i[0]:void 0),!a||(a.endsWith("?")&&(a=a.slice(0,-1)),!(s=(e=>{var r,t,a=e.feature.id,n=e.feature.properties;if(!a||!n)return void k.A.warn("Either the id of the feature or its properties (or even both) aren't available");t="number"==typeof a?a:parseInt(a.split(".")[1],10);var l=Object.entries(n).find(e=>{var r=(0,d._)(e,2)[1];return r===t||r===t.toString()});if(!l)return void k.A.warn("Count not detect the id property");var i=l[0],s=null==(r=e.layer.getSource())?void 0:r.getParams().LAYERS,o=document.createElementNS("https://www.opengis.net/wfs/2.0","LockFeature");o.setAttribute("service","WFS"),o.setAttribute("version","2.0.0"),o.setAttribute("expiry","300"),o.setAttribute("lockAction","SOME");var u=document.createElementNS("https://www.opengis.net/wfs/2.0","Query");u.setAttribute("typeNames",s);var c=document.createElementNS("https://www.opengis.net/fes/2.0","Filter"),g=document.createElementNS("https://www.opengis.net/fes/2.0","PropertyIsEqualTo"),m=document.createElementNS("https://www.opengis.net/fes/2.0","ValueReference"),f=document.createTextNode(i);m.appendChild(f);var p=document.createElementNS("https://www.opengis.net/fes/2.0","Literal"),h=document.createTextNode(t.toString());return p.appendChild(h),g.appendChild(m),g.appendChild(p),c.appendChild(g),u.appendChild(c),o.appendChild(u),o})({layer:e.layer,feature:e.feature}))))return[2];return o={"Content-Type":"application/xml"},[4,fetch(a,{method:"POST",headers:(null==(t=e.layer)?void 0:t.get("useBearerToken"))?(0,l._)({},o,(0,et.M)(null==r?void 0:r.getKeycloak())):o,body:new XMLSerializer().serializeToString(s)})];case 1:if(!(u=g.sent()).ok)throw Error("No successful response while executing a WFS-LockFeature");return[4,u.text()];case 2:if(c=g.sent(),new DOMParser().parseFromString(c,"text/xml").getElementsByTagName("wfs:FeaturesNotLocked").length>0)throw Error(`Error while locking a feature: ${c}`);return[2,c]}})})(),[r])),E=D(),N=(0,P.k)(),L=(0,C.useTranslation)().t,T=O(e=>e.editFeature.userEditMode);return t=e=>(0,c._)(function(){var r,t;return(0,g.YH)(this,function(a){switch(a.label){case 0:if(!(e.features.length&&(T.includes("UPDATE")||T.includes("DELETE"))))return[3,6];if(r=e.features[0],!f||!r)return[2];if(!K().wfsLockFeatureEnabled)return[3,5];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,S({layer:f,feature:r})];case 2:if(!(t=a.sent()))return[2];return E((0,e_.J7)(r)),h(t),[3,4];case 3:return v(a.sent()),[3,4];case 4:return[3,6];case 5:E((0,e_.J7)(r)),a.label=6;case 6:return[2]}})})(),n=(0,P.k)(),i=(0,ea.A)(),u=(0,o.useCallback)(e=>(0,c._)(function(){var r,s,o,u,c,d,m,p;return(0,g.YH)(this,function(g){switch(g.label){case 0:if(!n||!f||(r=e.coordinate,!(s=n.getView().getResolution()))||(u=null==(o=f.getSource())?void 0:o.getFeatureInfoUrl(r,s,n.getView().getProjection(),{INFO_FORMAT:"application/json",BUFFER:10}),c={"Content-Type":"application/json"},!u))return[2];g.label=1;case 1:return g.trys.push([1,4,5,6]),n.getTargetElement().style.cursor="wait",[4,fetch(u,{method:"GET",headers:f.get("useBearerToken")?(0,l._)({},c,(0,et.M)(null==i?void 0:i.getKeycloak())):c})];case 2:if(!(d=g.sent()).ok)throw Error("No successful response");return[4,d.json()];case 3:return m=g.sent(),t&&t(m),[3,6];case 4:return p=g.sent(),k.A.error("Error: ",p),a&&a(),[3,6];case 5:return n.getTargetElement().style.cursor="",[7];case 6:return[2]}})})(),[i,f,n,t,a]),m=(0,o.useCallback)(e=>{if(n&&f&&!e.dragging){var r=f.getData(e.pixel);if(r instanceof Uint8ClampedArray){var t=r&&r[3]>0;n.getTargetElement().style.cursor=t?"pointer":""}}},[f,n]),(0,o.useEffect)(()=>{if(n)return n.on("pointermove",m),n.on("singleclick",u),()=>{n.un("pointermove",m),n.un("singleclick",u)}},[n,m,u]),(0,s.jsxs)("div",{className:"edit-feature-switch",children:[T.includes("CREATE")&&(0,s.jsxs)(s.Fragment,{children:[T.includes("UPDATE")&&(0,s.jsx)("div",{children:L("EditFeatureSwitch.usageHint")}),(0,s.jsx)(eE.Ay,{loading:w,onClick:()=>(0,c._)(function(){var e;return(0,g.YH)(this,function(r){switch(r.label){case 0:return[4,(0,c._)(function(){var e,r,t,a,n;return(0,g.YH)(this,function(l){switch(l.label){case 0:if(!N||!f)return[2];l.label=1;case 1:return l.trys.push([1,3,4,5]),A(!0),[4,_(f)];case 2:if(!(t=l.sent()))return[2];switch(null==(a=null==(r=t.featureTypes[0])||null==(e=r.properties)?void 0:e.find(e=>eW(e.type)))?void 0:a.type){case"gml:MultiPoint":return[2,"MultiPoint"];case"gml:Point":return[2,"Point"];case"gml:MultiLineString":return[2,"MultiLineString"];case"gml:LineString":return[2,"LineString"];case"gml:MultiPolygon":return[2,"MultiPolygon"];case"gml:Polygon":return[2,"Polygon"];case"xsd:boolean":case"xsd:date":case"xsd:int":case"xsd:number":case"xsd:string":case void 0:return[2]}return[3,5];case 3:return n=l.sent(),k.A.error(n),[3,5];case 4:return A(!1),[7];case 5:return[2]}})})()];case 1:if(!(e=r.sent()))return[2];return E((0,e_.J7)({type:"Feature",properties:{},geometry:{type:e,coordinates:[]}})),x(),[2]}})})(),children:L("EditFeatureSwitch.createFeature")})]}),!T.includes("CREATE")&&(T.includes("UPDATE")||T.includes("DELETE"))&&(0,s.jsx)("div",{children:L("EditFeatureSwitch.limitedUsageHint")})]})},rp=e=>{var r=(0,a._)({},(0,n._)(e)),t=(0,C.useTranslation)().t,u=(0,d._)((0,o.useState)(),2),m=u[0],p=u[1],h=(0,d._)((0,o.useState)(!1),2),y=h[0],v=h[1],b=(0,d._)((0,o.useState)(t("EditFeatureDrawer.featureEditor")),2),x=b[0],j=b[1],w=O(e=>e.editFeatureDrawerOpen),A=O(e=>e.editFeature.layerId),_=O(e=>e.editFeature.feature),S=O(e=>e.editFeature.formDirty),E=(0,P.k)(),N=D(),T=eJ(),F=en();(0,o.useEffect)(()=>{if(E&&A){var e=L.B.getLayerByOlUid(E,A);if(!e||!(0,Q.lb)(e))return void k.A.warn(`Could not find layer with id ${A}`);j(`${t("EditFeatureDrawer.featureEditor")} - ${e.get("name")}`),p(e)}},[E,A,t]);var M=()=>(0,c._)(function(){return(0,g.YH)(this,function(e){switch(e.label){case 0:return[4,(0,c._)(function(){var e,r,t;return(0,g.YH)(this,function(a){switch(a.label){case 0:if(!m||!_||!_.id||!K().wfsLockFeatureEnabled)return[2];a.label=1;case 1:return a.trys.push([1,4,,5]),(e=new(q())).setId(_.id),[4,T({layer:m,deleteFeatures:[],upsertFeatures:[e]})];case 2:if(!(r=a.sent()))return[2];return[4,F({layer:m,transaction:r})];case 3:return a.sent(),[3,5];case 4:return t=a.sent(),k.A.error("Error while releasing the lock on the feature: ",t),[3,5];case 5:return[2]}})})()];case 1:return e.sent(),N((0,eq.jD)()),N((0,e_.RB)(!1)),N((0,e_.cL)()),v(!1),[2]}})})();return(0,s.jsxs)(eX,(0,i._)((0,l._)({className:"map-drawer edit-feature-drawer",onClose:()=>{m&&_&&S?f.A.confirm({maskClosable:!1,title:t("EditFeatureDrawer.closeDrawerWarnTitle"),content:t("EditFeatureDrawer.closeDrawerWarnContent"),okType:"danger",onOk:M}):M()},open:w,title:x},r),{children:[!m&&(0,s.jsx)(G.A,{message:t("EditFeatureDrawer.noLayerFoundError"),type:"error",showIcon:!0}),y&&(0,s.jsx)(G.A,{message:t("EditFeatureDrawer.isFeatureLockedErrorMsg"),type:"error",showIcon:!0}),m&&A&&!_&&(0,s.jsx)(rf,{layer:m,onLockSuccess:()=>{v(!1)},onLockError:()=>{v(!0)},onCreate:()=>{v(!1)}}),m&&_&&(0,s.jsx)(rm,{feature:_,layer:m})]}))},rh=t(63038),ry=t(54440),rv=t(92822),rb=t.n(rv),rx=t(96018),rj=t.n(rx),rw=t(94342),rA=t(63054),r_=t.n(rA),rS=t(95574),rC=e=>{var r,t=e.opener,a=(0,eg._)(e,["opener"]),n=(0,C.useTranslation)().t,c=O(e=>e.appInfo),g=O(e=>e.logoPath),m=O(e=>e.description),p=(0,d._)((0,o.useState)(!1),2),h=p[0],y=p[1],v=()=>{y(!h)};return r=t?u().cloneElement(t,{onClick:v}):(0,s.jsx)("button",{onClick:v,children:"Open"}),(0,s.jsxs)(s.Fragment,{children:[r,(0,s.jsxs)(f.A,(0,i._)((0,l._)({className:"application-info",title:n("ApplicationInfo.title"),centered:!0,open:h,onOk:v,onCancel:v,footer:null},a),{children:[(0,s.jsx)("img",{className:"logo",src:g,alt:"Logo"}),(0,s.jsx)("div",{className:"description",children:m}),(0,s.jsx)(rS.A,{title:n("ApplicationInfo.clientVersionTitle"),value:"10.1.1"}),c.version&&c.buildTime&&(0,s.jsx)(rS.A,{title:n("ApplicationInfo.backendVersionTitle"),value:`${c.version} (${c.buildTime})`})]}))]})},rk=e=>{var r,t,u=(0,a._)({},(0,n._)(e)),c=V(),d=(0,C.useTranslation)().t,g=O(e=>e.legal),m=(0,P.k)(),f=(e,r)=>{c.forEach(t=>{if((n=t.integration)&&"footer"===n.placement&&(null==(a=t.integration)?void 0:a.placementOrientation)===e){var a,n,l,i,o=t.key,u=t.wrappedComponent;r.splice(null!=(i=null==(l=t.integration)?void 0:l.insertionIndex)?i:0,0,(0,s.jsx)(u,{},o))}})};return((0,o.useEffect)(()=>{m&&(m.getControls().getArray().find(e=>e instanceof rj())||m.addControl(new(rj())({target:"scale-line-container"})))},[m]),(0,o.useEffect)(()=>{m&&(m.getControls().getArray().find(e=>e instanceof rb())||m.addControl(new(rb())({coordinateFormat:(0,rw.createStringXY)(2),projection:m.getView().getProjection(),target:"mouse-position"})))},[m]),m)?(0,s.jsxs)("div",(0,i._)((0,l._)({className:"footer"},u),{children:[(0,s.jsx)("div",{className:"item-container left-items",children:(f("left",r=[(0,s.jsx)("div",{id:"scale-line-container","aria-label":"scale-line"},"scale-line-container"),(0,s.jsx)(rh.A,{type:"vertical"},"scale-line-divider"),(0,s.jsxs)("div",{className:"scale-combo","aria-label":"scale-combo",children:[d("Footer.scale"),":\xa0",(0,s.jsx)(r_(),{"aria-label":"scalecombo-dropdown"}),(0,s.jsx)(rh.A,{type:"vertical"})]},"scale-combo-container"),(0,s.jsxs)("div",{className:"reference-system","aria-label":"reference-system",children:[d("Footer.refSystem"),": ",m.getView().getProjection().getCode(),(0,s.jsx)(rh.A,{type:"vertical"})]},"reference-system-container"),(0,s.jsxs)("div",{className:"mouse-position-wrapper",children:[d("Footer.mousePosition"),":\xa0",(0,s.jsx)("div",{id:"mouse-position",className:"mouse-position","aria-label":"mouse-position"})]},"mouse-position-container")]),r)}),(0,s.jsx)("div",{className:"item-container right-items",children:(t=[(0,s.jsx)(eE.Ay,{onClick:()=>{window.open(g.contact,"_blank")},type:"link",children:d("Footer.contact")},"open-contact"),(0,s.jsx)(eE.Ay,{onClick:()=>{window.open(g.imprint,"_blank")},type:"link",children:d("Footer.imprint")},"open-imprint"),(0,s.jsx)(eE.Ay,{onClick:()=>{window.open(g.privacy,"_blank")},type:"link",children:d("Footer.privacypolicy")},"open-privacy"),(0,s.jsx)(rC,{opener:(0,s.jsx)(ry.A,{title:d("Footer.aboutTooltip"),children:(0,s.jsx)(eE.Ay,{type:"link","aria-label":"info-opener",children:d("Footer.about")})})},"application-info")],c.length>0&&f("right",t),t)})]})):(0,s.jsx)(s.Fragment,{})},rE="documentationbutton",rN=e=>{var r=e.className,t=(0,C.useTranslation)().t,a=r?`${rE} ${r}`:rE;return(0,s.jsx)(ry.A,{title:t("DocumentationButton.tooltip"),children:(0,s.jsx)(eE.Ay,{type:"link","aria-label":"documentation-button",onClick:()=>window.open("/gis-docs","_blank"),className:a,icon:(0,s.jsx)(eF.g,{icon:eT.APe})})})},rL=t(31844),rT=t(94394),rF=t.n(rT),rP=t(53762),rM=t.n(rP),rD=t(47670),rO=t(42516),rU=t(22559),rB=t(14010),rI=t(77239),rR=t(97581),r$=t(51098),rV=t(48389),rY=t(40542),rH=t.n(rY),rz=t(47312),rG=t.n(rz),rW=t(66922),rK=t.n(rW),rJ=t(97562),rq=t.n(rJ),rQ=t(23712),rX=t(68314),rZ=t.n(rX),r0=t(98114),r1=e=>{var r,t,a=e.geocoderSearchEngine,n=e.dataSearchEngine,l=(0,P.k)(),i=(0,C.useTranslation)().t,u=D(),m=(0,o.useRef)(null),f=(0,o.useMemo)(()=>new(e8()),[]),h=(0,d._)((0,o.useState)(!!a),2),y=h[0],v=h[1],x=(0,d._)((0,o.useState)(!!n),2),j=x[0],w=x[1],A=(0,d._)((0,o.useState)(null==(t=null==(r=K().search)?void 0:r.defaultUseViewBox)||t),2),_=A[0],S=A[1],E=(0,d._)((0,o.useState)(""),2),N=E[0],L=E[1],T=(0,d._)((0,o.useState)(!1),2),F=T[0],M=T[1],O=(0,d._)((0,o.useState)(!1),2),U=O[0],B=O[1],I=(0,d._)((0,o.useState)(!1),2),R=I[0],$=I[1],V=(0,d._)((0,o.useState)([]),2),Y=V[0],H=V[1],z=ra();(0,o.useEffect)(()=>(window.addEventListener("mousedown",G),()=>{window.removeEventListener("mousedown",G)}),[]);var G=e=>{for(var r=e.target;r;)r=r.parentNode;m.current&&m.current.contains(e.target)||B(!1)},W=(0,o.useMemo)(()=>{var e={items:[{label:(0,s.jsx)(ef.A,{checked:_,onChange:e=>S(e.target.checked),children:i("MultiSearch.searchInViewBox")}),key:"viewbox"}]};return a&&e.items.push({label:(0,s.jsx)(ef.A,{checked:y,onChange:e=>v(e.target.checked),children:i("MultiSearch.searchGeocoder")}),key:"geocoder"}),n&&e.items.push({label:(0,s.jsx)(ef.A,{checked:j,onChange:e=>w(e.target.checked),children:i("MultiSearch.searchData")}),key:"data"}),e},[_,i,a,n,y,j]),J=(0,o.useCallback)(()=>(0,c._)(function(){var e,r,t,i,s,o,u,c,d,m,f,p;return(0,g.YH)(this,function(g){switch(g.label){case 0:if(!l||!y&&!j)return[2];if(t=null!=(r=null==(e=K().search)?void 0:e.minChars)?r:3,N.length<t)return q(),[2];if(M(!0),_&&(o=null==l?void 0:l.getView().getProjection(),(u=null==l||null==(s=l.getView())?void 0:s.calculateExtent())&&(i=(0,rO.transformExtent)(u,o,"EPSG:4326"))),c=[],!(j&&n))return[3,5];g.label=1;case 1:return g.trys.push([1,3,4,5]),[4,n(N,i)];case 2:if(!(d=g.sent()))throw Error("No response from data search engine.");return c.push(...d),[3,5];case 3:return m=g.sent(),k.A.error("Error while data search: \n",m),[3,5];case 4:return y||M(!1),[7];case 5:if(!(y&&a))return[3,10];g.label=6;case 6:return g.trys.push([6,8,9,10]),[4,a(N,i)];case 7:if(!(f=g.sent()))throw Error("No response from geocoder search engine.");return c.push(...f),[3,10];case 8:return p=g.sent(),k.A.error("Error while geocoder search: \n",p),[3,10];case 9:return M(!1),[7];case 10:return H(c.every(e=>0===e.features.length)?[]:c),B(!0),[2]}})})(),[l,y,j,N,_,n,a]);(0,o.useEffect)(()=>{var e,r,t=setTimeout(()=>{J()},null!=(r=null==(e=K().search)?void 0:e.delay)?r:1e3);return()=>clearTimeout(t)},[J]);var q=()=>{H([])},Q=e=>{var r=e.feature.get("layer");if(null==r?void 0:r.get("editable"))return[(0,s.jsx)(s.Fragment,{})]},X=(0,o.useMemo)(()=>new(rq())({stroke:new(rK())({color:"rgb(255,0,0)",width:2}),fill:new(rG())({color:"rgba(255,255,255, 0.5)"}),image:new(rH())({radius:10,fill:new(rG())({color:"rgba(255,255,255, 0.5)"}),stroke:new(rK())({color:"rgb(255,0,0)",width:3})})}),[]);return(0,s.jsxs)("div",{className:"multi-search",ref:m,children:[(0,s.jsxs)(r$.A.Compact,{children:[(0,s.jsx)(p.A,{value:N,disabled:!y&&!j,onChange:e=>{M(""!==e.target.value),L(e.target.value)},allowClear:!0,onFocus:()=>B(!0),placeholder:y&&j?i("MultiSearch.searchPlaceholder"):!y&&j?i("MultiSearch.searchPlaceholderDataOnly"):y&&!j?i("MultiSearch.searchPlaceholderGeocoderOnly"):void 0,prefix:(0,s.jsx)(rU.A,{}),suffix:F?(0,s.jsx)(rB.A,{}):null}),(0,s.jsx)(rV.A,{menu:W,trigger:["click"],onOpenChange:$,open:R,children:(0,s.jsx)(ry.A,{title:i("MultiSearch.settingsTooltip"),placement:"right",children:(0,s.jsx)(eE.Ay,{icon:(0,s.jsx)(rI.A,{})})})})]}),(()=>{if(N.length<2||!U||F||!Y)return null;var e=Y.length;return 0===e?(0,s.jsx)("div",{className:"no-search-result-div",children:(0,s.jsx)(rR.A,{image:rR.A.PRESENTED_IMAGE_SIMPLE})}):(0,s.jsx)(rZ(),{searchResults:Y,numTotal:e,accordion:!0,searchTerms:N.split(" "),actionsCreator:Q,layerStyle:X,onClick:e=>{if(B(!1),(i=null==(a=e.feature.getGeometry())?void 0:a.getExtent())&&(null==l||l.getView().fit(i,{size:l.getSize(),padding:z(null==(n=K().search)?void 0:n.showSearchResultDrawer)})),(null==(r=K().search)?void 0:r.activateLayerOnClick)&&(c=null==(s=e)||null==(o=s.feature)?void 0:o.get("layer"))&&l&&!c.getVisible()&&(c.setVisible(!0),rQ.s2.setParentsVisible(l,l.getLayerGroup().getLayers(),(0,b.getUid)(c))),null==(t=K().search)?void 0:t.showSearchResultDrawer){var r,t,a,n,i,s,o,c,d,g,m=f.writeFeatureObject(e.feature),p=(null==(d=m.properties)?void 0:d.layer)===void 0;null==(g=m.properties)||delete g.layer,u((0,r0.tB)({geoJSONFeature:m,layerId:p?null:(0,b.getUid)(e.feature.get("layer")),drawerVisibility:!0})),L("")}}})})()]})},r2=e=>{var r,t,i,u,m,f,p,h,y,v,b,x,j,w=(0,a._)({},(0,n._)(e)),A=O(e=>e.searchEngines.includes("nominatim")),_=O(e=>e.searchEngines.includes("solr")),S=O(e=>e.searchEngines.includes("wfs")),E=(r=(0,P.k)(),t=e1(),i=eK(),u=(0,o.useCallback)((e,r)=>e.replace(/{\s*(\w+?)\s*}/g,(e,t)=>r.getProperties()[t]||""),[]),m=(0,o.useCallback)((e,r,t)=>{var a=null==t?void 0:t.get("searchConfig");if(null==a?void 0:a.displayTemplate)return u(a.displayTemplate,r);var n=!0,l=!1,i=void 0;try{for(var s,o=Object.entries(r.getProperties())[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var c=(0,d._)(s.value,2),g=c[0],m=c[1],f=null==m?void 0:m.toString();if(f.toLowerCase().indexOf(null==e?void 0:e.toLowerCase())>-1)return`${f} [${g}]`}}catch(e){l=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(l)throw i}}return r.getId()},[u]),(0,o.useCallback)((e,a)=>(0,c._)(function(){var n,l,s,o,u,c,d,f,p,h,y,v,b,x,j,w,A,_,S,C;return(0,g.YH)(this,function(E){switch(E.label){case 0:if(!r)return[2];if(0===(n=r.getAllLayers().filter(e=>e.get("searchable"))).length)return k.A.warn("No queryable layer found."),[2];l=[],s=[],o=!0,u=!1,c=void 0,E.label=1;case 1:E.trys.push([1,6,7,8]),d=function(){var n,o,u,c,d,m,f,h,y,v,b,x,j;return(0,g.YH)(this,function(g){switch(g.label){case 0:if(n=p.value,!(0,Q.lb)(n))return k.A.warn("Layer type not supported in search: ",n),[2,"continue"];if(!((d=null==n?void 0:n.get("searchConfig"))&&d.attributes))return k.A.warn("No search configuration given for layer: ",n),[2,"continue"];return[4,i(n)];case 1:if(!(m=g.sent()))return k.A.warn("No successful DescribeFeatureType for layer: ",n),[2,"continue"];if(!(f=null==(u=n.getSource())||null==(o=u.getParams())?void 0:o.LAYERS))return k.A.warn("No layer name available for layer: ",n),[2,"continue"];if(!(h=m.featureTypes.find(e=>{var r;return e.typeName===f||e.typeName===(null==(r=f.split(":"))?void 0:r[1])})))return k.A.warn("No corresponding feature type for layer: ",n),[2,"continue"];if(0===(y=d.attributes.map(r=>{var t=h.properties.find(e=>e.name===r);if(!t)return k.A.warn(`Attribute "${r}" not found in feature type "${h.typeName}" for layer "${n.get("name")}".`),null;if("string"===t.localType)return(0,rD.like)(r,`*${e}*`,"*",".","!",!1);if("number"!==t.localType&&"int"!==t.localType)return k.A.warn(`Attribute "${r}" with type "${t.localType}" not supported for search in layer "${n.get("name")}".`),null;var a=Number(e);return isNaN(a)?null:(0,rD.equalTo)(r,a)}).filter(e=>null!==e)).length)return k.A.warn("No valid filter available for layer: ",n),[2,"continue"];return v=[],d.displayTemplate&&(b=/{\s*(\w+?)\s*}/g,v.push(...Array.from(d.displayTemplate.matchAll(b),e=>e[1]))),(null==(c=K().search)?void 0:c.showSearchResultDrawer)&&d.resultDrawerConfig&&v.push(...(null==(j=d.resultDrawerConfig)||null==(x=j.children)?void 0:x.map(e=>e.propertyName))||[]),l.push(t({layer:n,filter:1===y.length?y[0]:(0,rD.or)(...y),bbox:a?(0,rO.transformExtent)(a,"EPSG:4326",r.getView().getProjection()):void 0,maxFeatures:10,propertyNames:d.resultDrawerConfig?Array.from(new Set(v)):void 0})),s.push(n),[2]}})},f=n[Symbol.iterator](),E.label=2;case 2:if(o=(p=f.next()).done)return[3,5];return[5,(0,g.Ju)(d())];case 3:E.sent(),E.label=4;case 4:return o=!0,[3,2];case 5:return[3,8];case 6:return h=E.sent(),u=!0,c=h,[3,8];case 7:try{o||null==f.return||f.return()}finally{if(u)throw c}return[7];case 8:return[4,Promise.allSettled(l)];case 9:v=(y=E.sent().map((e,r)=>({value:"fulfilled"===e.status?e.value:void 0,reason:"rejected"===e.status?e.reason:void 0,status:e.status,layer:s[r]}))).filter(e=>"fulfilled"===e.status),y.filter(e=>"rejected"===e.status).forEach(e=>{k.A.error(`Error while fetching the layer search results for layer "${e.layer.get("name")}": `,e.reason)}),b=new(e8()),x=[],j=!0,w=!1,A=void 0;try{for(_=function(){var t=C.value,a=b.readFeatures(t.value,{featureProjection:r.getView().getProjection()});a.forEach(r=>{r.set("title",m(e,r,t.layer)),r.set("layer",t.layer)}),x.push({title:t.layer.get("name"),features:a})},S=v[Symbol.iterator]();!(j=(C=S.next()).done);j=!0)_()}catch(e){w=!0,A=e}finally{try{j||null==S.return||S.return()}finally{if(w)throw A}}return[2,x]}})})(),[t,i,m,r])),N=(f=(0,P.k)(),p=(0,ea.A)(),h=(0,o.useCallback)(e=>(0,c._)(function(){var r,t,a,n,i,s,o,u,c;return(0,g.YH)(this,function(d){switch(d.label){case 0:return a={q:e.query,rows:null!=(r=e.rowsPerQuery)?r:100,defType:null!=(t=e.queryParser)?t:"edismax"},e.fieldList?a.qf=e.fieldList:a.qf=null!=(n=e.coreName)?n:"search",e.viewBox&&(a.fq=`geometry:[${e.viewBox[1]},${e.viewBox[0]} TO ${e.viewBox[3]},${e.viewBox[2]}]`),e.useSolrHighlighting&&(a.hl=!0,a["hl.fl"]="*",a["hl.tag.pre"]=null!=(i=e.tagPre)?i:"<b>",a["hl.tag.post"]=null!=(s=e.tagPost)?s:"</b>",a["hl.requireFieldMatch"]=null==(o=e.requireFieldMatch)||o),u={"Content-Type":"application/json"},[4,fetch(e.searchUrl,{method:"POST",headers:(0,l._)({},u,(0,et.M)(null==p?void 0:p.getKeycloak())),body:JSON.stringify(a)})];case 1:if(!(c=d.sent()).ok)throw Error("Failed to execute Solr query");return[4,c.json()];case 2:return[2,d.sent()]}})})(),[p]),y=(0,o.useCallback)((e,r)=>e.replace(/{\s*(\w+?)\s*}/g,(e,t)=>{var a;return(null==(a=r[t])?void 0:a.toString())||""}),[]),v=(0,o.useCallback)((e,r,t)=>{if(!f)return"";var a=L.B.getLayerByNameParam(f,r.featureType[0]),n=null==a?void 0:a.get("searchConfig"),l=["geometry"],i="";if(null==n?void 0:n.displayTemplate)return y(n.displayTemplate,r);if(t){var s=Object.keys(t).filter(e=>!l.includes(e));if(s.length>0){var o=t[s[0]];return`${o} [${s[0]}]`}}return Object.keys(r).filter(e=>!l.includes(e)).forEach(t=>{var a,n=null==(a=r[t])?void 0:a.toString();!i&&n.toLowerCase().indexOf(e.toLowerCase())>-1&&(i=`${n} [${t}]`)}),i||(i=r.id),i},[f,y]),b=(0,o.useCallback)((e,r)=>{var t=["category","id","featureType","geometry","search","_version_"];Object.keys(r).filter(e=>!t.includes(e)).forEach(t=>{var a=r[t];void 0!==a&&e.set(t,a)})},[]),(0,o.useCallback)((e,r)=>(0,c._)(function(){var t,a,n,i,s,o,u,c,m,p,y,x,j,w,A,_,S,C,E,N,T,F,P,M,D,O,U,B,I,R,$,V,Y;return(0,g.YH)(this,function(g){switch(g.label){case 0:var H,z,G,W,J,X;if(!f)return[2];i=null!=(n=null==(t=K().search)?void 0:t.solrBasePath)?n:"/search/query",z=(H={searchValue:e,map:f}).searchValue,G=H.map,W=z.trim().replaceAll(/[()\\\-_.//]/g," ").split(" ").map(e=>e.trim()).filter(e=>""!==e),J=[],X=G.getAllLayers().filter(e=>e.get("searchable")),Object.entries(rF()(X,e=>{var r;return null==(r=e.get("searchConfig"))?void 0:r.attributes})).forEach(e=>{var r=(0,d._)(e,2),t=r[0],a=r[1].filter(e=>(0,Q.lb)(e)).map(e=>{var r,t;return null==(t=e.getSource())||null==(r=t.getParams())?void 0:r.LAYERS}).map(e=>`featureType:"${e}"`).join(" OR "),n=`(${a}) AND (${W.map(e=>`(${e.trim()}^4 OR *${e.trim()}*^2 OR ${e.trim()}~1)`).join(" AND ")})`;J.push({query:n,fieldList:"undefined"!==t?t.split(",").join(" "):void 0})}),s=J,o=[],u=!0,c=!1,m=void 0;try{for(p=s[Symbol.iterator]();!(u=(y=p.next()).done);u=!0)x=y.value,o.push(h({searchUrl:i,query:x.query,fieldList:x.fieldList,rowsPerQuery:null==(w=K().search)||null==(j=w.solrQueryConfig)?void 0:j.rowsPerQuery,queryParser:null==(_=K().search)||null==(A=_.solrQueryConfig)?void 0:A.queryParser,coreName:null==(S=K().search)?void 0:S.coreName,useSolrHighlighting:null==(C=K().search)?void 0:C.useSolrHighlighting,tagPre:null==(N=K().search)||null==(E=N.solrQueryConfig)?void 0:E.tagPre,tagPost:null==(F=K().search)||null==(T=F.solrQueryConfig)?void 0:T.tagPost,requireFieldMatch:null==(M=K().search)||null==(P=M.solrQueryConfig)?void 0:P.requireFieldMatch,viewBox:r}))}catch(e){c=!0,m=e}finally{try{u||null==p.return||p.return()}finally{if(c)throw m}}return[4,Promise.allSettled(o)];case 1:return O=(D=g.sent().map(e=>({value:"fulfilled"===e.status?e.value:void 0,reason:"rejected"===e.status?e.reason:void 0,status:e.status}))).filter(e=>"fulfilled"===e.status),D.filter(e=>"rejected"===e.status).forEach(e=>{k.A.error("Error while fetching the solr results for layer ",e.reason)}),U=O.flatMap(e=>{var r,t;return null==(t=e.value)||null==(r=t.response)?void 0:r.docs}).filter(e=>e),B=Object.assign({},...O.map(e=>{var r;return null==(r=e.value)?void 0:r.highlighting})),I=new(rM()),R=[],(null==(a=K().search)?void 0:a.groupByCategory)?$=rF()(U,e=>{var r;return null==e||null==(r=e.category)?void 0:r[0]}):(V=f.getAllLayers().filter(e=>e.get("searchable")),Y=U.map(e=>{var r,t=null==(r=V.filter(e=>(0,Q.lb)(e)).find(r=>{var t,a,n;return(null==(a=r.getSource())||null==(t=a.getParams())?void 0:t.LAYERS)===(null==e||null==(n=e.featureType)?void 0:n[0])}))?void 0:r.get("name");return(0,l._)({layerTitle:t},e)}),$=rF()(Y,e=>null==e?void 0:e.layerTitle)),Object.keys($).forEach(r=>{var t=$[r].map(r=>{if(null==r||null==(l=r.geometry)?void 0:l[0]){var t=r.id,a=I.readGeometry(r.geometry[0],{dataProjection:"EPSG:4326",featureProjection:f.getView().getProjection()}),n=new(q())({geometry:a});if(b(n,r),n.set("title",v(e,r,null==B?void 0:B[t])),null==(i=r.featureType)?void 0:i[0]){var l,i,s,o,u=L.B.getLayerByNameParam(f,null==(o=r.featureType)?void 0:o[0]);u&&(n.set("layer",u),s=u.get("name"))}else s=t.substring(0,t.lastIndexOf("_"));return n.set("ftName",s),n}}).filter(e=>e);R.push({title:r,features:t})}),[2,R]}})})(),[b,h,v,f])),T=(x=(0,P.k)(),j=(0,C.useTranslation)().t,(0,o.useCallback)((e,r)=>(0,c._)(function(){var t,a,n,l,i;return(0,g.YH)(this,function(s){switch(s.label){case 0:if(!x)return[2];return[4,(0,rL.$b)({bounded:r?1:void 0,viewBox:r?null==r?void 0:r.toString():void 0,countryCodes:"",nominatimBaseUrl:null!=(a=null==(t=K().search)?void 0:t.nominatimUrl)?a:"https://nominatim.openstreetmap.org/search?"})(e)];case 1:return n=s.sent(),l=new(e8()),i=null==n?void 0:n.features.filter(e=>!ej()(null==e?void 0:e.properties.geojson)).map(e=>{var r=l.readFeature(e.geometry,{dataProjection:"EPSG:4326",featureProjection:x.getView().getProjection()});if(!Array.isArray(r))return r.setProperties(e.properties),r.set("title",e.properties.display_name),r}).filter(e=>void 0!==e),[2,[{title:j("useNominatimSearchEngine.title"),features:null!=i?i:[]}]]}})})(),[x,j]));return A||_||S?(0,s.jsx)("div",{className:"search","aria-label":"search-field",children:(0,s.jsx)(r1,(0,l._)({"aria-label":"search",geocoderSearchEngine:(()=>{if(A)return T})(),dataSearchEngine:_&&S?void k.A.warn("Both solr and wfs search are configured. Only one of them can be used at the same time."):_?N:S?E:void 0},w))}):(k.A.warn("Neither nominatim, solr nor wfs search is configured."),(0,s.jsx)(s.Fragment,{}))},r3=t(83386),r4=t(64855),r5=e=>{var r=e.className,t=e.imageSrc,a=e.userMenu,n=e.userName,o=e.style,u=(0,eg._)(e,["className","imageSrc","userMenu","userName","style"]),c="userchip",d=()=>{var e=r?`${r} ${c}`:c;return(0,s.jsxs)("div",{className:e,style:o,children:[(0,s.jsx)(r4.A,(0,i._)((0,l._)({src:t,size:"large",className:"userimage"},u),{children:t?"":eC()(n)?n.split(" ").map(e=>{var r;return null!=(r=e[0])?r:""}).join("").toUpperCase():"??"})),(0,s.jsx)("span",{className:"username",children:n})]})};return(null==a?void 0:a.items)?(0,s.jsx)(rV.A,{menu:a,trigger:["click"],getPopupContainer:()=>document.getElementsByClassName(c)[0],children:d()}):d()},r8=()=>{var e,r,t,a,n,l,i,u,m,f,p,h,y,v,b,x,j,w,A,_,S,k,E,N,L,T=(0,C.useTranslation)().t,F=(0,d._)((0,o.useState)(),2),P=F[0],M=F[1],D=(0,ea.A)(),U=null==D?void 0:D.getKeycloak(),B=O(e=>e.user);return(0,o.useEffect)(()=>{(0,c._)(function(){return(0,g.YH)(this,function(e){switch(e.label){case 0:return[4,null==U?void 0:U.createLoginUrl()];case 1:return M(e.sent()),[2]}})})()},[U]),(0,s.jsx)("div",{className:"user-menu",children:e4()(B)?(0,s.jsx)(ry.A,{title:T("UserMenu.loginTooltip"),children:(0,s.jsx)(eE.Ay,{type:"link",onClick:()=>{U&&U.login()},icon:(0,s.jsx)(eF.g,{icon:eT.Kh_}),children:T("UserMenu.loginMenuTitle")})}):(0,s.jsx)(r5,{size:"small",imageSrc:(r=(e={email:null!=(L=null==(N=B.providerDetails)?void 0:N.email)?L:"",size:28}).email,t=e.size,a=e.rating,n=e.defaultImage,l=e.force,i=(void 0===r?"":r).toLowerCase(),u=(0,r3.md5)(i),m=`https://www.gravatar.com/avatar/${u}?s=${void 0===t?80:t}&r=${void 0===a?"g":a}&d=${void 0===n?"identicon":n}`,void 0!==l&&l&&(m=`${m}&f=y`),m),userName:(0,s.jsx)(eF.g,{icon:eT.tdl}),userMenu:(A={key:"username",label:(0,s.jsxs)("div",{className:"username-menu-item","aria-label":"user-name",children:[(0,s.jsx)("span",{className:"item-username",children:null!=(x=null==(f=B.providerDetails)?void 0:f.username)?x:B.authProviderId}),(0,s.jsx)("br",{}),(0,s.jsx)("span",{className:"item-fullname",children:`${null!=(j=null==(p=B.providerDetails)?void 0:p.firstName)?j:""} ${null!=(w=null==(h=B.providerDetails)?void 0:h.lastName)?w:""}`})]})},_={type:"divider"},S={key:"settings",icon:(0,s.jsx)(eF.g,{icon:eT.McB}),label:T("UserMenu.settingsMenuTitle")},k={key:"logout",icon:(0,s.jsx)(eF.g,{icon:eT.dbg}),label:(0,s.jsx)("div",{"aria-label":"logout",children:T("UserMenu.logoutMenuTitle")})},{items:Array.isArray(E=null==U||null==(b=U.tokenParsed)||null==(v=b.resource_access)||null==(y=v.account)?void 0:y.roles)&&E.indexOf("manage-account")>-1?[A,_,S,_,k]:[A,_,k],onClick:e=>{switch(e.key){case"settings":U&&U.accountManagement();break;case"logout":U&&U.logout({redirectUri:P})}}})})})},r6=e=>{var r,t,o,u=(0,a._)({},(0,n._)(e)),c=O(e=>e.title),d=O(e=>e.logoPath),g=O(e=>e.userMenu.visible),m=(0,C.useTranslation)().t,f=V(),p=y.A.Link,h=(e,r)=>{f.forEach(t=>{if((n=t.integration)&&"header"===n.placement&&(null==(a=t.integration)?void 0:a.placementOrientation)===e){var a,n,l,i,o=t.key,u=t.wrappedComponent;r.splice(null!=(i=null==(l=t.integration)?void 0:l.insertionIndex)?i:0,0,(0,s.jsx)(u,{},o))}})};return(0,s.jsxs)("div",(0,i._)((0,l._)({className:"header"},u),{children:[(0,s.jsx)("div",{className:"item-container left-items",children:(h("left",r=[(0,s.jsx)(ry.A,{title:m("Header.backToHome"),placement:"bottomLeft",children:(0,s.jsx)(p,{href:K().logoLinkUrl||K().shogunBase||"/","aria-label":m("Header.backToHome"),className:"logo-link",children:(0,s.jsx)("img",{className:"logo","data-testid":"logo",src:d,alt:"","aria-hidden":"true"})})},"logo"),(0,s.jsx)("div",{className:"title","aria-label":"title",children:c},"title")]),r)}),(0,s.jsx)("div",{className:"item-container center-items",children:(h("center",t=[(0,s.jsx)(r2,{"aria-label":"search-input",name:"search-input",className:"search-input"},"search")]),t)}),(0,s.jsx)("div",{className:"item-container right-items",children:(h("right",o=[(()=>{if(K().documentationButtonVisible)return(0,s.jsx)(rN,{},"docs-button")})(),(()=>{var e;if(g&&(null==(e=K().keycloak)?void 0:e.enabled))return(0,s.jsx)("div",{"aria-label":"user-menu",children:(0,s.jsx)(r8,{},"user-menu")},"user-menu")})()].filter(e=>void 0!==e)),o)})]}))},r7=t(41476),r9=t(43922),te=t.n(r9),tr=t(79601),tt=t(96604),ta=e=>{var r=e.layer,t=(0,eg._)(e,["layer"]),a=(0,d._)((0,o.useState)(!1),2),n=a[0],u=a[1],m=(0,d._)((0,o.useState)(),2),f=m[0],p=m[1],h=(0,d._)((0,o.useState)(),2),y=h[0],v=h[1],b=(0,ea.A)(),x=(0,C.useTranslation)().t,j=(0,o.useCallback)(()=>(0,c._)(function(){var e;return(0,g.YH)(this,function(t){switch(t.label){case 0:if(t.trys.push([0,2,3,4]),u(!0),p(""),!r||!r.get("shogunId"))throw Error("No layer provided or the layer has no shogunId set");return[4,null==b?void 0:b.layer().findOne(r.get("shogunId"))];case 1:return v(t.sent()),[3,4];case 2:return e=t.sent(),k.A.error(e),p(x("LayerConfiguration.errorMessage")),[3,4];case 3:return u(!1),[7];case 4:return[2]}})})(),[x,b,r]);return((0,o.useEffect)(()=>{j()},[j]),f)?(0,s.jsx)(G.A,{type:"error",closable:!0,message:f}):(0,s.jsx)(tt.A,{spinning:n,children:(0,s.jsx)("pre",(0,i._)((0,l._)({className:"layer-configuration"},t),{children:(0,s.jsx)("code",{children:JSON.stringify(y,null,"  ")})}))})},tn=e=>{var r=e.layer,t=(0,eg._)(e,["layer"]),a=(0,d._)((0,o.useState)(!1),2),n=a[0],u=a[1],m=(0,d._)((0,o.useState)(),2),f=m[0],p=m[1],h=(0,d._)((0,o.useState)(),2),y=h[0],v=h[1],b=(0,ea.A)(),x=(0,C.useTranslation)().t,j=(0,o.useCallback)(()=>(0,c._)(function(){var e;return(0,g.YH)(this,function(t){switch(t.label){case 0:if(!r||!(0,Q.lb)(r))return[2];t.label=1;case 1:return t.trys.push([1,3,4,5]),u(!0),v(""),p(void 0),[4,N.A.getWmsCapabilitiesByLayer(r,{headers:(0,l._)({},r.get("useBearerToken")?(0,l._)({},(0,et.M)(null==b?void 0:b.getKeycloak())):void 0)})];case 2:return p(t.sent()),[3,5];case 3:return e=t.sent(),k.A.error(e),v(x("LayerDetails.errorMessage")),[3,5];case 4:return u(!1),[7];case 5:return[2]}})})(),[x,b,r]);(0,o.useEffect)(()=>{j()},[j]);var w=()=>{var e;if(r&&(0,Q.lb)(r))return null==(e=r.getSource())?void 0:e.getParams().LAYERS},A=()=>{if(r&&(0,Q.lb)(r)){if(r.getSource()instanceof Z()&&(e=r.getSource().getUrl()),r.getSource()instanceof er()){var e,t=r.getSource().getUrls();e=t?t[0]:void 0}if(e)return E.Q.createValidGetCapabilitiesRequest(e,"WMS","1.3.0")}},_=()=>{var e,r,t=null==f||null==(r=f.Capability)||null==(e=r.Layer)?void 0:e.Layer,a=w();return Array.isArray(t)?null==t?void 0:t.find(e=>(null==e?void 0:e.Name)===a):t},S=()=>{var e=_();if(e&&e.EX_GeographicBoundingBox)return[e.EX_GeographicBoundingBox.westBoundLongitude,e.EX_GeographicBoundingBox.southBoundLatitude,e.EX_GeographicBoundingBox.eastBoundLongitude,e.EX_GeographicBoundingBox.northBoundLatitude].join(", ")},L=()=>{var e=_();if(e)return e.MinScaleDenominator},T=()=>{var e=_();if(e)return e.MaxScaleDenominator},F=()=>{var e=_();if(e)return e.Abstract},P=()=>{var e;return null==f||null==(e=f.Service)?void 0:e.Abstract},M=()=>{var e,r;return null==f||null==(r=f.Service)||null==(e=r.ContactInformation)?void 0:e.ContactElectronicMailAddress},D=()=>{var e=_();if(e)return e.Title},O=()=>{var e;return null==f||null==(e=f.Service)?void 0:e.AccessConstraints};return y?(0,s.jsx)(G.A,{type:"error",closable:!0,message:y}):(0,s.jsx)(tt.A,{spinning:n,children:(0,s.jsxs)(em.A,(0,i._)((0,l._)({className:"layer-details",layout:"horizontal",size:"small",labelAlign:"left",labelWrap:!0,labelCol:{flex:"150px"}},t),{children:[(0,s.jsx)(em.A.Item,{name:"layerName",label:x("LayerDetails.layerNameLabel"),children:(0,s.jsx)("span",{children:w()?w():x("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(em.A.Item,{name:"layerTitle",label:x("LayerDetails.layerTitleLabel"),children:(0,s.jsx)("span",{children:D()?D():x("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(em.A.Item,{name:"service-abstract",label:x("LayerDetails.serviceAbstractLabel"),children:(0,s.jsx)("span",{children:P()?P():x("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(em.A.Item,{name:"abstract",label:x("LayerDetails.abstractLabel"),children:(0,s.jsx)("span",{children:F()?F():x("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(em.A.Item,{name:"accessConstraints",label:x("LayerDetails.accessConstraintsLabel"),children:(0,s.jsx)("span",{children:O()?O():x("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(em.A.Item,{name:"CapabilitiesUrl",label:x("LayerDetails.capabilitiesUrlLabel"),children:(0,s.jsx)("a",{href:A(),children:A()})}),(0,s.jsx)(em.A.Item,{name:"contact",label:x("LayerDetails.contactLabel"),children:M()?(0,s.jsx)("a",{href:`mailto:${M()}`,children:M()}):(0,s.jsx)("span",{children:x("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(em.A.Item,{name:"minScale",label:x("LayerDetails.minScaleLabel"),children:(0,s.jsx)("span",{children:L()?L():x("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(em.A.Item,{name:"maxScale",label:x("LayerDetails.maxScaleLabel"),children:(0,s.jsx)("span",{children:T()?T():x("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(em.A.Item,{name:"bbox",label:x("LayerDetails.bboxLabel"),children:(0,s.jsx)("span",{children:S()?S():x("LayerDetails.noDataPlaceholder")})})]}))})},tl=e=>{var r=(0,a._)({},(0,n._)(e)),t=(0,d._)((0,o.useState)(),2),u=t[0],c=t[1],g=(0,d._)((0,o.useState)(!1),2),m=g[0],p=g[1],h=O(e=>e.layerDetailsModal.visible),y=O(e=>e.layerDetailsModal.layerId),v=D(),b=(0,P.k)(),x=(0,C.useTranslation)().t;return(0,o.useEffect)(()=>{if(b){if(!y)return void c(void 0);var e=L.B.getLayerByOlUid(b,y);e instanceof te()&&c(e)}},[b,y]),(0,s.jsxs)(f.A,(0,i._)((0,l._)({className:"layer-details-modal",title:(0,s.jsxs)("div",{className:"title-group",children:[(0,s.jsx)("span",{children:x("LayerDetailsModal.title",{layerName:null==u?void 0:u.get("name")})}),(null==u?void 0:u.get("shogunId"))&&(0,s.jsx)(ry.A,{title:x(m?"LayerDetailsModal.internalConfigurationButtonTooltipPressed":"LayerDetailsModal.internalConfigurationButtonTooltip"),children:(0,s.jsx)(eE.Ay,{type:"link",className:m?"pressed":"",icon:(0,s.jsx)(r7.A,{}),onClick:()=>{p(!m)}})})]}),open:h,onCancel:()=>{v((0,tr.jD)()),v((0,tr.wT)(void 0))},width:800,footer:!1},r),{children:[(0,s.jsx)(tn,{layer:u,hidden:m}),(null==u?void 0:u.get("shogunId"))&&(0,s.jsx)(ta,{layer:u,hidden:!m})]}))},ti=t(26252),ts=t(93320),to=t.n(ts),tu=()=>{var e=(0,C.useTranslation)().t,r=(0,P.k)(),t=(0,d._)((0,o.useState)(!1),2),a=t[0],n=t[1],i=O(e=>e.mapToolbarVisible.visible),u=O(e=>e.stylingDrawerVisibility),c=O(e=>e.editFeatureDrawerOpen),g=O(e=>e.searchResult.drawerVisibility),m={tooltipPlacement:"left",tooltipProps:{mouseEnterDelay:.5}};return(0,s.jsx)(s.Fragment,{children:i&&(0,s.jsxs)(rn,{id:"map-toolbar",className:u||c||g?"drawer-open":"",alignment:"vertical",role:"toolbar",children:[r&&(0,s.jsx)(to(),(0,l._)({"aria-label":"zoom-in",tooltip:e("MapToolbar.zoomInTooltip"),icon:(0,s.jsx)(eF.g,{icon:eT.QLR})},m)),r&&(0,s.jsx)(to(),(0,l._)({"aria-label":"zoom-out",tooltip:e("MapToolbar.zoomOutTooltip"),delta:-1,icon:(0,s.jsx)(eF.g,{icon:eT.EZy})},m)),r&&(0,s.jsx)(ti.GeoLocationButton,(0,l._)({"aria-label":"geolocation",showMarker:!0,follow:!0,pressed:a,onChange:()=>n(!a),tooltip:e("MapToolbar.geoLocation"),icon:(0,s.jsx)(eF.g,{icon:eT.BtD}),pressedIcon:(0,s.jsx)(eF.g,{icon:eT.w6m})},m))]})})},tc=t(15516),td=t.n(tc),tg=t(70038),tm=t.n(tg),tf=t(72184),tp=t.n(tf),th=t(38254),ty=e=>{let r;var t=e.value,a=e.attributeName,n=e.resultDrawerConfig,l=t;if(Array.isArray(t)&&1===t.length&&"string"==typeof t[0]&&(l=t[0]),"string"==typeof l&&(r=l,/^(?:\w+:)?\/\/([^\s.]+\.\S{2}|localhost[:?\d]*)\S*$/.test(r))&&n){var i,o,u=null==(i=n.children)?void 0:i.find(e=>e.displayName===a),c=(null==u||null==(o=u.fieldProps)?void 0:o.urlDisplayValue)||l;return(0,s.jsx)("a",{href:l,target:"_blank",rel:"noopener noreferrer",children:c})}return(0,s.jsx)("div",{style:{wordBreak:"break-word",whiteSpace:"pre-line"},children:null==l||"object"==typeof l?"":l})},tv=e=>{var r,t,u=(0,a._)({},(0,n._)(e)),c=D(),d=(0,P.k)(),g=O(e=>e.searchResult.drawerVisibility),m=O(e=>e.searchResult.geoJSONFeature),f=O(e=>e.searchResult.layerId),p=(0,o.useMemo)(()=>m?new(e8())().readFeature(m):null,[m]),h=(0,o.useMemo)(()=>f&&d?L.B.getLayerByOlUid(d,f):null,[f,d]),y=(0,th.c)(()=>new(td())({source:new(tm()),style:new(rq())({stroke:new(rK())({color:"rgb(255,0,0)",width:2}),fill:new(rG())({color:"rgba(255,255,255, 0.5)"}),image:new(rH())({radius:10,fill:new(rG())({color:"rgba(255,255,255, 0.5)"}),stroke:new(rK())({color:"rgb(255,0,0)",width:3})})})}),[]),v=(0,o.useCallback)(e=>{y&&y.getSource()&&e&&(y.getSource().clear(),y.getSource().addFeature(e))},[y]);(0,o.useEffect)(()=>{p&&d&&v(p)},[p,d,v]);var b=(0,C.useTranslation)().t,x=null!=(t=null==h||null==(r=h.get("searchConfig"))?void 0:r.resultDrawerConfig)?t:null;(0,o.useEffect)(()=>{p&&(null==x?void 0:x.children)&&x.children.map(e=>e.propertyName).forEach(e=>{var r=p.get(e);Array.isArray(r)&&1===r.length&&"string"==typeof r[0]&&p.set(e,r[0])})},[p,null==x?void 0:x.children]);var j=(0,o.useMemo)(()=>(null==x?void 0:x.children)?x.children.map(e=>e.propertyName):void 0,[x]),w=(0,o.useMemo)(()=>(null==x?void 0:x.children)?Object.fromEntries(x.children.map(e=>{var r;return[e.propertyName,null!=(r=e.displayName)?r:""]})):void 0,[x]),A=[{title:b("FeaturePropertyGrid.key"),dataIndex:"attributeName",key:"attributeName",width:"50%",ellipsis:!0,defaultSortOrder:"ascend",sorter:(e,r)=>e.key.localeCompare(r.key)},{title:b("FeaturePropertyGrid.value"),dataIndex:"attributeValue",key:"attributeValue",width:"50%",ellipsis:!0,render:(e,r)=>(0,s.jsx)(ty,{value:e,attributeName:r.attributeName,resultDrawerConfig:x})}];return(0,s.jsx)(eX,(0,i._)((0,l._)({title:b("SearchResultDrawer.title"),placement:"right",onClose:()=>{c((0,r0.tB)({drawerVisibility:!1,layerId:null,geoJSONFeature:null})),null==y||y.getSource().clear()},open:g,maskClosable:!1,mask:!1},u),{children:(0,s.jsxs)("div",{children:[p&&(0,s.jsx)("h3",{children:((e,r)=>{if(!e)return"";if(!r){var t;return null!=(t=e.get("title"))?t:""}var a=r.match(/^{(.+)}$/);if(a){var n,l=a[1];return null!=(n=e.get(l))?n:""}return r})(p,null==x?void 0:x.title)}),p&&Object.keys(p.getProperties()).length>1&&(x?(0,s.jsx)(eU,{name:null==x?void 0:x.title,feature:p,formConfig:null==x?void 0:x.children}):(0,s.jsx)(tp(),{className:"property-grid",feature:p,attributeFilter:j,size:"small",sticky:!1,attributeNames:w,columns:A,scroll:{scrollToFirstRowOnChange:!0}}))]})}))},tb=t(18994),tx=t(66322),tj=t(93863),tw=t(40131),tA=t(8369),t_=t(58156),tS=t.n(t_),tC=t(69737),tk=e=>{var r=(0,a._)({},(0,n._)(e)),t=(0,C.useTranslation)().t,i=(0,o.useMemo)(()=>{var e,r=tC.A.language||(null==(e=tC.A.options)?void 0:e.lng)||"en_US";switch(r){case"en":case"en_GB":case"en_US":r="en_US";break;case"de":r="de_DE";break;case"pl":r="pl_Pl";break;case"cz":r="cs_CZ";break;default:r=""}return tS()(tx.Hg,r)||tx.Hg.en_US},[]),u={name:t("StylingComponent.defaultStyleName"),rules:[{name:t("StylingComponent.defaultAreaStyleName"),symbolizers:[{kind:"Fill",color:"#00b72b",outlineOpacity:.8,opacity:.5,fillOpacity:.8,outlineWidth:2,outlineColor:"#00b72b"}]},{name:t("StylingComponent.defaultLineStyleName"),symbolizers:[{kind:"Line",color:"#00b72b",width:2,opacity:.8}]},{name:t("StylingComponent.defaultPointStyleName"),symbolizers:[{kind:"Mark",wellKnownName:"circle",color:"#00b72b",strokeColor:"#00b72b",strokeOpacity:.8,opacity:.5,radius:7}],filter:["==","label","undefined"]},{name:t("StylingComponent.defaultTextStyleName"),symbolizers:[{kind:"Text",label:"{{label}}",size:12,font:["sans-serif"],opacity:.8,color:"#00b72b",offset:[5,5],haloColor:"#00b72b",haloWidth:1}],filter:["!=","label","undefined"]}]},m=(0,d._)((0,o.useState)(u),2),f=m[0],p=m[1],h=(0,P.k)();return(0,o.useEffect)(()=>{if(f&&h){var e=new tA.A,r=L.B.getLayerByName(h,"react-geo_digitize");(0,c._)(function(){var t,a,n,l,i,s,o,u,c,d,m,p,h,y;return(0,g.YH)(this,function(g){switch(g.label){case 0:i=!0,s=!1,o=void 0,g.label=1;case 1:g.trys.push([1,6,7,8]),u=f.rules[Symbol.iterator](),g.label=2;case 2:if(i=(c=u.next()).done)return[3,5];return m={name:"",rules:[d=c.value]},[4,e.writeStyle(m)];case 3:if(!(p=g.sent()).output||d.symbolizers.length<1)return[2];"Fill"===d.symbolizers[0].kind&&(t=p.output),"Text"===d.symbolizers[0].kind&&(l=p.output),"Line"===d.symbolizers[0].kind&&(a=p.output),"Mark"===d.symbolizers[0].kind&&(n=p.output),g.label=4;case 4:return i=!0,[3,2];case 5:return[3,8];case 6:return h=g.sent(),s=!0,o=h,[3,8];case 7:try{i||null==u.return||u.return()}finally{if(s)throw o}return[7];case 8:return y=(e,r)=>{var i,s=null==(i=e.getGeometry())?void 0:i.getType();if(s){if(["MultiPolygon","Polygon","Circle"].includes(s))return"function"==typeof t?t(e,r):t;if(["MultiLineString","LineString"].includes(s))return"function"==typeof a?a(e,r):a;if(["MultiPoint","Point"].includes(s))return e.get("label")?"function"==typeof l?l(e,r):l:"function"==typeof n?n(e,r):n}},r.setStyle(y),[2]}})})().then(()=>k.A.info("Styles parsed and applied to draw layer."))}},[f,h]),(0,s.jsx)(tw.Ii.Provider,{value:{locale:i},children:(0,s.jsx)(tj.E,(0,l._)({style:f,onStyleChange:p},r))})},tE=e=>{var r=(0,a._)({},(0,n._)(e)),t=D(),o=O(e=>e.stylingDrawerVisibility),u=(0,C.useTranslation)().t;return(0,s.jsx)(eX,(0,i._)((0,l._)({title:u("StylingDrawer.title"),placement:"right",onClose:()=>{t((0,tb.en)(!1))},open:o,maskClosable:!1,mask:!1},r),{children:(0,s.jsx)(tk,{})}))},tN=t(21239),tL=t(82306),tT=t.n(tL),tF=t(76625),tP=t(54614),tM=t(85684),tD=t(91045),tO=h.A.Option,tU=()=>{var e=Object.keys(tC.A.services.resourceStore.data);return(0,s.jsx)("div",{className:"language-select","aria-label":"language-selector",children:(0,s.jsx)(h.A,{defaultValue:tC.A.language||"en",onChange:e=>{tC.A.changeLanguage(e)},children:e.map(e=>(0,s.jsx)(tO,{value:e,children:e.toUpperCase()},e))})})},tB=t(95423),tI=t(66563),tR=t(91436),t$=t(45871),tV=t(17965),tY=t.n(tV),tH=t(17936),tz=t(81851),tG=()=>{var e=(0,P.k)(),r=(0,o.useMemo)(()=>["layerConfig","isExternalLayer","isUploadedLayer","groupName"],[]),t=(0,C.useTranslation)().t,a=e?tz.s.getLink(e,";",e=>e.get("name"),e=>(e instanceof S()||e instanceof A())&&e.getVisible(),r):"",n=(0,d._)((0,o.useState)(a),2),l=n[0],i=n[1],u=`Hey,\r
check out the layer-composition I created:\r
\r
${l}`;return(0,o.useEffect)(()=>{if(e){var t=[],a=e=>e.get("name"),n=e=>(e instanceof S()||e instanceof A())&&e.getVisible(),l=()=>{i(tz.s.getLink(e,";",a,n,r))},s=()=>{e.getAllLayers().filter(e=>e.get("isExternalLayer")||e.get("isUploadedLayer")).forEach(e=>{var r=e.get("layerConfig");r&&(r.clientConfig?r.clientConfig.opacity=e.getOpacity():r.clientConfig={opacity:e.getOpacity()},e.set("layerConfig",r))}),l()},o=e=>{var r=e.getLayers().getArray(),a=!0,n=!1,i=void 0;try{for(var u,c=r[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var d=u.value;if(d instanceof j())o(d);else{var g=d.on("change:visible",l),m=d.on("change:opacity",s);t.push(g,m)}}}catch(e){n=!0,i=e}finally{try{a||null==c.return||c.return()}finally{if(n)throw i}}},u=e.getView().on("change:center",l),c=e.getView().on("change:resolution",l);return o(e.getLayerGroup()),s(),()=>{(0,tH.unByKey)(u),(0,tH.unByKey)(c),(0,tH.unByKey)(t)}}},[r,e,t]),(0,s.jsxs)("div",{className:"permalink-wrapper",children:[(0,s.jsxs)("div",{className:"icons",children:[(0,s.jsx)(ry.A,{title:t("Permalink.whatsAppTooltip"),children:(0,s.jsx)(tB.A,{onClick:function(){var e=new URL("https://wa.me");e.searchParams.set("text",u),window.open(e)}})}),(0,s.jsx)(ry.A,{title:t("Permalink.mailTooltip"),children:(0,s.jsx)(tI.A,{onClick:function(){var e=new URL("mailto:");e.searchParams.set("subject","SHOGun Web-GIS"),e.searchParams.set("body",u),window.open(e.toString().replace(/\+/g,"%20"),"_self")}})})]}),(0,s.jsxs)("div",{className:"link","aria-label":"permalink-url",children:[(0,s.jsx)(p.A,{value:l,readOnly:!0}),(0,s.jsx)(ry.A,{title:t("Permalink.copyTooltip"),children:(0,s.jsx)(tR.A,{onClick:function(){tY()(l)?t$.Ay.info(t("Permalink.copiedToClipboard")):t$.Ay.info(t("Permalink.copyToClipboardFailed"))}})})]})]})},tW=t(2180),tK=t(96752),tJ=t(4998),tq=t(14437),tQ=t(33094),tX=t(19056),tZ=t(62659),t0=t(81492),t1=t(54450),t2=t(48594);class t3 extends t2.W{serialize(e,r){var t=super.serialize(e,r);return t.baseURL.startsWith("/geoserver/ows")&&(t.baseURL=`http://shogun-geoserver:8080${t.baseURL}`),t.baseURL.startsWith("/geoserver/SHOGUN")&&(t.baseURL=`http://shogun-geoserver:8080${t.baseURL}`),t}}var t4=t3,t5=class extends t4{serialize(e,r){var t=(0,l._)({tileSize:[512,512]},r),a=e.getSource();if(a&&this.validateSource(a))return(0,l._)({},super.serialize(e,t),{type:t1.I.TYPE_WMS},r)}},t8=e=>{var r=e.value,t=e.id,a=e.placeholder,n=e.maxLength,i=(0,eg._)(e,["value","id","placeholder","maxLength"]),u=D();return(0,o.useEffect)(()=>{ej()(t)||u((0,t0.ik)({[t]:r}))},[r,t,u]),(0,s.jsx)(p.A,(0,l._)({id:t,value:r,placeholder:a,maxLength:n,showCount:!!(n&&n>1)},i))},t6=e=>{var r=e.printManager,t=e.onValueChange,a=e.placeholder,n=e.value,u=(0,eg._)(e,["printManager","onValueChange","placeholder","value"]),c=(0,d._)((0,o.useState)(n),2),g=c[0],m=c[1],f=(0,o.useRef)(g);return(0,o.useEffect)(()=>{f.current=n},[n]),(0,o.useEffect)(()=>{r&&(r.setLayout(g),f.current!==g&&t())},[r,g,t,n]),(0,o.useEffect)(()=>{m(n)},[n]),(0,s.jsx)(h.A,(0,i._)((0,l._)({placeholder:void 0===a?"Bitte w\xe4hlen Sie eine Vorlage aus":a,value:g,onChange:m},u),{children:null==r?void 0:r.getLayouts().map(e=>(0,s.jsx)(h.A.Option,{value:e.name,children:e.name},e.name))}))},t7=e=>{var r=e.printManager,t=e.placeholder,a=e.value,n=e.outputFormats,u=(0,eg._)(e,["printManager","placeholder","value","outputFormats"]),c=(0,d._)((0,o.useState)(a),2),g=c[0],m=c[1];return(0,o.useEffect)(()=>{r&&r.setOutputFormat(g)},[r,g]),(0,o.useEffect)(()=>{m(a)},[a]),(0,s.jsx)(h.A,(0,i._)((0,l._)({placeholder:t,value:g,onChange:m},u),{children:n.map(e=>(0,s.jsx)(h.A.Option,{value:e,children:e.toLocaleUpperCase()},e))}))},t9=e=>{var r=e.printManager,t=e.placeholder,a=e.value,n=(0,eg._)(e,["printManager","placeholder","value"]),u=(0,d._)((0,o.useState)(a),2),c=u[0],g=u[1];return(0,o.useEffect)(()=>{r&&r.setDpi(c)},[r,c]),(0,o.useEffect)(()=>{g(a)},[a]),(0,s.jsx)(h.A,(0,i._)((0,l._)({placeholder:t,value:c,onChange:g},n),{children:null==r?void 0:r.getDpis().map(e=>(0,s.jsx)(h.A.Option,{value:e,children:`${e} DPI`},e))}))},ae=t(73386),ar=e=>{var r=e.printManager,t=e.placeholder,a=e.value,n=(0,eg._)(e,["printManager","placeholder","value"]),u=(0,P.k)(),c=(0,d._)((0,o.useState)(0),2),g=c[0],m=c[1];return(0,o.useEffect)(()=>{r&&g&&r.setScale(g)},[r,g]),(0,o.useEffect)(()=>{var e=()=>{var e=r.getScale();e&&m(e)},t=null==u?void 0:u.getInteractions().getArray().find(e=>e.get("name")===ae.O.TRANSFORM_INTERACTION_NAME);if(r&&t)return t.on("scaling",e),()=>{t.on("scaling",e)}},[r,u]),(0,o.useEffect)(()=>{a&&m(a)},[a]),(0,s.jsx)(h.A,(0,i._)((0,l._)({placeholder:t,value:g,onChange:m},n),{children:null==r?void 0:r.getScales().map(e=>(0,s.jsx)(h.A.Option,{value:e,children:`1 : ${e.toLocaleString()}`},e))}))};t(42482).m.getLegendGraphicUrl=e=>{if(e.get("legendUrl"))return e.get("legendUrl");if(e.getSource()instanceof er()||e.getSource()instanceof Z()){var r=e.get("customPrintLegendParams"),t=e.getSource(),a=t.getParams(),n=a.LAYERS,i=a.VERSION,s=a.FORMAT,o=t instanceof Z()?t.getUrl():t.getUrls()[0];o.startsWith("/geoserver/ows")&&(o=`http://shogun-geoserver:8080${o}`);var u=(0,l._)({LAYER:n.split(",")[0],VERSION:i||"1.3.0",SERVICE:"WMS",REQUEST:"GetLegendGraphic",FORMAT:s||"image/png"},r),c=Object.keys(u).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(u[e])}`).join("&");return o.startsWith("/geoserver/SHOGUN")?(o=`http://shogun-geoserver:8080${o}/service?`,`${o}${c}`):o.endsWith("?")?`${o}${c}`:`${o}?${c}`}return""};var at=e=>{var r,t=e.active,a=e.customPrintScales,n=void 0===a?[]:a,u=e.layerBlackList,m=void 0===u?[]:u,f=e.outputFormats,p=(0,eg._)(e,["active","customPrintScales","layerBlackList","outputFormats"]),h=(0,d._)(em.A.useForm(),1)[0],y=(0,C.useTranslation)(),v=y.t,b=y.i18n,x=(0,P.k)(),w=D(),A=b.language,_=(0,ea.A)(),S=O(e=>e.print.customMapParams),E=O(e=>e.print.customParams),N=O(e=>e.print.printApp),T=(0,d._)((0,o.useState)(null),2),F=T[0],M=T[1],U=(0,d._)((0,o.useState)(!1),2),B=U[0],I=U[1],R=(0,d._)((0,o.useState)(null),2),$=R[0],V=R[1],Y=(0,o.useCallback)(e=>{if(x){var r=e.get("name");return r&&!m.includes(r)&&e.getVisible()&&!(e instanceof j())&&L.B.layerInResolutionRange(e,x)}},[x,m]),H=(0,o.useCallback)(e=>{if(ej()(x))return!1;var r=e.get("name"),t=!m.includes(r),a=!e.get("hideLegendInPrint"),n=e.getVisible()&&L.B.layerInResolutionRange(e,x),l=!(e instanceof j());if(t&&a&&n&&l){var i=null==x?void 0:x.getView().getResolution();return i&&e.set("customPrintLegendParams",{SCALE:L.B.getScaleForResolution(i,"m")}),!0}return!1},[x,m]),z=(0,o.useCallback)(e=>x?L.B.getAllLayers(x).filter(r=>{var t=r.get("name");return t&&!t.includes("react-geo")&&r.getVisible()&&!(r instanceof j())&&r!==e}):[],[x]),W=(0,o.useCallback)(e=>{var r=e.getExtentLayer();if(!r)return"";var t=z(r),a=[];return t.filter(e=>{var r,t;return e.getSource&&(null==(r=e.getSource())?void 0:r.getAttributions)&&(null==(t=e.getSource())?void 0:t.getAttributions())}).forEach(e=>{var r=tZ.A.getLayerAttributionsText(e,",",!0);a.includes(r)||a.push(r)}),a.join(", ").trim()},[z]),J=(0,o.useCallback)(()=>(0,c._)(function(){var e,r,t,a,i,s,o,u,c,d;return(0,g.YH)(this,function(g){switch(g.label){case 0:if(ej()(x))return[2];s={url:null!=(i=null==(e=K().print)?void 0:e.url)?i:"/print",map:x,customPrintScales:null==x||null==(a=x.getView())||null==(t=a.getResolutions())||null==(r=t.map(e=>{var r,t,a=null==x||null==(t=x.getView())||null==(r=t.getProjection())?void 0:r.getUnits();if(void 0!==e){var n=L.B.getScaleForResolution(e,a);if(void 0!==n)return L.B.roundScale(n)}}).filter(e=>void 0!==e))?void 0:r.reverse(),timeout:6e4,layerFilter:Y,headers:(0,l._)({},(0,et.M)(null==_?void 0:_.getKeycloak())),transformOpts:{rotate:!1},serializers:[new tq.t,new tK.S,new tJ.C,new tQ.o,new tX.S,new t4,new t5],legendFilter:H},n.length>0&&(s=(0,l._)({},s,{customPrintScales:n.toReversed()})),o=new tW.O(s),g.label=1;case 1:return g.trys.push([1,8,,9]),[4,o.init()];case 2:if(g.sent(),c=o.getPrintApps(),N)return[3,5];if(!(c&&A&&c.includes(A)))return[3,4];return[4,o.setPrintApp(A)];case 3:g.sent(),g.label=4;case 4:return[3,7];case 5:return[4,o.setPrintApp(N)];case 6:g.sent(),g.label=7;case 7:return o.setOutputFormat(o.getOutputFormats()[0]),o.setDpi(o.getDpis()[0]),o.setLayout(null==(u=o.getLayouts()[0])?void 0:u.name),[2,o];case 8:return d=g.sent(),V(()=>v("PrintForm.managerErrorMessage")),k.A.error("Could not initialize print manager: ",d),[3,9];case 9:return[2]}})})(),[x,Y,_,H,n,N,A,v]);return(0,o.useEffect)(()=>{F&&w((0,t0.ik)({attributions:W(F)}))},[w,W,F]),(0,eP.Z)(()=>(0,c._)(function(){var e;return(0,g.YH)(this,function(r){switch(r.label){case 0:if(!t)return[3,3];if(F)return[3,2];return h.resetFields(),[4,J()];case 1:(e=r.sent())&&M(e),r.label=2;case 2:return[3,4];case 3:null==F||F.shutdownManager(),M(null),r.label=4;case 4:return[2]}})})(),[F,t,J,h]),(0,o.useEffect)(()=>{F&&(E&&F.setCustomParams(E),S&&F.setCustomMapParams(S))},[F,E,S]),(0,s.jsxs)("div",{className:"print","aria-label":"print-form",children:[$&&(0,s.jsx)(G.A,{className:"print-alert",message:$,type:"error",closable:!0,showIcon:!0,onClose:()=>{V(null)}}),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(em.A,(0,i._)((0,l._)({form:h,className:"print-form",labelAlign:"left",labelCol:{flex:"90px"}},p),{children:(null==F?void 0:F.isInitiated())&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(em.A.Item,{"aria-label":"print-title",name:"title",label:v("PrintForm.title"),initialValue:v("PrintForm.initialTitle"),children:(0,s.jsx)(t8,{"aria-label":"print-title-input",maxLength:50,placeholder:v("PrintForm.titlePlaceholder")})}),(0,s.jsx)(em.A.Item,{"aria-label":"print-comment",name:"comment",label:v("PrintForm.comment"),children:(0,s.jsx)(t8,{"aria-label":"print-comment-input",maxLength:200,placeholder:v("PrintForm.commentPlaceholder")})}),(0,s.jsx)(em.A.Item,{"aria-label":"print-layout",name:"layout",label:v("PrintForm.layout"),initialValue:null==F||null==(r=F.getLayouts()[0])?void 0:r.name,children:(0,s.jsx)(t6,{"aria-label":"print-layout-input",printManager:F,onValueChange:()=>{h.setFieldValue("dpi",null==F?void 0:F.getDpis()[0])}})}),(0,s.jsx)(em.A.Item,{"aria-label":"print-scale",name:"scale",label:v("PrintForm.scale"),initialValue:null==F?void 0:F.getClosestScaleToFitMap(),children:(0,s.jsx)(ar,{"aria-label":"print-scale-input",printManager:F})}),(0,s.jsx)(em.A.Item,{"aria-label":"print-dpi",name:"dpi",label:v("PrintForm.dpi"),initialValue:F.getDpis()[0],children:(0,s.jsx)(t9,{"aria-label":"print-dpi-input",printManager:F,placeholder:v("PrintForm.resolutionPlaceholder")})}),(0,s.jsx)(em.A.Item,{"aria-label":"print-format",name:"format",label:v("PrintForm.format"),initialValue:"pdf",children:(0,s.jsx)(t7,{"aria-label":"print-format-input",printManager:F,outputFormats:void 0===f?["pdf","png"]:f,placeholder:v("PrintForm.outputFormatPlaceholder")})})]})})),(0,s.jsx)(eE.Ay,{"aria-label":"create-print",className:"print-button tool-menu-button",disabled:!(null==F?void 0:F.isInitiated()),icon:(0,s.jsx)(eF.g,{icon:eT.cbP}),loading:B,onClick:()=>(0,c._)(function(){var e,r;return(0,g.YH)(this,function(t){switch(t.label){case 0:if(t.trys.push([0,2,3,4]),V(null),I(!0),!F)return[2];return[4,F.print(!1)];case 1:if(!(e=t.sent()))throw Error("No download URL available, the job has failed.");return window.open(e),[3,4];case 2:return r=t.sent(),V(v("PrintForm.printJobErrorMsg")||null),k.A.error(r),[3,4];case 3:return I(!1),[7];case 4:return[2]}})})(),children:v("PrintForm.downloadBtnText")})]})]})},aa=t(47960),an=t(47152),al=t(69478),ai=t.n(al),as=t(58030),ao=e=>{var r=e.keyName,t=e.onChange,a=void 0===t?()=>{}:t,n=e.options,l=(0,C.useTranslation)().t;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(em.A.Item,{name:[r,"name"],rules:[{required:!0,message:l("AttributionRow.missingKey")},e=>{var r=e.getFieldsValue;return{validator(e,t){var a=r(!0);return a.fields&&Object.entries(a.fields).filter(e=>{var r=(0,d._)(e,2)[1];return(null==r?void 0:r.name)===t}).length>1?Promise.reject(Error(l("AttributionRow.keyInUse"))):Promise.resolve()}}}],children:(0,s.jsx)(as.A,{placeholder:l("AttributionRow.keyPlaceholder"),onChange:e=>{a(e)},options:null==n?void 0:n.map(e=>({value:e}))})}),(0,s.jsx)(em.A.Item,{name:[r,"value"],rules:[{required:!0,message:l("AttributionRow.missingValue")}],children:(0,s.jsx)(p.A,{placeholder:l("AttributionRow.valuePlaceholder"),onChange:e=>{a(e.target.value)}})})]})},au=e=>{var r=e.selectedFeature,t=(0,eg._)(e,["selectedFeature"]),a=(0,d._)((0,o.useState)(!0),2),n=a[0],u=a[1],f=(0,d._)((0,o.useState)([]),2),p=f[0],h=f[1],y=(0,d._)((0,o.useState)([]),2),v=y[0],b=y[1],x=(0,d._)(m.Ay.useNotification(),2)[1],j=(0,d._)(em.A.useForm(),1)[0],w=(0,P.k)(),A=void 0!==r,_=(0,C.useTranslation)().t,S=(0,o.useCallback)(e=>{var r,t=null==(r=e.fields)?void 0:r.map(e=>{var r;return null==e||null==(r=e.name)?void 0:r.toLowerCase()}).filter(e=>void 0!==e);b(p.filter(e=>!(null==t?void 0:t.includes(e.toLowerCase()))))},[p]);(0,o.useEffect)(()=>{if(w){var e,t=null==r?void 0:r.getProperties();if(j.setFieldValue("fields",[]),t){var a=Object.entries(Object.fromEntries(Object.entries(t).filter(e=>!((0,d._)(e,2)[1]instanceof ai())).map(e=>{var r=(0,d._)(e,2);return[r[0],r[1]]}))).map(e=>{var r=(0,d._)(e,2);return{name:r[0],value:r[1]}});j.setFieldValue("fields",a)}var n=null==(e=rt.y.getDigitizeLayer(w).getSource())?void 0:e.getFeatures(),l=new Set;null==n||n.forEach(e=>{Object.keys(e.getProperties()).forEach(r=>{e.get(r)instanceof ai()||l.add(r)})}),h(Array.from(l))}},[r,j,w]);var E=()=>(0,c._)(function(){var e;return(0,g.YH)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,j.validateFields()];case 1:return r.sent(),u(!0),[3,3];case 2:return e=r.sent(),u(!1),k.A.error(e),[3,3];case 3:return[2]}})})();return(0,s.jsxs)(eQ.A,(0,i._)((0,l._)({title:_("Attribution.title"),className:"attribution-drawer",placement:"right",mask:!1,maskClosable:!1,closable:!1,open:A},t),{children:[!r&&(0,s.jsx)(s.Fragment,{children:_("Attribution.select")}),(0,s.jsx)(an.A,{children:(0,s.jsxs)(em.A,{onFinish:e=>{if(r){for(var t in m.Ay.destroy(),m.Ay.success({message:_("notificationApplyText.title"),placement:"top",duration:3.5}),r.getProperties())r.get(t)instanceof ai()||r.unset(t);e.fields&&Object.values(e.fields).forEach(e=>{(null==e?void 0:e.name)&&r.set(e.name,e.value)})}},autoComplete:"off",form:j,onValuesChange:(e,r)=>{S(r)},children:[(0,s.jsx)(em.A.List,{name:"fields",children:(e,t)=>{var a=t.add,n=t.remove;return(0,s.jsxs)(s.Fragment,{children:[e.map(e=>(0,s.jsxs)("div",{className:"attribute-row",children:[(0,s.jsx)(ao,{keyName:e.name,onChange:E,options:v},e.key),(0,s.jsxs)(eR.A,{title:_("AttributionPopConfirm.title"),okText:_("AttributionPopConfirm.okText"),cancelText:_("AttributionPopConfirm.cancelText"),placement:"topRight",onConfirm:()=>{m.Ay.destroy(),m.Ay.info({message:_("notificationDeleteText.title"),description:_("notificationDeleteText.info"),placement:"top",duration:6}),n(e.name)},children:[x,(0,s.jsx)(eE.Ay,{className:"remove-attribute-button",type:"primary",danger:!0,icon:(0,s.jsx)(eF.g,{icon:aa.xbI})})]})]},e.key)),(0,s.jsx)(em.A.Item,{children:r?(0,s.jsx)(eE.Ay,{type:"dashed",onClick:()=>{a()},className:"add-attribute-button",icon:(0,s.jsx)(eF.g,{icon:eT.QLR}),children:_("Attribution.add")}):(0,s.jsx)(s.Fragment,{})})]})}}),(0,s.jsx)(em.A.Item,{children:(0,s.jsx)(eE.Ay,{className:"submit-attributes-button",type:"primary",htmlType:"submit",disabled:!n,hidden:!r,children:_("Attribution.submit")})})]})})]}))},ac=t(14830),ad=f.A.confirm,ag="deleteallbutton",am=e=>{var r=e.className,t=e.digitizeLayer,a=(0,eg._)(e,["className","digitizeLayer"]),n=(0,d._)((0,o.useState)(null),2),i=n[0],u=n[1],c=(0,P.k)(),g=(0,C.useTranslation)().t;if((0,o.useEffect)(()=>{c&&(t?u([t]):u([rt.y.getDigitizeLayer(c)]))},[c,t]),!i)return null;var m=r?`${ag} ${r}`:ag;return(0,s.jsx)(F(),(0,l._)({onClick:()=>{ad({title:g("DeleteAllButton.deleteAll"),content:g("DeleteAllButton.confirmMessage"),icon:(0,s.jsx)(ac.A,{}),onOk(){var e;null==(e=i[0].getSource())||e.clear()}})},className:m},a))},af=ek.A.Dragger,ap=e=>{var r=e.className,t=e.footer,a=e.width,n=e.onCancel,u=e.onSuccess,c=e.onFailure,g=(0,eg._)(e,["className","footer","width","onCancel","onSuccess","onFailure"]),m=(0,d._)((0,o.useState)(!1),2),p=m[0],h=m[1],y=(0,d._)((0,o.useState)(""),2),v=y[0],b=y[1],x=(0,P.k)(),j=(0,C.useTranslation)().t,w=["json","geojson"],A=["application/json","application/geo+json","application/geojson"];return(0,s.jsxs)(f.A,(0,i._)((0,l._)({title:j("ImportDataModal.title"),onCancel:e=>{b(""),h(!1),null==n||n(e)},className:void 0===r?"import-data-modal":r,width:void 0===a?600:a,footer:void 0!==t&&t},g),{children:[v&&(0,s.jsx)(G.A,{message:v,closable:!0,type:"error"}),(0,s.jsx)(tt.A,{spinning:p,children:(0,s.jsxs)(af,{customRequest:e=>{var r=e.file,t=e.onSuccess,a=e.onError;if(r instanceof File&&x){var n=new FileReader;n.onload=()=>{try{var e=new(e8())().readFeatures(n.result,{featureProjection:x.getView().getProjection()});null==t||t(e)}catch(e){null==a||a(e),k.A.error("Error while reading the file: ",e)}},n.readAsText(r)}},accept:[...w.map(e=>`.${e}`),A].join(","),maxCount:1,showUploadList:!1,beforeUpload:e=>{var r=e.type,t=e.name.split(".").pop();return b(""),!!A.includes(r)&&(!t||!!w.includes(t))||(b(j("ImportDataModal.error.supportedFormats",{supportedFormats:A.join(", ")})),!1)},onChange:e=>{var r=e.file.status,t=e.file.response;if(x)if("uploading"===r)h(!0);else if("done"===r){var a=rt.y.getDigitizeLayer(x).getSource();null==a||a.addFeatures(t||[]),h(!1),t$.Ay.success(j("ImportDataModal.success")),null==u||u(t||[])}else"error"===r&&(h(!1),b(j("ImportDataModal.error.parsing")),null==c||c(e.file.error))},children:[(0,s.jsx)("p",{className:"ant-upload-drag-icon",children:(0,s.jsx)(eF.g,{icon:eT.JmV})}),(0,s.jsx)("p",{className:"ant-upload-text",children:j("ImportDataModal.description")}),(0,s.jsx)("p",{className:"ant-upload-hint",children:j("ImportDataModal.hint")})]})})]}))},ah=()=>{var e=D(),r=(0,C.useTranslation)().t,t=O(e=>e.stylingDrawerVisibility);return(0,s.jsx)(eE.Ay,{type:"link",onClick:()=>{e((0,tb.en)(!t))},icon:(0,s.jsx)(eF.g,{icon:eT._eQ}),children:r(t?"StylingDrawer.closeColorPalette":"StylingDrawer.openColorPalette")})},ay=e=>{var r=e.showDrawPoint,t=e.showDrawLine,a=e.showDrawPolygon,n=e.showDrawCircle,l=e.showDrawRectangle,i=e.showDrawAnnotation,u=e.showModifyFeatures,c=e.showUploadFeatures,g=e.showDeleteFeatures,m=(0,d._)((0,o.useState)(),2),f=m[0],p=m[1],h=(0,d._)((0,o.useState)(),2),y=h[0],v=h[1],b=(0,d._)((0,o.useState)(!1),2),x=b[0],j=b[1],w=(0,C.useTranslation)().t,A=(0,P.k)(),_=(0,o.useCallback)((e,r)=>{v(r),"draw-modify"!==r&&p(void 0)},[]),S=(0,o.useCallback)(e=>{e.selected.length>0?p(e.selected[0]):p(void 0)},[]),k=()=>{j(!1)};return A?(0,s.jsxs)("div",{className:"draw-tools",children:[(0,s.jsxs)(rr.ToggleGroup,{selected:y,onChange:_,children:[r?(0,s.jsxs)(e9(),{drawType:"Point",pressed:!1,type:"link",value:"draw-point",children:[(0,s.jsx)(eF.g,{icon:eT.GEE}),(0,s.jsx)("span",{className:"draw-point",children:w("Draw.point")})]},"draw-point"):(0,s.jsx)(s.Fragment,{}),t?(0,s.jsxs)(e9(),{drawType:"LineString",type:"link",value:"draw-line",children:[(0,s.jsx)(eF.g,{icon:eT.Nby}),(0,s.jsx)("span",{className:"draw-line",children:w("Draw.line")})]},"draw-line"):(0,s.jsx)(s.Fragment,{}),a?(0,s.jsxs)(e9(),{value:"draw-polygon",drawType:"Polygon",type:"link",children:[(0,s.jsx)(eF.g,{icon:eT.qTS}),(0,s.jsx)("span",{className:"draw-polygon",children:w("Draw.polygon")})]},"draw-polygon"):(0,s.jsx)(s.Fragment,{}),n?(0,s.jsxs)(e9(),{value:"draw-circle",drawType:"Circle",type:"link",children:[(0,s.jsx)(eF.g,{icon:eT.s4k}),(0,s.jsx)("span",{className:"draw-circle",children:w("Draw.circle")})]},"draw-circle"):(0,s.jsx)(s.Fragment,{}),l?(0,s.jsxs)(e9(),{drawType:"Rectangle",type:"link",value:"draw-rectangle",children:[(0,s.jsx)(eF.g,{icon:eT.Nfw}),(0,s.jsx)("span",{className:"draw-rectangle",children:w("Draw.rectangle")})]},"draw-rectangle"):(0,s.jsx)(s.Fragment,{}),i?(0,s.jsxs)(e9(),{drawType:"Text",modalPromptCancelButtonText:w("Draw.modalPromptCancelButtonText"),modalPromptOkButtonText:w("Draw.modalPromptOkButtonText"),modalPromptTitle:w("Draw.modalPromptTitle"),type:"link",value:"draw-text",children:[(0,s.jsx)(eF.g,{icon:eT.jrc}),(0,s.jsx)("span",{className:"draw-text",children:w("Draw.text")})]},"draw-text"):(0,s.jsx)(s.Fragment,{}),(0,s.jsx)(ah,{},"styling"),u?(0,s.jsxs)(re.ModifyButton,{value:"draw-modify",type:"link",onFeatureSelect:S,children:[(0,s.jsx)(eF.g,{icon:eT.LFz}),(0,s.jsx)("span",{className:"draw-modify",children:w("Draw.modify")})]},"draw-modify"):(0,s.jsx)(s.Fragment,{}),g?(0,s.jsxs)(e6.DeleteButton,{value:"draw-delete",type:"link",children:[(0,s.jsx)(eF.g,{icon:eT.IP$}),(0,s.jsx)("span",{className:"draw-delete",children:w("Draw.delete")})]},"draw-delete"):(0,s.jsx)(s.Fragment,{})]}),g?(0,s.jsxs)(am,{value:"draw-delete-all",type:"link",children:[(0,s.jsx)(eF.g,{icon:eT.yLS}),(0,s.jsx)("span",{className:"draw-delete-all",children:w("DeleteAllButton.deleteAll")})]}):(0,s.jsx)(s.Fragment,{}),c?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eE.Ay,{onClick:()=>{j(!0)},"aria-label":"draw-upload",type:"link",icon:(0,s.jsx)(eF.g,{icon:eT.JmV}),children:(0,s.jsx)("span",{className:"draw-upload",children:w("Draw.upload")})}),(0,s.jsx)(ap,{open:x,onCancel:k,onSuccess:k})]}):(0,s.jsx)(s.Fragment,{}),c?(0,s.jsxs)(F(),{value:"draw-export",onClick:()=>{var e=[];if(A){var r,t=A.getView().getProjection().getCode(),a=null==(r=rt.y.getDigitizeLayer(A).getSource())?void 0:r.getFeatures();if(a&&a.length>0){a.forEach(r=>{var a,n=r.clone();null==(a=n.getGeometry())||a.transform(t,"EPSG:4326"),e.push(n)});var n=new Blob([new(e8())().writeFeatures(e)],{type:"application/geo+json"}),l=window.URL.createObjectURL(n),i=document.createElement("a");i.href=l,i.setAttribute("download","exportedFeatures.geojson"),document.body.appendChild(i),i.click(),document.body.removeChild(i)}}},type:"link",children:[(0,s.jsx)(eF.g,{icon:eT.cbP}),(0,s.jsx)("span",{className:"draw-export",children:w("Draw.export")})]}):(0,s.jsx)(s.Fragment,{}),(0,s.jsx)(au,{selectedFeature:f})]}):(0,s.jsx)(s.Fragment,{})},av=t(2543),ab=t(17442),ax=t(82379),aj=e=>{var r=(0,P.k)(),t=(0,o.useCallback)(()=>(0,c._)(function(){var t,a,n,l,i;return(0,g.YH)(this,function(s){return!r||L.B.getLayerByName(r,e.layerName)||(t=new(tm()),a=new(rG())({color:"rgba(255, 255, 255, 0.15)"}),n=new(rK())({color:"rgba(209, 70, 47, 1)",width:2}),l=new(rq())({fill:a,stroke:n,image:new(rH())({radius:5,fill:a,stroke:n})}),(i=new(td())({source:t,style:l})).set("name",e.layerName),r.addLayer(i)),[2]})})(),[r,e.layerName]),a=(0,o.useCallback)(()=>{if(r){var t=L.B.getLayerByName(r,e.layerName);t&&r.removeLayer(t)}},[r,e.layerName]);(0,o.useEffect)(()=>(t(),()=>a()),[a,t])},aw=t(51047),aA=t(32629),a_=t.n(aA),aS=e=>{var r=e.exportFilter,t=e.features,a=e.layer,n=e.selectedFeature,i=(0,eg._)(e,["exportFilter","features","layer","selectedFeature"]),o=(0,C.useTranslation)().t,u=D(),c=(0,P.k)(),g=ra(),m=O(e=>e.featureInfo.activeCopyTools),f=O(e=>e.editFeature.userEditMode),p=f.includes("CREATE")||f.includes("DELETE")||f.includes("UPDATE"),h=null==a?void 0:a.get("editable");return(0,s.jsxs)("div",{className:"pagination-toolbar",children:[(0,s.jsx)(aw.A,(0,l._)({simple:!0,total:t.length,size:"small",pageSize:1},i)),(0,s.jsxs)("div",{className:"copy-buttons",children:[p&&(0,s.jsx)(ry.A,{title:o(h?"PaginationToolbar.editFeature":"PaginationToolbar.editDisabled"),children:(0,s.jsx)(eE.Ay,{type:"text",size:"small",onClick:()=>{if(a&&c){var e=new(e8())().writeFeature(n);try{var r=JSON.parse(e),t=rt.y.getDigitizeLayer(c);if(!t)return;var l=t.getSource();if(!l||(l.clear(),l.addFeature(n),(0,eu.isEmpty)(l.getExtent())))return;c.getView().fit(l.getExtent(),{padding:g()}),u((0,e_.Ht)((0,b.getUid)(a))),u((0,e_.J7)(r)),u((0,eq.WU)())}catch(e){k.A.error("Could not parse GeoJSON: ",e)}}},icon:(0,s.jsx)(eF.g,{icon:eT.MT7}),disabled:!h})},"edit"),(null==m?void 0:m.includes(tF.D8.COPY_AS_GEOJSON))&&(0,s.jsx)(ry.A,{title:o("PaginationToolbar.copyAsGeoJson"),children:(0,s.jsx)(eE.Ay,{type:"text",size:"small",onClick:()=>{if(n){var e=n.clone();if(r){var t=Object.entries(e.getProperties()),a=t.filter(e=>{var t=(0,d._)(e,2);return r(t[0],t[1])}),l=!0,i=!1,s=void 0;try{for(var o,u=t[Symbol.iterator]();!(l=(o=u.next()).done);l=!0){var c=(0,d._)(o.value,2),g=c[0];c[1]instanceof ai()||e.unset(g)}}catch(e){i=!0,s=e}finally{try{l||null==u.return||u.return()}finally{if(i)throw s}}e.setProperties(Object.fromEntries(a))}tY()(new(e8())().writeFeature(e))}},icon:(0,s.jsx)(eF.g,{icon:eT.Iae})})}),(null==m?void 0:m.includes(tF.D8.COPY_AS_OBJECT))&&(0,s.jsx)(ry.A,{title:o("PaginationToolbar.copyAsObject"),children:(0,s.jsx)(eE.Ay,{type:"text",size:"small",onClick:()=>{if(n){var e=Object.entries(a_()(n.getProperties())).filter(e=>!((0,d._)(e,2)[1]instanceof ai()));r&&(e=e.filter(e=>{var t=(0,d._)(e,2);return r(t[0],t[1])})),tY()(JSON.stringify(Object.fromEntries(e)))}},icon:(0,s.jsx)(eF.g,{icon:eT.YEm})})})]})]})},aC=e=>{var r=e.features,t=e.layerName,a=e.layer,n=e.tabConfig,i=(0,eg._)(e,["features","layerName","layer","tabConfig"]),u=(0,d._)((0,o.useState)(1),2),c=u[0],g=u[1],m=(0,d._)((0,o.useState)(),2),f=m[0],p=m[1],h=(0,d._)((0,o.useState)("0"),2),y=h[0],v=h[1],b=(0,P.k)(),x=`selection-layer-${t}`;if(aj({layerName:x}),(0,o.useEffect)(()=>{if(b){var e,t=L.B.getLayerByName(b,x);t&&(null==(e=t.getSource())||e.clear(),g(1),r.length>0&&(v("0"),p(r[0])))}},[r,b,x]),(0,o.useEffect)(()=>{if(f&&b){var e,r,t=L.B.getLayerByName(b,x);t&&(null==(e=t.getSource())||e.clear(),null==(r=t.getSource())||r.addFeature(f))}},[f,b,x]),!n||!f)return(0,s.jsx)(s.Fragment,{});var j=n.filter(e=>!ej()(e)).map((e,r)=>({label:e.title,key:`${r}`,forceRender:!0,children:(0,s.jsx)(eU,{name:e.title,feature:f,formConfig:e.children})}));return(0,s.jsxs)("div",{className:"feature-info-tabs",children:[(0,s.jsx)(aS,{current:c,exportFilter:e=>{var r=!1,t=!0,a=!1,l=void 0;try{for(var i,s=n[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var o=i.value;if(o.children){var u=!0,c=!1,d=void 0;try{for(var g,m=o.children[Symbol.iterator]();!(u=(g=m.next()).done);u=!0)if(g.value.propertyName===e){r=!0;break}}catch(e){c=!0,d=e}finally{try{u||null==m.return||m.return()}finally{if(c)throw d}}}}}catch(e){a=!0,l=e}finally{try{t||null==s.return||s.return()}finally{if(a)throw l}}return r},features:r,layer:a,onChange:e=>{e<1||(g(e),p(r[e-1]))},selectedFeature:f}),(0,s.jsx)(ri.A,(0,l._)({items:j,activeKey:y,defaultActiveKey:"0",onTabClick:e=>{v(e)}},i))]})},ak=e=>{var r=e.features,t=e.layerName,a=e.layer,n=(0,eg._)(e,["features","layerName","layer"]),i=(0,d._)((0,o.useState)(),2),u=i[0],c=i[1],g=(0,d._)((0,o.useState)(),2),m=g[0],f=g[1],p=(0,d._)((0,o.useState)([]),2),h=p[0],y=p[1],v=(0,P.k)(),b=(0,C.useTranslation)().t,x=`selection-layer-${t}`;aj({layerName:x}),(0,o.useEffect)(()=>{if(v){var e,t=L.B.getLayerByName(v,x);t&&(null==(e=t.getSource())||e.clear(),c(1),r.length>0&&f(r[0]))}},[r,v,x]),(0,o.useEffect)(()=>{if(m&&v){var e,r,t=L.B.getLayerByName(v,x);t&&(y(Object.entries(m.getProperties()).filter(e=>(0,d._)(e,2)[1]instanceof ai()).map(e=>(0,d._)(e,1)[0])),null==(e=t.getSource())||e.clear(),null==(r=t.getSource())||r.addFeature(m))}},[m,v,x]);var j=e=>{c(e),f(r[e-1])};if(!m)return(0,s.jsx)(s.Fragment,{});var w=m.getKeys().filter(e=>!h.includes(e.toLocaleLowerCase()));return(0,s.jsx)(tp(),(0,l._)({className:"property-grid",feature:m,attributeFilter:w,size:"small",sticky:!0,title:()=>(0,s.jsx)(aS,{features:r,selectedFeature:m,current:u,layer:a,onChange:j}),columns:[{title:b("FeaturePropertyGrid.key"),dataIndex:"attributeName",key:"attributeName",width:"50%",ellipsis:!0,defaultSortOrder:"ascend",sorter:(e,r)=>e.key.localeCompare(r.key)},{title:b("FeaturePropertyGrid.value"),dataIndex:"attributeValue",key:"attributeValue",width:"50%",ellipsis:!0}],scroll:{scrollToFirstRowOnChange:!0,y:"calc(100% - 90px)"}},n))},aE=e=>{var r=(0,a._)({},(0,n._)(e)),t=(0,C.useTranslation)().t,i=(0,P.k)(),u=(0,ea.A)(),c=V(),g=D(),m=(0,d._)((0,o.useState)(void 0),2),f=m[0],p=m[1],h=O(e=>e.featureInfo.enabled),y=e=>{p(e)},v=e=>{if(!ej()(i))return i.getAllLayers().findIndex(r=>{if((0,Q.lb)(r)){var t=r.getSource(),a=b(null==t?void 0:t.getParams().LAYERS);return b(e)===a}return!1})},b=e=>e.split(":").length>1?e.split(":")[1]:e.split(":")[0];return i&&h?(0,s.jsx)("div",{className:"feature-info-panel",children:(0,s.jsx)(ab.CoordinateInfo,(0,l._)({active:h,drillDown:!0,featureCount:10,fetchOpts:e=>({headers:(0,l._)({},e.get("useBearerToken")?(0,l._)({},(0,et.M)(null==u?void 0:u.getKeycloak())):void 0)}),layerFilter:e=>!!e.getVisible()&&!!e.get("hoverable")&&(!!(e instanceof A()&&e.getSource()instanceof Z())||e instanceof S()&&e.getSource()instanceof er()),onSuccess:e=>{var r=e.features,t=(0,av.groupBy)(r,"featureType"),a=(0,av.mapValues)(t,e=>e.map(e=>e.feature)),n={},l=!0,i=!1,s=void 0;try{for(var o,u=Object.entries(a)[Symbol.iterator]();!(l=(o=u.next()).done);l=!0){var c=(0,d._)(o.value,2),m=c[0],f=c[1];n[m]=new(e8())().writeFeatures(f)}}catch(e){i=!0,s=e}finally{try{l||null==u.return||u.return()}finally{if(i)throw s}}var h=r.map(e=>({layerName:e.featureType,index:v(e.featureType)})).sort((e,r)=>ej()(e.index)||ej()(r.index)?0:r.index-e.index);h.length>0&&p(h[0].layerName),g((0,ax.nR)(n))},resultRenderer:e=>{if(ej()(i))return(0,s.jsx)(s.Fragment,{});var r=e.features,a=e.loading;if(0===r.length)return(0,s.jsx)("span",{className:"usage-hint",children:t("FeatureInfo.usageHint")});var n=[];return Object.entries((0,av.groupBy)(r,"featureType")).forEach(e=>{var r=(0,d._)(e,2),t=r[0],a=r[1],l=!1,o=a.map(e=>e.feature),u=i.getAllLayers(),g=v(t);if(!ej()(g)){var m=u[g];c.forEach(e=>{var r;if((r=e.integration)&&"feature-info"===r.placement&&(Array.isArray(e.integration.layers)&&e.integration.layers.includes(t)||!e.integration.layers)){var a=e.key,i=e.wrappedComponent;n.push({label:t,index:g,key:t,children:(0,s.jsx)(i,{},a)}),l=!0}}),l||n.push({label:(null==m?void 0:m.get("name"))||t,index:g,key:t,children:(0,s.jsx)("div",{children:(null==m?void 0:m.get("featureInfoFormConfig"))?(0,s.jsx)(aC,{tabConfig:null==m?void 0:m.get("featureInfoFormConfig"),features:o,layerName:t,layer:m}):(0,s.jsx)(ak,{features:o,layerName:t,layer:m})},t)})}}),n.sort((e,r)=>r.index-e.index),(0,s.jsx)(tt.A,{spinning:a,children:(0,s.jsx)(ri.A,{destroyInactiveTabPane:!0,items:n,activeKey:f,defaultActiveKey:n[0].key,onTabClick:y})})}},r))}):(0,s.jsx)(s.Fragment,{})},aN=t(22490),aL=t(41414),aT=t.n(aL),aF=t(42790),aP=t(85086),aM=t.n(aP),aD=t(74178),aO=t.n(aD),aU="YYYY-MM-DD",aB=e=>{var r=e.layer,t=(0,eg._)(e,["layer"]),a=(0,d._)((0,o.useState)(),2),n=a[0],i=a[1],u=(0,d._)((0,o.useState)(),2),c=u[0],g=u[1],m=(0,d._)((0,o.useState)(),2),f=m[0],p=m[1],h=(0,o.useMemo)(()=>{if(ej()(c)||ej()(f))return[];var e=c.clone().add(f.diff(c)/2);return[{timestamp:c,markConfig:{label:c.format(aU)}},{timestamp:e,markConfig:{label:e.format(aU)}},{timestamp:f,markConfig:{label:f.format(aU),style:{left:"unset",right:0,transform:"translate(50%)"}}}]},[f,c]),y=(0,C.useTranslation)().t;return(0,o.useEffect)(()=>{var e,t=r.get("dimension");if(t&&(t.values&&(e=t.values.split(",")),e&&0!==e.length)){g(ei()(e[0])),p(ei()(e[e.length-1])),i(ei()(e[e.length-1]));var a={};if(e.forEach(e=>{a[e]=ei()(e).format("YYYY-MM-DD")}),"current"===e.default){var n=[NaN,""];Object.values(a).forEach(e=>{var r=ei()().diff(ei()(e));r<n[0]&&(n=[r,e])}),i(ei()(n[1]))}}},[r]),(0,s.jsxs)("div",{className:"wms-time-slider",children:[(0,s.jsxs)(rh.A,{children:[(0,s.jsx)(eF.g,{icon:eT.a$}),y("WmsTimeSlider.title")]}),h&&c&&f?(0,s.jsx)(aO(),(0,l._)({defaultValue:ei()(),formatString:aU,marks:h,max:f,min:c,onChange:e=>{var t;i(e),null==(t=r.getSource())||t.updateParams({TIME:Array.isArray(e)?e[0].format(aU):e.format(aU)})},value:n},t)):(0,s.jsx)("span",{children:y("WmsTimeSlider.default")})]})},aI=e=>{var r,t=e.layer,a=e.visibleLegendsIds,n=e.setVisibleLegendsIds,u=(0,eg._)(e,["layer","visibleLegendsIds","setVisibleLegendsIds"]),f=(0,d._)((0,o.useState)(!1),2),p=f[0],h=f[1],y=(0,d._)((0,o.useState)(!1),2),v=y[0],x=y[1],w=D(),A=(0,ea.A)(),_=(0,P.k)(),S=ra(),E=(0,C.useTranslation)().t,N=null!=(r=t.get("downloadConfig"))?r:null,T=O(e=>e.editFeature.userEditMode),F=O(e=>e.layerTree.metadataVisible),M=e=>{var r=[e],t=!0,a=!1,n=void 0;try{for(var l,i=e.getLayers().getArray()[Symbol.iterator]();!(t=(l=i.next()).done);t=!0){var s=l.value;s instanceof j()&&r.push(...M(s))}}catch(e){a=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(a)throw n}}return r},U=e=>{(!_?[]:M(_.getLayerGroup()).filter(r=>r.getLayers().getArray().includes(e))).forEach(r=>r.getLayers().remove(e))},B=[];if((0,Q.lb)(t)&&B.push({label:(0,s.jsx)(tt.A,{spinning:v,children:E("LayerTreeContextMenu.layerZoomToExtent")}),key:"zoomToExtent"}),(0,Q.lb)(t)&&t.getVisible()){var I=a.includes((0,b.getUid)(t));B.push({label:I?E("LayerTreeContextMenu.hideLegend"):E("LayerTreeContextMenu.showLegend"),key:"toggleLegend"})}if((t.get("isExternalLayer")||t.get("isUploadedLayer"))&&B.push({label:E("LayerTreeContextMenu.removeLayer"),key:"removeExternal"}),N){var R=N.map(e=>{var r;return{label:E("LayerTreeContextMenu.downloadLayer",{formatName:null!=(r=e.formatName)?r:"XML"}),key:`downloadLayer|${encodeURI(e.downloadUrl)}`}});B.push(...R)}return t.get("editable")&&(T.includes("CREATE")||T.includes("UPDATE")||T.includes("DELETE"))&&B.push({label:E("LayerTreeContextMenu.editLayer"),key:"editLayer"}),F&&B.push({label:E("LayerTreeContextMenu.layerDetails"),key:"layerDetails"}),(0,s.jsx)("div",{"aria-label":"layer-context",children:(0,s.jsx)(rV.A,(0,i._)((0,l._)({menu:{items:B,onClick:e=>{let r;switch((null==e?void 0:e.key.startsWith("downloadLayer"))&&(r=decodeURI(e.key.split("|")[1]),(0,c._)(function(){var e,a;return(0,g.YH)(this,function(n){switch(n.label){case 0:if(!t)return[2];return[4,fetch(r,{method:"GET",headers:(0,l._)({},t.get("useBearerToken")?(0,l._)({},(0,et.M)(null==A?void 0:A.getKeycloak())):void 0)})];case 1:return[4,n.sent().blob()];case 2:return e=n.sent(),(a=document.createElement("a")).href=URL.createObjectURL(e),a.setAttribute("download",t.get("name")),a.click(),[2]}})})()),null==e?void 0:e.key){case"zoomToExtent":(0,c._)(function(){var e,r;return(0,g.YH)(this,function(a){switch(a.label){case 0:if(!_)return[2];x(!0),a.label=1;case 1:return a.trys.push([1,3,4,5]),[4,tZ.A.getExtentForLayer(t,{headers:t.get("useBearerToken")?(0,l._)({},(0,et.M)(null==A?void 0:A.getKeycloak())):{}})];case 2:return e=a.sent(),e=(0,rO.transformExtent)(e,"EPSG:4326",_.getView().getProjection()),_.getView().fit(e,{padding:S()}),[3,5];case 3:return r=a.sent(),k.A.error(r),m.Ay.error({message:E("LayerTreeContextMenu.extentError")}),[3,5];case 4:return x(!1),[7];case 5:return[2]}})})();break;case"removeExternal":if(_){U(t);var i=L.B.getLayerByName(_,E("AddLayerModal.externalWmsFolder")),s=L.B.getLayerByName(_,E("UploadDataModal.uploadedDataFolder"));i&&0===i.getLayers().getLength()&&U(i),s&&0===s.getLayers().getLength()&&U(s)}break;case"toggleLegend":var o=(0,b.getUid)(t),u=[...a];u.includes(o)?u.splice(u.indexOf(o),1):u.push(o),n(u);break;case"editLayer":w((0,e_.J7)(null)),w((0,e_.Ht)((0,b.getUid)(t))),w((0,eq.WU)());break;case"layerDetails":w((0,tr.wT)((0,b.getUid)(t))),w((0,tr.WU)())}h(!1)}},placement:"bottomLeft",onOpenChange:h,open:p,trigger:["click"]},u),{children:(0,s.jsx)(eF.g,{icon:eT.vaG})}))})},aR=()=>(0,s.jsxs)("div",{className:"layer-node-title-loading-animation",children:[(0,s.jsx)("span",{className:"dot-one",children:"."}),(0,s.jsx)("span",{className:"dot-two",children:"."}),(0,s.jsx)("span",{className:"dot-three",children:"."})]}),a$=e=>{var r,t,i=(0,a._)({},(0,n._)(e)),u=(0,P.k)(),c=(0,ea.A)(),g=(0,C.useTranslation)().t,m=null==u?void 0:u.getAllLayers().map(e=>(0,b.getUid)(e)),f=null!=(r=O(e=>e.layerTree.showLegends))&&r,p=null!=(t=O(e=>e.layerTree.layerIconsVisible))&&t,h=(0,d._)((0,o.useState)(f&&null!=m?m:[]),2),y=h[0],v=h[1],x=(0,d._)((0,o.useState)({}),2),w=x[0],_=x[1],k=(0,d._)((0,o.useState)(),2),E=k[0],N=k[1],T=(0,o.useCallback)(()=>{u&&L.B.getAllLayers(u).forEach(e=>{if(e instanceof te()){var r=e.getSource();r instanceof er()&&(r.hasListener("tileloadstart")||r.on("tileloadstart",B),r.hasListener("tileloadend")||r.hasListener("tileloaderror")||r.on(["tileloadend","tileloaderror"],I)),r instanceof Z()&&(r.hasListener("imageloadstart")||r.on("imageloadstart",B),r.hasListener("imageloadend")||r.hasListener("imageloaderror")||r.on(["imageloadend","imageloaderror"],I))}})},[u]),F=(0,o.useCallback)(()=>{var e=null==u?void 0:u.getAllLayers().map(e=>(0,b.getUid)(e));(null==e?void 0:e.length)!==(null==m?void 0:m.length)&&T()},[u,m,T]),M=(0,o.useMemo)(()=>({SCALE:E,LEGEND_OPTIONS:"fontAntiAliasing:true;forceLabels:on",TRANSPARENT:!0}),[E]),D=(0,o.useMemo)(()=>(0,l._)({},(0,et.M)(null==c?void 0:c.getKeycloak())),[c]),U=(0,o.useCallback)(e=>{var r=e.map.getView(),t=r.getProjection().getUnits()||"m",a=r.getResolution();N(a?L.B.getScaleForResolution(a,t):void 0)},[]);(0,o.useEffect)(()=>{if(u)return U(new aN.A("moveend",u)),u.on("moveend",U),()=>{u.un("moveend",U)}},[u,U]),(0,o.useEffect)(()=>{if(u)return T(),u.getLayers().on("change",F),()=>{L.B.getAllLayers(u).forEach(e=>{if(e instanceof te()){var r=e.getSource();r.hasListener("tileloadstart")&&r.un("tileloadstart",B),r.hasListener("tileloadend")&&r.un("tileloadend",I),r.hasListener("tileloaderror")&&r.un("tileloaderror",I)}}),u.getLayers().un("change",F)}},[u,T,F]);var B=e=>{_(r=>{var t=(0,b.getUid)(e.target),a=structuredClone(r);return a[t]&&a[t].loaded>=a[t].loading?(a[t].loading=1,a[t].loaded=0,a[t].percent=0):(a[t]||(a[t]={loading:0,loaded:0,percent:0}),a[t].loading=Number.isInteger(a[t].loading)?a[t].loading+1:1),a})},I=e=>{_(r=>{var t=(0,b.getUid)(e.target),a=structuredClone(r);a[t]||(a[t]={loading:0,loaded:0,percent:0}),a[t].loaded=Number.isInteger(a[t].loaded)?a[t].loaded+1:1;var n=Math.round(a[t].loaded/a[t].loading*100);return n>a[t].percent&&(a[t].percent=n),a})};return u?(0,s.jsx)(aT(),(0,l._)({"aria-label":"layertree",className:"layertree",nodeTitleRenderer:e=>{if(u){var r,t=e instanceof te()&&(0,b.getUid)(e.getSource())?null==(r=w[(0,b.getUid)(e.getSource())])?void 0:r.percent:100;return e instanceof j()?(0,s.jsx)("div",{"aria-label":"layer-group",children:e.get("name")}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"tree-node-header","aria-label":"tree-node-header",children:[(0,s.jsxs)("span",{"aria-label":"layer-name",className:"layer-name",children:[e.get("name"),(0,s.jsx)("span",{className:"loading-dots",children:t<100&&(0,s.jsx)(aR,{})}),(0,s.jsxs)("span",{className:"layer-icons-group",children:[e.get("searchable")&&p&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(ry.A,{title:g("ToolMenu.searchable"),children:(0,s.jsx)(eF.g,{icon:eT.$UM,className:"layer-icon"})})}),e.get("hoverable")&&e.get("visible")&&p&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(ry.A,{title:g("ToolMenu.queryable"),children:(0,s.jsx)(eF.g,{icon:eT.mEO,className:"layer-icon"})})}),e.get("editable")&&p&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(ry.A,{title:g("ToolMenu.editable"),children:(0,s.jsx)(eF.g,{icon:eT.hpd,className:"layer-icon"})})})]})]}),(e instanceof S()||e instanceof A())&&(0,s.jsx)("div",{"aria-label":"layer-context-menu",children:(0,s.jsx)(aI,{layer:e,visibleLegendsIds:y,setVisibleLegendsIds:v})})]}),e.get("visible")&&(0,s.jsx)("div",{className:"layer-transparency",role:"button","aria-label":"transparency-slider",tabIndex:0,onClick:e=>e.stopPropagation(),onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),e.stopPropagation())},onDragStart:e=>{e.stopPropagation(),e.preventDefault()},draggable:!0,children:(0,s.jsx)(aM(),{tooltip:{formatter:e=>`${g("LayerTree.transparency")}: ${e}%`},layer:e})}),e.get("visible")&&"WMSTIME"===e.get("type")&&(0,s.jsx)("div",{className:"layer-time-slider",children:(0,s.jsx)(aB,{layer:e})}),e.get("visible")&&(0,Q.lb)(e)&&y.includes((0,b.getUid)(e))&&(0,s.jsx)(aF.Legend,{layer:e,errorMsg:g("LayerTree.noLegendAvailable"),extraParams:M,headers:e.get("useBearerToken")?D:void 0})]})}},filterFunction:e=>e instanceof j()||!(e instanceof td())||!ej()(e.get("shogunId")),draggable:!0},i)):(0,s.jsx)(s.Fragment,{})},aV=t(37100),aY=t.n(aV),aH=t(80868),az=e=>{var r=e.showMeasureDistance,t=e.showMeasureArea,a=(0,C.useTranslation)().t,n=(0,P.k)(),l=(0,o.useMemo)(()=>{if(ej()(n))return!0;var e=aY().Proj(n.getView().getProjection().getCode()),r=tS()(e,"projName");return e4()(r)||"longlat"===r||"geocent"===r},[n]),i=(0,d._)((0,o.useState)(),2),u=i[0],c=i[1];return n?(0,s.jsxs)(rr.ToggleGroup,{className:"measure-tools",selected:u,onChange:(e,r)=>{c(r)},children:[r?(0,s.jsxs)(aH.MeasureButton,{geodesic:l,value:"line",measureType:"line",type:"link",continueLineMsg:a("Measure.clicktodrawline"),children:[(0,s.jsx)(eF.g,{icon:eT.$$g}),(0,s.jsx)("span",{className:"measure-text",children:a("Measure.line")})]}):(0,s.jsx)(s.Fragment,{}),t?(0,s.jsxs)(aH.MeasureButton,{geodesic:l,value:"poly",measureType:"polygon",type:"link",continuePolygonMsg:a("Measure.clicktodrawarea"),children:[(0,s.jsx)(eF.g,{icon:eT.mSI}),(0,s.jsx)("span",{className:"measure-text",children:a("Measure.area")})]}):(0,s.jsx)(s.Fragment,{})]}):(0,s.jsx)(s.Fragment,{})},aG=e=>{var r,t=e.collapseWidth,a=void 0===t?40:t,n=e.minWidth,u=void 0===n?240:n,c=e.maxWidth,g=void 0===c?600:c,m=(0,eg._)(e,["collapseWidth","minWidth","maxWidth"]),f=(0,C.useTranslation)().t,p=(0,P.k)(),h=V(),y=D(),v=O(e=>e.toolMenu.availableTools),b=O(e=>e.toolMenu.activeKeys),x=O(e=>e.toolMenu.maxHeight),j=(0,ea.A)(),w=null==j?void 0:j.getKeycloak(),A=(0,d._)((0,o.useState)(!1),2),_=A[0],S=A[1],k=(0,d._)((0,o.useState)([]),2),E=k[0],N=k[1],L=(0,d._)((0,o.useState)(!1),2),T=L[0],F=L[1],M=(0,d._)((0,o.useState)(320),2),B=M[0],I=M[1],R=(0,d._)((0,o.useState)(B),2),$=R[0],Y=R[1];(0,o.useEffect)(()=>{var e=window.matchMedia("only screen and (max-width: 450px) and (orientation: portrait),only screen and (max-width: 750px) and (orientation: landscape), only screen and (max-width: 580px)"),r=RegExp("/Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile|Kindle|NetFront|Silk-Accelerated|(hpw|web)OS|Fennec|Minimo|Opera M(obi|ini)|Blazer|Dolfin|Dolphin|Skyfire|Zune/");(e.matches||r.test(window.navigator.userAgent))&&(S(!0),I(a))},[a]),(0,o.useEffect)(()=>{E.length<1&&(v.includes("default")?N(["measure_tools","draw_tools","feature_info","print","tree","permalink","language_selector"]):N(v))},[E,v]),(0,o.useEffect)(()=>{var e=["print","measure_tools","draw_tools","feature_info","tree"];if(e.filter(e=>b.includes(e)).length>1){var r=b.slice(0,b.length-1).reverse().find(r=>e.includes(r));r&&y((0,tM.R_)(b.filter(e=>e!==r)))}y((0,tF.SY)(b.includes("feature_info"))),y((0,tP.NG)(b.includes("tree")))},[b,y]);var H=O(e=>e.layerTree.activeUploadTools),z=(0,o.useCallback)(()=>{F(!0)},[]),G=(0,o.useCallback)(()=>{F(!1)},[]),W=(0,o.useCallback)(e=>{if(T&&!_){var r=e.clientX-document.body.offsetLeft;r>u&&r<g&&(I(r),Y(r))}},[T,_,u,g]);return(0,o.useEffect)(()=>(document.addEventListener("mousemove",W),document.addEventListener("mouseup",G),()=>{document.removeEventListener("mousemove",W),document.removeEventListener("mouseup",G)}),[W,G]),(0,s.jsxs)("div",{"aria-label":"tool-menu",className:`tool-menu ${_?"collapsed":""}`,style:{width:B,maxHeight:null!=x?x:"100%"},children:[(0,s.jsx)(tN.A,(0,l._)({expandIconPosition:"end",activeKey:b,destroyOnHidden:!0,onChange:e=>{S(!1),y((0,tM.R_)(tT()(e))),_&&I($)},items:(r=[],E.forEach(e=>{var t=(e=>{switch(e){case"measure_tools":return{icon:eT.W2$,title:f("ToolMenu.measure"),wrappedComponent:(0,s.jsx)(az,{showMeasureDistance:v.includes("default")||v.includes("measure_tools_distance"),showMeasureArea:v.includes("default")||v.includes("measure_tools_area")})};case"draw_tools":return{icon:eT.fyG,title:f("ToolMenu.draw"),wrappedComponent:(0,s.jsx)(ay,{showDrawPoint:v.includes("default")||v.includes("draw_tools_point"),showDrawLine:v.includes("default")||v.includes("draw_tools_line"),showDrawPolygon:v.includes("default")||v.includes("draw_tools_polygon"),showDrawCircle:v.includes("default")||v.includes("draw_tools_circle"),showDrawRectangle:v.includes("default")||v.includes("draw_tools_rectangle"),showDrawAnnotation:v.includes("default")||v.includes("draw_tools_annotation"),showModifyFeatures:v.includes("default")||v.includes("draw_tools_modify"),showUploadFeatures:v.includes("default")||v.includes("draw_tools_upload"),showDownloadFeatures:v.includes("default")||v.includes("draw_tools_download"),showDeleteFeatures:v.includes("default")||v.includes("draw_tools_delete"),showStyleFeatures:v.includes("default")||v.includes("draw_tools_style")})};case"feature_info":return{icon:eT.mEO,title:f("ToolMenu.featureInfo"),wrappedComponent:(0,s.jsx)(aE,{})};case"print":return{icon:eT.mHA,title:f("ToolMenu.print"),wrappedComponent:p?(0,s.jsx)(at,{active:b.includes("print"),layerBlackList:["react-geo_measure","hoverVectorLayer"]}):(0,s.jsx)(s.Fragment,{})};case"tree":var r,t,a;return{icon:eT.GKN,title:f("ToolMenu.layertree"),wrappedComponent:(0,s.jsxs)("div",{className:"tree-wrapper",children:[(0,s.jsx)(a$,{}),(null==H?void 0:H.includes(tP.Rt.addWMS))&&(0,s.jsx)(eE.Ay,{className:"add-wms-button tool-menu-button",icon:(0,s.jsx)(eF.g,{icon:eT.QLR}),onClick:()=>y((0,U.WU)()),children:f("ToolMenu.addWms")}),w&&(null==(a=K().geoserver)||null==(t=a.upload)||null==(r=t.authorizedRoles)?void 0:r.some(e=>w.hasResourceRole(e,w.clientId)))&&(null==H?void 0:H.includes(tP.Rt.dataUpload))&&(0,s.jsx)(eE.Ay,{className:"upload-data-button tool-menu-button",icon:(0,s.jsx)(eF.g,{icon:eT.JmV}),onClick:()=>y((0,tD.WU)()),children:f("ToolMenu.uploadData")})]})};case"permalink":return{icon:eT.ekB,title:f("Permalink.title"),wrappedComponent:(0,s.jsx)(tG,{})};case"language_selector":return{icon:eT.mh,title:f("ToolMenu.languageSelect"),wrappedComponent:(0,s.jsx)(tU,{})}}})(e);if(t){var a=t.icon,n=t.title,l=t.wrappedComponent;r.push({key:e,label:(0,s.jsxs)(s.Fragment,{children:[a?(0,s.jsx)(eF.g,{icon:a}):void 0,(0,s.jsx)("span",{children:n})]}),children:l})}}),h&&h.forEach(e=>{var t;if((t=e.integration)&&"tool-menu"===t.placement){var a=e.key,n=e.wrappedComponent,o=e.integration,u=o.label,c=o.insertionIndex,d=o.icon,g=(0,eg._)(e.integration,["label","insertionIndex","icon"]),m=(0,i._)((0,l._)({key:a,label:(0,s.jsxs)(s.Fragment,{children:[d?(0,s.jsx)(eF.g,{icon:d}):void 0,(0,s.jsx)("span",{children:f(void 0===u?"Plugin":u)})]})},g),{children:(0,s.jsx)(n,{})});r.splice(null!=c?c:0,0,m)}}),r)},m)),(0,s.jsx)(ry.A,{placement:"right",title:_?f("ToolMenu.expand"):f("ToolMenu.collapse"),children:(0,s.jsx)(eE.Ay,{className:"collapse-btn","aria-label":"collapse-button",icon:_?(0,s.jsx)(eF.g,{icon:eT.XkK}):(0,s.jsx)(eF.g,{icon:eT.Wzs}),onClick:()=>{y((0,tM.R_)([])),S(!_),_?I($):I(a)}})}),_?(0,s.jsx)(s.Fragment,{}):(0,s.jsx)("div",{className:"dynamicWidth",role:"button",tabIndex:0,onMouseDown:z,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),z())}})]})},aW=t(24522),aK=t(56334),aJ=ek.A.Dragger,aq=e=>{var r=(0,a._)({},(0,n._)(e)),t=(0,d._)((0,o.useState)(""),2),u=t[0],m=t[1],p=(0,d._)((0,o.useState)(""),2),h=p[0],y=p[1],v=(0,d._)((0,o.useState)(!1),2),b=v[0],x=v[1],w=O(e=>e.uploadDataModal.visible),A=O(e=>e.user),_=D(),S=(0,P.k)(),E=(0,ea.A)(),N=(0,C.useTranslation)().t;return(0,s.jsxs)(f.A,(0,i._)((0,l._)({className:"upload-data-modal",title:N("UploadDataModal.title"),open:w,onCancel:()=>{m(""),y(""),_((0,tD.jD)())},width:600,footer:!1},r),{children:[h&&(0,s.jsx)(G.A,{message:h,closable:!0,type:"success"}),u&&(0,s.jsx)(G.A,{message:u,closable:!0,type:"error"}),(0,s.jsx)(tt.A,{spinning:b,children:(0,s.jsxs)(aJ,{customRequest:e=>(0,c._)(function(){var r,t,a,n,s,o,u,m,f,p,h,y,v,b,x;return(0,g.YH)(this,function(j){switch(j.label){case 0:n=e.onError,s=e.onSuccess,u=(o=e.file).name.split("."),m=o.type,p=null!=(f=null==(r=K().geoserver)?void 0:r.base)?f:"/geoserver",y=null!=(h=null==(a=K().geoserver)||null==(t=a.upload)?void 0:t.workspace)?h:"SHOGUN",v=`${u[0]}_${Date.now()}`.toUpperCase(),b={file:o,baseUrl:p,workspace:y,storeName:v,layerName:v},j.label=1;case 1:let w;if(j.trys.push([1,6,,7]),"image/tiff"!==m)return[3,3];return[4,(w=b,(0,c._)(function(){var e,r,t,a,n,s;return(0,g.YH)(this,function(o){switch(o.label){case 0:return r=w.baseUrl,t=w.workspace,a=w.storeName,n=w.layerName,s=w.file,[4,fetch(`${r}/rest/workspaces/${t}/coveragestores/${a}/file.geotiff?configure=none`,{method:"PUT",headers:(0,i._)((0,l._)({},(0,et.M)(null==E?void 0:E.getKeycloak())),{"Content-Type":"image/tiff"}),body:s})];case 1:if(!o.sent().ok)throw Error(N("UploadDataModal.error.general",{fileName:s.name}));return[4,fetch(`${r}/rest/workspaces/${t}/coveragestores/${a}/coverages`,{method:"POST",headers:(0,i._)((0,l._)({},(0,et.M)(null==E?void 0:E.getKeycloak())),{"Content-Type":"application/json"}),body:JSON.stringify({coverage:{enabled:!0,name:n,nativeName:n,title:n,keywords:{string:["User upload",`Uploaded by ${null==(e=A.providerDetails)?void 0:e.username}`]}}})})];case 2:if(!o.sent().ok)throw Error(N("UploadDataModal.error.general",{fileName:s.name}));return[2]}})})())];case 2:j.sent(),j.label=3;case 3:let _;if("application/zip"!==m)return[3,5];return[4,(_=b,(0,c._)(function(){var e,r,t,a,n,s,o,u,c;return(0,g.YH)(this,function(g){switch(g.label){case 0:return r=_.baseUrl,t=_.workspace,a=_.storeName,n=_.layerName,s=_.file,[4,aW.Shapefile.load(s)];case 1:if(o=g.sent(),u="",c={attribute:[]},1!==Object.entries(o).length)throw Error(N("UploadDataModal.error.zipContent"));return Object.entries(o).forEach(e=>{var r=(0,d._)(e,2),t=r[0],a=r[1];u=t;var n=a.parse("dbf",{properties:!1});c.attribute=n.fields.map(e=>({name:e.name,minOccurs:0,maxOccurs:1,nillable:!0,binding:(e=>{switch(e){case"C":return"java.lang.String";case"D":return"java.util.Date";case"N":return"java.lang.Long";case"F":return"java.lang.Double";case"L":return"java.lang.Boolean";default:return null}})(e.type),length:e.length}));var l=a.parse("shx");c.attribute.push({name:"the_geom",minOccurs:0,maxOccurs:1,nillable:!0,binding:{0:null,1:"org.locationtech.jts.geom.Point",3:"org.locationtech.jts.geom.LineString",5:"org.locationtech.jts.geom.Polygon",8:"org.locationtech.jts.geom.MultiPoint",11:"org.locationtech.jts.geom.Point",13:"org.locationtech.jts.geom.LineString",15:"org.locationtech.jts.geom.Polygon",18:"org.locationtech.jts.geom.MultiPoint",21:"org.locationtech.jts.geom.Point",23:"org.locationtech.jts.geom.LineString",25:"org.locationtech.jts.geom.Polygon",28:"org.locationtech.jts.geom.MultiPoint",31:null}[l.header.type]})}),[4,fetch(`${r}/rest/workspaces/${t}/datastores/${a}/file.shp?configure=none`,{method:"PUT",headers:(0,i._)((0,l._)({},(0,et.M)(null==E?void 0:E.getKeycloak())),{"Content-Type":"application/zip"}),body:s})];case 2:if(!g.sent().ok)throw Error(N("UploadDataModal.error.general",{fileName:s.name}));return[4,fetch(`${r}/rest/workspaces/${t}/datastores/${a}/featuretypes`,{method:"POST",headers:(0,i._)((0,l._)({},(0,et.M)(null==E?void 0:E.getKeycloak())),{"Content-Type":"application/json"}),body:JSON.stringify({featureType:{enabled:!0,name:n,nativeName:u,title:n,attributes:c,keywords:{string:["User upload",`Uploaded by ${null==(e=A.providerDetails)?void 0:e.username}`]}}})})];case 3:if(!g.sent().ok)throw Error(N("UploadDataModal.error.general",{fileName:s.name}));return[2]}})})())];case 4:j.sent(),j.label=5;case 5:return s&&s({baseUrl:p,workspace:y,layerName:v}),[3,7];case 6:return x=j.sent(),n&&n({name:"UploadError",message:x instanceof Error?x.message:N("UploadDataModal.error.general",{fileName:o.name})}),[3,7];case 7:return[2]}})})(),accept:"image/tiff,application/zip",maxCount:1,showUploadList:!1,beforeUpload:e=>{var r,t,a,n=null!=(a=null==(t=K().geoserver)||null==(r=t.upload)?void 0:r.limit)?a:2e8,l=e.type,i=e.size;if(m(""),y(""),i>n)return m(N("UploadDataModal.error.maxSize",{maxSize:n/1e6})),!1;var s=["application/zip","image/tiff"];return!!s.includes(l)||(m(N("UploadDataModal.error.supportedFormats",{supportedFormats:s.join(", ")})),!1)},onChange:e=>(0,c._)(function(){var r,t,a;return(0,g.YH)(this,function(n){if("uploading"===(r=e.file).status&&x(!0),"done"===r.status){if(!E||!r.response)return[2];t={name:r.response.layerName,type:"TILEWMS",clientConfig:{hoverable:!0},sourceConfig:{url:`${r.response.baseUrl}/ows?`,layerNames:`${r.response.workspace}:${r.response.layerName}`,useBearerToken:!0}},(a=new aK.A({client:E}).parseTileLayer(t)).set("layerConfig",t),a.set("isUploadedLayer",!0),a.set("groupName",N("UploadDataModal.uploadedDataFolder"));if(S){var l=N("UploadDataModal.uploadedDataFolder"),i=L.B.getLayerByName(S,l);if(!i){i=new(j())({layers:[],properties:{name:l}});var s=S.getLayerGroup().getLayers();s.insertAt((null==s?void 0:s.getLength())||0,i)}i.getLayers().getArray().includes(a)||i.getLayers().push(a)}y(N("UploadDataModal.success",{fileName:r.name,layerName:r.response.layerName})),x(!1)}else"error"===r.status&&(x(!1),k.A.error(r.error),r.error&&r.error.message?m(r.error.message):m(N("UploadDataModal.error.general",{fileName:r.name})));return[2]})})(),children:[(0,s.jsx)("p",{className:"ant-upload-drag-icon",children:(0,s.jsx)(eF.g,{icon:eT.JmV})}),(0,s.jsx)("p",{className:"ant-upload-text",children:N("UploadDataModal.description")}),(0,s.jsx)("p",{className:"ant-upload-hint",children:N("UploadDataModal.hint")})]})})]}))},aQ=e=>{var r=(0,a._)({},(0,n._)(e));return(0,c._)(function(){var e,r,t,a,n,l,i,s,o,c,d,m,f,p,h,y,v,b,x;return(0,g.YH)(this,function(w){switch(w.label){case 0:var _;if(e=(0,P.k)(),r=(0,ea.A)(),_=window.location.search,t=u().useMemo(()=>new URLSearchParams(_),[_]),a=(0,C.useTranslation)().t,n=t.get("layers"),!e||(l=e=>e.get("name"),i=e=>e instanceof S()||e instanceof A(),!(s=tz.s.applyLink(e,";",l,i))))return[2];o=r=>{var t=new(j())({layers:[]});t.set("name",r);var a=e.getLayerGroup().getLayers();return a.insertAt((null==a?void 0:a.getLength())||0,t),t},w.label=1;case 1:if(w.trys.push([1,10,,11]),c=JSON.parse(s),!r)throw Error("Client is not available");d=new aK.A({client:r}),m=!0,f=!1,p=void 0,w.label=2;case 2:w.trys.push([2,7,8,9]),h=function(){var r,t,l,i,s;return(0,g.YH)(this,function(u){switch(u.label){case 0:if(r=v.value,e4()(null==r?void 0:r.layerConfig))return[3,2];return t=r.layerConfig,[4,d.parseLayer(t)];case 1:if(!(l=u.sent())||(r.isExternalLayer&&l.set("isExternalLayer",r.isExternalLayer),r.isUploadedLayer&&l.set("isUploadedLayer",r.isUploadedLayer),l.set("groupName",r.groupName),l.set("layerConfig",r.layerConfig),l.setVisible(!!(null==n?void 0:n.split(";").some(e=>e===t.name))),!(l.get("isExternalLayer")||l.get("isUploadedLayer"))))return[2,"continue"];i=void 0,l.get("groupName")?(i=L.B.getLayerByName(e,l.get("groupName")))||(i=o(l.get("groupName"))):(i=null==(s=L.B.getLayersByProperty(e,"isExternalLayerGroup",!0))?void 0:s[0])||(i=o(a("AddLayerModal.externalWmsFolder"))).set("isExternalLayerGroup",!0),L.B.getLayerByName(e,l.get("name"))||i.getLayers().push(l),u.label=2;case 2:return[2]}})},y=c[Symbol.iterator](),w.label=3;case 3:if(m=(v=y.next()).done)return[3,6];return[5,(0,g.Ju)(h())];case 4:w.sent(),w.label=5;case 5:return m=!0,[3,3];case 6:return[3,9];case 7:return b=w.sent(),f=!0,p=b,[3,9];case 8:try{m||null==y.return||y.return()}finally{if(f)throw p}return[7];case 9:return[3,11];case 10:return x=w.sent(),k.A.error(x),[3,11];case 11:return[2]}})})(),(0,o.useEffect)(()=>{var e=document.querySelectorAll(".loadmask")[0];e&&e.classList.add("loadmask-hidden")},[]),(0,s.jsxs)("div",(0,i._)((0,l._)({className:"App"},r),{children:[(0,s.jsx)(r6,{}),(0,s.jsx)(Y,{}),(0,s.jsx)(aG,{}),(0,s.jsx)(tu,{}),(0,s.jsx)(rk,{}),(0,s.jsx)(z,{}),(0,s.jsx)(B,{}),(0,s.jsx)(aq,{}),(0,s.jsx)(rp,{}),(0,s.jsx)(tl,{}),(0,s.jsx)(tE,{}),(0,s.jsx)(tv,{})]}))},aX=aQ},59627:function(){},99286:function(){}}]);
//# sourceMappingURL=7916.231b792590bf20a7.js.map