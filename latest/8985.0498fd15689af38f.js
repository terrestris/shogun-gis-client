"use strict";(self.webpackChunk_terrestris_shogun_gis_client=self.webpackChunk_terrestris_shogun_gis_client||[]).push([["8985"],{80967:function(e,t){t.Z=class e{constructor(){this.disposed=!1}dispose(){!this.disposed&&(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}},30006:function(e,t,n){var i=n(73381);t.Z={SINGLECLICK:"singleclick",CLICK:i.default.CLICK,DBLCLICK:i.default.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"}},79682:function(e,t,n){function i(e,t,n){let i,o;n=n||r;let s=0,a=e.length,u=!1;for(;s<a;)(o=+n(e[i=s+(a-s>>1)],t))<0?s=i+1:(a=i,u=!o);return u?s:~s}function r(e,t){return e>t?1:e<t?-1:0}function o(e,t){return e<t?1:e>t?-1:0}function s(e,t,n){if(e[0]<=t)return 0;let i=e.length;if(t<=e[i-1])return i-1;if("function"==typeof n){for(let r=1;r<i;++r){let i=e[r];if(i===t)return r;if(i<t){if(n(t,e[r-1],i)>0)return r-1;return r}}return i-1}if(n>0){for(let n=1;n<i;++n)if(e[n]<t)return n-1;return i-1}if(n<0){for(let n=1;n<i;++n)if(e[n]<=t)return n;return i-1}for(let n=1;n<i;++n){if(e[n]==t)return n;if(e[n]<t){if(e[n-1]-t<t-e[n])return n-1;return n}}return i-1}function a(e,t,n){for(;t<n;){let i=e[t];e[t]=e[n],e[n]=i,++t,--n}}function u(e,t){let n=Array.isArray(t)?t:[t],i=n.length;for(let t=0;t<i;t++)e[e.length]=n[t]}function l(e,t){let n=e.length;if(n!==t.length)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}function h(e,t,n){let i=t||r;return e.every(function(t,r){if(0===r)return!0;let o=i(e[r-1],t);return!(o>0||n&&0===o)})}n.d(t,{$1:function(){return o},FZ:function(){return a},fS:function(){return l},h7:function(){return s},j2:function(){return r},l7:function(){return u},pT:function(){return h},ry:function(){return i}})},86320:function(e,t,n){function i(e){return Math.pow(e,3)}function r(e){return 1-i(1-e)}function o(e){return 3*e*e-2*e*e*e}function s(e){return e}function a(e){return e<.5?o(2*e):1-o(2*(e-.5))}n.r(t),n.d(t,{easeIn:function(){return i},easeOut:function(){return r},inAndOut:function(){return o},linear:function(){return s},upAndDown:function(){return a}})},9520:function(e,t,n){n.r(t),n.d(t,{preventDefault:function(){return r},stopPropagation:function(){return i}});function i(e){e.stopPropagation()}function r(e){e.preventDefault()}t.default=class e{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}},73381:function(e,t,n){n.r(t),t.default={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"}},66575:function(e,t,n){var i=n(80967),r=n(64011),o=n(13580),s=n(9520);class a extends i.Z{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;let n=this.listeners_||(this.listeners_={}),i=n[e]||(n[e]=[]);!i.includes(t)&&i.push(t)}dispatchEvent(e){let t;let n="string"==typeof e,i=n?e:e.type,o=this.listeners_&&this.listeners_[i];if(!o)return;let a=n?new s.default(e):e;!a.target&&(a.target=this.eventTarget_||this);let u=this.dispatching_||(this.dispatching_={}),l=this.pendingRemovals_||(this.pendingRemovals_={});!(i in u)&&(u[i]=0,l[i]=0),++u[i];for(let e=0,n=o.length;e<n;++e)if(!1===(t="handleEvent"in o[e]?o[e].handleEvent(a):o[e].call(this,a))||a.propagationStopped){t=!1;break}if(0==--u[i]){let e=l[i];for(delete l[i];e--;)this.removeEventListener(i,r.VOID);delete u[i]}return t}disposeInternal(){this.listeners_&&(0,o.Z)(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return!!this.listeners_&&(e?e in this.listeners_:Object.keys(this.listeners_).length>0)}removeEventListener(e,t){if(!this.listeners_)return;let n=this.listeners_[e];if(!n)return;let i=n.indexOf(t);-1!==i&&(this.pendingRemovals_&&e in this.pendingRemovals_?(n[i]=r.VOID,++this.pendingRemovals_[e]):(n.splice(i,1),0===n.length&&delete this.listeners_[e]))}}t.Z=a},36403:function(e,t,n){n.r(t),n.d(t,{all:function(){return a},altKeyOnly:function(){return u},altShiftKeysOnly:function(){return l},always:function(){return g},click:function(){return c},doubleClick:function(){return v},focus:function(){return h},focusWithTabindex:function(){return d},mouseActionButton:function(){return f},mouseOnly:function(){return S},never:function(){return _},noModifierKeys:function(){return y},penOnly:function(){return T},platformModifierKey:function(){return C},platformModifierKeyOnly:function(){return E},pointerMove:function(){return m},primaryAction:function(){return w},shiftKeyOnly:function(){return x},singleClick:function(){return p},targetNotEditable:function(){return P},touchOnly:function(){return F}});var i=n(30006),r=n(38906),o=n(64011),s=n(91358);function a(e){let t=arguments;return function(e){let n=!0;for(let i=0,r=t.length;i<r&&(n=n&&t[i](e));++i);return n}}let u=function(e){let t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},l=function(e){let t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},h=function(e){let t=e.map.getTargetElement(),n=t.getRootNode(),i=e.map.getOwnerDocument().activeElement;return n instanceof ShadowRoot?n.host.contains(i):t.contains(i)},d=function(e){let t=e.map.getTargetElement(),n=t.getRootNode();return!(n instanceof ShadowRoot?n.host:t).hasAttribute("tabindex")||h(e)},g=o.TRUE,c=function(e){return e.type==i.Z.CLICK},f=function(e){let t=e.originalEvent;return 0==t.button&&!(s.WEBKIT&&s.MAC&&t.ctrlKey)},_=o.FALSE,m=function(e){return"pointermove"==e.type},p=function(e){return e.type==i.Z.SINGLECLICK},v=function(e){return e.type==i.Z.DBLCLICK},y=function(e){let t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},E=function(e){let t=e.originalEvent;return!t.altKey&&(s.MAC?t.metaKey:t.ctrlKey)&&!t.shiftKey},C=function(e){let t=e.originalEvent;return s.MAC?t.metaKey:t.ctrlKey},x=function(e){let t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},P=function(e){let t=e.originalEvent,n=t.target.tagName;return"INPUT"!==n&&"SELECT"!==n&&"TEXTAREA"!==n&&!t.target.isContentEditable},S=function(e){let t=e.originalEvent;return(0,r.h)(void 0!==t,"mapBrowserEvent must originate from a pointer event"),"mouse"==t.pointerType},F=function(e){let t=e.originalEvent;return(0,r.h)(void 0!==t,"mapBrowserEvent must originate from a pointer event"),"touch"===t.pointerType},T=function(e){let t=e.originalEvent;return(0,r.h)(void 0!==t,"mapBrowserEvent must originate from a pointer event"),"pen"===t.pointerType},w=function(e){let t=e.originalEvent;return(0,r.h)(void 0!==t,"mapBrowserEvent must originate from a pointer event"),t.isPrimary&&0===t.button}},64011:function(e,t,n){n.r(t),n.d(t,{FALSE:function(){return o},TRUE:function(){return r},VOID:function(){return s},memoizeOne:function(){return a},toPromise:function(){return u}});var i=n(79682);function r(){return!0}function o(){return!1}function s(){}function a(e){let t,n,r;return function(){let o=Array.prototype.slice.call(arguments);return(!n||this!==r||!(0,i.fS)(o,n))&&(r=this,n=o,t=e.apply(this,arguments)),t}}function u(e){return function(){let t;try{t=e()}catch(e){return Promise.reject(e)}return t instanceof Promise?t:Promise.resolve(t)}()}},47588:function(e,t,n){n.d(t,{Cv:function(){return a},FW:function(){return u}});var i=n(58493),r=n(86320),o=n(73604);class s extends i.default{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(o.Z.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(o.Z.ACTIVE,e)}setMap(e){this.map_=e}}function a(e,t,n){let i=e.getCenterInternal();if(i){let o=[i[0]+t[0],i[1]+t[1]];e.animateInternal({duration:void 0!==n?n:250,easing:r.linear,center:e.getConstrainedCenter(o)})}}function u(e,t,n,i){let o=e.getZoom();if(void 0===o)return;let s=e.getConstrainedZoom(o+t),a=e.getResolutionForZoom(s);e.getAnimating()&&e.cancelAnimations(),e.animate({resolution:a,anchor:n,duration:void 0!==i?i:250,easing:r.easeOut})}t.ZP=s},1577:function(e,t,n){n.r(t),n.d(t,{ModifyEvent:function(){return T}});var i=n(78426),r=n(19629),o=n(23068),s=n(30006),a=n(79682),u=n(90728),l=n(9520),h=n(73381),d=n(36403),g=n(21915),c=n(52043),f=n(15265),_=n(28799),m=n(5374),p=n(73410),v=n(25753),y=n(73101),E=n(31219),C=n(49179),x=n(38024);let P=[0,0,0,0],S=[],F={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class T extends l.default{constructor(e,t,n){super(e),this.features=t,this.mapBrowserEvent=n}}class w extends x.default{constructor(e){let t;if(super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:d.primaryAction,this.defaultDeleteCondition_=function(e){return(0,d.altKeyOnly)(e)&&(0,d.singleClick)(e)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:d.always,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new y.Z,this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new _.default({source:new p.default({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:function(){let e=(0,E.createEditingStyle)();return function(t,n){return e.Point}}(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null,e.features?t=e.features:e.source&&(this.source_=e.source,t=new i.default(this.source_.getFeatures()),this.source_.addEventListener(v.Z.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(v.Z.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(r.Z.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(r.Z.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=void 0===e.snapToPointer?!this.hitDetection_:e.snapToPointer}addFeature_(e){let t=e.getGeometry();if(t){let n=this.SEGMENT_WRITERS_[t.getType()];n&&n(e,t)}let n=this.getMap();n&&n.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(n.getCoordinateFromPixel(this.lastPixel_)),e.addEventListener(h.default.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new i.default;let n=this.featuresBeingModified_.getArray();for(let e=0,i=t.length;e<i;++e){let i=t[e].feature;i&&!n.includes(i)&&this.featuresBeingModified_.push(i)}0===this.featuresBeingModified_.getLength()?this.featuresBeingModified_=null:this.dispatchEvent(new T(F.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(h.default.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){let t=this.rBush_,n=[];t.forEach(function(t){e===t.feature&&n.push(t)});for(let e=n.length-1;e>=0;--e){let i=n[e];for(let e=this.dragSegments_.length-1;e>=0;--e)this.dragSegments_[e][0]===i&&this.dragSegments_.splice(e,1);t.remove(i)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){let t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){let n=t.getCoordinates();this.rBush_.insert(t.getExtent(),{feature:e,geometry:t,segment:[n,n]})}writeMultiPointGeometry_(e,t){let n=t.getCoordinates();for(let i=0,r=n.length;i<r;++i){let r=n[i],o={feature:e,geometry:t,depth:[i],index:i,segment:[r,r]};this.rBush_.insert(t.getExtent(),o)}}writeLineStringGeometry_(e,t){let n=t.getCoordinates();for(let i=0,r=n.length-1;i<r;++i){let r=n.slice(i,i+2),o={feature:e,geometry:t,index:i,segment:r};this.rBush_.insert((0,g.boundingExtent)(r),o)}}writeMultiLineStringGeometry_(e,t){let n=t.getCoordinates();for(let i=0,r=n.length;i<r;++i){let r=n[i];for(let n=0,o=r.length-1;n<o;++n){let o=r.slice(n,n+2),s={feature:e,geometry:t,depth:[i],index:n,segment:o};this.rBush_.insert((0,g.boundingExtent)(o),s)}}}writePolygonGeometry_(e,t){let n=t.getCoordinates();for(let i=0,r=n.length;i<r;++i){let r=n[i];for(let n=0,o=r.length-1;n<o;++n){let o=r.slice(n,n+2),s={feature:e,geometry:t,depth:[i],index:n,segment:o};this.rBush_.insert((0,g.boundingExtent)(o),s)}}}writeMultiPolygonGeometry_(e,t){let n=t.getCoordinates();for(let i=0,r=n.length;i<r;++i){let r=n[i];for(let n=0,o=r.length;n<o;++n){let o=r[n];for(let r=0,s=o.length-1;r<s;++r){let s=o.slice(r,r+2),a={feature:e,geometry:t,depth:[n,i],index:r,segment:s};this.rBush_.insert((0,g.boundingExtent)(s),a)}}}}writeCircleGeometry_(e,t){let n=t.getCenter(),i={feature:e,geometry:t,index:0,segment:[n,n]},r={feature:e,geometry:t,index:1,segment:[n,n]},o=[i,r];i.featureSegments=o,r.featureSegments=o,this.rBush_.insert((0,g.createOrUpdateFromCoordinate)(n),i);let s=t,a=(0,m.getUserProjection)();if(a&&this.getMap()){let e=this.getMap().getView().getProjection();s=s.clone().transform(a,e),s=(0,f.fromCircle)(s).transform(e,a)}this.rBush_.insert(s.getExtent(),r)}writeGeometryCollectionGeometry_(e,t){let n=t.getGeometriesArray();for(let t=0;t<n.length;++t){let i=n[t];(0,this.SEGMENT_WRITERS_[i.getType()])(e,i)}}createOrUpdateVertexFeature_(e,t,n,i){let r=this.vertexFeature_;return r?r.getGeometry().setCoordinates(e):(r=new o.default(new c.default(e)),this.vertexFeature_=r,this.overlay_.getSource().addFeature(r)),r.set("features",t),r.set("geometries",n),r.set("existing",i),r}handleEvent(e){let t;return!e.originalEvent||(this.lastPointerEvent_=e,!e.map.getView().getInteracting()&&e.type==s.Z.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(t=e.type==s.Z.SINGLECLICK&&!!this.ignoreNextSingleClick_||this.removePoint()),e.type==s.Z.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t)}findInsertVerticesAndUpdateDragSegments_(e){this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null;let t=this.vertexFeature_;if(!t)return;let n=this.getMap().getView().getProjection(),i=[],r=t.getGeometry().getCoordinates(),o=(0,g.boundingExtent)([r]),s=this.rBush_.getInExtent(o),a={};s.sort(M);for(let t=0,o=s.length;t<o;++t){let o=s[t],l=o.segment,h=(0,C.getUid)(o.geometry),d=o.depth;if(d&&(h+="-"+d.join("-")),!a[h]&&(a[h]=[,,]),"Circle"===o.geometry.getType()&&1===o.index){let t=I(e,o,n);(0,u.equals)(t,r)&&!a[h][0]&&(this.dragSegments_.push([o,0]),a[h][0]=o);continue}if((0,u.equals)(l[0],r)&&!a[h][0]){this.dragSegments_.push([o,0]),a[h][0]=o;continue}if((0,u.equals)(l[1],r)&&!a[h][1]){if(a[h][0]&&0===a[h][0].index){let e=o.geometry.getCoordinates();switch(o.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":e=e[d[1]];case"Polygon":if(o.index!==e[d[0]].length-2)continue}}this.dragSegments_.push([o,1]),a[h][1]=o;continue}(0,C.getUid)(l)in this.vertexSegments_&&!a[h][0]&&!a[h][1]&&i.push(o)}return i}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([e])=>e));let t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],n=[],i=[];for(let r=0,o=this.dragSegments_.length;r<o;++r){let o;let s=this.dragSegments_[r],a=s[0],l=a.feature;!n.includes(l)&&n.push(l);let h=a.geometry;!i.includes(h)&&i.push(h);let d=a.depth,g=a.segment,c=s[1];for(;t.length<h.getStride();)t.push(g[c][t.length]);switch(h.getType()){case"Point":o=t,g[0]=t,g[1]=t;break;case"MultiPoint":(o=h.getCoordinates())[a.index]=t,g[0]=t,g[1]=t;break;case"LineString":(o=h.getCoordinates())[a.index+c]=t,g[c]=t;break;case"MultiLineString":case"Polygon":(o=h.getCoordinates())[d[0]][a.index+c]=t,g[c]=t;break;case"MultiPolygon":(o=h.getCoordinates())[d[1]][d[0]][a.index+c]=t,g[c]=t;break;case"Circle":if(g[0]=t,g[1]=t,0===a.index)this.changingFeature_=!0,h.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0;let n=e.map.getView().getProjection(),i=(0,u.distance)((0,m.fromUserCoordinate)(h.getCenter(),n),(0,m.fromUserCoordinate)(t,n)),r=(0,m.getUserProjection)();if(r){let e=h.clone().transform(r,n);e.setRadius(i),i=e.transform(n,r).getRadius()}h.setRadius(i),this.changingFeature_=!1}}o&&this.setGeometryCoordinates_(h,o)}this.createOrUpdateVertexFeature_(t,n,i,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;let t=e.coordinate,n=this.findInsertVerticesAndUpdateDragSegments_(t);if(n?.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,n),this.vertexFeature_)){let e=this.vertexFeature_.getGeometry().getCoordinates();for(let t=n.length-1;t>=0;--t)this.insertVertex_(n[t],e);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){let n=this.dragSegments_[t][0],i=n.geometry;if("Circle"===i.getType()){let t=i.getCenter(),r=n.featureSegments[0],o=n.featureSegments[1];r.segment[0]=t,r.segment[1]=t,o.segment[0]=t,o.segment[1]=t,this.rBush_.update((0,g.createOrUpdateFromCoordinate)(t),r);let s=i,a=(0,m.getUserProjection)();if(a){let t=e.map.getView().getProjection();s=s.clone().transform(a,t),s=(0,f.fromCircle)(s).transform(t,a)}this.rBush_.update(s.getExtent(),o)}else this.rBush_.update((0,g.boundingExtent)(n.segment),n)}return this.featuresBeingModified_&&(this.dispatchEvent(new T(F.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.coordinate)}handlePointerAtPixel_(e){let t,n;let i=this.getMap(),r=i.getPixelFromCoordinate(e),s=i.getView().getProjection();if(this.hitDetection_){let e="object"==typeof this.hitDetection_?e=>e===this.hitDetection_:void 0;i.forEachFeatureAtPixel(r,(e,i,r)=>{r&&"Point"===r.getType()&&(r=new c.default((0,m.toUserCoordinate)(r.getCoordinates(),s)));let a=r||e.getGeometry();if(a&&"Point"===a.getType()&&e instanceof o.default&&this.features_.getArray().includes(e)){n=a;let i=e.getGeometry().getFlatCoordinates().slice(0,2);t=[{feature:e,geometry:n,segment:[i,i]}]}return!0},{layerFilter:e})}if(!t){let n=(0,m.fromUserExtent)((0,g.createOrUpdateFromCoordinate)(e,P),s),r=i.getView().getResolution()*this.pixelTolerance_,o=(0,m.toUserExtent)((0,g.buffer)(n,r,P),s);t=this.rBush_.getInExtent(o)}if(t&&t.length>0){let o=t.sort(function(t,n){return D(e,t,s)-D(e,n,s)})[0],a=o.segment,l=I(e,o,s),h=i.getPixelFromCoordinate(l),d=(0,u.distance)(r,h);if(n||d<=this.pixelTolerance_){let n={};if(n[(0,C.getUid)(a)]=!0,!this.snapToPointer_&&(this.delta_[0]=l[0]-e[0],this.delta_[1]=l[1]-e[1]),"Circle"===o.geometry.getType()&&1===o.index)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(l,[o.feature],[o.geometry],this.snappedToVertex_);else{let e=i.getPixelFromCoordinate(a[0]),r=i.getPixelFromCoordinate(a[1]),s=(0,u.squaredDistance)(h,e),g=(0,u.squaredDistance)(h,r);if(d=Math.sqrt(Math.min(s,g)),this.snappedToVertex_=d<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(l=s>g?a[1]:a[0]),this.createOrUpdateVertexFeature_(l,[o.feature],[o.geometry],this.snappedToVertex_);let c={};c[(0,C.getUid)(o.geometry)]=!0;for(let e=1,i=t.length;e<i;++e){let i=t[e].segment;if((0,u.equals)(a[0],i[0])&&(0,u.equals)(a[1],i[1])||(0,u.equals)(a[0],i[1])&&(0,u.equals)(a[1],i[0])){let r=(0,C.getUid)(t[e].geometry);!(r in c)&&(c[r]=!0,n[(0,C.getUid)(i)]=!0)}else break}}this.vertexSegments_=n;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){let n;let i=e.segment,r=e.feature,o=e.geometry,s=e.depth,a=e.index;for(;t.length<o.getStride();)t.push(0);switch(o.getType()){case"MultiLineString":case"Polygon":(n=o.getCoordinates())[s[0]].splice(a+1,0,t);break;case"MultiPolygon":(n=o.getCoordinates())[s[1]][s[0]].splice(a+1,0,t);break;case"LineString":(n=o.getCoordinates()).splice(a+1,0,t);break;default:return!1}this.setGeometryCoordinates_(o,n);let u=this.rBush_;u.remove(e),this.updateSegmentIndices_(o,a,s,1);let l={segment:[i[0],t],feature:r,geometry:o,depth:s,index:a};u.insert((0,g.boundingExtent)(l.segment),l),this.dragSegments_.push([l,1]);let h={segment:[t,i[1]],feature:r,geometry:o,depth:s,index:a+1};return u.insert((0,g.boundingExtent)(h.segment),h),this.dragSegments_.push([h,0]),!0}updatePointer_(e){return e&&this.findInsertVerticesAndUpdateDragSegments_(e),this.vertexFeature_?.getGeometry().getCoordinates()}getPoint(){let e=this.vertexFeature_?.getGeometry().getCoordinates();return e?(0,m.toUserCoordinate)(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(e=>"Circle"===e.getType()||e.getType().endsWith("Point")))return!1;let e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent((0,g.boundingExtent)([e])).some(({segment:t})=>(0,u.equals)(t[0],e)||(0,u.equals)(t[1],e))}removePoint(e){if(e&&(e=(0,m.fromUserCoordinate)(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=s.Z.POINTERDRAG){let e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_.map(([e])=>e));let t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new T(F.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null,t}return!1}removeVertex_(){let e,t,n,i,r,o,s,a,u,l,h;let d=this.dragSegments_,c={},f=!1;for(r=d.length-1;r>=0;--r)l=(n=d[r])[0],h=(0,C.getUid)(l.feature),l.depth&&(h+="-"+l.depth.join("-")),!(h in c)&&(c[h]={}),0===n[1]?(c[h].right=l,c[h].index=l.index):1==n[1]&&(c[h].left=l,c[h].index=l.index+1);for(h in c){switch(u=c[h].right,s=c[h].left,a=(o=c[h].index)-1,a<0&&(a=0),e=t=(i=(l=void 0!==s?s:u).geometry).getCoordinates(),f=!1,i.getType()){case"MultiLineString":t[l.depth[0]].length>2&&(t[l.depth[0]].splice(o,1),f=!0);break;case"LineString":t.length>2&&(t.splice(o,1),f=!0);break;case"MultiPolygon":e=e[l.depth[1]];case"Polygon":(e=e[l.depth[0]]).length>4&&(o==e.length-1&&(o=0),e.splice(o,1),f=!0,0===o&&(e.pop(),e.push(e[0]),a=e.length-1))}if(f){this.setGeometryCoordinates_(i,t);let e=[];if(void 0!==s&&(this.rBush_.remove(s),e.push(s.segment[0])),void 0!==u&&(this.rBush_.remove(u),e.push(u.segment[1])),void 0!==s&&void 0!==u){let t={depth:l.depth,feature:l.feature,geometry:l.geometry,index:a,segment:e};this.rBush_.insert((0,g.boundingExtent)(t.segment),t)}this.updateSegmentIndices_(i,o,l.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),d.length=0}}return f}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(e=>"Circle"===e.getType()||e.getType().endsWith("Point")))return!1;let e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent((0,g.boundingExtent)([e])).some(({segment:t})=>!((0,u.equals)(t[0],e)||(0,u.equals)(t[1],e)))}insertPoint(e){let t=e?(0,m.fromUserCoordinate)(e,this.getMap().getView().getProjection()):this.vertexFeature_?.getGeometry().getCoordinates();return!!t&&this.findInsertVerticesAndUpdateDragSegments_(t).reduce((e,n)=>e||this.insertVertex_(n,t),!1)}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,n,i){this.rBush_.forEachInExtent(e.getExtent(),function(r){r.geometry===e&&(void 0===n||void 0===r.depth||(0,a.fS)(r.depth,n))&&r.index>t&&(r.index+=i)})}}function M(e,t){return e.index-t.index}function D(e,t,n){let i=t.geometry;if("Circle"===i.getType()){let r=i;if(1===t.index){let t=(0,m.getUserProjection)();t&&(r=r.clone().transform(t,n));let i=Math.sqrt((0,u.squaredDistance)(r.getCenter(),(0,m.fromUserCoordinate)(e,n)))-r.getRadius();return i*i}}let r=(0,m.fromUserCoordinate)(e,n);return S[0]=(0,m.fromUserCoordinate)(t.segment[0],n),S[1]=(0,m.fromUserCoordinate)(t.segment[1],n),(0,u.squaredDistanceToSegment)(r,S)}function I(e,t,n){let i=t.geometry;if("Circle"===i.getType()&&1===t.index){let t=i,r=(0,m.getUserProjection)();return r&&(t=t.clone().transform(r,n)),(0,m.toUserCoordinate)(t.getClosestPoint((0,m.fromUserCoordinate)(e,n)),n)}let r=(0,m.fromUserCoordinate)(e,n);return S[0]=(0,m.fromUserCoordinate)(t.segment[0],n),S[1]=(0,m.fromUserCoordinate)(t.segment[1],n),(0,m.toUserCoordinate)((0,u.closestOnSegment)(r,S),n)}t.default=w},38024:function(e,t,n){n.r(t),n.d(t,{centroid:function(){return s}});var i=n(30006),r=n(47588);class o extends r.ZP{constructor(e){super(e=e||{}),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==i.Z.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==i.Z.POINTERUP){let t=this.handleUpEvent(e);this.handlingDownUpSequence=t&&this.targetPointers.length>0}}else if(e.type==i.Z.POINTERDOWN){let n=this.handleDownEvent(e);this.handlingDownUpSequence=n,t=this.stopDown(n)}else e.type==i.Z.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function s(e){let t=e.length,n=0,i=0;for(let r=0;r<t;r++)n+=e[r].clientX,i+=e[r].clientY;return{clientX:n/t,clientY:i/t}}t.default=o},73604:function(e,t){t.Z={ACTIVE:"active"}},13580:function(e,t,n){function i(e){for(let t in e)delete e[t]}function r(e){let t;for(t in e)return!1;return!t}n.d(t,{Z:function(){return i},x:function(){return r}})},49179:function(e,t,n){function i(){throw Error("Unimplemented abstract method.")}n.r(t),n.d(t,{VERSION:function(){return s},abstract:function(){return i},getUid:function(){return o}});let r=0;function o(e){return e.ol_uid||(e.ol_uid=String(++r))}let s="10.4.0"}}]);
//# sourceMappingURL=8985.0498fd15689af38f.js.map