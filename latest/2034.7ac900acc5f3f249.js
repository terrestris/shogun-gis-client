"use strict";(self.webpackChunk_terrestris_shogun_gis_client=self.webpackChunk_terrestris_shogun_gis_client||[]).push([["2034"],{19473:function(e,t,r){r.d(t,{T:function(){return n}});class i{constructor(e,t,r,i){this.minX=e,this.maxX=t,this.minY=r,this.maxY=i}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function n(e,t,r,n,o){return void 0!==o?(o.minX=e,o.maxX=t,o.minY=r,o.maxY=n,o):new i(e,t,r,n)}t.Z=i},4027:function(e,t,r){r.d(t,{W:function(){return i}});function i(e,t,r,i){let n=e[t],o=e[t+1],l=0;for(let s=t+i;s<r;s+=i){let t=e[s],r=e[s+1];l+=Math.sqrt((t-n)*(t-n)+(r-o)*(r-o)),n=t,o=r}return l}},71418:function(e,t,r){r.r(t),r.d(t,{default:function(){return E}});var i=r("93564"),n=r("82928"),o=r("82777"),l=r("74273"),s=r("59900"),a=r("6908"),d=r("33162"),h=r("17356"),u=r("82359"),g=r("79682"),c=r("21915"),m=r("43631"),f=r("49179"),T=r("50596"),p=r("90728");let x={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},R={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class y extends l.Z{constructor(e,t){super(e,t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=(0,u.Ue)(),this.tileClipContexts_=null}drawTile(e,t,r,i,n,o,l,s){this.updateExecutorGroup_(e,t.pixelRatio,t.viewState.projection),this.tileImageNeedsRender_(e)&&this.renderTileImage_(e,t),super.drawTile(e,t,r,i,n,o,l,s)}getTile(e,t,r,i){let n=this.getOrCreateTile(e,t,r,i);if(!n)return null;let o=i.viewState.resolution,l=i.viewHints;return(!(l[a.Z.ANIMATING]||l[a.Z.INTERACTING])||!n.wantedResolution)&&(n.wantedResolution=o),n}prepareFrame(e){let t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,r){let i=this.getLayer(),l=i.getRevision(),a=i.getRenderOrder()||null,d=e.wantedResolution,h=e.getReplayState(i);if(!h.dirty&&h.renderedResolution===d&&h.renderedRevision==l&&h.renderedRenderOrder==a)return;let u=i.getSource(),g=!!i.getDeclutter(),T=u.getTileGrid(),p=u.getTileGridForProjection(r).getTileCoordExtent(e.wrappedTileCoord),x=u.getSourceTiles(t,r,e),R=(0,f.getUid)(i);delete e.hitDetectionImageData[R],e.executorGroups[R]=[],h.dirty=!1;for(let r=0,l=x.length;r<l;++r){let l=x[r];if(l.getState()!=s.default.LOADED)continue;let f=l.tileCoord,y=T.getTileCoordExtent(f),C=(0,c.getIntersection)(p,y),v=(0,c.buffer)(C,i.getRenderBuffer()*d,this.tempExtent),S=(0,c.equals)(y,C)?null:v,E=new n.Z(0,C,d,t),I=(0,m.se)(d,t),_=function(e,t){let r;let n=e.getStyleFunction()||i.getStyleFunction();if(n&&(r=n(e,d)),r){let i=this.renderFeature(e,I,r,E,g,t);h.dirty=h.dirty||i}},w=l.getFeatures();a&&a!==h.renderedRenderOrder&&w.sort(a);for(let e=0,t=w.length;e<t;++e){let t=w[e];(!S||(0,c.intersects)(S,t.getGeometry().getExtent()))&&_.call(this,t,e)}let b=E.finish(),X="vector"!==i.getRenderMode()&&g&&1===x.length?null:C,A=new o.ZP(X,d,t,u.getOverlaps(),b,i.getRenderBuffer(),!0);e.executorGroups[R].push(A)}h.renderedRevision=l,h.renderedRenderOrder=a,h.renderedResolution=d}forEachFeatureAtCoordinate(e,t,r,i,n){let o;let l=t.viewState.resolution,s=t.viewState.rotation;r=void 0==r?0:r;let a=this.getLayer(),d=a.getSource().getTileGridForProjection(t.viewState.projection),h=(0,c.boundingExtent)([e]);(0,c.buffer)(h,l*r,h);let u={},g=function(e,t,r){let o=e.getId();void 0===o&&(o=(0,f.getUid)(e));let l=u[o];if(l){if(!0!==l&&r<l.distanceSq){if(0===r)return u[o]=!0,n.splice(n.lastIndexOf(l),1),i(e,a,t);l.geometry=t,l.distanceSq=r}}else{if(0===r)return u[o]=!0,i(e,a,t);n.push(u[o]={feature:e,layer:a,geometry:t,distanceSq:r,callback:i})}},m=this.renderedTiles,T=(0,f.getUid)(a),p=a.getDeclutter(),x=p?t.declutter[p].all().map(e=>e.value):null;e:for(let t=0,i=m.length;t<i;++t){let i=m[t],n=d.getTileCoordExtent(i.wrappedTileCoord);if(!(0,c.intersects)(n,h))continue;let a=i.executorGroups[T];for(let t=0,i=a.length;t<i;++t)if(o=a[t].forEachFeatureAtCoordinate(e,l,s,r,g,x))break e}return o}getFeatures(e){return 0===this.renderedTiles.length?Promise.resolve([]):new Promise((t,r)=>{let i=this.getLayer(),n=i.getSource(),o=this.renderedProjection,l=o.getExtent(),a=this.renderedResolution,d=n.getTileGridForProjection(o),g=(0,u.nn)(this.renderedPixelToCoordinateTransform_,e.slice()),m=d.getTileCoordForCoordAndResolution(g,a).toString(),x=this.renderedTiles.find(e=>e.tileCoord.toString()===m&&e.getState()===s.default.LOADED);if(!x||x.loadingSourceTiles>0){t([]);return}n.getWrapX()&&o.canWrapX()&&!(0,c.containsExtent)(l,d.getTileCoordExtent(x.tileCoord))&&(0,p.wrapX)(g,o);let R=(0,f.getUid)(i),y=d.getTileCoordExtent(x.wrappedTileCoord),C=(0,c.getTopLeft)(y),v=[(g[0]-C[0])/a,(C[1]-g[1])/a],S=x.getSourceTiles().reduce((e,t)=>e.concat(t.getFeatures()),[]),E=x.hitDetectionImageData[R];if(!E){let e=(0,T.Pq)(d.getTileSize(d.getZForResolution(a,n.zDirection))),t=this.renderedRotation_,r=[this.getRenderTransform(d.getTileCoordCenter(x.wrappedTileCoord),a,0,h.UN,e[0]*h.UN,e[1]*h.UN,0)];E=(0,h.TU)(e,r,S,i.getStyleFunction(),d.getTileCoordExtent(x.wrappedTileCoord),x.getReplayState(i).renderedResolution,t),x.hitDetectionImageData[R]=E}t((0,h.ix)(v,S,E))})}getFeaturesInExtent(e){let t=[],r=this.getTileCache();if(0===r.getCount())return t;let i=this.getLayer().getSource().getTileGridForProjection(this.frameState.viewState.projection),n=i.getZForResolution(this.renderedResolution),o={};return r.forEach(r=>{if(r.tileCoord[0]!==n||r.getState()!==s.default.LOADED)return;let l=r.getSourceTiles();for(let r=0,n=l.length;r<n;++r){let n=l[r],s=n.getKey();if(s in o)continue;o[s]=!0;let a=n.tileCoord;if((0,c.intersects)(e,i.getTileCoordExtent(a))){let r=n.getFeatures();if(r)for(let i=0,n=r.length;i<n;++i){let n=r[i],o=n.getGeometry();(0,c.intersects)(e,o.getExtent())&&t.push(n)}}}}),t}handleFontsChanged(){let e=this.getLayer();e.getVisible()&&void 0!==this.renderedLayerRevision_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e,t){let r=this.context,i=r.globalAlpha;r.globalAlpha=t.opacity;let n=e.viewHints,l=!(n[a.Z.ANIMATING]||n[a.Z.INTERACTING]),s=[this.context.canvas.width,this.context.canvas.height],d=this.getLayer().getDeclutter(),h=d?e.declutter[d]:void 0,u=(0,f.getUid)(this.getLayer()),g=this.renderedTiles;for(let t=0,r=g.length;t<r;++t){let r=g[t],i=r.executorGroups[u];if(i)for(let t=i.length-1;t>=0;--t)i[t].execute(this.context,s,this.getTileRenderTransform(r,e),e.viewState.rotation,l,o.o5,h)}r.globalAlpha=i}renderDeferredInternal(e){let t=this.renderedTiles,r=(0,f.getUid)(this.getLayer()),i=t.reduce((e,t,i)=>(t.executorGroups[r].forEach(t=>e.push({executorGroup:t,index:i})),e),[]),n=i.map(({executorGroup:e})=>e.getDeferredZIndexContexts()),o={};for(let e=0,t=i.length;e<t;++e){let t=i[e].executorGroup.getDeferredZIndexContexts();for(let e in t)o[e]=!0}Object.keys(o).map(Number).sort(g.j2).forEach(e=>{n.forEach((t,r)=>{if(!!t[e])t[e].forEach(e=>{let{executorGroup:t,index:n}=i[r],o=t.getRenderedContext(),l=o.globalAlpha;o.globalAlpha=this.renderedOpacity_;let s=this.tileClipContexts_[n];s&&s.draw(o),e.draw(o),s&&o.restore(),o.globalAlpha=l,e.clear()}),t[e].length=0})})}getTileRenderTransform(e,t){let r=t.pixelRatio,i=t.viewState,n=i.center,o=i.resolution,l=i.rotation,s=t.size,a=Math.round(s[0]*r),d=Math.round(s[1]*r),h=this.getLayer().getSource().getTileGridForProjection(t.viewState.projection),g=e.tileCoord,c=h.getTileCoordExtent(e.wrappedTileCoord),m=h.getTileCoordExtent(g,this.tempExtent)[0]-c[0];return(0,u.Jp)((0,u.bA)(this.inversePixelTransform.slice(),1/r,1/r),this.getRenderTransform(n,o,l,r,a,d,m))}postRender(e,t){let r=t.viewHints,i=!(r[a.Z.ANIMATING]||r[a.Z.INTERACTING]);this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation,this.renderedOpacity_=t.layerStatesArray[t.layerIndex].opacity;let n=this.getLayer(),l=n.getRenderMode(),s=e.globalAlpha;e.globalAlpha=this.renderedOpacity_;let h=n.getDeclutter(),u=h?R[l].filter(e=>!o.o5.includes(e)):R[l],g=t.viewState,m=g.rotation,T=n.getSource(),p=T.getTileGridForProjection(g.projection).getZForResolution(g.resolution,T.zDirection),x=this.renderedTiles,y=[],C=[],v=[],S=(0,f.getUid)(n),E=!0;for(let r=x.length-1;r>=0;--r){let o;let l=x[r];E=E&&!l.getReplayState(n).dirty;let s=l.executorGroups[S].filter(e=>e.hasExecutors(u));if(0===s.length)continue;let a=this.getTileRenderTransform(l,t),g=l.tileCoord[0],f=!1,T=s[0].getClipCoords(a),R=e;if(T){R=(o=new d.Z).getContext();for(let e=0,t=y.length;e<t;++e)if(p!==g&&g<C[e]){let t=y[e];(0,c.intersects)([T[0],T[3],T[4],T[7]],[t[0],t[3],t[4],t[7]])&&(!f&&(R.save(),f=!0),R.beginPath(),R.moveTo(T[0],T[1]),R.lineTo(T[2],T[3]),R.lineTo(T[4],T[5]),R.lineTo(T[6],T[7]),R.moveTo(t[6],t[7]),R.lineTo(t[4],t[5]),R.lineTo(t[2],t[3]),R.lineTo(t[0],t[1]),R.clip())}y.push(T),C.push(g)}for(let r=0,n=s.length;r<n;++r)s[r].execute(e,[e.canvas.width,e.canvas.height],a,m,i,u,t.declutter?.[h]);f&&(R===e?R.restore():v[r]=o)}e.globalAlpha=s,this.ready=E,this.tileClipContexts_=v,!t.declutter&&this.renderDeferredInternal(t),super.postRender(e,t)}renderFeature(e,t,r,i,n,o){if(!r)return!1;let l=!1;if(Array.isArray(r))for(let s=0,a=r.length;s<a;++s)l=(0,m.Pn)(i,e,r[s],t,this.boundHandleStyleImageChange_,void 0,n,o)||l;else l=(0,m.Pn)(i,e,r,t,this.boundHandleStyleImageChange_,void 0,n,o);return l}tileImageNeedsRender_(e){let t=this.getLayer();if("vector"===t.getRenderMode())return!1;let r=e.getReplayState(t),i=t.getRevision(),n=e.wantedResolution;return r.renderedTileResolution!==n||r.renderedTileRevision!==i}renderTileImage_(e,t){let r=this.getLayer(),i=e.getReplayState(r),n=r.getRevision(),o=e.executorGroups[(0,f.getUid)(r)];i.renderedTileRevision=n;let l=e.wrappedTileCoord,s=l[0],a=r.getSource(),d=t.pixelRatio,h=t.viewState.projection,g=a.getTileGridForProjection(h),c=g.getResolution(e.tileCoord[0]),m=t.pixelRatio/e.wantedResolution*c,T=g.getResolution(s),p=e.getContext();d=Math.round(Math.max(d,m/d));let R=a.getTilePixelSize(s,d,h);p.canvas.width=R[0],p.canvas.height=R[1];let y=d/m;if(1!==y){let e=(0,u.mc)(this.tmpTransform_);(0,u.bA)(e,y,y),p.setTransform.apply(p,e)}let C=g.getTileCoordExtent(l,this.tempExtent),v=m/T,S=(0,u.mc)(this.tmpTransform_);(0,u.bA)(S,v,-v),(0,u.Iu)(S,-C[0],-C[3]);for(let e=0,t=o.length;e<t;++e)o[e].execute(p,[p.canvas.width*y,p.canvas.height*y],S,0,!0,x[r.getRenderMode()],null);i.renderedTileResolution=e.wantedResolution}}var C=r("71534"),v=r("38906");class S extends i.Z{constructor(e){let t=Object.assign({},e=e||{});delete t.preload;let r=void 0===e.cacheSize?0:e.cacheSize;delete e.cacheSize,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=r;let i=e.renderMode||"hybrid";(0,v.h)("hybrid"==i||"vector"==i,"`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=i,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(void 0===e.useInterimTilesOnError||e.useInterimTilesOnError),this.getBackground,this.setBackground}createRenderer(){return new y(this,{cacheSize:this.cacheSize_})}getFeatures(e){return super.getFeatures(e)}getFeaturesInExtent(e){return this.getRenderer().getFeaturesInExtent(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(C.Z.PRELOAD)}getUseInterimTilesOnError(){return this.get(C.Z.USE_INTERIM_TILES_ON_ERROR)}setPreload(e){this.set(C.Z.PRELOAD,e)}setUseInterimTilesOnError(e){this.set(C.Z.USE_INTERIM_TILES_ON_ERROR,e)}}var E=S},70701:function(e,t,r){function i(e,t,r,i){return void 0!==i?(i[0]=e,i[1]=t,i[2]=r,i):[e,t,r]}function n(e,t,r){return e+"/"+t+"/"+r}function o(e){return function(e,t,r){return(t<<e)+r}(e[0],e[1],e[2])}r.d(t,{T9:function(){return i},lg:function(){return n},tE:function(){return l},vp:function(){return o}});function l(e,t){let r=e[0],i=e[1],n=e[2];if(t.getMinZoom()>r||r>t.getMaxZoom())return!1;let o=t.getFullTileRange(r);return!o||o.containsXY(i,n)}}}]);
//# sourceMappingURL=2034.7ac900acc5f3f249.js.map