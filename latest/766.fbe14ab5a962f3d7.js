"use strict";(self.webpackChunk_terrestris_shogun_gis_client=self.webpackChunk_terrestris_shogun_gis_client||[]).push([["766"],{78907:function(e,t,i){var s=i(3783),r=i(31644),n=i(74255),l=i(84674),o=i(44954);class a extends r.A{constructor(e,t,i,s,r,n){super(e,t,n),this.crossOrigin_=s,this.src_=i,this.key=i,this.image_,o.WORKER_OFFSCREEN_CANVAS?this.image_=new OffscreenCanvas(1,1):(this.image_=new Image,null!==s&&(this.image_.crossOrigin=s)),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(e){this.image_=e,this.state=n.default.LOADED,this.unlistenImage_(),this.changed()}getCrossOrigin(){return this.crossOrigin_}handleImageError_(){let e;this.state=n.default.ERROR,this.unlistenImage_(),this.image_=((e=(0,l.Y)(1,1)).fillStyle="rgba(0,0,0,0)",e.fillRect(0,0,1,1),e.canvas),this.changed()}handleImageLoad_(){if(o.WORKER_OFFSCREEN_CANVAS)this.state=n.default.LOADED;else{let e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=n.default.LOADED:this.state=n.default.EMPTY}this.unlistenImage_(),this.changed()}load(){this.state==n.default.ERROR&&(this.state=n.default.IDLE,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==n.default.IDLE&&(this.state=n.default.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=(0,s.f6)(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}}t.A=a},9359:function(e,t){t.A={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"}},82971:function(e,t,i){i.d(t,{A:function(){return v}});var s=i(31644),r=i(74255);function n(e){return e instanceof Image||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageBitmap?e:null}let l=Error("disposed"),o=[256,256];class a extends s.A{constructor(e){super(e.tileCoord,r.default.IDLE,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null,this.controller_=e.controller||null}getSize(){if(this.size_)return this.size_;let e=n(this.data_);return e?[e.width,e.height]:o}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==r.default.IDLE&&this.state!==r.default.ERROR)return;this.state=r.default.LOADING,this.changed();let e=this;this.loader_().then(function(t){e.data_=t,e.state=r.default.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=r.default.ERROR,e.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(l),this.controller_=null),super.disposeInternal()}}var h=i(78907),u=i(90123),d=i(19487),c=i(85752),g=i(58318),_=i(7689),f=i(5245),p=i(74802),T=i(17229),m=class{constructor(e){this.highWaterMark=void 0!==e?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){let e=this.pop();e instanceof p.A&&e.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){let i=this.entries_[e];return(0,T.v)(void 0!==i,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(e){let t=this.entries_[e];return(0,T.v)(void 0!==t,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){let e,t=Array(this.count_),i=0;for(e=this.newest_;e;e=e.older)t[i++]=e.key_;return t}getValues(){let e,t=Array(this.count_),i=0;for(e=this.newest_;e;e=e.older)t[i++]=e.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){return this.entries_[e]?.value_}pop(){let e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){(0,T.v)(!(e in this.entries_),"Tried to set a value for a key that is used already");let i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}},E=i(93435),x=i(21878),R=i(94092),C=i(24763);function w(e,t,i){if(!(i in e))return e[i]=new Set([t]),!0;let s=e[i],r=s.has(t);return r||s.add(t),!r}function S(e,t){let i=e.layerStatesArray[e.layerIndex];i.extent&&(t=(0,c.getIntersection)(t,(0,g.fromUserExtent)(i.extent,e.viewState.projection)));let s=i.layer.getRenderSource();if(!s.getWrapX()){let i=s.getTileGridForProjection(e.viewState.projection).getExtent();i&&(t=(0,c.getIntersection)(t,i))}return t}class y extends C.A{constructor(e,t){super(e),t=t||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=(0,c.createEmpty)(),this.tempTileRange_=new u.A(0,0,0,0),this.tempTileCoord_=(0,E.N)(0,0,0);const i=void 0!==t.cacheSize?t.cacheSize:512;this.tileCache_=new m(i),this.sourceTileCache_=null,this.maxStaleKeys=.5*i}getTileCache(){return this.tileCache_}getSourceTileCache(){return this.sourceTileCache_||(this.sourceTileCache_=new m(512)),this.sourceTileCache_}getOrCreateTile(e,t,i,s){let r,n=this.tileCache_,l=this.getLayer().getSource(),o=(0,E.et)(l,l.getKey(),e,t,i);if(n.containsKey(o))r=n.get(o);else{let a=s.viewState.projection,h=l.getProjection();if(!(r=l.getTile(e,t,i,s.pixelRatio,a,!h||(0,g.equivalent)(h,a)?void 0:this.getSourceTileCache())))return null;n.set(o,r)}return r}getTile(e,t,i,s){let r=this.getOrCreateTile(e,t,i,s);return r||null}getData(e){let t=this.frameState;if(!t)return null;let i=this.getLayer(),s=(0,x.Bb)(t.pixelToCoordinateTransform,e.slice()),l=i.getExtent();if(l&&!(0,c.containsCoordinate)(l,s))return null;let o=t.viewState,u=i.getRenderSource(),d=u.getTileGridForProjection(o.projection),g=u.getTilePixelRatio(t.pixelRatio);for(let e=d.getZForResolution(o.resolution);e>=d.getMinZoom();--e){let i,l=d.getTileCoordForCoordAndZ(s,e),c=this.getTile(e,l[1],l[2],t);if(!c||c.getState()!==r.default.LOADED)continue;let p=d.getOrigin(e),T=(0,f.xq)(d.getTileSize(e)),m=d.getResolution(e);if(c instanceof h.A||c instanceof _.A)i=c.getImage();else if(!(c instanceof a))continue;else if(!(i=n(c.getData())))continue;let E=Math.floor(g*((s[0]-p[0])/m-l[1]*T[0])),x=Math.floor(g*((p[1]-s[1])/m-l[2]*T[1])),R=Math.round(g*u.getGutterForProjection(o.projection));return this.getImageData(i,E+R,x+R)}return null}prepareFrame(e){this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;let t=this.getLayer().getSource();if(!t)return!1;let i=t.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==i&&(this.renderedSourceRevision_=i,this.renderedSourceKey_===t.getKey()&&(this.tileCache_.clear(),this.sourceTileCache_?.clear())):this.renderedSourceRevision_=i,!0}enqueueTilesForNextExtent(){return!0}enqueueTiles(e,t,i,s,n){let l=e.viewState,o=this.getLayer(),a=o.getRenderSource(),h=a.getTileGridForProjection(l.projection),u=(0,R.getUid)(a);u in e.wantedTiles||(e.wantedTiles[u]={});let d=e.wantedTiles[u],g=o.getMapInternal(),_=Math.max(i-n,h.getMinZoom(),h.getZForResolution(Math.min(o.getMaxResolution(),g?g.getView().getResolutionForZoom(Math.max(o.getMinZoom(),0)):h.getResolution(0)),a.zDirection)),f=l.rotation,p=f?(0,c.getRotatedViewport)(l.center,l.resolution,f,e.size):void 0;for(let n=i;n>=_;--n){let i=h.getTileRangeForExtentAndZ(t,n,this.tempTileRange_),l=h.getResolution(n);for(let t=i.minX;t<=i.maxX;++t)for(let o=i.minY;o<=i.maxY;++o){if(f&&!h.tileCoordIntersectsViewport([n,t,o],p))continue;let i=this.getTile(n,t,o,e);if(!i||!w(s,i,n))continue;let a=i.getKey();if(d[a]=!0,i.getState()===r.default.IDLE&&!e.tileQueue.isKeyQueued(a)){let s=(0,E.N)(n,t,o,this.tempTileCoord_);e.tileQueue.enqueue([i,u,h.getTileCoordCenter(s),l])}}}}findStaleTile_(e,t){let i=this.tileCache_,s=e[0],n=e[1],l=e[2],o=this.getStaleKeys();for(let e=0;e<o.length;++e){let a=(0,E.et)(this.getLayer().getSource(),o[e],s,n,l);if(i.containsKey(a)){let e=i.peek(a);if(e.getState()===r.default.LOADED)return e.endTransition((0,R.getUid)(this)),w(t,e,s),!0}}return!1}findAltTiles_(e,t,i,s){let n=e.getTileRangeForTileCoordAndZ(t,i,this.tempTileRange_);if(!n)return!1;let l=!0,o=this.tileCache_,a=this.getLayer().getRenderSource(),h=a.getKey();for(let e=n.minX;e<=n.maxX;++e)for(let t=n.minY;t<=n.maxY;++t){let n=(0,E.et)(a,h,i,e,t),u=!1;if(o.containsKey(n)){let e=o.peek(n);e.getState()===r.default.LOADED&&(w(s,e,i),u=!0)}u||(l=!1)}return l}renderFrame(e,t){let i;this.renderComplete=!0;let s=e.layerStatesArray[e.layerIndex],n=e.viewState,l=n.projection,o=n.resolution,a=n.center,h=e.pixelRatio,u=this.getLayer(),_=u.getSource(),f=_.getTileGridForProjection(l),p=f.getZForResolution(o,_.zDirection),T=f.getResolution(p),m=_.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==m&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=m):this.renderedSourceKey_=m;let E=e.extent,C=_.getTilePixelRatio(h);this.prepareContainer(e,t);let w=this.context.canvas.width,y=this.context.canvas.height,v=s.extent&&(0,g.fromUserExtent)(s.extent,l);v&&(E=(0,c.getIntersection)(E,(0,g.fromUserExtent)(s.extent,l)));let I=T*w/2/C,A=T*y/2/C,L=[a[0]-I,a[1]-A,a[0]+I,a[1]+A],O={};this.renderedTiles.length=0;let D=u.getPreload();if(e.nextExtent&&this.enqueueTilesForNextExtent()){let t=f.getZForResolution(n.nextResolution,_.zDirection),i=S(e,e.nextExtent);this.enqueueTiles(e,i,t,O,D)}let M=S(e,E);if(this.enqueueTiles(e,M,p,O,0),D>0&&setTimeout(()=>{this.enqueueTiles(e,M,p-1,O,D-1)},0),!(p in O))return this.container;let K=(0,R.getUid)(this),F=e.time;for(let t of O[p]){let i=t.getState();if(i===r.default.EMPTY)continue;let s=t.tileCoord;if(i===r.default.LOADED&&1===t.getAlpha(K,F)){t.endTransition(K);continue}if(i!==r.default.ERROR&&(this.renderComplete=!1),this.findStaleTile_(s,O)){!function(e,t,i){let s=e[i];s&&s.delete(t)}(O,t,p),e.animate=!0;continue}if(this.findAltTiles_(f,s,p+1,O))continue;let n=f.getMinZoom();for(let e=p-1;e>=n&&!this.findAltTiles_(f,s,e,O);--e);}let P=T/o*h/C,k=this.getRenderContext(e);(0,x.Zz)(this.tempTransform,w/2,y/2,P,P,0,-w/2,-y/2),s.extent&&this.clipUnrotated(k,e,v),_.getInterpolate()||(k.imageSmoothingEnabled=!1),this.preRender(k,e);let j=Object.keys(O).map(Number);j.sort(d.V_);let G=[],Z=[];for(let t=j.length-1;t>=0;--t){let s=j[t],n=_.getTilePixelSize(s,h,l),o=f.getResolution(s)/T,a=n[0]*o*P,u=n[1]*o*P,d=f.getTileCoordForCoordAndZ((0,c.getTopLeft)(L),s),g=f.getTileCoordExtent(d),p=(0,x.Bb)(this.tempTransform,[C*(g[0]-L[0])/T,C*(L[3]-g[3])/T]),m=C*_.getGutterForProjection(l);for(let t of O[s]){if(t.getState()!==r.default.LOADED)continue;let n=t.tileCoord,l=d[1]-n[1],o=Math.round(p[0]-(l-1)*a),h=d[2]-n[2],g=Math.round(p[1]-(h-1)*u),f=Math.round(p[0]-l*a),T=Math.round(p[1]-h*u),E=o-f,x=g-T,R=1===j.length,C=!1;i=[f,T,f+E,T,f+E,T+x,f,T+x];for(let e=0,t=G.length;e<t;++e)if(!R&&s<Z[e]){let t=G[e];(0,c.intersects)([f,T,f+E,T+x],[t[0],t[3],t[4],t[7]])&&(C||(k.save(),C=!0),k.beginPath(),k.moveTo(i[0],i[1]),k.lineTo(i[2],i[3]),k.lineTo(i[4],i[5]),k.lineTo(i[6],i[7]),k.moveTo(t[6],t[7]),k.lineTo(t[4],t[5]),k.lineTo(t[2],t[3]),k.lineTo(t[0],t[1]),k.clip())}G.push(i),Z.push(s),this.drawTile(t,e,f,T,E,x,m,R),C&&k.restore(),this.renderedTiles.unshift(t),this.updateUsedTiles(e.usedTiles,_,t)}}if(this.renderedResolution=T,this.extentChanged=!this.renderedExtent_||!(0,c.equals)(this.renderedExtent_,L),this.renderedExtent_=L,this.renderedPixelRatio=h,this.postRender(this.context,e),s.extent&&k.restore(),k.imageSmoothingEnabled=!0,this.renderComplete){let t=(e,t)=>{let i=(0,R.getUid)(_),s=t.wantedTiles[i],r=s?Object.keys(s).length:0;this.updateCacheSize(r),this.tileCache_.expireCache(),this.sourceTileCache_?.expireCache()};e.postRenderFunctions.push(t)}return this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,2*e)}drawTile(e,t,i,s,r,l,o,h){let u;if(e instanceof a){if(!(u=n(e.getData())))throw Error("Rendering array data is not yet supported")}else u=this.getTileImage(e);if(!u)return;let d=this.getRenderContext(t),c=(0,R.getUid)(this),g=t.layerStatesArray[t.layerIndex],_=g.opacity*(h?e.getAlpha(c,t.time):1),f=_!==d.globalAlpha;f&&(d.save(),d.globalAlpha=_),d.drawImage(u,o,o,u.width-2*o,u.height-2*o,i,s,r,l),f&&d.restore(),_!==g.opacity?t.animate=!0:h&&e.endTransition(c)}getImage(){let e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,t,i){let s=(0,R.getUid)(t);s in e||(e[s]={}),e[s][i.getKey()]=!0}}var v=y},7689:function(e,t,i){var s=i(31644),r=i(74255),n=i(84674),l=i(55506),o=i(17353),a=i(85752),h=i(94966),u=i(22482),d=i(73445),c=i(20776);class g extends s.A{constructor(e,t,i,s,n,l,o,g,_,f,p,T){super(n,r.default.IDLE,T),this.renderEdges_=void 0!==p&&p,this.pixelRatio_=o,this.gutter_=g,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=s,this.wrappedTileCoord_=l||n,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=e.canWrapX()?e.getExtent():void 0;const m=s.getTileCoordExtent(this.wrappedTileCoord_),E=this.targetTileGrid_.getExtent();let x=this.sourceTileGrid_.getExtent();const R=E?(0,a.getIntersection)(m,E):m;if(0===(0,a.getArea)(R)){this.state=r.default.EMPTY;return}const C=e.getExtent();C&&(x=x?(0,a.getIntersection)(x,C):C);const w=s.getResolution(this.wrappedTileCoord_[0]),S=(0,u.aY)(e,i,R,w);if(!isFinite(S)||S<=0){this.state=r.default.EMPTY;return}const y=void 0!==f?f:c.l;if(this.triangulation_=new d.A(e,i,R,x,S*y,w),0===this.triangulation_.getTriangles().length){this.state=r.default.EMPTY;return}this.sourceZ_=t.getZForResolution(S);let v=this.triangulation_.calculateSourceExtent();if(x&&(e.canWrapX()?(v[1]=(0,h.qE)(v[1],x[1],x[3]),v[3]=(0,h.qE)(v[3],x[1],x[3])):v=(0,a.getIntersection)(v,x)),(0,a.getArea)(v)){let i=0,s=0;e.canWrapX()&&(i=(0,a.getWidth)(C),s=Math.floor((v[0]-C[0])/i)),(0,a.wrapAndSliceX)(v.slice(),e,!0).forEach(e=>{let r=t.getTileRangeForExtentAndZ(e,this.sourceZ_);for(let e=r.minX;e<=r.maxX;e++)for(let t=r.minY;t<=r.maxY;t++){let r=_(this.sourceZ_,e,t,o);if(r){let e=s*i;this.sourceTiles_.push({tile:r,offset:e})}}++s}),0===this.sourceTiles_.length&&(this.state=r.default.EMPTY)}else this.state=r.default.EMPTY}getImage(){return this.canvas_}reproject_(){let e=[];if(this.sourceTiles_.forEach(t=>{let i=t.tile;if(i&&i.getState()==r.default.LOADED){let s=this.sourceTileGrid_.getTileCoordExtent(i.tileCoord);s[0]+=t.offset,s[2]+=t.offset;let r=this.clipExtent_?.slice();r&&(r[0]+=t.offset,r[2]+=t.offset),e.push({extent:s,clipExtent:r,image:i.getImage()})}}),this.sourceTiles_.length=0,0===e.length)this.state=r.default.ERROR;else{let t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),s="number"==typeof i?i:i[0],n="number"==typeof i?i:i[1],l=this.targetTileGrid_.getResolution(t),o=this.sourceTileGrid_.getResolution(this.sourceZ_),a=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=(0,u.XX)(s,n,this.pixelRatio_,o,this.sourceTileGrid_.getExtent(),l,a,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=r.default.LOADED}this.changed()}load(){if(this.state==r.default.IDLE){this.state=r.default.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{let i=t.getState();if(i==r.default.IDLE||i==r.default.LOADING){e++;let i=(0,o.KT)(t,l.default.CHANGE,s=>{let n=t.getState();(n==r.default.LOADED||n==r.default.ERROR||n==r.default.EMPTY)&&((0,o.JH)(i),0==--e&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(i)}}),0===e?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e},t,i){e.getState()==r.default.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(o.JH),this.sourcesListenerKeys_=null}release(){this.canvas_&&((0,n.Yg)(this.canvas_.getContext("2d")),u.BV.push(this.canvas_),this.canvas_=null),super.release()}}t.A=g}}]);
//# sourceMappingURL=766.fbe14ab5a962f3d7.js.map