"use strict";(self.webpackChunk_terrestris_shogun_gis_client=self.webpackChunk_terrestris_shogun_gis_client||[]).push([["1509"],{2022:function(t,e,i){i.d(e,{Jx:function(){return g},Kp:function(){return o},Q9:function(){return _}});var a=i(66575),s=i(73381),n=i(11256),h=i(91358),r=i(13002),c=i(64011);class l extends a.Z{constructor(t,e,i,a){super(),this.extent=t,this.pixelRatio_=i,this.resolution=e,this.state="function"==typeof a?n.default.IDLE:a,this.image_=null,this.loader="function"==typeof a?a:null}changed(){this.dispatchEvent(s.default.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==n.default.IDLE&&this.loader){this.state=n.default.LOADING,this.changed();let t=this.getResolution(),e=Array.isArray(t)?t[0]:t;(0,c.toPromise)(()=>this.loader(this.getExtent(),e,this.getPixelRatio())).then(t=>{"image"in t&&(this.image_=t.image),"extent"in t&&(this.extent=t.extent),"resolution"in t&&(this.resolution=t.resolution),"pixelRatio"in t&&(this.pixelRatio_=t.pixelRatio),(t instanceof HTMLImageElement||t instanceof ImageBitmap||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement)&&(this.image_=t),this.state=n.default.LOADED}).catch(t=>{this.state=n.default.ERROR,console.error(t)}).finally(()=>this.changed())}}setImage(t){this.image_=t}setResolution(t){this.resolution=t}}function o(t,e,i){let a=!0,n=!1,c=!1,l=[(0,r.Vx)(t,s.default.LOAD,function(){c=!0,!n&&e()})];return t.src&&h.IMAGE_DECODE?(n=!0,t.decode().then(function(){a&&e()}).catch(function(t){a&&(c?e():i())})):l.push((0,r.Vx)(t,s.default.ERROR,i)),function(){a=!1,l.forEach(r.bN)}}function _(t,e){var i,a;return e&&(t.src=e),t.src&&h.IMAGE_DECODE?new Promise((e,i)=>t.decode().then(()=>e(t)).catch(a=>t.complete&&t.width?e(t):i(a))):(i=t,new Promise((t,e)=>{function a(){n(),t(i)}function s(){n(),e(Error("Image load error"))}function n(){i.removeEventListener("load",a),i.removeEventListener("error",s)}i.addEventListener("load",a),i.addEventListener("error",s)}))}function g(t,e){return e&&(t.src=e),t.src&&h.IMAGE_DECODE&&h.CREATE_IMAGE_BITMAP?t.decode().then(()=>createImageBitmap(t)).catch(e=>{if(t.complete&&t.width)return t;throw e}):_(t)}e.ZP=l},97889:function(t,e,i){i.d(e,{U:function(){return g}});var a=i(66575),s=i(73381),n=i(11256),h=i(11820),r=i(85386),c=i(2022),l=i(16250);let o=null;class _ extends a.Z{constructor(t,e,i,a,s){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=i,this.canvas_={},this.color_=s,this.imageState_=void 0===a?n.default.IDLE:a,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(void 0===this.tainted_&&this.imageState_===n.default.LOADED){!o&&(o=(0,r.E4)(1,1,void 0,{willReadFrequently:!0})),o.drawImage(this.image_,0,0);try{o.getImageData(0,0,1,1),this.tainted_=!1}catch(t){o=null,this.tainted_=!0}}return!0===this.tainted_}dispatchChangeEvent_(){this.dispatchEvent(s.default.CHANGE)}handleImageError_(){this.imageState_=n.default.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=n.default.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return!this.image_&&this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(!this.image_&&this.initializeImage_(),!this.hitDetectionImage_){if(this.isTainted_()){let t=this.size_[0],e=this.size_[1],i=(0,r.E4)(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_}return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===n.default.IDLE){!this.image_&&this.initializeImage_(),this.imageState_=n.default.LOADING;try{void 0!==this.src_&&(this.image_.src=this.src_)}catch(t){this.handleImageError_()}this.image_ instanceof HTMLImageElement&&(0,c.Q9)(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==n.default.LOADED)return;let e=this.image_,i=(0,r.E4)(Math.ceil(e.width*t),Math.ceil(e.height*t)),a=i.canvas;i.scale(t,t),i.drawImage(e,0,0),i.globalCompositeOperation="multiply",i.fillStyle=(0,h.XC)(this.color_),i.fillRect(0,0,a.width/t,a.height/t),i.globalCompositeOperation="destination-in",i.drawImage(e,0,0),this.canvas_[t]=a}ready(){return!this.ready_&&(this.ready_=new Promise(t=>{if(this.imageState_===n.default.LOADED||this.imageState_===n.default.ERROR)t();else{let e=()=>{(this.imageState_===n.default.LOADED||this.imageState_===n.default.ERROR)&&(this.removeEventListener(s.default.CHANGE,e),t())};this.addEventListener(s.default.CHANGE,e)}})),this.ready_}}function g(t,e,i,a,s,n){let h=void 0===e?void 0:l.c1.get(e,i,s);return!h&&(h=new _(t,t&&"src"in t?t.src||void 0:e,i,a,s),l.c1.set(e,i,s,h,n)),n&&h&&!l.c1.getPattern(e,i,s)&&l.c1.set(e,i,s,h,n),h}e.Z=_},16250:function(t,e,i){i.d(e,{c1:function(){return r}});var a=i(11256),s=i(11820),n=i(85386);function h(t,e,i){return e+":"+t+":"+(i?(0,s._2)(i):"null")}let r=new class t{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(let e in this.cache_){let i=this.cache_[e];(3&t++)==0&&!i.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,i){let a=h(t,e,i);return a in this.cache_?this.cache_[a]:null}getPattern(t,e,i){let a=h(t,e,i);return a in this.patternCache_?this.patternCache_[a]:null}set(t,e,i,s,r){let c=h(t,e,i),l=c in this.cache_;this.cache_[c]=s,r&&(s.getImageState()===a.default.IDLE&&s.load(),s.getImageState()===a.default.LOADING?s.ready().then(()=>{this.patternCache_[c]=(0,n.W8)().createPattern(s.getImage(1),"repeat")}):this.patternCache_[c]=(0,n.W8)().createPattern(s.getImage(1),"repeat")),!l&&++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}}}]);
//# sourceMappingURL=1509.c7176d8819e9cac4.js.map