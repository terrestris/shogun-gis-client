"use strict";(self.webpackChunk_terrestris_shogun_gis_client=self.webpackChunk_terrestris_shogun_gis_client||[]).push([["7470"],{76464:function(t,e,r){var n=r(14293),o=r.n(n),i=r(69880),s=r.n(i),a=r(91949);class l{static getLength(t,e,r=!0,n=6371008.8,o=6){let i=Math.pow(10,o);if(!r)return Math.round(t.getLength()*i)/i;{let r={projection:e.getView().getProjection().getCode(),radius:n};return(0,a.getLength)(t,r)}}static formatLength(t,e,r,n=!0){let o;let i=Math.pow(10,r),s=l.getLength(t,e,n);return o=s>1e3?Math.round(s/1e3*i)/i+" km":s>1?Math.round(s*i)/i+" m":Math.round(1e3*s*i)/i+" mm"}static getArea(t,e,r=!0,n=6371008.8){if(!r)return t.getArea();{let r={projection:e.getView().getProjection().getCode(),radius:n};return(0,a.getArea)(t,r)}}static getAreaOfCircle(t,e){if(o()(e.getView().getProjection()))return NaN;if(!["radians","degrees"].includes(e.getView().getProjection().getUnits()))return Math.PI*Math.pow(t.getRadius(),2);{let e=t.getRadius(),r=2*Math.PI*40589753129677.44;return r*=1-Math.cos(e/6371008.8)}}static formatArea(t,e,r,n=!0){let o,i;let a=Math.pow(10,r);return i=(o=t instanceof s()?l.getAreaOfCircle(t,e):l.getArea(t,e,n))>1e4?Math.round(o/1e6*a)/a+" km<sup>2</sup>":o>.01?Math.round(o*a)/a+" m<sup>2</sup>":Math.round(1e6*o*a)/a+" mm<sup>2</sup>"}static angle(t,e){let r=t[0]-e[0],n=void 0,o=Math.atan2(t[1]-e[1],r);return o*=180/Math.PI}static angle360(t,e){let r=l.angle(t,e);return r<0&&(r=360+r),r}static makeClockwise(t){return 360-t}static makeZeroDegreesAtNorth(t){let e=t+90;return e>360&&(e-=360),e}static formatAngle(t,e=2){let r=t.getCoordinates(),n=r.length;if(n<2)return"";let o=r[n-1],i=r[n-2],s=l.angle360(i,o);return s=l.makeZeroDegreesAtNorth(s),s=l.makeClockwise(s),`${s.toFixed(e)}\xb0`}}e.Z=l},40503:function(t,e,r){r.r(e),r.d(e,{CoordinateInfo:function(){return E},default:function(){return I}});var n=r("9948"),o=r.n(n),i=r("96486"),s=r("14293"),a=r.n(s),l=r("48472"),u=r.n(l),p=r("96792"),c=r.n(p),g=r("94945"),h=r("12038");r("23560"),r("86977"),r("51425"),r("49413"),r("5762"),r("80982"),r("93349"),r("44126");var f,d="deflate-raw",y=self.DecompressionStream;try{new y(d),async t=>{let e=new y(d),r=e.writable.getWriter(),n=e.readable.getReader();r.write(t),r.close();let o,i=[],s=0,a=0,l;for(;!(l=await n.read()).done;)o=l.value,i.push(o),s+=o.length;return i.length-1?(o=new Uint8Array(s),i.map(t=>{o.set(t,a),a+=t.length}),o):i[0]}}catch{}new TextDecoder;b.prototype.parsePoint=function(t){return{type:"Point",coordinates:this.parseCoord(t,0)}},b.prototype.parseZPoint=function(t){let e=this.parsePoint(t);return e.coordinates.push(t.getFloat64(16,!0)),e},b.prototype.parsePointArray=function(t,e,r){let n=[],o=0;for(;o<r;)n.push(this.parseCoord(t,e)),e+=16,o++;return n},b.prototype.parseZPointArray=function(t,e,r,n){let o=0;for(;o<r;)n[o].push(t.getFloat64(e,!0)),o++,e+=8;return n},b.prototype.parseArrayGroup=function(t,e,r,n,o){let i,s;let a=[],l=0,u=0;for(;l<n;){if(l++,r+=4,i=u,!!(s=(u=l===n?o:t.getInt32(r,!0))-i))a.push(this.parsePointArray(t,e,s)),e+=s<<4}return a},b.prototype.parseZArrayGroup=function(t,e,r,n){let o=0;for(;o<r;)n[o]=this.parseZPointArray(t,e,n[o].length,n[o]),e+=n[o].length<<3,o++;return n},b.prototype.parseMultiPoint=function(t){let e={},r=t.getInt32(32,!0);if(!r)return null;let n=this.parseCoord(t,0),o=this.parseCoord(t,16);return e.bbox=[n[0],n[1],o[0],o[1]],1===r?(e.type="Point",e.coordinates=this.parseCoord(t,36)):(e.type="MultiPoint",e.coordinates=this.parsePointArray(t,36,r)),e},b.prototype.parseZMultiPoint=function(t){let e;let r=this.parseMultiPoint(t);if(!r)return null;if("Point"===r.type)return r.coordinates.push(t.getFloat64(72,!0)),r;e=r.coordinates.length;let n=52+(e<<4);return r.coordinates=this.parseZPointArray(t,n,e,r.coordinates),r},b.prototype.parsePolyline=function(t){let e;let r={},n=t.getInt32(32,!0);if(!n)return null;let o=this.parseCoord(t,0),i=this.parseCoord(t,16);r.bbox=[o[0],o[1],i[0],i[1]];let s=t.getInt32(36,!0);if(1===n)r.type="LineString",e=44,r.coordinates=this.parsePointArray(t,e,s);else{r.type="MultiLineString",e=40+(n<<2);r.coordinates=this.parseArrayGroup(t,e,40,n,s)}return r},b.prototype.parseZPolyline=function(t){let e;let r=this.parsePolyline(t);if(!r)return null;let n=r.coordinates.length;return"LineString"===r.type?(e=60+(n<<4),r.coordinates=this.parseZPointArray(t,e,n,r.coordinates),r):(e=56+(r.coordinates.reduce(function(t,e){return t+e.length},0)<<4)+(n<<2),r.coordinates=this.parseZArrayGroup(t,e,n,r.coordinates),r)},b.prototype.polyFuncs=function(t){return t?"LineString"===t.type?(t.type="Polygon",t.coordinates=[t.coordinates],t):(t.coordinates=function(t){let e=[],r=[];for(let n of t){let t=function(t){let e,r,n=0,o=1,i=t.length,s=[t[0][0],t[0][1],t[0][0],t[0][1]];for(;o<i;)e=r||t[0],n+=((r=t[o])[0]-e[0])*(r[1]+e[1]),o++,r[0]<s[0]&&(s[0]=r[0]),r[1]<s[1]&&(s[1]=r[1]),r[0]>s[2]&&(s[2]=r[0]),r[1]>s[3]&&(s[3]=r[1]);return{ring:t,clockWise:n>0,bbox:s,children:[]}}(n);t.clockWise?e.push(t):r.push(t)}for(let t of r)for(let r of e){var n,o;if(n=r,o=t,!(n.bbox[0]>o.bbox[0])&&!(n.bbox[1]>o.bbox[1])&&!(n.bbox[2]<o.bbox[2])&&!(n.bbox[3]<o.bbox[3])){r.children.push(t.ring);break}}let i=[];for(let t of e)i.push([t.ring].concat(t.children));return i}(t.coordinates),1===t.coordinates.length)?(t.type="Polygon",t.coordinates=t.coordinates[0],t):(t.type="MultiPolygon",t):t},b.prototype.parsePolygon=function(t){return this.polyFuncs(this.parsePolyline(t))},b.prototype.parseZPolygon=function(t){return this.polyFuncs(this.parseZPolyline(t))};let P={1:"parsePoint",3:"parsePolyline",5:"parsePolygon",8:"parseMultiPoint",11:"parseZPoint",13:"parseZPolyline",15:"parseZPolygon",18:"parseZMultiPoint"};function b(t,e){if(!(this instanceof b))return new b(t,e);this.buffer=t,this.headers=this.parseHeader(),this.shpFuncs(e),this.rows=this.getRows()}b.prototype.shpFuncs=function(t){var e;let r=this.headers.shpCode;if(r>20&&(r-=20),!(r in P))throw Error(`I don't know shp type "${r}"`);this.parseFunc=this[P[r]],this.parseCoord=(e=t)?function(t,r){let n=[t.getFloat64(r,!0),t.getFloat64(r+8,!0)];return e.inverse(n)}:function(t,e){return[t.getFloat64(e,!0),t.getFloat64(e+8,!0)]}},b.prototype.getShpCode=function(){return this.parseHeader().shpCode},b.prototype.parseHeader=function(){let t=this.buffer;return{length:t.getInt32(24)<<1,version:t.getInt32(28,!0),shpCode:t.getInt32(32,!0),bbox:[t.getFloat64(36,!0),t.getFloat64(44,!0),t.getFloat64(52,!0),t.getFloat64(60,!0)]}},b.prototype.getRows=function(){let t,e=100,r=this.buffer.byteLength-8,n=[];for(;e<=r&&(t=this.getRow(e));){;e+=8,e+=t.len,t.type?n.push(this.parseFunc(t.data)):n.push(null)}return n},b.prototype.getRow=function(t){let e=this.buffer.getInt32(t),r=this.buffer.getInt32(t+4)<<1;if(0===r)return{id:e,len:r,type:0};if(!(t+r+8>this.buffer.byteLength))return{id:e,len:r,data:new DataView(this.buffer.buffer,this.buffer.byteOffset+t+12,r-4),type:this.buffer.getInt32(t+8,!0)}};function w(t){return new Float64Array(t)}function m(t){return new Float64Array(t)}new TextDecoder,r("42151"),r("99655"),r("82422"),r("14976"),r("71527"),r("65518"),w(4),w(8),w(12),w(16),w(4),w(4),w(4),w(4),w(4),w(4),w(4),w(4),w(4),w(4),w(8),w(8),w(8),w(4),w(8),w(8),w(8),w(12),w(192),w(192),w(4),w(4),w(4),w(4),w(4),w(4),w(4),w(4),w(8),w(8),w(8),w(8),w(8),w(8),w(8),w(8),w(8),w(4),w(4),w(4),w(8),w(16),w(16),w(16),w(32),w(32),w(48),w(64),w(1152),w(1152),w(4),w(4),w(4),w(4),w(4),w(4),w(4),w(4),w(4),w(4),w(24),w(24),w(24),w(24),w(24),w(24),w(24),w(24),w(24),w(24),w(1152),w(1152),w(1152),w(1152),w(1152),w(2304),w(2304),w(3456),w(5760),w(8),w(8),w(8),w(16),w(24),w(48),w(48),w(96),w(192),w(384),w(384),w(384),w(768),w(96),w(96),w(96),w(1152),m(4),m(8),m(12),m(16),m(4),m(4),m(4),m(4),m(4),m(4),m(4),m(4),m(4),m(4),m(8),m(8),m(8),m(4),m(8),m(8),m(8),m(12),m(192),m(192),m(4),m(4),m(4),m(4),m(4),m(4),m(4),m(4),m(8),m(8),m(8),m(8),m(8),m(8),m(8),m(8),m(8),m(4),m(4),m(4),m(8),m(16),m(16),m(16),m(32),m(32),m(48),m(64),m(1152),m(1152),m(4),m(4),m(4),m(4),m(4),m(4),m(4),m(4),m(4),m(4),m(24),m(24),m(24),m(24),m(24),m(24),m(24),m(24),m(24),m(24),m(1152),m(1152),m(1152),m(1152),m(1152),m(2304),m(2304),m(3456),m(5760),m(8),m(8),m(8),m(16),m(24),m(48),m(48),m(96),m(192),m(384),m(384),m(384),m(768),m(96),m(96),m(96),m(1152);function F(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*=r,n*=n,Math.sqrt(r+n)}(function(t,e,r,n){this.p=t,this.polylineEdge=e,this.polygonEdge=r,this.isHeadingIn=n,this.distanceFromPolylineEdgeStart=F(this.polylineEdge.p1.p,this.p),this.distanceFromPolygonEdgeStart=F(this.polygonEdge.p1.p,this.p),this.polygonEdge.intersectionPoints.push(this),this.polylineEdge.intersectionPoints.push(this),this.visitCount=0}).prototype.incrementVisitCount=function(){this.visitCount=this.visitCount+1},r("86954"),r("54388"),r("76464"),r("35674"),r("27275");var C=r("68191");r("16293"),r("38394");var A=r("39660");let M=t=>{if("gml"===t)return"application/vnd.ogc.gml";if("json"===t)return"application/json";throw Error("Unknown info format type")},k=t=>{let e=t.getId();return(0,i.isString)(e)?e.split(".")[0]:e?.toString()??(0,i.uniqueId)("UNKNOWN")};var v=({queryLayers:t=[],featureCount:e=1,fetchOpts:r={},drillDown:o=!1,onError:s,onSuccess:l,infoFormat:p="gml"})=>{let f=(0,A.Z)(),[d,y]=(0,n.useState)(),[P,b]=(0,n.useState)([]),[w,m]=(0,n.useState)(!1),F=(0,n.useCallback)(e=>t.includes(e),[t]);(0,n.useEffect)(()=>{if(f&&w)return f.getTargetElement().style.cursor="wait",()=>{f.getTargetElement().style.cursor="auto"}},[w,f]);let v=(0,n.useCallback)(async t=>{if(a()(f))return;let n=f.getView(),d=n.getResolution(),P=n.getProjection(),w=f.getEventPixel(t.originalEvent),A=t.coordinate,v=f.getAllLayers().filter(F).filter(t=>t.getData&&t.getData(w)&&(0,C.us)(t)),E=f.getAllLayers().filter(F).filter(t=>(0,C.tm)(t));m(!0);try{let t=[];for(let n of v){if(!o&&t.length>0)break;let i=n.getSource();if(!i)continue;let s=i.getFeatureInfoUrl(A,d,P,{INFO_FORMAT:M(p),FEATURE_COUNT:e});if(s){let e;e=r instanceof Function?r(n):r[(0,g.getUid)(n)];let o=await fetch(s,e),i=null;if("gml"===p)i=new(c());else{if("json"!==p)continue;i=new(u())}let a=await o.text();t.push(...i.readFeatures(a).map(t=>({feature:t,layer:n,featureType:k(t)})))}}for(let e of E){if(!o&&t.length>0)break;let r=e.getSource();if(!!r)t.push(...r.getFeaturesAtCoordinate(A).map(t=>({feature:t,layer:e,featureType:k(t)})))}let n=(0,i.cloneDeep)(t),s=(0,i.cloneDeep)(A);b(n),y(s),l?.({clickCoordinate:s,loading:!1,features:n})}catch(t){h.Z.error(t),s?.(t)}m(!1)},[o,e,r,p,F,f]);return(0,n.useEffect)(()=>(f?.on("click",v),()=>{f?.un("click",v)}),[f,v]),{clickCoordinate:d,loading:w,features:P}};let E=({resultRenderer:t=()=>o().createElement(o().Fragment,null),...e})=>{let r=v(e);return a()(r)?null:o().createElement(o().Fragment,null,t(r))};var I=E}}]);
//# sourceMappingURL=7470.11982172b87f36e2.js.map