{"version":3,"file":"5292.657e5112a34573ff.js","sources":["webpack://@terrestris/shogun-gis-client/./node_modules/@terrestris/base-util/dist/MathUtil/MathUtil.js","webpack://@terrestris/shogun-gis-client/./node_modules/@terrestris/react-util/dist/Hooks/useGeoLocation/useGeoLocation.js","webpack://@terrestris/shogun-gis-client/./node_modules/@terrestris/react-geo/dist/Button/GeoLocationButton/GeoLocationButton.js","webpack://@terrestris/shogun-gis-client/./node_modules/@terrestris/react-geo/dist/Button/ToggleButton/ToggleButton.js","webpack://@terrestris/shogun-gis-client/./node_modules/@terrestris/react-geo/dist/constants.js","webpack://@terrestris/shogun-gis-client/./node_modules/@terrestris/react-util/dist/Hooks/useOlLayer/useOlLayer.js"],"sourcesContent":["/**\n * Helper Class for various calculations.\n *\n * @class MathUtil\n */\nclass MathUtil {\n    /**\n     * Converts radians to degrees.\n     *\n     * @param {number} rad The radian value to convert.\n     */\n    static radToDeg = (rad) => rad * 360 / (Math.PI * 2);\n    /**\n     * Converts degrees to radians.\n     *\n     * @param {number} deg The degree value to convert.\n     */\n    static degToRad = (deg) => deg * Math.PI * 2 / 360;\n    /**\n     * Returns the modulo for (negative) values.\n     *\n     * @param {number} n The number.\n     */\n    static mod = (n) => ((n % (2 * Math.PI)) + (2 * Math.PI)) % (2 * Math.PI);\n}\nexport default MathUtil;\n","import { useCallback, useEffect, useMemo, useState } from 'react';\nimport _isNil from 'lodash/isNil';\nimport OlFeature from 'ol/Feature';\nimport OlGeolocation from 'ol/Geolocation';\nimport OlGeomLineString from 'ol/geom/LineString';\nimport OlGeomPoint from 'ol/geom/Point';\nimport OlLayerVector from 'ol/layer/Vector';\nimport { unByKey } from 'ol/Observable';\nimport OlSourceVector from 'ol/source/Vector';\nimport OlStyleIcon from 'ol/style/Icon';\nimport OlStyleStyle from 'ol/style/Style';\nimport MathUtil from '@terrestris/base-util/dist/MathUtil/MathUtil';\nimport useMap from '../useMap/useMap';\nimport { useOlLayer } from '../useOlLayer/useOlLayer';\nimport mapMarkerHeading from './geolocation-marker-heading.png';\nimport mapMarker from './geolocation-marker.png';\n/**\n * This hook allows to debounce a setState.\n */\nexport const useGeoLocation = ({ active, enableTracking = false, follow = false, onError, onGeoLocationChange, showMarker = false, trackingOptions = {\n    enableHighAccuracy: true,\n    maximumAge: 10000,\n    timeout: 600000\n} }) => {\n    const map = useMap();\n    const [actualPosition, setActualPosition] = useState();\n    const trackedLine = useMemo(() => new OlGeomLineString([], 'XYZM'), []);\n    const markerFeature = useMemo(() => new OlFeature(), []);\n    useOlLayer(() => new OlLayerVector({\n        properties: {\n            name: 'react-geo_geolocationlayer'\n        },\n        source: new OlSourceVector({\n            features: [markerFeature]\n        }),\n        style: (feature) => {\n            const heading = feature.get('heading');\n            const src = (Number.isFinite(heading) && heading !== 0) ? mapMarkerHeading : mapMarker;\n            const rotation = (Number.isFinite(heading) && heading !== 0) ? heading * Math.PI / 180 : 0;\n            return [new OlStyleStyle({\n                    image: new OlStyleIcon({\n                        rotation,\n                        src\n                    })\n                })];\n        }\n    }), [], showMarker && active);\n    /**\n     * Callback of the interactions on change event.\n     */\n    const onLocationChanged = useCallback((geoLocationEvent) => {\n        const ac = geoLocationEvent.target;\n        const position = ac.getPosition() ?? [0, 0];\n        const accuracy = ac.getAccuracy();\n        let heading = ac.getHeading() || 0;\n        const speed = ac.getSpeed() || 0;\n        const x = position[0];\n        const y = position[1];\n        const fCoords = trackedLine.getCoordinates();\n        const previous = fCoords[fCoords.length - 1];\n        const prevHeading = previous && previous[2];\n        if (prevHeading) {\n            let headingDiff = heading - MathUtil.mod(prevHeading);\n            // force the rotation change to be less than 180Â°\n            if (Math.abs(headingDiff) > Math.PI) {\n                const sign = (headingDiff >= 0) ? 1 : -1;\n                headingDiff = -sign * (2 * Math.PI - Math.abs(headingDiff));\n            }\n            heading = prevHeading + headingDiff;\n        }\n        trackedLine.appendCoordinate([x, y, heading, Date.now()]);\n        // only keep the 20 last coordinates\n        trackedLine.setCoordinates(trackedLine.getCoordinates().slice(-20));\n        const actualGeoLocation = {\n            position,\n            accuracy,\n            heading,\n            speed\n        };\n        setActualPosition(actualGeoLocation);\n        onGeoLocationChange?.(actualGeoLocation);\n    }, [trackedLine, onGeoLocationChange]);\n    // Geolocation Control\n    const olGeoLocation = useMemo(() => active ? new OlGeolocation({\n        projection: map?.getView().getProjection()\n    }) : undefined, [active, map]);\n    // re-centers the view by putting the given coordinates at 3/4 from the top or\n    // the screen\n    const getCenterWithHeading = useCallback((position, rotation, resolution) => {\n        const size = map?.getSize() ?? [0, 0];\n        const height = size[1];\n        return [\n            position[0] - Math.sin(rotation) * height * resolution / 4,\n            position[1] + Math.cos(rotation) * height * resolution / 4\n        ];\n    }, [map]);\n    useEffect(() => {\n        if (!onError || !olGeoLocation) {\n            return;\n        }\n        const key = olGeoLocation.on('error', onError);\n        return () => {\n            unByKey(key);\n        };\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [olGeoLocation]);\n    useEffect(() => {\n        if (!olGeoLocation) {\n            return;\n        }\n        const key = olGeoLocation.on('change', onLocationChanged);\n        return () => {\n            unByKey(key);\n        };\n    }, [olGeoLocation, onLocationChanged]);\n    useEffect(() => {\n        olGeoLocation?.setTracking(enableTracking);\n    }, [enableTracking, olGeoLocation]);\n    useEffect(() => {\n        olGeoLocation?.setTrackingOptions(trackingOptions);\n    }, [olGeoLocation, trackingOptions]);\n    useEffect(() => {\n        const deltaMean = 500; // the geolocation sampling period mean in ms\n        // use sampling period to get a smooth transition\n        let m = Date.now() - deltaMean * 1.5;\n        m = Math.max(m, 0);\n        // interpolate position along positions LineString\n        const c = trackedLine.getCoordinateAtM(m, true);\n        if (!_isNil(c)) {\n            if (follow) {\n                map?.getView().setCenter(getCenterWithHeading([c[0], c[1]], -c[2], map?.getView().getResolution() ?? 0));\n                map?.getView().setRotation(-c[2]);\n            }\n            if (showMarker) {\n                const pointGeometry = new OlGeomPoint([c[0], c[1]]);\n                markerFeature.setGeometry(pointGeometry);\n            }\n        }\n    }, [actualPosition, showMarker, follow, map, trackedLine, getCenterWithHeading, markerFeature]);\n    return {\n        actualPosition,\n        trackedLine\n    };\n};\nexport default useGeoLocation;\n//# sourceMappingURL=useGeoLocation.js.map","import { useGeoLocation } from '@terrestris/react-util/dist/Hooks/useGeoLocation/useGeoLocation';\nimport React from 'react';\nimport { CSS_PREFIX } from '../../constants';\nimport ToggleButton from '../ToggleButton/ToggleButton';\nexport const GeoLocationButton = ({ className, follow = false, enableTracking = false, onGeoLocationChange = () => undefined, onError = () => undefined, showMarker = true, trackingOptions, pressed, ...passThroughProps }) => {\n    useGeoLocation({\n        active: !!pressed,\n        enableTracking: pressed,\n        follow,\n        onError,\n        onGeoLocationChange,\n        showMarker,\n        trackingOptions\n    });\n    const finalClassName = className\n        ? `${className} ${CSS_PREFIX}geolocationbutton`\n        : `${CSS_PREFIX}geolocationbutton`;\n    return (React.createElement(ToggleButton, { pressed: pressed, className: finalClassName, ...passThroughProps }));\n};\nexport default GeoLocationButton;\n//# sourceMappingURL=GeoLocationButton.js.map","import './ToggleButton.less';\nimport { Button, Tooltip } from 'antd';\nimport React from 'react';\nimport { CSS_PREFIX } from '../../constants';\nexport const ToggleButton = ({ type = 'primary', pressed = false, tooltipProps = {\n    mouseEnterDelay: 1.5\n}, className, tooltip, tooltipPlacement, pressedIcon, icon, children, value, onClick, onChange = () => { }, ...passThroughProps }) => {\n    const handleChange = (evt) => {\n        if (onClick) {\n            onClick(evt);\n            if (evt.defaultPrevented) {\n                return;\n            }\n        }\n        onChange(evt, value);\n    };\n    const internalClassName = `${CSS_PREFIX}togglebutton`;\n    const finalClassName = className\n        ? `${className} ${internalClassName}`\n        : internalClassName;\n    let pressedClass = '';\n    if (pressed) {\n        pressedClass = ' btn-pressed';\n    }\n    return (React.createElement(Tooltip, { title: tooltip, placement: tooltipPlacement, ...tooltipProps },\n        React.createElement(Button, { type: type, onClick: handleChange, onChange: onChange, className: `${finalClassName}${pressedClass}`, \"aria-pressed\": pressed, icon: pressed ?\n                pressedIcon :\n                icon, ...passThroughProps }, children)));\n};\nexport default ToggleButton;\n//# sourceMappingURL=ToggleButton.js.map","const CSS_PREFIX = 'react-geo-';\nexport { CSS_PREFIX };\n//# sourceMappingURL=constants.js.map","import { useEffect, useState } from 'react';\nimport { isNil } from 'lodash';\nimport useMap from '../useMap/useMap';\n/**\n * This hook adds a layer to the map and removes/updates it if the dependency array changes.\n * It accepts an optional visible parameter that toggles the visible state of the layer. If it is undefined the\n * visible state will not get changed.\n * @param constructor returns a layer to be added to the map, will be called again, if the layer needs\n * to be updated\n * @param dependencies\n * @param visible\n */\nexport const useOlLayer = (constructor, dependencies, visible) => {\n    const map = useMap();\n    const [layer, setLayer] = useState();\n    useEffect(() => {\n        if (!map) {\n            return undefined;\n        }\n        const newLayer = constructor();\n        if (!newLayer) {\n            return undefined;\n        }\n        map.addLayer(newLayer);\n        setLayer(newLayer);\n        return () => {\n            map.removeLayer(newLayer);\n            setLayer(undefined);\n        };\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [map, ...dependencies]);\n    useEffect(() => {\n        if (!layer || isNil(visible)) {\n            return;\n        }\n        layer.setVisible(visible);\n    }, [layer, visible]);\n    return layer;\n};\nexport default useOlLayer;\n//# sourceMappingURL=useOlLayer.js.map"],"names":["Math","s","Number","a","Date","T","e"],"mappings":"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"}