"use strict";(self.webpackChunk_terrestris_shogun_gis_client=self.webpackChunk_terrestris_shogun_gis_client||[]).push([["6976"],{15107:function(e,t,i){var r=i(24969),n=i(59900),o=i(85386),a=i(2022);class s extends r.Z{constructor(e,t,i,r,n,o){super(e,t,o),this.crossOrigin_=r,this.src_=i,this.key=i,this.image_=new Image,null!==r&&(this.image_.crossOrigin=r),this.unlisten_=null,this.tileLoadFunction_=n}getImage(){return this.image_}setImage(e){this.image_=e,this.state=n.default.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=n.default.ERROR,this.unlistenImage_(),this.image_=function(){let e=(0,o.E4)(1,1);return e.fillStyle="rgba(0,0,0,0)",e.fillRect(0,0,1,1),e.canvas}(),this.changed()}handleImageLoad_(){let e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=n.default.LOADED:this.state=n.default.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==n.default.ERROR&&(this.state=n.default.IDLE,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==n.default.IDLE&&(this.state=n.default.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=(0,a.Kp)(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}}t.Z=s},71534:function(e,t){t.Z={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"}},74273:function(e,t,i){i.d(t,{Z:function(){return Q}});var r=i("4722"),n=i("24969"),o=i("59900"),a=i("85386");function s(e){return e instanceof Image||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageBitmap?e:null}let l=Error("disposed"),h=null,u=[256,256];class d extends n.Z{constructor(e){super(e.tileCoord,o.default.IDLE,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null,this.controller_=e.controller||null}getSize(){if(this.size_)return this.size_;let e=s(this.data_);return e?[e.width,e.height]:u}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==o.default.IDLE&&this.state!==o.default.ERROR)return;this.state=o.default.LOADING,this.changed();let e=this;this.loader_().then(function(t){e.data_=t,e.state=o.default.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=o.default.ERROR,e.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(l),this.controller_=null),super.disposeInternal()}}var _=d,c=i("15107"),g=i("80967"),f=i("38906"),E=class e{constructor(e){this.highWaterMark=void 0!==e?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){let e=this.pop();e instanceof g.Z&&e.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){let i=this.entries_[e];return((0,f.h)(void 0!==i,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_)?i.value_:(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i,i.value_)}remove(e){let t=this.entries_[e];return(0,f.h)(void 0!==t,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){let e;let t=Array(this.count_),i=0;for(e=this.newest_;e;e=e.older)t[i++]=e.key_;return t}getValues(){let e;let t=Array(this.count_),i=0;for(e=this.newest_;e;e=e.older)t[i++]=e.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){return this.entries_[e]?.value_}pop(){let e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,!this.oldest_&&(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){(0,f.h)(!(e in this.entries_),"Tried to set a value for a key that is used already");let i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}},T=i("35211"),R=i("73381"),x=i("56245"),p=i("52209");function m(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function A(e,t,i,r,n,o,a){a=a??m();let s=1/(e-t),l=1/(i-r),h=1/(n-o);return a[0]=-2*s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*l,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*h,a[11]=0,a[12]=(e+t)*s,a[13]=(r+i)*l,a[14]=(o+n)*h,a[15]=1,a}function v(e,t,i,r,n){return(n=n??m())[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n[4]=e[4]*i,n[5]=e[5]*i,n[6]=e[6]*i,n[7]=e[7]*i,n[8]=e[8]*r,n[9]=e[9]*r,n[10]=e[10]*r,n[11]=e[11]*r,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}var L=i("91358");let S=`
  attribute vec4 a_position;
  attribute vec4 a_texcoord;

  uniform mat4 u_matrix;
  uniform mat4 u_textureMatrix;

  varying vec2 v_texcoord;

  void main() {
    gl_Position = u_matrix * a_position;
    vec2 texcoord = (u_textureMatrix * a_texcoord).xy;
    v_texcoord = texcoord;
  }
`,D=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (
      v_texcoord.x < 0.0 ||
      v_texcoord.y < 0.0 ||
      v_texcoord.x > 1.0 ||
      v_texcoord.y > 1.0
    ) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;class w{constructor(e){this.gl_=e,this.program_=I(e,D,S),this.positionLocation=e.getAttribLocation(this.program_,"a_position"),this.texcoordLocation=e.getAttribLocation(this.program_,"a_texcoord"),this.matrixLocation=e.getUniformLocation(this.program_,"u_matrix"),this.textureMatrixLocation=e.getUniformLocation(this.program_,"u_textureMatrix"),this.textureLocation=e.getUniformLocation(this.program_,"u_texture"),this.positionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),this.positions=[0,0,0,1,1,0,1,0,0,1,1,1],e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.positions),e.STATIC_DRAW),this.texcoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texcoordBuffer),this.texcoords=[0,0,0,1,1,0,1,0,0,1,1,1],e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.texcoords),e.STATIC_DRAW)}drawImage(e,t,i,r,n,o,a,s,l,h,u,d,_){var c,g,f,E,T,R,x,p,L;let S,D,w,F,I,y,C,M,U,b,P,O,X=this.gl_;void 0===s&&(s=r),void 0===l&&(l=n),void 0===o&&(o=t),void 0===a&&(a=i),void 0===h&&(h=o),void 0===u&&(u=a),void 0===d&&(d=X.canvas.width),void 0===_&&(_=X.canvas.height),X.bindTexture(X.TEXTURE_2D,e),X.useProgram(this.program_),X.bindBuffer(X.ARRAY_BUFFER,this.positionBuffer),X.enableVertexAttribArray(this.positionLocation),X.vertexAttribPointer(this.positionLocation,2,X.FLOAT,!1,0,0),X.bindBuffer(X.ARRAY_BUFFER,this.texcoordBuffer),X.enableVertexAttribArray(this.texcoordLocation),X.vertexAttribPointer(this.texcoordLocation,2,X.FLOAT,!1,0,0);let G=A(0,d,0,_,-1,1);c=G,g=s,f=l,E=0,c===(T=T??m())?(T[12]=c[0]*g+c[4]*f+0*c[8]+c[12],T[13]=c[1]*g+c[5]*f+c[9]*E+c[13],T[14]=c[2]*g+c[6]*f+c[10]*E+c[14],T[15]=c[3]*g+c[7]*f+c[11]*E+c[15]):(S=c[0],D=c[1],w=c[2],F=c[3],I=c[4],y=c[5],C=c[6],M=c[7],U=c[8],b=c[9],P=c[10],O=c[11],T[0]=S,T[1]=D,T[2]=w,T[3]=F,T[4]=I,T[5]=y,T[6]=C,T[7]=M,T[8]=U,T[9]=b,T[10]=P,T[11]=O,T[12]=S*g+I*f+U*E+c[12],T[13]=D*g+y*f+b*E+c[13],T[14]=w*g+C*f+P*E+c[14],T[15]=F*g+M*f+O*E+c[15]),G=v(G=T,h,u,1),X.uniformMatrix4fv(this.matrixLocation,!1,G);let B=(R=r/t,x=n/i,p=0,(L=L??m())[0]=1,L[1]=0,L[2]=0,L[3]=0,L[4]=0,L[5]=1,L[6]=0,L[7]=0,L[8]=0,L[9]=0,L[10]=1,L[11]=0,L[12]=R,L[13]=x,L[14]=0,L[15]=1,L);B=v(B,o/t,a/i,1),X.uniformMatrix4fv(this.textureMatrixLocation,!1,B),X.uniform1i(this.textureLocation,0),X.drawArrays(X.TRIANGLES,0,this.positions.length/2)}}function F(e,t,i){let r=e.createShader(t);if(null===r)throw Error("Shader compilation failed");if(e.shaderSource(r,i),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){let t=e.getShaderInfoLog(r);if(null===t)throw Error("Shader info log creation failed");throw Error(t)}return r}function I(e,t,i){let r=e.createProgram(),n=F(e,e.VERTEX_SHADER,i),o=F(e,e.FRAGMENT_SHADER,t);if(null===r)throw Error("Program creation failed");if(e.attachShader(r,n),e.attachShader(r,o),e.linkProgram(r),!e.getProgramParameter(r,e.LINK_STATUS)){if(null===e.getProgramInfoLog(r))throw Error("Program info log creation failed");throw Error()}return r}var y=i("21915");let C=`
  attribute vec4 a_position;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
  }
`,M=`
  precision mediump float;

  uniform vec4 u_val;
  void main() {
     gl_FragColor = u_val;
  }
`,U=`
  attribute vec4 a_position;
  attribute vec2 a_texcoord;

  varying vec2 v_texcoord;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
     v_texcoord = a_texcoord;
  }
`,b=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (v_texcoord.x < 0.0 || v_texcoord.x > 1.0 || v_texcoord.y < 0.0 || v_texcoord.y > 1.0) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`,P=[];var O=i("21882"),X=i("13002"),G=class e extends _{constructor(e){super({tileCoord:e.tileCoord,loader:()=>Promise.resolve(new Uint8ClampedArray(4)),interpolate:e.interpolate,transition:e.transition}),this.renderEdges_=void 0!==e.renderEdges&&e.renderEdges,this.pixelRatio_=e.pixelRatio,this.gutter_=e.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=e.sourceTileGrid,this.targetTileGrid_=e.targetTileGrid,this.wrappedTileCoord_=e.wrappedTileCoord||e.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;let t=e.sourceProj,i=t.getExtent(),r=e.sourceTileGrid.getExtent();this.clipExtent_=t.canWrapX()?r?(0,y.getIntersection)(i,r):i:r;let n=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),a=this.targetTileGrid_.getExtent(),s=this.sourceTileGrid_.getExtent(),l=a?(0,y.getIntersection)(n,a):n;if(0===(0,y.getArea)(l)){this.state=o.default.EMPTY;return}i&&(s=s?(0,y.getIntersection)(s,i):i);let h=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),u=e.targetProj,d=(0,p.Co)(t,u,l,h);if(!isFinite(d)||d<=0){this.state=o.default.EMPTY;return}let _=void 0!==e.errorThreshold?e.errorThreshold:T.m;if(this.triangulation_=new x.Z(t,u,l,s,d*_,h,e.transformMatrix),0===this.triangulation_.getTriangles().length){this.state=o.default.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(d);let c=this.triangulation_.calculateSourceExtent();if(s&&(t.canWrapX()?(c[1]=(0,O.uZ)(c[1],s[1],s[3]),c[3]=(0,O.uZ)(c[3],s[1],s[3])):c=(0,y.getIntersection)(c,s)),(0,y.getArea)(c)){let r=0,n=0;t.canWrapX()&&(r=(0,y.getWidth)(i),n=Math.floor((c[0]-i[0])/r)),(0,y.wrapAndSliceX)(c.slice(),t,!0).forEach(t=>{let i=this.sourceTileGrid_.getTileRangeForExtentAndZ(t,this.sourceZ_),o=e.getTileFunction;for(let e=i.minX;e<=i.maxX;e++)for(let t=i.minY;t<=i.maxY;t++){let i=o(this.sourceZ_,e,t,this.pixelRatio_);if(i){let e=n*r;this.sourceTiles_.push({tile:i,offset:e})}}++n}),0===this.sourceTiles_.length&&(this.state=o.default.EMPTY)}else this.state=o.default.EMPTY}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){var e,t,i,r;let n,l,u;let d=[],_=!1;if(this.sourceTiles_.forEach(e=>{var t;let i;let r=e.tile;if(!r||r.getState()!==o.default.LOADED)return;let n=r.getSize(),l=this.gutter_;let u=(t=r.getData())instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Float32Array||t instanceof DataView?t:null;u?i=u:(_=!0,i=function(e){!h&&(h=(0,a.E4)(e.width,e.height,void 0,{willReadFrequently:!0}));let t=h.canvas,i=e.width;t.width!==i&&(t.width=i);let r=e.height;return t.height!==r&&(t.height=r),h.clearRect(0,0,i,r),h.drawImage(e,0,0),h.getImageData(0,0,i,r).data}(s(r.getData())));let c=[n[0]+2*l,n[1]+2*l],g=i instanceof Float32Array,f=c[0]*c[1],E=g?Float32Array:Uint8ClampedArray,T=new E(i.buffer),R=E.BYTES_PER_ELEMENT,x=R*T.length/f,p=Math.floor(T.byteLength/c[1]/R/c[0]),m=this.sourceTileGrid_.getTileCoordExtent(r.tileCoord);m[0]+=e.offset,m[2]+=e.offset;let A=this.clipExtent_?.slice();A&&(A[0]+=e.offset,A[2]+=e.offset),d.push({extent:m,clipExtent:A,data:T,dataType:E,bytesPerPixel:x,pixelSize:c,bandCount:p})}),this.sourceTiles_.length=0,0===d.length){this.state=o.default.ERROR,this.changed();return}let c=this.wrappedTileCoord_[0],g=this.targetTileGrid_.getTileSize(c),f="number"==typeof g?g:g[0],E="number"==typeof g?g:g[1],T=f*this.pixelRatio_,R=E*this.pixelRatio_,x=this.targetTileGrid_.getResolution(c),p=this.sourceTileGrid_.getResolution(this.sourceZ_),m=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),v=d[0].bandCount,S=new d[0].dataType(v*T*R);let D=(e=T,t=R,r={premultipliedAlpha:!1,antialias:!1},u=(i=P)&&i.length?i.shift():L.WORKER_OFFSCREEN_CANVAS?new OffscreenCanvas(e||300,t||300):document.createElement("canvas"),e&&(u.width=e),t&&(u.height=t),u.getContext("webgl",r)),F=D.RGBA;if(d[0].dataType==Float32Array){l=D.FLOAT,D.getExtension("WEBGL_color_buffer_float"),D.getExtension("OES_texture_float"),D.getExtension("EXT_float_blend");let e=D.getExtension("OES_texture_float_linear");n=null!==e&&this.interpolate}else l=D.UNSIGNED_BYTE,n=this.interpolate;let O=Math.ceil(v/4);for(let e=O-1;e>=0;--e){let t=[];for(let i=0,r=d.length;i<r;++i){let r=d[i],o=r.pixelSize,a=o[0],s=o[1],h=new r.dataType(4*a*s),u=r.data,_=4*e;for(let e=0,t=h.length;e<t;e+=4)h[e]=u[_],h[e+1]=u[_+1],h[e+2]=u[_+2],h[e+3]=u[_+3],_+=v;let c=D.createTexture();D.bindTexture(D.TEXTURE_2D,c),n?(D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,D.LINEAR),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,D.LINEAR)):(D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,D.NEAREST),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,D.NEAREST)),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_S,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_T,D.CLAMP_TO_EDGE),D.texImage2D(D.TEXTURE_2D,0,F,a,s,0,F,l,h),t.push({extent:r.extent,clipExtent:r.clipExtent,texture:c,width:a,height:s})}let{framebuffer:i,width:r,height:o}=function(e,t,i,r,n,o,a,s,l,h,u,d,_,c){let g,f,E,T,R;let x=Math.round(r*t),p=Math.round(r*i);if(e.canvas.width=x,e.canvas.height=p,f=e.createTexture(),e.bindTexture(e.TEXTURE_2D,f),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),_?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,x,p,0,e.RGBA,u,null),g=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,g),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,f,0),null===g)throw Error("Could not create framebuffer");if(null===f)throw Error("Could not create texture");if(0===l.length)return{width:x,height:p,framebuffer:g,texture:f};let m=(0,y.createEmpty)();l.forEach(function(e,t,i){(0,y.extend)(m,e.extent)});let v=1/n;{if(E=e.createTexture(),null===f)throw Error("Could not create texture");T=Math.round((0,y.getWidth)(m)*v),R=Math.round((0,y.getHeight)(m)*v);let t=e.getParameter(e.MAX_TEXTURE_SIZE),i=Math.max(T,R),r=i>t?t/i:1,n=Math.round(T*r),o=Math.round(R*r);e.bindTexture(e.TEXTURE_2D,E),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),_?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n,o,0,e.RGBA,u,null);let a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,E,0);let s=new w(e);l.forEach(function(t,i,l){let u=(t.extent[0]-m[0])*v*r,d=-(t.extent[3]-m[3])*v*r,c=(0,y.getWidth)(t.extent)*v*r,g=(0,y.getHeight)(t.extent)*v*r;if(e.bindFramebuffer(e.FRAMEBUFFER,a),e.viewport(0,0,n,o),t.clipExtent){let i=(t.clipExtent[0]-m[0])*v*r,n=-(t.clipExtent[3]-m[3])*v*r,o=(0,y.getWidth)(t.clipExtent)*v*r,a=(0,y.getHeight)(t.clipExtent)*v*r;e.enable(e.SCISSOR_TEST),e.scissor(_?i:Math.round(i),_?n:Math.round(n),_?o:Math.round(i+o)-Math.round(i),_?a:Math.round(n+a)-Math.round(n))}s.drawImage(t.texture,t.width,t.height,h,h,t.width-2*h,t.height-2*h,_?u:Math.round(u),_?d:Math.round(d),_?c:Math.round(u+c)-Math.round(u),_?g:Math.round(d+g)-Math.round(d),n,o),e.disable(e.SCISSOR_TEST)}),e.deleteFramebuffer(a)}let L=(0,y.getTopLeft)(a),S=(0,y.getTopLeft)(m),D=e=>{let t=(e[0][0]-L[0])/o*r,i=-(e[0][1]-L[1])/o*r,n=(e[1][0]-L[0])/o*r,a=-(e[1][1]-L[1])/o*r,s=(e[2][0]-L[0])/o*r;return{u1:n,v1:a,u0:t,v0:i,u2:s,v2:-(e[2][1]-L[1])/o*r}};e.bindFramebuffer(e.FRAMEBUFFER,g),e.viewport(0,0,x,p);{let t=[],i=[],r=I(e,b,U);e.useProgram(r);let o=e.getUniformLocation(r,"u_texture");e.bindTexture(e.TEXTURE_2D,E),e.uniform1i(o,0),s.getTriangles().forEach(function(e,r,o){let a=e.source,{u1:s,v1:l,u0:h,v0:u,u2:d,v2:_}=D(e.target),c=(a[0][0]-S[0])/n/T,g=-(a[0][1]-S[1])/n/R,f=(a[1][0]-S[0])/n/T,E=-(a[1][1]-S[1])/n/R,x=(a[2][0]-S[0])/n/T,p=-(a[2][1]-S[1])/n/R;t.push(s,l,h,u,d,_),i.push(f,E,c,g,x,p)});let a=A(0,x,p,0,-1,1),l=e.getUniformLocation(r,"u_matrix");e.uniformMatrix4fv(l,!1,a);let h=e.getAttribLocation(r,"a_position"),u=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,u),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t),e.STATIC_DRAW),e.vertexAttribPointer(h,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(h);let d=e.getAttribLocation(r,"a_texcoord"),_=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,_),e.bufferData(e.ARRAY_BUFFER,new Float32Array(i),e.STATIC_DRAW),e.vertexAttribPointer(d,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(d),e.drawArrays(e.TRIANGLES,0,t.length/2)}if(d){let t=I(e,M,C);e.useProgram(t);let i=A(0,x,p,0,-1,1),r=e.getUniformLocation(t,"u_matrix");e.uniformMatrix4fv(r,!1,i);let n=Array.isArray(d)?d:[0,0,0,255],o=e.getUniformLocation(t,"u_val");e.uniform4fv(o,n);let a=e.getAttribLocation(t,"a_position"),l=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,l),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(a);let h=s.getTriangles().reduce(function(e,t){let{u1:i,v1:r,u0:n,v0:o,u2:a,v2:s}=D(t.target);return e.concat([i,r,n,o,n,o,a,s,a,s,i,r])},[]);e.bufferData(e.ARRAY_BUFFER,new Float32Array(h),e.STATIC_DRAW),e.drawArrays(e.LINES,0,h.length/2)}return{width:x,height:p,framebuffer:g,texture:f}}(D,f,E,this.pixelRatio_,p,x,m,this.triangulation_,t,this.gutter_,l,this.renderEdges_,n),a=4*o,s=new d[0].dataType(r*a);D.bindFramebuffer(D.FRAMEBUFFER,i),D.readPixels(0,0,r,o,D.RGBA,l,s);let h=4*e;for(let e=0,t=s.length;e<t;e+=4){let t=(r-1-(e/a|0))*a+e%a;S[h]=s[t],S[h+1]=s[t+1],S[h+2]=s[t+2],S[h+3]=s[t+3],h+=v}}if(!function(e){let t=e.canvas;t.width=1,t.height=1,e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT)}(D),P.push(D.canvas),_){let e=(0,a.E4)(f,E),t=new ImageData(S,f);e.putImageData(t,0,0),this.reprojData_=e.canvas}else this.reprojData_=S;this.reprojSize_=[Math.round(T),Math.round(R)],this.state=o.default.LOADED,this.changed()}load(){if(this.state!==o.default.IDLE&&this.state!==o.default.ERROR)return;this.state=o.default.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{let i=t.getState();if(i!==o.default.IDLE&&i!==o.default.LOADING)return;e++;let r=(0,X.oL)(t,R.default.CHANGE,()=>{let i=t.getState();(i==o.default.LOADED||i==o.default.ERROR||i==o.default.EMPTY)&&((0,X.bN)(r),0==--e&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(r)}),0===e?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e}){e.getState()==o.default.IDLE&&e.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(X.bN),this.sourcesListenerKeys_=null}},B=i("7245"),Z=i("19473"),N=i("82359"),j=i("79682"),K=i("70701"),Y=i("5374"),W=i("49179"),k=i("50596");function z(e,t,i,r){return`${e},${(0,K.lg)(t,i,r)}`}function H(e,t,i){if(!(i in e))return e[i]=new Set([t]),!0;let r=e[i],n=r.has(t);return!n&&r.add(t),!n}function V(e,t){let i=e.layerStatesArray[e.layerIndex];i.extent&&(t=(0,y.getIntersection)(t,(0,Y.fromUserExtent)(i.extent,e.viewState.projection)));let r=i.layer.getRenderSource();if(!r.getWrapX()){let i=r.getTileGridForProjection(e.viewState.projection).getExtent();i&&(t=(0,y.getIntersection)(t,i))}return t}class q extends r.Z{constructor(e,t){super(e),t=t||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=(0,y.createEmpty)(),this.tempTileRange_=new Z.Z(0,0,0,0),this.tempTileCoord_=(0,K.T9)(0,0,0);let i=void 0!==t.cacheSize?t.cacheSize:512;this.tileCache_=new E(i),this.maxStaleKeys=.5*i}getTileCache(){return this.tileCache_}getOrCreateTile(e,t,i,r){let n;let o=this.tileCache_,a=this.getLayer().getSource(),s=z(a.getKey(),e,t,i);if(o.containsKey(s))n=o.get(s);else{if(!(n=a.getTile(e,t,i,r.pixelRatio,r.viewState.projection)))return null;o.set(s,n)}return n}getTile(e,t,i,r){let n=this.getOrCreateTile(e,t,i,r);return n?n:null}getData(e){let t=this.frameState;if(!t)return null;let i=this.getLayer(),r=(0,N.nn)(t.pixelToCoordinateTransform,e.slice()),n=i.getExtent();if(n&&!(0,y.containsCoordinate)(n,r))return null;let a=t.viewState,l=i.getRenderSource(),h=l.getTileGridForProjection(a.projection),u=l.getTilePixelRatio(t.pixelRatio);for(let e=h.getZForResolution(a.resolution);e>=h.getMinZoom();--e){let i;let n=h.getTileCoordForCoordAndZ(r,e),d=this.getTile(e,n[1],n[2],t);if(!d||d.getState()!==o.default.LOADED)continue;let g=h.getOrigin(e),f=(0,k.Pq)(h.getTileSize(e)),E=h.getResolution(e);if(d instanceof c.Z||d instanceof B.Z)i=d.getImage();else if(!(d instanceof _))continue;else if(!(i=s(d.getData())))continue;let T=Math.floor(u*((r[0]-g[0])/E-n[1]*f[0])),R=Math.floor(u*((g[1]-r[1])/E-n[2]*f[1])),x=Math.round(u*l.getGutterForProjection(a.projection));return this.getImageData(i,T+x,R+x)}return null}prepareFrame(e){this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;let t=this.getLayer().getSource();if(!t)return!1;let i=t.getRevision();return this.renderedRevision_?this.renderedRevision_!==i&&(this.renderedRevision_=i,this.renderedSourceKey_===t.getKey()&&this.tileCache_.clear()):this.renderedRevision_=i,!0}enqueueTiles(e,t,i,r,n){let a=e.viewState,s=this.getLayer(),l=s.getRenderSource(),h=l.getTileGridForProjection(a.projection),u=(0,W.getUid)(l);!(u in e.wantedTiles)&&(e.wantedTiles[u]={});let d=e.wantedTiles[u],_=s.getMapInternal(),c=Math.max(i-n,h.getMinZoom(),h.getZForResolution(Math.min(s.getMaxResolution(),_?_.getView().getResolutionForZoom(Math.max(s.getMinZoom(),0)):h.getResolution(0)),l.zDirection));for(let n=i;n>=c;--n){let i=h.getTileRangeForExtentAndZ(t,n,this.tempTileRange_),a=h.getResolution(n);for(let t=i.minX;t<=i.maxX;++t)for(let s=i.minY;s<=i.maxY;++s){let i=this.getTile(n,t,s,e);if(!i||!H(r,i,n))continue;let l=i.getKey();if(d[l]=!0,i.getState()===o.default.IDLE&&!e.tileQueue.isKeyQueued(l)){let r=(0,K.T9)(n,t,s,this.tempTileCoord_);e.tileQueue.enqueue([i,u,h.getTileCoordCenter(r),a])}}}}findStaleTile_(e,t){let i=this.tileCache_,r=e[0],n=e[1],a=e[2],s=this.getStaleKeys();for(let e=0;e<s.length;++e){let l=z(s[e],r,n,a);if(i.containsKey(l)){let e=i.get(l);if(e.getState()===o.default.LOADED)return e.endTransition((0,W.getUid)(this)),H(t,e,r),!0}}return!1}findAltTiles_(e,t,i,r){let n=e.getTileRangeForTileCoordAndZ(t,i,this.tempTileRange_);if(!n)return!1;let a=!0,s=this.tileCache_,l=this.getLayer().getRenderSource().getKey();for(let e=n.minX;e<=n.maxX;++e)for(let t=n.minY;t<=n.maxY;++t){let n=z(l,i,e,t),h=!1;if(s.containsKey(n)){let e=s.get(n);e.getState()===o.default.LOADED&&(H(r,e,i),h=!0)}!h&&(a=!1)}return a}renderFrame(e,t){let i,r=!0;this.renderComplete=!0;let n=e.layerStatesArray[e.layerIndex],a=e.viewState,s=a.projection,l=a.resolution,h=a.center,u=e.pixelRatio,d=this.getLayer(),_=d.getSource(),c=_.getRevision(),g=_.getTileGridForProjection(s),f=g.getZForResolution(l,_.zDirection),E=g.getResolution(f),T=_.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==T&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=T):this.renderedSourceKey_=T;let R=e.extent,x=_.getTilePixelRatio(u);this.prepareContainer(e,t);let p=this.context.canvas.width,m=this.context.canvas.height,A=n.extent&&(0,Y.fromUserExtent)(n.extent,s);A&&(R=(0,y.getIntersection)(R,(0,Y.fromUserExtent)(n.extent,s)));let v=E*p/2/x,L=E*m/2/x,S=[h[0]-v,h[1]-L,h[0]+v,h[1]+L],D={};this.renderedTiles.length=0;let w=d.getPreload();if(e.nextExtent){let t=g.getZForResolution(a.nextResolution,_.zDirection),i=V(e,e.nextExtent);this.enqueueTiles(e,i,t,D,w)}let F=V(e,R);if(this.enqueueTiles(e,F,f,D,0),w>0&&setTimeout(()=>{this.enqueueTiles(e,F,f-1,D,w-1)},0),!(f in D))return this.container;let I=(0,W.getUid)(this),C=e.time;for(let t of D[f]){let i=t.getState();if((t instanceof B.Z||t instanceof G)&&i===o.default.EMPTY)continue;let n=t.tileCoord;if(i===o.default.LOADED&&1===t.getAlpha(I,C)){t.endTransition(I);continue}if(i!==o.default.IDLE&&(r=!1),i!==o.default.ERROR&&(this.renderComplete=!1),this.findStaleTile_(n,D)){!function(e,t,i){let r=e[i];r&&r.delete(t)}(D,t,f),e.animate=!0;continue}if(this.findAltTiles_(g,n,f+1,D))continue;let a=g.getMinZoom();for(let e=f-1;e>=a&&!this.findAltTiles_(g,n,e,D);--e);}let M=E/l*u/x,U=this.getRenderContext(e);(0,N.qC)(this.tempTransform,p/2,m/2,M,M,0,-p/2,-m/2),n.extent&&this.clipUnrotated(U,e,A),!_.getInterpolate()&&(U.imageSmoothingEnabled=!1),this.preRender(U,e);let b=Object.keys(D).map(Number);b.sort(j.j2);let P=[],O=[];for(let t=b.length-1;t>=0;--t){let r=b[t],n=_.getTilePixelSize(r,u,s),a=g.getResolution(r)/E,l=n[0]*a*M,h=n[1]*a*M,d=g.getTileCoordForCoordAndZ((0,y.getTopLeft)(S),r),c=g.getTileCoordExtent(d),f=(0,N.nn)(this.tempTransform,[x*(c[0]-S[0])/E,x*(S[3]-c[3])/E]),T=x*_.getGutterForProjection(s);for(let t of D[r]){if(t.getState()!==o.default.LOADED)continue;let n=t.tileCoord,a=d[1]-n[1],s=Math.round(f[0]-(a-1)*l),u=d[2]-n[2],c=Math.round(f[1]-(u-1)*h),g=Math.round(f[0]-a*l),E=Math.round(f[1]-u*h),R=s-g,x=c-E,p=1===b.length,m=!1;i=[g,E,g+R,E,g+R,E+x,g,E+x];for(let e=0,t=P.length;e<t;++e)if(!p&&r<O[e]){let t=P[e];(0,y.intersects)([g,E,g+R,E+x],[t[0],t[3],t[4],t[7]])&&(!m&&(U.save(),m=!0),U.beginPath(),U.moveTo(i[0],i[1]),U.lineTo(i[2],i[3]),U.lineTo(i[4],i[5]),U.lineTo(i[6],i[7]),U.moveTo(t[6],t[7]),U.lineTo(t[4],t[5]),U.lineTo(t[2],t[3]),U.lineTo(t[0],t[1]),U.clip())}P.push(i),O.push(r),this.drawTile(t,e,g,E,R,x,T,p),m&&U.restore(),this.renderedTiles.unshift(t),this.updateUsedTiles(e.usedTiles,_,t)}}return this.renderedRevision=c,this.renderedResolution=E,this.extentChanged=!this.renderedExtent_||!(0,y.equals)(this.renderedExtent_,S),this.renderedExtent_=S,this.renderedPixelRatio=u,this.postRender(this.context,e),n.extent&&U.restore(),U.imageSmoothingEnabled=!0,this.renderComplete&&e.postRenderFunctions.push((e,t)=>{let i=(0,W.getUid)(_),r=t.wantedTiles[i],n=r?Object.keys(r).length:0;this.updateCacheSize(n),this.tileCache_.expireCache()}),!this.renderComplete&&!r&&(e.animate=!0),this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,2*e)}drawTile(e,t,i,r,n,o,a,l){let h;if(e instanceof _){if(!(h=s(e.getData())))throw Error("Rendering array data is not yet supported")}else h=this.getTileImage(e);if(!h)return;let u=this.getRenderContext(t),d=(0,W.getUid)(this),c=t.layerStatesArray[t.layerIndex],g=c.opacity*(l?e.getAlpha(d,t.time):1),f=g!==u.globalAlpha;f&&(u.save(),u.globalAlpha=g),u.drawImage(h,a,a,h.width-2*a,h.height-2*a,i,r,n,o),f&&u.restore(),g!==c.opacity?t.animate=!0:l&&e.endTransition(d)}getImage(){let e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,t,i){let r=(0,W.getUid)(t);!(r in e)&&(e[r]={}),e[r][i.getKey()]=!0}}var Q=q},7245:function(e,t,i){var r=i(35211),n=i(73381),o=i(24969),a=i(59900),s=i(56245),l=i(52209),h=i(21882),u=i(21915),d=i(13002),_=i(85386);class c extends o.Z{constructor(e,t,i,n,o,d,_,c,g,f,E,T){super(o,a.default.IDLE,T),this.renderEdges_=void 0!==E&&E,this.pixelRatio_=_,this.gutter_=c,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=n,this.wrappedTileCoord_=d||o,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=e.canWrapX()?e.getExtent():void 0;let R=n.getTileCoordExtent(this.wrappedTileCoord_),x=this.targetTileGrid_.getExtent(),p=this.sourceTileGrid_.getExtent(),m=x?(0,u.getIntersection)(R,x):R;if(0===(0,u.getArea)(m)){this.state=a.default.EMPTY;return}let A=e.getExtent();A&&(p=p?(0,u.getIntersection)(p,A):A);let v=n.getResolution(this.wrappedTileCoord_[0]),L=(0,l.Co)(e,i,m,v);if(!isFinite(L)||L<=0){this.state=a.default.EMPTY;return}let S=void 0!==f?f:r.m;if(this.triangulation_=new s.Z(e,i,m,p,L*S,v),0===this.triangulation_.getTriangles().length){this.state=a.default.EMPTY;return}this.sourceZ_=t.getZForResolution(L);let D=this.triangulation_.calculateSourceExtent();if(p&&(e.canWrapX()?(D[1]=(0,h.uZ)(D[1],p[1],p[3]),D[3]=(0,h.uZ)(D[3],p[1],p[3])):D=(0,u.getIntersection)(D,p)),(0,u.getArea)(D)){let i=0,r=0;e.canWrapX()&&(i=(0,u.getWidth)(A),r=Math.floor((D[0]-A[0])/i)),(0,u.wrapAndSliceX)(D.slice(),e,!0).forEach(e=>{let n=t.getTileRangeForExtentAndZ(e,this.sourceZ_);for(let e=n.minX;e<=n.maxX;e++)for(let t=n.minY;t<=n.maxY;t++){let n=g(this.sourceZ_,e,t,_);if(n){let e=r*i;this.sourceTiles_.push({tile:n,offset:e})}}++r}),0===this.sourceTiles_.length&&(this.state=a.default.EMPTY)}else this.state=a.default.EMPTY}getImage(){return this.canvas_}reproject_(){let e=[];if(this.sourceTiles_.forEach(t=>{let i=t.tile;if(i&&i.getState()==a.default.LOADED){let r=this.sourceTileGrid_.getTileCoordExtent(i.tileCoord);r[0]+=t.offset,r[2]+=t.offset;let n=this.clipExtent_?.slice();n&&(n[0]+=t.offset,n[2]+=t.offset),e.push({extent:r,clipExtent:n,image:i.getImage()})}}),this.sourceTiles_.length=0,0===e.length)this.state=a.default.ERROR;else{let t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),r="number"==typeof i?i:i[0],n="number"==typeof i?i:i[1],o=this.targetTileGrid_.getResolution(t),s=this.sourceTileGrid_.getResolution(this.sourceZ_),h=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=(0,l.sY)(r,n,this.pixelRatio_,s,this.sourceTileGrid_.getExtent(),o,h,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=a.default.LOADED}this.changed()}load(){if(this.state==a.default.IDLE){this.state=a.default.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{let i=t.getState();if(i==a.default.IDLE||i==a.default.LOADING){e++;let i=(0,d.oL)(t,n.default.CHANGE,r=>{let n=t.getState();(n==a.default.LOADED||n==a.default.ERROR||n==a.default.EMPTY)&&((0,d.bN)(i),0==--e&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(i)}}),0===e?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e},t,i){e.getState()==a.default.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(d.bN),this.sourcesListenerKeys_=null}release(){this.canvas_&&((0,_.jy)(this.canvas_.getContext("2d")),l.rX.push(this.canvas_),this.canvas_=null),super.release()}}t.Z=c}}]);
//# sourceMappingURL=6976.40f0561b9347f782.js.map