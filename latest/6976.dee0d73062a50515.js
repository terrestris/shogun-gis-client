"use strict";(self.webpackChunk_terrestris_shogun_gis_client=self.webpackChunk_terrestris_shogun_gis_client||[]).push([["6976"],{28799:function(e,t,r){r.r(t),r.d(t,{default:function(){return R}});var i=r(6908),n=r(79682),s=r(90728),a=r(85386),h=r(21915),o=r(5374),l=r(97208),d=r(82928),c=r(82777),u=r(17356),g=r(49179),p=r(43631),_=r(4722);class x extends _.Z{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=(0,h.createEmpty)(),this.wrappedRenderedExtent_=(0,h.createEmpty)(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(e,t,r){let n=t.extent,s=t.viewState,a=s.center,o=s.resolution,l=s.projection,d=s.rotation,u=l.getExtent(),g=this.getLayer().getSource(),p=this.getLayer().getDeclutter(),_=t.pixelRatio,x=t.viewHints,y=!(x[i.Z.ANIMATING]||x[i.Z.INTERACTING]),f=this.context,R=Math.round((0,h.getWidth)(n)/o*_),m=Math.round((0,h.getHeight)(n)/o*_),C=g.getWrapX()&&l.canWrapX(),D=C?(0,h.getWidth)(u):null,E=C?Math.ceil((n[2]-u[2])/D)+1:1,I=C?Math.floor((n[0]-u[0])/D):0;do{let i=this.getRenderTransform(a,o,0,_,R,m,I*D);t.declutter&&(i=i.slice(0)),e.execute(f,[f.canvas.width,f.canvas.height],i,d,y,void 0===r?c.QN:r?c.o5:c.eV,r?p&&t.declutter[p]:void 0)}while(++I<E)}setDrawContext_(){1!==this.opacity_&&(this.targetContext_=this.context,this.context=(0,a.E4)(this.context.canvas.width,this.context.canvas.height,_.r))}resetDrawContext_(){if(1!==this.opacity_&&this.targetContext_){let e=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=e,(0,a.jy)(this.context),_.r.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(e){this.replayGroup_&&this.getLayer().getDeclutter()&&this.renderWorlds(this.replayGroup_,e,!0)}renderDeferredInternal(e){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(e,t){let r=e.layerStatesArray[e.layerIndex];this.opacity_=r.opacity;let i=e.viewState;this.prepareContainer(e,t);let n=this.context,s=this.replayGroup_,a=s&&!s.isEmpty();if(!a&&!(this.getLayer().hasListener(l.Z.PRERENDER)||this.getLayer().hasListener(l.Z.POSTRENDER)))return this.container;this.setDrawContext_(),this.preRender(n,e);let d=i.projection;if(this.clipped_=!1,a&&r.extent&&this.clipping){let t=(0,o.fromUserExtent)(r.extent,d);a=(0,h.intersects)(t,e.extent),this.clipped_=a&&!(0,h.containsExtent)(t,e.extent),this.clipped_&&this.clipUnrotated(n,e,t)}return a&&this.renderWorlds(s,e,!this.getLayer().getDeclutter()&&void 0),!e.declutter&&this.clipped_&&n.restore(),this.postRender(n,e),this.renderedRotation_!==i.rotation&&(this.renderedRotation_=i.rotation,this.hitDetectionImageData_=null),e.declutter||this.resetDrawContext_(),this.container}getFeatures(e){return new Promise(t=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){let e=this.frameState.size.slice(),t=this.renderedCenter_,r=this.renderedResolution_,i=this.renderedRotation_,n=this.renderedProjection_,s=this.wrappedRenderedExtent_,a=this.getLayer(),l=[],d=e[0]*u.UN,c=e[1]*u.UN;l.push(this.getRenderTransform(t,r,i,u.UN,d,c,0).slice());let g=a.getSource(),_=n.getExtent();if(g.getWrapX()&&n.canWrapX()&&!(0,h.containsExtent)(_,s)){let e,n=s[0],a=(0,h.getWidth)(_),o=0;for(;n<_[0];)e=a*--o,l.push(this.getRenderTransform(t,r,i,u.UN,d,c,e).slice()),n+=a;for(o=0,n=s[2];n>_[2];)e=a*++o,l.push(this.getRenderTransform(t,r,i,u.UN,d,c,e).slice()),n-=a}let x=(0,o.getUserProjection)();this.hitDetectionImageData_=(0,u.TU)(e,l,this.renderedFeatures_,a.getStyleFunction(),s,r,i,(0,p.se)(r,this.renderedPixelRatio_),x?n:null)}t((0,u.ix)(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,t,r,i,n){if(!this.replayGroup_)return;let s=t.viewState.resolution,a=t.viewState.rotation,h=this.getLayer(),o={},l=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(e,s,a,r,function(e,t,r){let s=(0,g.getUid)(e),a=o[s];if(a){if(!0!==a&&r<a.distanceSq){if(0===r)return o[s]=!0,n.splice(n.lastIndexOf(a),1),i(e,h,t);a.geometry=t,a.distanceSq=r}}else{if(0===r)return o[s]=!0,i(e,h,t);n.push(o[s]={feature:e,layer:h,geometry:t,distanceSq:r,callback:i})}},l?t.declutter?.[l]?.all().map(e=>e.value):null)}handleFontsChanged(){let e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){let t,r=this.getLayer(),a=r.getSource();if(!a)return!1;let l=e.viewHints[i.Z.ANIMATING],u=e.viewHints[i.Z.INTERACTING],g=r.getUpdateWhileAnimating(),_=r.getUpdateWhileInteracting();if(this.ready&&!g&&l||!_&&u)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;let x=e.extent,y=e.viewState,f=y.projection,R=y.resolution,m=e.pixelRatio,C=r.getRevision(),D=r.getRenderBuffer(),E=r.getRenderOrder();void 0===E&&(E=p.eR);let I=y.center.slice(),w=(0,h.buffer)(x,D*R),v=w.slice(),S=[w.slice()],F=f.getExtent();if(a.getWrapX()&&f.canWrapX()&&!(0,h.containsExtent)(F,e.extent)){let e=(0,h.getWidth)(F),t=Math.max((0,h.getWidth)(w)/2,e);w[0]=F[0]-t,w[2]=F[2]+t,(0,s.wrapX)(I,f);let r=(0,h.wrapX)(S[0],f);r[0]<F[0]&&r[2]<F[2]?S.push([r[0]+e,r[1],r[2]+e,r[3]]):r[0]>F[0]&&r[2]>F[2]&&S.push([r[0]-e,r[1],r[2]-e,r[3]])}if(this.ready&&this.renderedResolution_==R&&this.renderedRevision_==C&&this.renderedRenderOrder_==E&&!!e.declutter===this.renderedFrameDeclutter_&&(0,h.containsExtent)(this.wrappedRenderedExtent_,w))return(0,n.fS)(this.renderedExtent_,v)||(this.hitDetectionImageData_=null,this.renderedExtent_=v),this.renderedCenter_=I,this.replayGroupChanged=!1,!0;this.replayGroup_=null;let G=new d.Z((0,p.Qz)(R,m),w,R,m),N=(0,o.getUserProjection)();if(N){for(let e=0,t=S.length;e<t;++e){let t=S[e],r=(0,o.toUserExtent)(t,f);a.loadFeatures(r,(0,o.toUserResolution)(R,f),N)}t=(0,o.getTransformFromProjections)(N,f)}else for(let e=0,t=S.length;e<t;++e)a.loadFeatures(S[e],R,f);let A=(0,p.se)(R,m),U=!0,W=(e,i)=>{let n,s=e.getStyleFunction()||r.getStyleFunction();if(s&&(n=s(e,R)),n){let r=this.renderFeature(e,A,n,G,t,this.getLayer().getDeclutter(),i);U=U&&!r}},P=(0,o.toUserExtent)(w,f),L=a.getFeaturesInExtent(P);E&&L.sort(E);for(let e=0,t=L.length;e<t;++e)W(L[e],e);this.renderedFeatures_=L,this.ready=U;let b=G.finish(),T=new c.ZP(w,R,m,a.getOverlaps(),b,r.getRenderBuffer(),!!e.declutter);return this.renderedResolution_=R,this.renderedRevision_=C,this.renderedRenderOrder_=E,this.renderedFrameDeclutter_=!!e.declutter,this.renderedExtent_=v,this.wrappedRenderedExtent_=w,this.renderedCenter_=I,this.renderedProjection_=f,this.renderedPixelRatio_=m,this.replayGroup_=T,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,r,i,n,s,a){if(!r)return!1;let h=!1;if(Array.isArray(r))for(let o=0,l=r.length;o<l;++o)h=(0,p.Pn)(i,e,r[o],t,this.boundHandleStyleImageChange_,n,s,a)||h;else h=(0,p.Pn)(i,e,r,t,this.boundHandleStyleImageChange_,n,s,a);return h}}var y=r(93564);class f extends y.Z{constructor(e){super(e)}createRenderer(){return new x(this)}}var R=f}}]);
//# sourceMappingURL=6976.dee0d73062a50515.js.map