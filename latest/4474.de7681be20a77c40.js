"use strict";(self.webpackChunk_terrestris_shogun_gis_client=self.webpackChunk_terrestris_shogun_gis_client||[]).push([["4474"],{38961:function(e,t,n){n.r(t),n.d(t,{CoordinateInfo:function(){return b},default:function(){return _}});var r=n(76395),l=n.n(r),i=n(69843),a=n.n(i),o=n(2543),u=n(58980),s=n.n(u),g=n(71174),c=n.n(g),f=n(25738),p=n.n(f),d=n(15784),m=n.n(d),v=n(1576),E=n.n(v),y=n(50858),h=n(82804),w=n(23712),k=n(30126);let x=e=>{let t=e.getId()??e.get("id");return(0,o.isString)(t)?t.split(".")[0]:t?.toString()??(0,o.uniqueId)("UNKNOWN")},b=({resultRenderer:e=()=>l().createElement(l().Fragment,null),...t})=>{let n=(({active:e,clickEvent:t="click",drillDown:n=!1,featureCount:l=1,fetchOpts:i={},getInfoFormat:u=()=>"application/json",layerFilter:g=()=>!0,onError:f=()=>void 0,onSuccess:d=()=>void 0,registerOnClick:v=!0,registerOnPointerMove:b=!1,registerOnPointerRest:_=!1})=>{let A=(0,k.A)(),[C,F]=(0,r.useState)(null),[S,T]=(0,r.useState)(null),[D,O]=(0,r.useState)([]),[j,I]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(A&&j)return A.getTargetElement().style.cursor="wait",()=>{A.getTargetElement().style.cursor="auto"}},[j,A]);let N=(0,r.useCallback)(e=>{if(e.dragging||a()(A))return;let t=A.getEventPixel(e.originalEvent),n=A.getAllLayers().filter(e=>g(e)).filter(e=>{let n=e.getData(t);return n&&n[3]>0});A.getTargetElement().style.cursor=n?.length>0?"pointer":""},[g,A]),P=(0,r.useCallback)(async e=>{if(a()(A))return;"dblclick"===t&&e.stopPropagation();let r=A.getView(),v=r.getResolution(),k=r.getProjection(),b=A.getEventPixel(e.originalEvent),_=e.coordinate,C=[0,0];e.originalEvent instanceof PointerEvent&&(C=[e.originalEvent.x,e.originalEvent.y]);let S=A.getAllLayers().reverse().filter(g).filter(e=>e.getData&&e.getData(b)&&(0,w.lb)(e)),D=A.getAllLayers().reverse().filter(g).filter(e=>(0,w.G5)(e));I(!0);try{let e=[];for(let t of S)try{if(!n&&e.length>0)break;let r=t.getSource();if(!r)continue;let a=await u(t),o=r.getFeatureInfoUrl(_,v,k,{INFO_FORMAT:a,FEATURE_COUNT:l});if(o){let n;n=i instanceof Function?i(t):i[(0,y.getUid)(t)];let r=await fetch(o,n),l=null,u=!1;if("application/vnd.ogc.gml"===a)l=new(E());else if(a.indexOf("gml/2")>-1)l=new(c());else if("application/vnd.ogc.gml/3.1.1"===a||"text/xml; subtype=gml/3.1.1"===a)l=new(p());else if("application/vnd.ogc.gml/3.2"===a||"text/xml; subtype=gml/3.2"===a)l=new(m());else{if(!("application/json"===a||a.indexOf("json")>-1))continue;l=new(s()),u=!0}let g=u?await r.json():await r.text();e.push(...l.readFeatures(g).map(e=>({feature:e,layer:t,featureType:x(e)})))}}catch(e){h.A.error(e)}for(let t of D){if(!n&&e.length>0)break;let r=t.getSource();r&&e.push(...r.getFeaturesAtCoordinate(_).map(e=>({feature:e,layer:t,featureType:x(e)})))}let t=(0,o.cloneDeep)(e),r=(0,o.cloneDeep)(_),a=(0,o.cloneDeep)(C);O(t),F(r),T(a),d?.({clickCoordinate:r,pixelCoordinate:a,loading:!1,features:t})}catch(e){h.A.error(e),f?.(e)}I(!1)},[t,n,l,i,u,g,A,f,d]);return(0,r.useEffect)(()=>{let n,r,l;return e&&(v&&t&&(l=A?.on(t,P)),b&&(n=A?.on("pointermove",N)),_&&(r=A?.on("pointerrest",P))),()=>{l&&t&&A?.un(t,l.listener),n&&A?.un("pointermove",n.listener),r&&A?.un("pointerrest",r.listener)}},[e,A,N,P,v,b,_,t]),{clickCoordinate:C,features:D,loading:j,pixelCoordinate:S}})(t);return a()(n)?null:l().createElement(l().Fragment,null,e(n))};var _=b}}]);
//# sourceMappingURL=4474.de7681be20a77c40.js.map