{"version":3,"file":"3759.c334b23331faaf17.js","sources":["webpack://@terrestris/shogun-gis-client/./node_modules/@terrestris/react-geo/dist/Legend/Legend.js","webpack://@terrestris/shogun-gis-client/./node_modules/@terrestris/react-geo/dist/constants.js"],"sourcesContent":["import { faCircleNotch } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport Logger from '@terrestris/base-util/dist/Logger';\nimport MapUtil from '@terrestris/ol-util/dist/MapUtil/MapUtil';\nimport { Spin } from 'antd';\nimport * as React from 'react';\nimport { useCallback, useEffect, useState } from 'react';\nimport { CSS_PREFIX } from '../constants';\n/**\n * Get the corresponding legendGraphic of a layer. If layer is configured with\n * \"legendUrl\" this will be used. Otherwise a getLegendGraphic requestString\n * will be created by the MapUtil.\n *\n * @param legendLayer The layer to get the legend graphic request for.\n * @param params The extra params.\n */\nconst getLegendUrl = (legendLayer, params) => {\n    let url;\n    if (legendLayer.get('legendUrl')) {\n        url = legendLayer.get('legendUrl');\n    }\n    else {\n        url = MapUtil.getLegendGraphicUrl(legendLayer, params);\n    }\n    return url;\n};\n/**\n * Class representing the Legend.\n *\n * @class Legend\n * @extends React.Component\n */\nexport const Legend = ({ className, layer, extraParams, onError, errorMsg, headers, loadingMask = true, ...passThroughProps }) => {\n    // eslint-disable-next-line\n    const [imgSrc, setImgSrc] = useState('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=');\n    const [legendUrl, setLegendUrl] = useState(getLegendUrl(layer, extraParams));\n    const [legendError, setLegendError] = useState(false);\n    const [loading, setLoading] = useState(false);\n    const handleError = useCallback((e) => {\n        Logger.warn(`Image error for legend of \"${layer.get('name')}\".`);\n        setLegendError(true);\n        if (onError) {\n            onError(e);\n        }\n    }, [layer, onError]);\n    const setLegendSrc = useCallback(async () => {\n        try {\n            setLoading(true);\n            const response = await fetch(legendUrl, {\n                headers\n            });\n            if (!response.ok) {\n                throw new Error('No successful response returned while getting the legend graphic');\n            }\n            const responseBlob = await response.blob();\n            setImgSrc(previousImgSrc => {\n                URL.revokeObjectURL(previousImgSrc);\n                return URL.createObjectURL(responseBlob);\n            });\n        }\n        catch (error) {\n            Logger.error('Error while setting the img src: ', error);\n            handleError(error);\n        }\n        finally {\n            setLoading(false);\n        }\n    }, [handleError, headers, legendUrl]);\n    useEffect(() => {\n        setLegendSrc();\n    }, [setLegendSrc]);\n    useEffect(() => {\n        setLegendUrl(getLegendUrl(layer, extraParams));\n    }, [layer, extraParams, setLegendSrc]);\n    const alt = layer.get('name')\n        ? layer.get('name') + ' legend'\n        : 'layer legend';\n    return (React.createElement(\"div\", { className: `${CSS_PREFIX}legend ${className ? className : ''}`, ...passThroughProps },\n        React.createElement(Spin, { spinning: loadingMask ? loading : false, indicator: (React.createElement(FontAwesomeIcon, { icon: faCircleNotch })) }, legendError ?\n            React.createElement(\"div\", { className: 'legend-load-error' }, errorMsg)\n            :\n                React.createElement(\"img\", { src: imgSrc, alt: alt, onError: handleError.bind(this) }))));\n};\nexport default Legend;\n//# sourceMappingURL=Legend.js.map","const CSS_PREFIX = 'react-geo-';\nexport { CSS_PREFIX };\n//# sourceMappingURL=constants.js.map"],"names":["getLegendUrl","legendLayer","params","url","Legend","className","layer","extraParams","onError","errorMsg","headers","loadingMask","passThroughProps","imgSrc","setImgSrc","legendUrl","setLegendUrl","legendError","setLegendError","loading","setLoading","handleError","e","setLegendSrc","response","fetch","Error","responseBlob","previousImgSrc","URL","error","alt","CSS_PREFIX"],"mappings":"mRAgBA,IAAMA,EAAe,CAACC,EAAaC,KAC/B,IAAIC,EAOJ,OALIA,EADAF,EAAY,GAAG,CAAC,aACVA,EAAY,GAAG,CAAC,aAGhB,uBAA2B,CAACA,EAAaC,EAGvD,EAOaE,EAAS,CAAC,CAAEC,UAAAA,CAAS,CAAEC,MAAAA,CAAK,CAAEC,YAAAA,CAAW,CAAEC,QAAAA,CAAO,CAAEC,SAAAA,CAAQ,CAAEC,QAAAA,CAAO,CAAEC,YAAAA,EAAc,EAAI,CAAE,GAAGC,EAAkB,IAEzH,GAAM,CAACC,EAAQC,EAAU,CAAG,eAAS,sHAC/B,CAACC,EAAWC,EAAa,CAAG,eAAShB,EAAaM,EAAOC,IACzD,CAACU,EAAaC,EAAe,CAAG,eAAS,IACzC,CAACC,EAASC,EAAW,CAAG,eAAS,IACjCC,EAAc,kBAAY,AAACC,IAC7B,QAAW,CAAC,CAAC,2BAA2B,EAAEhB,EAAM,GAAG,CAAC,QAAQ,EAAE,CAAC,EAC/DY,EAAe,IACXV,GACAA,EAAQc,EAEhB,EAAG,CAAChB,EAAOE,EAAQ,EACbe,EAAe,kBAAY,UAC7B,GAAI,CACAH,EAAW,IACX,IAAMI,EAAW,MAAMC,MAAMV,EAAW,CACpCL,QAAAA,CACJ,GACA,GAAI,CAACc,EAAS,EAAE,CACZ,MAAM,AAAIE,MAAM,oEAEpB,IAAMC,EAAe,MAAMH,EAAS,IAAI,GACxCV,EAAUc,IACNC,IAAI,eAAe,CAACD,GACbC,IAAI,eAAe,CAACF,IAEnC,CACA,MAAOG,EAAO,CACV,SAAY,CAAC,oCAAqCA,GAClDT,EAAYS,EAChB,QACQ,CACJV,EAAW,GACf,CACJ,EAAG,CAACC,EAAaX,EAASK,EAAU,EACpC,gBAAU,KACNQ,GACJ,EAAG,CAACA,EAAa,EACjB,gBAAU,KACNP,EAAahB,EAAaM,EAAOC,GACrC,EAAG,CAACD,EAAOC,EAAagB,EAAa,EACrC,IAAMQ,EAAMzB,EAAM,GAAG,CAAC,QAChBA,EAAM,GAAG,CAAC,QAAU,UACpB,eACN,OAAQ,eAAmB,CAAC,MAAO,CAAE,UAAW,CAAC,EAAE,GAAU,CAAC,OAAO,EAAED,GAAwB,GAAG,CAAC,CAAE,GAAGO,CAAgB,AAAC,EACrH,eAAmB,CAAC,GAAI,CAAE,CAAE,SAAUD,EAAAA,GAAcQ,EAAiB,UAAY,eAAmB,CAAC,GAAe,CAAE,CAAE,KAAM,KAAa,AAAC,EAAI,EAAGF,EAC/I,eAAmB,CAAC,MAAO,CAAE,UAAW,mBAAoB,EAAGR,GAE3D,eAAmB,CAAC,MAAO,CAAE,IAAKI,EAAQ,IAAKkB,EAAK,QAASV,EAAY,IAAI,CAAC,OAAM,IACpG,CACA,WAAejB,C,wDCnFf,IAAM4B,EAAa,Y"}