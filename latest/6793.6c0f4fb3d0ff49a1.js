"use strict";(self.webpackChunk_terrestris_shogun_gis_client=self.webpackChunk_terrestris_shogun_gis_client||[]).push([["6793"],{55453:function(e,t,n){n.r(t),n.d(t,{CoordinateInfo:function(){return b},default:function(){return C}});var r=n(9948),l=n.n(r),i=n(14293),a=n.n(i),o=n(96486),u=n(38450),s=n.n(u),g=n(41235),c=n.n(g),f=n(39907),p=n.n(f),d=n(95829),m=n.n(d),v=n(76676),E=n.n(v),y=n(98508),h=n(12038),w=n(42212),k=n(39660);let x=e=>{let t=e.getId()??e.get("id");return(0,o.isString)(t)?t.split(".")[0]:t?.toString()??(0,o.uniqueId)("UNKNOWN")};var _=({active:e,clickEvent:t="click",drillDown:n=!1,featureCount:l=1,fetchOpts:i={},getInfoFormat:u=()=>"application/json",layerFilter:g=()=>!0,onError:f=()=>void 0,onSuccess:d=()=>void 0,registerOnClick:v=!0,registerOnPointerMove:_=!1,registerOnPointerRest:b=!1})=>{let C=(0,k.Z)(),[F,S]=(0,r.useState)(null),[T,A]=(0,r.useState)(null),[D,O]=(0,r.useState)([]),[j,I]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(C&&j)return C.getTargetElement().style.cursor="wait",()=>{C.getTargetElement().style.cursor="auto"}},[j,C]);let N=(0,r.useCallback)(e=>{if(e.dragging||a()(C))return;let t=C.getEventPixel(e.originalEvent),n=C.getAllLayers().filter(e=>g(e)).filter(e=>{let n=e.getData(t);return n&&n[3]>0});C.getTargetElement().style.cursor=n?.length>0?"pointer":""},[g,C]),P=(0,r.useCallback)(async e=>{if(a()(C))return;"dblclick"===t&&e.stopPropagation();let r=C.getView(),v=r.getResolution(),k=r.getProjection(),_=C.getEventPixel(e.originalEvent),b=e.coordinate,F=[0,0];e.originalEvent instanceof PointerEvent&&(F=[e.originalEvent.x,e.originalEvent.y]);let T=C.getAllLayers().reverse().filter(g).filter(e=>e.getData&&e.getData(_)&&(0,w.us)(e)),D=C.getAllLayers().reverse().filter(g).filter(e=>(0,w.tm)(e));I(!0);try{let e=[];for(let t of T)try{if(!n&&e.length>0)break;let r=t.getSource();if(!r)continue;let a=await u(t),o=r.getFeatureInfoUrl(b,v,k,{INFO_FORMAT:a,FEATURE_COUNT:l});if(o){let n;n=i instanceof Function?i(t):i[(0,y.getUid)(t)];let r=await fetch(o,n),l=null,u=!1;if("application/vnd.ogc.gml"===a)l=new(E());else if(a.indexOf("gml/2")>-1)l=new(c());else if("application/vnd.ogc.gml/3.1.1"===a||"text/xml; subtype=gml/3.1.1"===a)l=new(p());else if("application/vnd.ogc.gml/3.2"===a||"text/xml; subtype=gml/3.2"===a)l=new(m());else{if(!("application/json"===a||a.indexOf("json")>-1))continue;l=new(s()),u=!0}let g=u?await r.json():await r.text();e.push(...l.readFeatures(g).map(e=>({feature:e,layer:t,featureType:x(e)})))}}catch(e){h.Z.error(e)}for(let t of D){if(!n&&e.length>0)break;let r=t.getSource();r&&e.push(...r.getFeaturesAtCoordinate(b).map(e=>({feature:e,layer:t,featureType:x(e)})))}let t=(0,o.cloneDeep)(e),r=(0,o.cloneDeep)(b),a=(0,o.cloneDeep)(F);O(t),S(r),A(a),d?.({clickCoordinate:r,pixelCoordinate:a,loading:!1,features:t})}catch(e){h.Z.error(e),f?.(e)}I(!1)},[t,n,l,i,u,g,C,f,d]);return(0,r.useEffect)(()=>{let n,r,l;return e&&(v&&t&&(l=C?.on(t,P)),_&&(n=C?.on("pointermove",N)),b&&(r=C?.on("pointerrest",P))),()=>{l&&t&&C?.un(t,l.listener),n&&C?.un("pointermove",n.listener),r&&C?.un("pointerrest",r.listener)}},[e,C,N,P,v,_,b,t]),{clickCoordinate:F,features:D,loading:j,pixelCoordinate:T}};let b=({resultRenderer:e=()=>l().createElement(l().Fragment,null),...t})=>{let n=_(t);return a()(n)?null:l().createElement(l().Fragment,null,e(n))};var C=b}}]);
//# sourceMappingURL=6793.6c0f4fb3d0ff49a1.js.map