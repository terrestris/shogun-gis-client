"use strict";(self.webpackChunk_terrestris_shogun_gis_client=self.webpackChunk_terrestris_shogun_gis_client||[]).push([["2034"],{19473:function(e,t,r){r.d(t,{T:function(){return n}});class i{constructor(e,t,r,i){this.minX=e,this.maxX=t,this.minY=r,this.maxY=i}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function n(e,t,r,n,o){return void 0!==o?(o.minX=e,o.maxX=t,o.minY=r,o.maxY=n,o):new i(e,t,r,n)}t.Z=i},4027:function(e,t,r){r.d(t,{W:function(){return i}});function i(e,t,r,i){let n=e[t],o=e[t+1],l=0;for(let s=t+i;s<r;s+=i){let t=e[s],r=e[s+1];l+=Math.sqrt((t-n)*(t-n)+(r-o)*(r-o)),n=t,o=r}return l}},71418:function(e,t,r){r.r(t),r.d(t,{default:function(){return E}});var i=r("38906"),n=r("59900"),o=r("6908"),l=r("79682"),s=r("90728"),a=r("21915"),d=r("82928"),h=r("82777"),u=r("33162"),g=r("17356"),c=r("50596"),m=r("82359"),f=r("49179"),T=r("43631"),p=r("68163");let x={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},R={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class y extends p.Z{constructor(e,t){super(e,t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=(0,m.Ue)(),this.tileClipContexts_=null}drawTile(e,t,r,i,n,o,l,s){this.updateExecutorGroup_(e,t.pixelRatio,t.viewState.projection),this.tileImageNeedsRender_(e)&&this.renderTileImage_(e,t),super.drawTile(e,t,r,i,n,o,l,s)}getTile(e,t,r,i){let n=this.getOrCreateTile(e,t,r,i);if(!n)return null;let l=i.viewState.resolution,s=i.viewHints;return(!(s[o.Z.ANIMATING]||s[o.Z.INTERACTING])||!n.wantedResolution)&&(n.wantedResolution=l),n}prepareFrame(e){let t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,r){let i=this.getLayer(),o=i.getRevision(),l=i.getRenderOrder()||null,s=e.wantedResolution,u=e.getReplayState(i);if(!u.dirty&&u.renderedResolution===s&&u.renderedRevision==o&&u.renderedRenderOrder==l)return;let g=i.getSource(),c=!!i.getDeclutter(),m=g.getTileGrid(),p=g.getTileGridForProjection(r).getTileCoordExtent(e.wrappedTileCoord),x=g.getSourceTiles(t,r,e),R=(0,f.getUid)(i);delete e.hitDetectionImageData[R],e.executorGroups[R]=[],u.dirty=!1;for(let r=0,o=x.length;r<o;++r){let o=x[r];if(o.getState()!=n.default.LOADED)continue;let f=o.tileCoord,y=m.getTileCoordExtent(f),C=(0,a.getIntersection)(p,y),v=(0,a.buffer)(C,i.getRenderBuffer()*s,this.tempExtent),S=(0,a.equals)(y,C)?null:v,E=new d.Z(0,C,s,t),I=(0,T.se)(s,t),_=function(e,t){let r;let n=e.getStyleFunction()||i.getStyleFunction();if(n&&(r=n(e,s)),r){let i=this.renderFeature(e,I,r,E,c,t);u.dirty=u.dirty||i}},w=o.getFeatures();l&&l!==u.renderedRenderOrder&&w.sort(l);for(let e=0,t=w.length;e<t;++e){let t=w[e];(!S||(0,a.intersects)(S,t.getGeometry().getExtent()))&&_.call(this,t,e)}let b=E.finish(),X="vector"!==i.getRenderMode()&&c&&1===x.length?null:C,A=new h.ZP(X,s,t,g.getOverlaps(),b,i.getRenderBuffer(),!0);e.executorGroups[R].push(A)}u.renderedRevision=o,u.renderedRenderOrder=l,u.renderedResolution=s}forEachFeatureAtCoordinate(e,t,r,i,n){let o;let l=t.viewState.resolution,s=t.viewState.rotation;r=void 0==r?0:r;let d=this.getLayer(),h=d.getSource().getTileGridForProjection(t.viewState.projection),u=(0,a.boundingExtent)([e]);(0,a.buffer)(u,l*r,u);let g={},c=function(e,t,r){let o=e.getId();void 0===o&&(o=(0,f.getUid)(e));let l=g[o];if(l){if(!0!==l&&r<l.distanceSq){if(0===r)return g[o]=!0,n.splice(n.lastIndexOf(l),1),i(e,d,t);l.geometry=t,l.distanceSq=r}}else{if(0===r)return g[o]=!0,i(e,d,t);n.push(g[o]={feature:e,layer:d,geometry:t,distanceSq:r,callback:i})}},m=this.renderedTiles,T=(0,f.getUid)(d),p=d.getDeclutter(),x=p?t.declutter?.[p]?.all().map(e=>e.value):null;e:for(let t=0,i=m.length;t<i;++t){let i=m[t],n=h.getTileCoordExtent(i.wrappedTileCoord);if(!(0,a.intersects)(n,u))continue;let d=i.executorGroups[T];for(let t=0,i=d.length;t<i;++t)if(o=d[t].forEachFeatureAtCoordinate(e,l,s,r,c,x))break e}return o}getFeatures(e){return 0===this.renderedTiles.length?Promise.resolve([]):new Promise((t,r)=>{let i=this.getLayer(),o=i.getSource(),l=this.renderedProjection,d=l.getExtent(),h=this.renderedResolution,u=o.getTileGridForProjection(l),T=(0,m.nn)(this.renderedPixelToCoordinateTransform_,e.slice()),p=u.getTileCoordForCoordAndResolution(T,h).toString(),x=this.renderedTiles.find(e=>e.tileCoord.toString()===p&&e.getState()===n.default.LOADED);if(!x||x.loadingSourceTiles>0){t([]);return}o.getWrapX()&&l.canWrapX()&&!(0,a.containsExtent)(d,u.getTileCoordExtent(x.tileCoord))&&(0,s.wrapX)(T,l);let R=(0,f.getUid)(i),y=u.getTileCoordExtent(x.wrappedTileCoord),C=(0,a.getTopLeft)(y),v=[(T[0]-C[0])/h,(C[1]-T[1])/h],S=x.getSourceTiles().reduce((e,t)=>e.concat(t.getFeatures()),[]),E=x.hitDetectionImageData[R];if(!E){let e=(0,c.Pq)(u.getTileSize(u.getZForResolution(h,o.zDirection))),t=this.renderedRotation_,r=[this.getRenderTransform(u.getTileCoordCenter(x.wrappedTileCoord),h,0,g.UN,e[0]*g.UN,e[1]*g.UN,0)];E=(0,g.TU)(e,r,S,i.getStyleFunction(),u.getTileCoordExtent(x.wrappedTileCoord),x.getReplayState(i).renderedResolution,t),x.hitDetectionImageData[R]=E}t((0,g.ix)(v,S,E))})}getFeaturesInExtent(e){let t=[],r=this.getTileCache();if(0===r.getCount())return t;let i=this.getLayer().getSource().getTileGridForProjection(this.frameState.viewState.projection),o=i.getZForResolution(this.renderedResolution),l={};return r.forEach(r=>{if(r.tileCoord[0]!==o||r.getState()!==n.default.LOADED)return;let s=r.getSourceTiles();for(let r=0,n=s.length;r<n;++r){let n=s[r],o=n.getKey();if(o in l)continue;l[o]=!0;let d=n.tileCoord;if((0,a.intersects)(e,i.getTileCoordExtent(d))){let r=n.getFeatures();if(r)for(let i=0,n=r.length;i<n;++i){let n=r[i],o=n.getGeometry();(0,a.intersects)(e,o.getExtent())&&t.push(n)}}}}),t}handleFontsChanged(){let e=this.getLayer();e.getVisible()&&void 0!==this.renderedLayerRevision_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e,t){let r=this.context,i=r.globalAlpha;r.globalAlpha=t.opacity;let n=e.viewHints,l=!(n[o.Z.ANIMATING]||n[o.Z.INTERACTING]),s=[this.context.canvas.width,this.context.canvas.height],a=this.getLayer().getDeclutter(),d=a?e.declutter?.[a]:void 0,u=(0,f.getUid)(this.getLayer()),g=this.renderedTiles;for(let t=0,r=g.length;t<r;++t){let r=g[t],i=r.executorGroups[u];if(i)for(let t=i.length-1;t>=0;--t)i[t].execute(this.context,s,this.getTileRenderTransform(r,e),e.viewState.rotation,l,h.o5,d)}r.globalAlpha=i}renderDeferredInternal(e){let t=this.renderedTiles,r=(0,f.getUid)(this.getLayer()),i=t.reduce((e,t,i)=>(t.executorGroups[r].forEach(t=>e.push({executorGroup:t,index:i})),e),[]),n=i.map(({executorGroup:e})=>e.getDeferredZIndexContexts()),o={};for(let e=0,t=i.length;e<t;++e){let t=i[e].executorGroup.getDeferredZIndexContexts();for(let e in t)o[e]=!0}Object.keys(o).map(Number).sort(l.j2).forEach(e=>{n.forEach((t,r)=>{if(!!t[e])t[e].forEach(e=>{let{executorGroup:t,index:n}=i[r],o=t.getRenderedContext(),l=o.globalAlpha;o.globalAlpha=this.renderedOpacity_;let s=this.tileClipContexts_[n];s&&s.draw(o),e.draw(o),s&&o.restore(),o.globalAlpha=l,e.clear()}),t[e].length=0})})}getTileRenderTransform(e,t){let r=t.pixelRatio,i=t.viewState,n=i.center,o=i.resolution,l=i.rotation,s=t.size,a=Math.round(s[0]*r),d=Math.round(s[1]*r),h=this.getLayer().getSource().getTileGridForProjection(t.viewState.projection),u=e.tileCoord,g=h.getTileCoordExtent(e.wrappedTileCoord),c=h.getTileCoordExtent(u,this.tempExtent)[0]-g[0];return(0,m.Jp)((0,m.bA)(this.inversePixelTransform.slice(),1/r,1/r),this.getRenderTransform(n,o,l,r,a,d,c))}postRender(e,t){let r=t.viewHints,i=!(r[o.Z.ANIMATING]||r[o.Z.INTERACTING]);this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation,this.renderedOpacity_=t.layerStatesArray[t.layerIndex].opacity;let n=this.getLayer(),l=n.getRenderMode(),s=e.globalAlpha;e.globalAlpha=this.renderedOpacity_;let d=n.getDeclutter(),g=d?R[l].filter(e=>!h.o5.includes(e)):R[l],c=t.viewState,m=c.rotation,T=n.getSource(),p=T.getTileGridForProjection(c.projection).getZForResolution(c.resolution,T.zDirection),x=this.renderedTiles,y=[],C=[],v=[],S=(0,f.getUid)(n),E=!0;for(let r=x.length-1;r>=0;--r){let o;let l=x[r];E=E&&!l.getReplayState(n).dirty;let s=l.executorGroups[S].filter(e=>e.hasExecutors(g));if(0===s.length)continue;let h=this.getTileRenderTransform(l,t),c=l.tileCoord[0],f=!1,T=s[0].getClipCoords(h),R=e;if(T){R=(o=new u.Z).getContext();for(let e=0,t=y.length;e<t;++e)if(p!==c&&c<C[e]){let t=y[e];(0,a.intersects)([T[0],T[3],T[4],T[7]],[t[0],t[3],t[4],t[7]])&&(!f&&(R.save(),f=!0),R.beginPath(),R.moveTo(T[0],T[1]),R.lineTo(T[2],T[3]),R.lineTo(T[4],T[5]),R.lineTo(T[6],T[7]),R.moveTo(t[6],t[7]),R.lineTo(t[4],t[5]),R.lineTo(t[2],t[3]),R.lineTo(t[0],t[1]),R.clip())}y.push(T),C.push(c)}for(let r=0,n=s.length;r<n;++r)s[r].execute(e,[e.canvas.width,e.canvas.height],h,m,i,g,t.declutter?.[d]);f&&(R===e?R.restore():v[r]=o)}e.globalAlpha=s,this.ready=E,this.tileClipContexts_=v,!t.declutter&&this.renderDeferredInternal(t),super.postRender(e,t)}renderFeature(e,t,r,i,n,o){if(!r)return!1;let l=!1;if(Array.isArray(r))for(let s=0,a=r.length;s<a;++s)l=(0,T.Pn)(i,e,r[s],t,this.boundHandleStyleImageChange_,void 0,n,o)||l;else l=(0,T.Pn)(i,e,r,t,this.boundHandleStyleImageChange_,void 0,n,o);return l}tileImageNeedsRender_(e){let t=this.getLayer();if("vector"===t.getRenderMode())return!1;let r=e.getReplayState(t),i=t.getRevision(),n=e.wantedResolution;return r.renderedTileResolution!==n||r.renderedTileRevision!==i}renderTileImage_(e,t){let r=this.getLayer(),i=e.getReplayState(r),n=r.getRevision(),o=e.executorGroups[(0,f.getUid)(r)];i.renderedTileRevision=n;let l=e.wrappedTileCoord,s=l[0],a=r.getSource(),d=t.pixelRatio,h=t.viewState.projection,u=a.getTileGridForProjection(h),g=u.getResolution(e.tileCoord[0]),c=t.pixelRatio/e.wantedResolution*g,T=u.getResolution(s),p=e.getContext();d=Math.round(Math.max(d,c/d));let R=a.getTilePixelSize(s,d,h);p.canvas.width=R[0],p.canvas.height=R[1];let y=d/c;if(1!==y){let e=(0,m.mc)(this.tmpTransform_);(0,m.bA)(e,y,y),p.setTransform.apply(p,e)}let C=u.getTileCoordExtent(l,this.tempExtent),v=c/T,S=(0,m.mc)(this.tmpTransform_);(0,m.bA)(S,v,-v),(0,m.Iu)(S,-C[0],-C[3]);for(let e=0,t=o.length;e<t;++e)o[e].execute(p,[p.canvas.width*y,p.canvas.height*y],S,0,!0,x[r.getRenderMode()],null);i.renderedTileResolution=e.wantedResolution}}var C=r("93564"),v=r("71534");class S extends C.Z{constructor(e){let t=Object.assign({},e=e||{});delete t.preload;let r=void 0===e.cacheSize?0:e.cacheSize;delete e.cacheSize,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=r;let n=e.renderMode||"hybrid";(0,i.h)("hybrid"==n||"vector"==n,"`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=n,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(void 0===e.useInterimTilesOnError||e.useInterimTilesOnError),this.getBackground,this.setBackground}createRenderer(){return new y(this,{cacheSize:this.cacheSize_})}getFeatures(e){return super.getFeatures(e)}getFeaturesInExtent(e){return this.getRenderer().getFeaturesInExtent(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(v.Z.PRELOAD)}getUseInterimTilesOnError(){return this.get(v.Z.USE_INTERIM_TILES_ON_ERROR)}setPreload(e){this.set(v.Z.PRELOAD,e)}setUseInterimTilesOnError(e){this.set(v.Z.USE_INTERIM_TILES_ON_ERROR,e)}}var E=S},70701:function(e,t,r){function i(e,t,r,i){return void 0!==i?(i[0]=e,i[1]=t,i[2]=r,i):[e,t,r]}function n(e,t,r){return e+"/"+t+"/"+r}function o(e){return function(e,t,r){return(t<<e)+r}(e[0],e[1],e[2])}r.d(t,{T9:function(){return i},lg:function(){return n},tE:function(){return l},vp:function(){return o}});function l(e,t){let r=e[0],i=e[1],n=e[2];if(t.getMinZoom()>r||r>t.getMaxZoom())return!1;let o=t.getFullTileRange(r);return!o||o.containsXY(i,n)}}}]);
//# sourceMappingURL=2034.25182d1f66cf922d.js.map