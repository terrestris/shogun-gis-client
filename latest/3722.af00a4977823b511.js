"use strict";(self.webpackChunk_terrestris_shogun_gis_client=self.webpackChunk_terrestris_shogun_gis_client||[]).push([["3722"],{60636:function(e,r,t){t.r(r),t.d(r,{App:function(){return aH},default:function(){return aX}});var a=t(58106),n=t(32206),l=t(91439),i=t(46439),s=t(85893),o=t(9948),u=t.n(o),c=t(92485),d=t(87719),p=t(65353),f=t(79718),m=t(58155),g=t(64614),h=t(32676),y=t(88983),v=t(62530),x=t(49179),b=t(55405),j=t.n(b),w=t(58875),S=t.n(w),_=t(10961),C=t.n(_),E=t(29435),N=t(12038),k=t(92212),L=t(49413),T=t(54388),P=t(53573),F=t.n(P),Z=t(39660),D=t(4649),M=()=>(0,D.useDispatch)(),A=D.useSelector,O=t(56511),U=e=>{var r=(0,a._)({},(0,n._)(e)),t=(0,d._)((0,o.useState)(!1),2),u=t[0],b=t[1],w=(0,d._)((0,o.useState)([]),2),_=w[0],P=w[1],D=(0,d._)((0,o.useState)([]),2),U=D[0],I=D[1],$=(0,d._)((0,o.useState)(""),2),R=$[0],G=$[1],B=(0,d._)((0,o.useState)("https://sgx.geodatenzentrum.de/wms_topplus_open"),2),V=B[0],J=B[1],z=(0,d._)((0,o.useState)(),2),W=z[0],K=z[1],q=(0,d._)((0,o.useState)("1.3.0"),2),Y=q[0],H=q[1],X=A(e=>e.addLayerModal.visible),Q=M(),ee=(0,Z.S)(),er=(0,E.useTranslation)().t;(0,o.useEffect)(()=>{X&&K(k.V.createValidGetCapabilitiesRequest(V,"WMS",Y))},[Y,X,V]);var et=()=>{I([]),P([]),Q((0,O.Cp)())},ea=e=>{if(ee){var r=er("AddLayerModal.externalWmsFolder"),t=T.C.getLayerByName(ee,r),a=!!t;if(t||(t=new(j())({layers:[]})).set("name",r),e.forEach(e=>{if(!t.getLayers().getArray().includes(e)){if(e.set("isExternalLayer",!0),e instanceof S()&&(a=null==(n=e.getSource())?void 0:n.getUrl()),e instanceof C()){var r,a,n,l,i=null==(l=e.getSource())?void 0:l.getUrls();a=(null==i?void 0:i.length)===1?i[0]:void 0}var s={name:e.get("name"),type:e instanceof C()?"TILEWMS":"WMS",opacity:e.getOpacity(),sourceConfig:{layerNames:null==(r=e.getSource())?void 0:r.getParams().LAYERS,url:a,useBearerToken:!1}};e.set("layerConfig",s),t.getLayers().push(e)}}),!a){var n=ee.getLayerGroup().getLayers();n.insertAt((null==n?void 0:n.getLength())||0,t)}et()}};return(0,s.jsxs)(m.Z,(0,i._)((0,l._)({className:"add-layer-modal",title:er("AddLayerModal.title"),open:X,onCancel:et,width:600,footer:[(0,s.jsx)(F(),{"aria-label":"add-all",disabled:(null==_?void 0:_.length)<1,onClick:()=>{ea(_)},children:er("AddLayerModal.addAllLayers")},"add-all"),(0,s.jsx)(F(),{"aria-label":"add-selected",disabled:(null==U?void 0:U.length)<1,onClick:()=>{ea(_.filter(e=>U.includes((0,x.getUid)(e))))},children:er("AddLayerModal.addSelectedLayers")},"add-selected")]},r),{children:[(0,s.jsx)("span",{children:er("AddLayerModal.requestWmsGetCapabilitiesInstruction")}),(0,s.jsx)(g.Z.Search,{"aria-label":"input-search",className:"url-input",placeholder:er("AddLayerModal.inputPlaceholder"),value:V,onChange:e=>{var r=e.target.value;G(k.V.isValid(r.trim())?"":"error"),J(e.target.value)},onSearch:()=>(0,c._)(function(){var e,r;return(0,p.Jh)(this,function(t){switch(t.label){case 0:if(!W)return[2];t.label=1;case 1:return t.trys.push([1,3,4,5]),b(!0),[4,L.Z.getWmsCapabilities(W)];case 2:return e=t.sent(),P(L.Z.getLayersFromWmsCapabilities(e,"Title")),[3,5];case 3:return r=t.sent(),f.ZP.error({message:er("AddLayerModal.errorMessage"),description:er("AddLayerModal.errorDescription")}),N.Z.error(r),[3,5];case 4:return b(!1),[7];case 5:return[2]}})})(),status:R,enterButton:!0,addonBefore:(0,s.jsx)(h.Z,{"aria-label":"select-version",defaultValue:"1.3.0",onChange:H,options:[{value:"1.3.0",label:`${er("AddLayerModal.version")} 1.3.0`},{value:"1.1.1",label:`${er("AddLayerModal.version")} 1.1.1`}]})}),""!==R&&(0,s.jsx)(y.Z,{className:"error",children:er("AddLayerModal.invalidUrlErrorMsg")}),(0,s.jsx)(v.Z,{"aria-label":"wms-table",loading:u,columns:[{title:er("AddLayerModal.columnTitle"),render:(e,r)=>r.get("title")}],scroll:{y:250},rowKey:e=>(0,x.getUid)(e),rowSelection:{selectedRowKeys:U,onChange:I},pagination:!1,dataSource:_})]}))},I=t(44568),$=t(89282),R=t(15180),G=()=>(0,o.useContext)(R.ZP),B=e=>{var r=(0,a._)({},(0,n._)(e)),t=(0,Z.S)(),u=G(),c=(0,E.useTranslation)(),d=c.t,p=c.i18n;(0,o.useEffect)(()=>{if(t){var e=T.C.getLayersByProperty(t,"isExternalLayerGroup",!0);if((null==e?void 0:e.length)===1){var r=e[0],a=e[0].get("name");r.set("name",d("AddLayerModal.externalWmsFolder"));var n=new I.ObjectEvent("change:layers","name",a);r.dispatchEvent(n)}}},[p.language,t,d]);var f=[];return(u&&u.forEach(e=>{var r;if((r=e.integration)&&"map"===r.placement){var t=e.key,a=e.wrappedComponent;f.push((0,s.jsx)(a,{},t))}}),t)?(0,s.jsx)($.MapComponent,(0,i._)((0,l._)({map:t},r),{children:f})):(0,s.jsx)(s.Fragment,{})},V=t(30143),J=()=>{var e=G(),r=(0,E.useTranslation)().t,t=()=>{var r=null;return e.forEach(e=>{var t;if((t=e.integration)&&"cookie-banner"===t.placement){var a=e.key,n=e.wrappedComponent;r=(0,s.jsx)(n,{},a)}}),r};return(0,s.jsx)(V.Gk,{disableStyles:!0,location:"bottom",buttonText:r("CookieBanner.button"),cookieName:"SHOGun-Session-Cookie",buttonClasses:"cookie-button",containerClasses:"cookie-container",contentClasses:"cookie-content",expires:150,children:t()?t():r("CookieBanner.info")},"default-cookie-consent")},z=t(33357),W=t(87617),K=t.n(W),q=t(16120),Y=t.n(q),H=t(68191),X=t(24955),Q=t.n(X),ee=t(74958),er=t.n(ee),et=t(78459),ea=t(71797),en=()=>{var e=(0,ea.Z)();return(0,o.useCallback)(r=>(0,c._)(function(){var t,a,n,i,s,o,u;return(0,p.Jh)(this,function(c){switch(c.label){case 0:if((n=r.layer.getSource())instanceof Q()&&(a=n.getUrl()),n instanceof er()&&(a=(i=n.getUrls())?i[0]:void 0),!a)return[2];return a.endsWith("?")&&(a=a.slice(0,-1)),s={"Content-Type":"application/xml"},[4,fetch(a,{method:"POST",headers:(null==(t=r.layer)?void 0:t.get("useBearerToken"))?(0,l._)({},s,(0,et.a)(null==e?void 0:e.getKeycloak())):s,body:new XMLSerializer().serializeToString(r.transaction)})];case 1:if(!(o=c.sent()).ok)throw Error("No successful response while executing a WFS-Transaction");return[4,o.text()];case 2:var d;if(u=c.sent(),d=new DOMParser().parseFromString(u,"text/xml"),["wfs:FAILED","ows:ExceptionReport"].some(e=>d.getElementsByTagName(e).length>0))throw Error(`Something failed: ${u}`);return[2,u]}})})(),[e])},el=t(27484),ei=t.n(el),es=t(50361),eo=t.n(es),eu=t(28287),ec=t(39244),ed=t.n(ec),ep=t(91007),ef=t(71490),em=t(19478),eg=t(80264),eh=t(36192),ey=t(96973),ev=t(23279),ex=t.n(ev),eb=t(14293),ej=t.n(eb),ew=t(13218),eS=t.n(ew),e_=t(63364),eC=t(47037),eE=t.n(eC),eN=t(24512),ek=t(76534),eL=t(58548),eT=e=>{var r=e.readOnly,t=e.fieldConfig,a=(0,ep._)(e,["readOnly","fieldConfig"]),n=(0,ea.Z)(),o=(0,E.useTranslation)().t;return n?(0,s.jsx)(eN.Z,(0,i._)((0,l._)({multiple:!0,name:"file",action:"/files/uploadToFileSystem",withCredentials:!0,headers:(0,l._)({},(0,eL.y)(),(0,et.a)(n.getKeycloak())),onRemove:e=>(0,c._)(function(){var r,t;return(0,p.Jh)(this,function(a){switch(a.label){case 0:if(!(t=null==e||null==(r=e.response)?void 0:r.fileUuid))return[3,2];return[4,fetch(`${null==n?void 0:n.getBasePath()}files/${t}`,{method:"DELETE",credentials:"same-origin",headers:(0,l._)({},(0,eL.y)(),(0,et.a)(null==n?void 0:n.getKeycloak()))})];case 1:return[2,a.sent()];case 2:return[2]}})})(),onPreview:e=>(0,c._)(function(){var r,t,a,i,s,o;return(0,p.Jh)(this,function(u){switch(u.label){case 0:if(!n||(t=null==(r=e.response)?void 0:r.fileName,a=`/files/${null==r?void 0:r.fileUuid}`,ej()(t)||ej()(null==r?void 0:r.fileUuid)))return[2];return i=document.createElement("a"),document.body.appendChild(i),[4,fetch(a,{headers:(0,l._)({},(0,et.a)(n.getKeycloak()))})];case 1:return[4,u.sent().blob()];case 2:return s=u.sent(),o=window.URL.createObjectURL(s),i.href=o,i.download=t,i.click(),window.URL.revokeObjectURL(o),[2]}})})()},null==t?void 0:t.fieldProps,a),{children:!(void 0!==r&&r)&&(0,s.jsx)(ek.ZP,{children:o("FileUpload.upload")})})):(0,s.jsx)(s.Fragment,{})},eP=t(84131),eF=t(62163),eZ=t(76383),eD=()=>{var e=(0,ea.Z)();return(0,o.useCallback)(r=>(0,c._)(function(){var t;return(0,p.Jh)(this,function(a){switch(a.label){case 0:if(ej()(r))return[2,Promise.reject(Error(`Passed url '${r}' is null or undefined`))];return[4,fetch(r,{credentials:"include",headers:(0,l._)({},(0,et.a)(null==e?void 0:e.getKeycloak()))})];case 1:return[4,a.sent().blob()];case 2:return t=a.sent(),[2,new Promise((e,r)=>{try{var a=new FileReader;a.onload=function(){e(this.result)},a.readAsDataURL(t)}catch(e){r(Error(`Error reading file: ${e}`))}})]}})})(),[e])},eM=e=>{var r=e.fieldConfig,t=e.readOnly,a=void 0!==t&&t,n=e.initialFileList,u=(0,ep._)(e,["fieldConfig","readOnly","initialFileList"]),f=(0,d._)((0,o.useState)(!1),2),g=f[0],h=f[1],y=(0,d._)((0,o.useState)(""),2),v=y[0],x=y[1],b=(0,d._)((0,o.useState)(),2),j=b[0],w=b[1],S=(0,ea.Z)(),_=eD(),C=(0,E.useTranslation)().t;return((0,eZ.b)(()=>(0,c._)(function(){return(0,p.Jh)(this,function(e){switch(e.label){case 0:if(!n||0===n.length)return[2];return[4,(0,c._)(function(){return(0,p.Jh)(this,function(e){switch(e.label){case 0:return[4,Promise.all(n.map(e=>(0,c._)(function(){var r,t,a;return(0,p.Jh)(this,function(n){switch(n.label){case 0:return t=[(0,l._)({},e)],a={},[4,_(`${null==S?void 0:S.getBasePath()}imagefiles/${null==e||null==(r=e.response)?void 0:r.fileUuid}/thumbnail`)];case 1:return[2,i._.apply(void 0,t.concat([(a.thumbUrl=n.sent(),a.url=void 0,a)]))]}})})()))];case 1:return[2,e.sent()]}})})()];case 1:return w(e.sent()),[2]}})})(),[null==n?void 0:n.length]),S)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eN.Z,(0,i._)((0,l._)({accept:"image/*",multiple:!0,name:"file",action:`${S.getBasePath()}imagefiles/uploadToFileSystem`,withCredentials:!0,listType:"picture-card",headers:(0,l._)({},(0,eL.y)(),(0,et.a)(S.getKeycloak())),onRemove:e=>(0,c._)(function(){var r,t;return(0,p.Jh)(this,function(a){switch(a.label){case 0:if(!(t=null==e||null==(r=e.response)?void 0:r.fileUuid))return[3,2];return[4,fetch(`${null==S?void 0:S.getBasePath()}imagefiles/${t}`,{method:"DELETE",credentials:"same-origin",headers:(0,l._)({},(0,eL.y)(),(0,et.a)(null==S?void 0:S.getKeycloak()))})];case 1:return[2,a.sent()];case 2:return[2]}})})(),onPreview:e=>(0,c._)(function(){var r;return(0,p.Jh)(this,function(t){switch(t.label){case 0:if(r=e.response,ej()(r)||ej()(null==r?void 0:r.fileUuid))return[2];return[4,_(`${null==S?void 0:S.getBasePath()}imagefiles/${r.fileUuid}`)];case 1:return x(t.sent()),h(!0),[2]}})})(),fileList:a?j:void 0},null==r?void 0:r.fieldProps,u),{children:!a&&(0,s.jsxs)("div",{children:[(0,s.jsx)(eF.G,{icon:eP.r8p}),(0,s.jsx)("div",{style:{marginTop:8},children:C("ImageUpload.upload")})]})})),(0,s.jsx)(m.Z,{open:g,footer:null,onCancel:()=>h(!1),children:(0,s.jsx)("img",{alt:"example",style:{width:"100%"},src:v})})]}):(0,s.jsx)(s.Fragment,{})},eA=t(50963),eO=e=>{var r=e.feature,t=e.formConfig,a=(0,ep._)(e,["feature","formConfig"]),n=(0,d._)((0,eA.useForm)(),1)[0];return(0,o.useEffect)(()=>{n.resetFields(),n.setFieldsValue(r.getProperties())},[r,n]),(0,s.jsx)(ef.Z,(0,i._)((0,l._)({className:"feature-info-form",form:n,labelCol:{span:8},labelAlign:"left",labelWrap:!0},a),{children:null==t?void 0:t.map(e=>{var r,t;return(0,s.jsx)(ef.Z.Item,{name:e.propertyName,label:null!=(r=e.displayName)?r:e.propertyName,children:(0,s.jsx)(eI,(0,l._)({label:null!=(t=e.displayName)?t:e.propertyName},e.fieldProps))},e.propertyName)})}))},eU=e=>{var r=e.value,t=e.referenceConfig,a=(0,ep._)(e,["value","referenceConfig"]),n=(0,d._)((0,o.useState)(!1),2),i=n[0],u=n[1],f=(0,d._)((0,o.useState)(),2),g=f[0],h=f[1],y=(0,E.useTranslation)().t,x=e=>{if(null==t?void 0:t.tablePropertyName){var r=/{{([^}]*)}}/g;if(null==t?void 0:t.tablePropertyName.match(r)){for(var a,n=null==t?void 0:t.tablePropertyName;a=r.exec(null==t?void 0:t.tablePropertyName);)n=n.replace(a[0],e[a[1]]);return n}return e[null==t?void 0:t.tablePropertyName]}if(e.id)return e.id},b=[{width:"100%",render:(e,r)=>x(r)?x(r):y("ReferenceTable.defaultRowPlaceholder")},{render:(e,r)=>(0,s.jsx)(ek.ZP,{onClick:()=>j(e,r),icon:(0,s.jsx)(eF.G,{icon:eP.IA$})})}],j=(e,r)=>{var t=new(Y());t.setProperties(r),h(t),u(!0)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v.Z,(0,l._)({size:"small",showHeader:!1,pagination:!1,columns:b,rowKey:"id",dataSource:(()=>{if(!r)return[];try{var e=JSON.parse(r);if(Array.isArray(e))return e;if(null==e||"number"==typeof e||"boolean"==typeof e||"string"==typeof e)return N.Z.warn("Unsupported value given"),[];if("object"==typeof e)return[e]}catch(e){return N.Z.warn("Error while parsing the table data ",e),[]}})()},a)),(0,s.jsx)(m.Z,{className:"reference-table-modal",open:i,maskClosable:!1,footer:null,width:600,destroyOnClose:!0,title:(()=>{if(!g)return y("ReferenceTable.defaultModalTitle");var e=x(g.getProperties());return e?`${y("ReferenceTable.modalTitle",{referenceValue:e})}`:y("ReferenceTable.defaultModalTitle")})(),onCancel:()=>(0,c._)(function(){return(0,p.Jh)(this,function(e){return u(!1),h(void 0),[2]})})(),children:g&&(0,s.jsx)(eO,{feature:g,formConfig:null==t?void 0:t.featureInfoFormConfig})})]})},eI=e=>{var r,t,a,n=e.dataType,o=void 0===n?"auto":n,u=e.valueMap,c=e.format,d=e.suffix,p=e.value,f=e.referenceConfig,m=e.urlDisplayValue,g=(0,ep._)(e,["dataType","valueMap","format","suffix","value","referenceConfig","urlDisplayValue"]),h=(0,E.useTranslation)().i18n,v="";if(p&&"string"==typeof p&&(null==u?void 0:u.hasOwnProperty(p))&&(p=u[p]),("string"===o||"auto"===o&&"string"==typeof p)&&p&&(v=null==p?void 0:p.toString()),"boolean"===o||"auto"===o&&"boolean"==typeof p||"false"===p||"true"===p)return(0,s.jsx)(em.Z,{checked:"false"!==p&&!1!==p,disabled:!0});("number"===o||"auto"===o&&Number.isFinite(p))&&p&&(v=new Intl.NumberFormat(h.language,{useGrouping:!1}).format(Number(p))),("date"===o||"auto"===o&&ei()(`${p}`).isValid())&&p&&((0,el.isDayjs)(p)||eE()(p)&&ei()(`${p}`).isValid())&&(v=ei()(p).format(void 0===c?"DD.MM.YYYY":c)),"auto"===o&&Array.isArray(p)&&(v=p.join(", ")),("url"===o||"auto"===o&&eE()(p)&&(r=p.toLowerCase(),["http://","https://","ftp://","mailto:"].some(e=>r.startsWith(e))))&&p&&(v=(0,s.jsx)("a",{href:null==p?void 0:p.toString(),target:"_blank",rel:"noreferrer",children:m||(null==p?void 0:p.toString())}));var x=p&&(e=>{if(!p)return null;var r="string"!=typeof e?JSON.stringify(e):e;try{r=JSON.parse(r)}catch(e){return N.Z.trace(e),null}return"object"==typeof r&&null!==r&&eJ(r[0])?r:null})(p);return"auto"===o&&x?(null==(a=x[0].response)||null==(t=a.fileType)?void 0:t.startsWith("image/"))?(0,s.jsx)(eM,{initialFileList:x,disabled:!0,readOnly:!0}):(0,s.jsx)(eT,{defaultFileList:x,disabled:!0,readOnly:!0}):"json"===o||"auto"===o&&p&&(e=>{var r="string"!=typeof e?JSON.stringify(e):e;try{r=JSON.parse(r)}catch(e){return N.Z.trace(e),!1}return"object"==typeof r&&null!==r})(p)?(0,s.jsx)(eU,{value:"string"==typeof p?p:JSON.stringify(p),referenceConfig:f}):(d&&(v=(0,s.jsxs)(s.Fragment,{children:[v," ",d]})),(0,s.jsx)(y.Z.Text,(0,i._)((0,l._)({className:"displayfield"},g),{children:v})))},e$=t(21689),eR=t(97398),eG=t.n(eR),eB=t(98508),eV=e=>{var r=e.parentForm,t=e.propertyName,a=e.value,n=e.tablePropertyName,u=e.formConfig,f=e.onChange,g=void 0===f?()=>{}:f,h=(0,ep._)(e,["parentForm","propertyName","value","tablePropertyName","formConfig","onChange"]),y=(0,d._)((0,o.useState)(!1),2),x=y[0],b=y[1],j=(0,d._)((0,o.useState)(),2),w=j[0],S=j[1],_=(0,d._)((0,eA.useForm)(),1)[0],C=(0,E.useTranslation)().t,k=eD(),L=(0,ea.Z)(),T=e=>{if(!n)return null!=(r=e.id)?r:"";var r,t,a=/{{([^}]*)}}/g;if(!n.match(a))return e[n];for(var l=n;t=a.exec(n);)l=l.replace(t[0],e[t[1]]);return l},P=[{width:"100%",defaultSortOrder:"ascend",sorter:(e,r)=>{var t=T(e),a=T(r);return Number.isFinite(t)&&Number.isFinite(a)?t-a:"string"==typeof t&&"string"==typeof a?t.localeCompare(a):0},render:(e,r)=>T(r)},{render:(e,r)=>(0,s.jsx)(ek.ZP,{onClick:()=>Z(r),icon:(0,s.jsx)(eF.G,{icon:eP.Xcf})})},{render:(e,r)=>(0,s.jsx)(e$.Z,{title:C("EditReferenceTable.confirmDeleteTitle"),onConfirm:()=>F(r),placement:"bottomRight",children:(0,s.jsx)(ek.ZP,{danger:!0,icon:(0,s.jsx)(eF.G,{icon:eP.$aW})})})}],F=e=>{var a=r.getFieldsValue();if(!a[t])return void N.Z.warn(`Could not find the property ${t} in the form values`);var n=eo()(a[t]);if(!Array.isArray(n))return void N.Z.warn("The delete candidate is not of required type array");var l=n.findIndex(r=>!!Number.isFinite(r.id)&&r.id===e.id||!!(r.internalId&&r.internalId===e.internalId));if(-1===l)return void N.Z.warn(`Could not find the index (${e.id}) to delete`);n.splice(l,1),g(n)},Z=e=>{var r=new(Y());r.setProperties(e),_.setFieldsValue(r.getProperties()),S(r),b(!0)},D=()=>{_.resetFields(),b(!1),S(void 0)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ek.ZP,{className:"add-reference-button",onClick:()=>{var e=new(Y());e.set("internalId",(0,eB.getUid)(e)),_.setFieldsValue(e.getProperties()),S(e),b(!0)},icon:(0,s.jsx)(eF.G,{icon:eP.r8p})}),(0,s.jsx)(v.Z,(0,l._)({size:"small",showHeader:!1,pagination:!1,columns:P,rowKey:"id",dataSource:(()=>{if(a){if(!Array.isArray(a))return void N.Z.warn("Reference value must be of of type array.");var e=eo()(a);return e.forEach(e=>{Object.entries(e).forEach(r=>{var t=(0,d._)(r,2),n=t[0],s=t[1];return(0,c._)(function(){var r;return(0,p.Jh)(this,function(t){switch(t.label){case 0:if((null==u?void 0:u.some(e=>e.propertyName===n&&"DATE"===e.component))&&(eE()(s)||eG()(s))&&(eE()(a)||eG()(a))&&(ei()(`${a}`).isValid()?e[n]=ei()(`${s}`):(N.Z.warn("Could not parse date"),e[n]=null)),!(null==u?void 0:u.some(e=>e.propertyName===n&&"UPLOAD"===e.component)))return[3,3];if(!Array.isArray(e[n]))return[3,2];return[4,Promise.all(null==(r=e[n])?void 0:r.map(e=>(0,c._)(function(){var r,t,a,n;return(0,p.Jh)(this,function(s){switch(s.label){case 0:if(t=[(0,l._)({},e)],a={},!e.type.startsWith("image"))return[3,2];return[4,k(`${null==L?void 0:L.getBasePath()}imagefiles/${null==e||null==(r=e.response)?void 0:r.fileUuid}/thumbnail`)];case 1:return n=s.sent(),[3,3];case 2:n=void 0,s.label=3;case 3:return[2,i._.apply(void 0,t.concat([(a.thumbUrl=n,a.url=e.type.startsWith("image")?void 0:e.url,a)]))]}})})()))];case 1:return e[n]=t.sent(),[3,3];case 2:e[n]=[],t.label=3;case 3:return[2]}})})()})}),e.every(e=>!!Number.isFinite(e.id)||"string"==typeof e.id&&e.id.length>0)||N.Z.warn("Not all elements in the referenced array contain an id value. This might result in unexpected behaviour"),e}})()},h)),(0,s.jsx)(m.Z,{className:"edit-reference-table-modal",open:x,maskClosable:!1,width:600,destroyOnClose:!0,title:`${C("EditReferenceTable.modalTitle",{referenceValue:w?T(w.getProperties()):void 0})}`,onCancel:()=>{D()},onOk:()=>(0,c._)(function(){var e;return(0,p.Jh)(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,_.validateFields()];case 1:return a.sent(),[3,3];case 2:return e=a.sent(),N.Z.warn("Form validation failed: ",e),[2];case 3:var n,l,i;return n=eo()(_.getFieldsValue(!0)),l=[],Array.isArray(r.getFieldValue(t))&&(l=eo()(r.getFieldValue(t))),(i=l.findIndex(e=>!!Number.isFinite(e.id)&&e.id===n.id||!!(e.internalId&&e.internalId===n.internalId)))>-1?l[i]=n:l.push(n),_.isFieldsTouched()&&g(l),D(),[2]}})})(),children:w&&(0,s.jsx)(ez,{form:_,formConfig:u,applyFormDirty:!1})})]})};function eJ(e){return!ej()(e)&&e.uid&&!ej()(e.name)&&!ej()(e.type)&&!ej()(e.uid)&&eS()(e.response)&&!ej()(e.response.id)&&!ej()(e.response.fileUuid)&&!ej()(e.response.fileName)&&!ej()(e.response.fileType)}var ez=e=>{var r=e.form,t=e.formConfig,a=e.applyFormDirty,n=void 0===a||a,o=(0,ep._)(e,["form","formConfig","applyFormDirty"]),u=(0,ea.Z)(),d=M(),f=A(e=>e.editFeature.formDirty);return(0,s.jsx)(ef.Z,(0,i._)((0,l._)({className:"edit-feature-form",form:r,labelCol:{span:8},labelAlign:"left",labelWrap:!0,onValuesChange:ex()(e=>(0,c._)(function(){return(0,p.Jh)(this,function(r){return n&&e&&!f&&d((0,e_.uQ)(!0)),[2]})})(),250)},o),{children:null==t?void 0:t.map(e=>{let t;e.readOnly?(t=e,a=(0,s.jsx)(eI,(0,l._)({},t.fieldProps))):e.component?a=(e=>{if(u)switch(e.component){case"CHECKBOX":return(0,s.jsx)(em.Z,(0,l._)({},null==e?void 0:e.fieldProps));case"DATE":return(0,s.jsx)(eg.Z,(0,l._)({},null==e?void 0:e.fieldProps));case"DISPLAY":return(0,s.jsx)("span",(0,l._)({},null==e?void 0:e.fieldProps));case"INPUT":return(0,s.jsx)(g.Z,(0,l._)({},null==e?void 0:e.fieldProps));case"NUMBER":return(0,s.jsx)(eh.Z,(0,l._)({},null==e?void 0:e.fieldProps));case"SELECT":return(0,s.jsx)(h.Z,(0,l._)({allowClear:!0},null==e?void 0:e.fieldProps));case"SWITCH":return(0,s.jsx)(ey.Z,(0,l._)({},null==e?void 0:e.fieldProps));case"TEXTAREA":return(0,s.jsx)(g.Z.TextArea,(0,l._)({},null==e?void 0:e.fieldProps));case"UPLOAD":var t;if((null==e||null==(t=e.fieldProps)?void 0:t.type)==="IMAGE")return(0,s.jsx)(eM,(0,l._)({},null==e?void 0:e.fieldProps));return(0,s.jsx)(eT,(0,l._)({},null==e?void 0:e.fieldProps));case"REFERENCE_TABLE":return(0,s.jsx)(eV,(0,l._)({tablePropertyName:e.tablePropertyName,propertyName:e.propertyName,formConfig:e.editFormConfig,parentForm:r},e.fieldProps),e.propertyName);default:return N.Z.error(`Component type "${null==e?void 0:e.component}" is not supported`),(0,s.jsx)(s.Fragment,{})}})(e):(N.Z.warn("FieldConfig is missing `readOnly`, `component` or `dataType` property."),a=(0,s.jsx)(g.Z,{placeholder:""},e.propertyName));var a,n,o={rules:[]};return o.rules=[{required:e.required}],"SWITCH"!==e.component&&"CHECKBOX"!==e.component||e.readOnly||(o.valuePropName="checked"),"UPLOAD"!==e.component||e.readOnly||(o.valuePropName="fileList",o.getValueFromEvent=e=>Array.isArray(e)?e:null==e?void 0:e.fileList),(0,s.jsx)(ef.Z.Item,(0,i._)((0,l._)({name:e.propertyName,label:null!=(n=e.displayName)?n:e.propertyName},o),{children:a}),e.propertyName)})}))},eW=e=>["gml:MultiPoint","gml:Point","gml:MultiLineString","gml:LineString","gml:MultiPolygon","gml:Polygon"].includes(e),eK=()=>{var e=(0,ea.Z)(),r="describeFeatureTypeCache";return(0,o.useCallback)(t=>(0,c._)(function(){var a,n,i,s,o,u,c,d,f,m,g;return(0,p.Jh)(this,function(p){switch(p.label){case 0:if((i=t.getSource())instanceof Q()&&(n=i.getUrl()),i instanceof er()&&(n=(s=i.getUrls())?s[0]:void 0),!n||(n.endsWith("?")&&(n=n.slice(0,-1)),!(o=null==(a=t.getSource())?void 0:a.getParams().LAYERS)))return[2];if(c=(u=JSON.parse(sessionStorage.getItem(r)||"{}"))[o])return[2,c];return d={SERVICE:"WFS",REQUEST:"DescribeFeatureType",VERSION:"2.0.0",OUTPUTFORMAT:"application/json",TYPENAMES:o},f={"Content-Type":"application/json"},[4,fetch(`${n}?${k.V.objectToRequestString(d)}`,{method:"GET",headers:t.get("useBearerToken")?(0,l._)({},f,(0,et.a)(null==e?void 0:e.getKeycloak())):f})];case 1:if(!(m=p.sent()).ok)throw Error("No successful response while executing a WFS-DescribeFeature");return[4,m.json()];case 2:return g=p.sent(),u[o]=g,sessionStorage.setItem(r,JSON.stringify(u)),[2,g]}})})(),[e])},eq=()=>{var e=(0,Z.S)(),r=eK(),t=(0,ea.Z)(),a=A(e=>e.editFeature.userEditMode),n=(0,o.useCallback)((e,r,a)=>{var l=!0,i=!1,s=void 0;try{for(var o,u=Object.entries(e)[Symbol.iterator]();!(l=(o=u.next()).done);l=!0)!function(){var l=(0,d._)(o.value,2),i=l[0],s=l[1];if(Array.isArray(s)){var u=s.map(e=>n(e,r));e[i]=a?JSON.stringify(u):u}if(void 0===s&&(e[i]=null),r.some(e=>{var r;return null==(r=e.children)?void 0:r.some(e=>e.propertyName===i&&e.readOnly)})&&delete e[i],ei()(s).isValid()&&(e[i]=s.toISOString()),Array.isArray(s)&&s.length>0&&eJ(s[0])){var c,p,f=(null==(p=s[0].response)||null==(c=p.fileType)?void 0:c.startsWith("image/"))?"imagefiles/":"files/",m=s.map(e=>{var r,a,n,l,i;return{uid:e.uid,lastModified:e.lastModified,name:e.name,type:e.type,url:`${null==t?void 0:t.getBasePath()}${f}${e.response.fileUuid}`,response:{id:null==(r=e.response)?void 0:r.id,created:null==(a=e.response)?void 0:a.created,fileName:null==(n=e.response)?void 0:n.fileName,fileType:null==(l=e.response)?void 0:l.fileType,fileUuid:null==(i=e.response)?void 0:i.fileUuid}}});e[i]=JSON.stringify(m)}}()}catch(e){i=!0,s=e}finally{try{l||null==u.return||u.return()}finally{if(i)throw s}}return e},[t]);return(0,o.useCallback)(t=>(0,c._)(function(){var l,i,s,o,u,c,d,f,m,g,h,y,v,x,b;return(0,p.Jh)(this,function(p){switch(p.label){case 0:if(!e)return[2];return u=[],c=[],d=[],[4,r(t.layer)];case 1:if(!(f=p.sent()))return[2];return m=t.layer.get("editFormConfig"),g=null==(i=f.featureTypes[0])||null==(l=i.properties)?void 0:l.find(e=>eW(e.type)),h=!1,null==(s=t.upsertFeatures)||s.forEach(e=>{var r=new(Y()),l=null==(i=e.getGeometry())?void 0:i.clone();if(l&&!(0,eu.isEmpty)(l.getExtent())&&(null==a?void 0:a.includes("EDIT_GEOMETRY"))){var i,s,o=null!=(s=null==g?void 0:g.name)?s:"geom";r.set(o,l),r.setGeometryName(o)}t.form&&r.setProperties(n(eo()(t.form.getFieldsValue()),m,!0));var d=!!e.getId();h||(h=d),d&&r.setId(e.getId()),(d?c:u).push(r)}),y={featureNS:f.targetNamespace,featurePrefix:f.targetPrefix,featureType:null==(o=t.layer.getSource())?void 0:o.getParams().LAYERS,srsName:e.getView().getProjection().getCode(),version:"1.1.0",nativeElements:[]},v=new(ed())().writeTransaction(u,c,d,y),h&&K().wfsLockFeatureEnabled&&((b=document.createElementNS("https://www.opengis.net/wfs","LockId")).appendChild(document.createTextNode("GeoServer")),null==(x=v.getRootNode())||x.appendChild(b)),[2,v]}})})(),[e,a,r,n])},eY=t(67187),eH=t(12477),eX=e=>{var r=e.open,t=e.children,a=(0,ep._)(e,["open","children"]),n=(0,Z.S)();return(0,o.useEffect)(()=>{var e;null==(e=document.querySelectorAll("#map")[0])||e.classList.toggle("bisected",!!r)},[r]),(0,s.jsx)(eH.Z,(0,i._)((0,l._)({rootClassName:"map-drawer",mask:!1,open:r,placement:"right",width:getComputedStyle(document.documentElement).getPropertyValue("--drawerWidth"),afterOpenChange:()=>{null==n||n.updateSize()}},a),{children:t}))},eQ=t(64903),e0=t.n(eQ),e1=()=>{var e=(0,ea.Z)(),r=(0,Z.S)(),t=eK();return(0,o.useCallback)(function(a){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"1.1.0";return(0,c._)(function(){var i,s,o,u,c,d,f,m,g,h,y;return(0,p.Jh)(this,function(p){switch(p.label){case 0:if(!r)return[2];return[4,t(a.layer)];case 1:if(!(u=p.sent())||((d=a.layer.getSource())instanceof Q()&&(c=d.getUrl()),d instanceof er()&&(c=(f=d.getUrls())?f[0]:void 0),!c))return[2];return c.endsWith("?")&&(c=c.slice(0,-1)),m=null==(s=u.featureTypes[0])||null==(i=s.properties)?void 0:i.find(e=>eW(e.type)),(g=new(ed())({version:n}).writeGetFeature({srsName:r.getView().getProjection().getCode(),featureNS:u.targetNamespace,featurePrefix:u.targetPrefix,featureTypes:[null==d?void 0:d.getParams().LAYERS],outputFormat:"application/json",maxFeatures:a.maxFeatures,propertyNames:a.propertyNames&&(null==m?void 0:m.name)?[...a.propertyNames,null==m?void 0:m.name]:void 0,bbox:a.bbox,filter:a.filter instanceof e0()?a.filter:void 0,geometryName:null==m?void 0:m.name}))instanceof Element&&a.filter instanceof Element&&g.getElementsByTagName("Query")[0].appendChild(a.filter),h={"Content-Type":"application/json"},[4,fetch(c,{method:"POST",headers:(null==(o=a.layer)?void 0:o.get("useBearerToken"))?(0,l._)({},h,(0,et.a)(null==e?void 0:e.getKeycloak())):h,body:new XMLSerializer().serializeToString(g)})];case 2:if(!(y=p.sent()).ok)throw Error("No successful response while executing a WFS-GetFeature");return[4,y.json()];case 3:return[2,p.sent()]}})})()},[e,t,r])},e2=t(78001),e3=t(41609),e4=t.n(e3),e5=t(38450),e6=t.n(e5),e8=t(20521),e7=t(33846),e9=t.n(e7),re=t(82707),rr=t(59694),rt=t(14292),ra=()=>{var e=(0,o.useCallback)((e,r)=>Number(getComputedStyle(document.body).getPropertyValue(e).replace("px",""))||r,[]);return(0,o.useCallback)(function(){var r,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=document.querySelector(".tool-menu"),n=null!=(r=null==a?void 0:a.clientWidth)?r:0,l=e("--headerHeight",50),i=e("--footerHeight",40),s=0;return t&&(s=e("--drawerWidth",450)),[l,s,i,n]},[e])},rn=e=>{var r=e.alignment,t=e.className,a=void 0===t?"":t,n=e.children,o=(0,ep._)(e,["alignment","className","children"]),u="toolbar",c=a?`${a} ${u}`:u;return(0,s.jsx)("div",(0,i._)((0,l._)({className:`${c} ${void 0===r?"horizontal":r}-toolbar`,role:"toolbar"},o),{children:n}))},rl=e=>{var r,t,a=e.feature,n=e.historyLength,u=void 0===n?10:n,c=(0,o.useRef)({past:[],future:[]}),p=(0,Z.S)(),f=M(),m=ra(),g=(0,d._)((0,o.useState)(),2),h=g[0],y=g[1],v=(0,d._)((0,o.useState)(0),2)[1],x=(0,d._)((0,o.useState)(void 0),2),b=x[0],j=x[1],w=(0,o.useMemo)(()=>new(e6()),[]),S=A(e=>e.editFeature.userEditMode),_=A(e=>e.editFeature.formDirty);(0,o.useEffect)(()=>{if(p)return h||y(rt.w.getDigitizeLayer(p)),()=>{h&&(null==p||p.removeLayer(h))}},[h,p]),(0,o.useEffect)(()=>{c.current.past.length>0&&!_&&f((0,e_.uQ)(!0))},[f,c.current.past]),(0,o.useEffect)(()=>{if(h&&(null==a?void 0:a.id)){null==(e=h.getSource())||e.clear();var e,r=w.readFeature(a);if(!Array.isArray(r)){var t=h.getSource();t&&(t.addFeature(r),v(e=>e+1),(0,eu.isEmpty)(t.getExtent())||null==p||p.getView().fit(t.getExtent(),{padding:m(!0)}))}}},[a,h,w,p,m]);var C=()=>{var e,r=null==h||null==(e=h.getSource())?void 0:e.getFeatures();if(r){var t=w.writeFeaturesObject(r);c.current=(0,i._)((0,l._)({},c.current),{past:[...c.current.past,t].slice(-10)}),v(e=>e+1)}},E={tooltipPlacement:"left",tooltipProps:{mouseEnterDelay:.5}};return h&&S.includes("EDIT_GEOMETRY")?(0,s.jsxs)(rn,{className:"geometry-edit-tb",alignment:"vertical",children:[(0,s.jsxs)(rr.ToggleGroup,{selected:b,onChange:(e,r)=>{j(r)},children:[S.includes("CREATE")?(0,s.jsx)(e9(),(0,l._)({value:"create",icon:(0,s.jsx)(eF.G,{icon:eP.TzT}),pressedIcon:(0,s.jsx)(eF.G,{icon:eP.TzT}),name:"draw",digitizeLayer:h,tooltip:(0,e2.t)("EditFeatureGeometryToolbar.draw"),drawType:a.geometry.type,onDrawEnd:e=>{if(!a.geometry.type.toLocaleLowerCase().startsWith("multi")){var r=null==h?void 0:h.getSource(),t=null==r?void 0:r.getFeatures()[0];t&&(null==r||r.once("addfeature",e=>r.removeFeature(e.feature)),t.setGeometry(e.feature.getGeometry()))}C()}},E)):(0,s.jsx)(s.Fragment,{}),S.includes("UPDATE")?(0,s.jsx)(re.ModifyButton,(0,l._)({value:"update",icon:(0,s.jsx)(eF.G,{icon:eP.ubJ}),pressedIcon:(0,s.jsx)(eF.G,{icon:eP.ubJ}),name:"edit",digitizeLayer:h,tooltip:(0,e2.t)("EditFeatureGeometryToolbar.edit"),onModifyStart:C,onModifyEnd:C,onTranslateEnd:C},E)):(0,s.jsx)(s.Fragment,{}),S.includes("DELETE")?(0,s.jsx)(e8.DeleteButton,(0,l._)({value:"delete",icon:(0,s.jsx)(eF.G,{icon:eP.$aW}),pressedIcon:(0,s.jsx)(eF.G,{icon:eP.$aW}),name:"delete",digitizeLayer:h,tooltip:(0,e2.t)("EditFeatureGeometryToolbar.delete"),onFeatureRemove:C},E)):(0,s.jsx)(s.Fragment,{})]}),(0,s.jsx)(F(),(0,l._)({icon:(0,s.jsx)(eF.G,{icon:eP.X7o}),tooltip:(0,e2.t)("EditFeatureGeometryToolbar.undo"),onClick:()=>{var e=null==h?void 0:h.getSource(),r=null==e?void 0:e.getFeatures();if(r){var t=w.writeFeaturesObject(r),a=c.current.past[c.current.past.length-1];e4()(a)||(null==e||e.clear(),null==e||e.addFeatures(w.readFeatures(a)),c.current={past:c.current.past.slice(0,-1),future:[...c.current.future,t].slice(-u)},v(e=>e+1))}},disabled:(null==(r=c.current.past)?void 0:r.length)===0},E)),(0,s.jsx)(F(),(0,l._)({icon:(0,s.jsx)(eF.G,{icon:eP.X7o,flip:"horizontal"}),tooltip:(0,e2.t)("EditFeatureGeometryToolbar.redo"),onClick:()=>{var e=null==h?void 0:h.getSource(),r=null==e?void 0:e.getFeatures();if(r){var t=w.writeFeaturesObject(r),a=c.current.future[c.current.future.length-1];e4()(a)||(null==e||e.clear(),null==e||e.addFeatures(w.readFeatures(a)),c.current={future:c.current.future.slice(0,-1),past:[...c.current.past,t].slice(-u)},v(e=>e+1))}},disabled:(null==(t=c.current.future)?void 0:t.length)===0},E))]}):(0,s.jsx)(s.Fragment,{})},ri=t(33100),rs=e=>{var r=e.tabConfig,t=e.form,a=e.initialValues,n=(0,ep._)(e,["tabConfig","form","initialValues"]),i=null==r?void 0:r.map((e,r)=>({label:e.title,key:`${r}`,forceRender:!0,children:(0,s.jsx)(ez,{name:e.title,form:t,initialValues:a,formConfig:e.children})}));return(0,s.jsx)(ri.Z,(0,l._)({items:i},n))},ro=e=>{var r=e.feature,t=e.layer,a=e.onError,n=void 0===a?()=>{}:a,u=e.onSuccess,f=void 0===u?()=>{}:u,m=(0,ep._)(e,["feature","layer","onError","onSuccess"]),g=(0,d._)((0,o.useState)(!1),2),h=g[0],y=g[1],v=(0,E.useTranslation)().t,x=(0,Z.S)(),b=eq(),j=en();return(0,s.jsx)(e$.Z,{title:v("DeleteButton.confirm"),onConfirm:()=>(0,c._)(function(){var e,a,l,i;return(0,p.Jh)(this,function(s){switch(s.label){case 0:if(!x||!t||!(0,H.us)(t))return[2];s.label=1;case 1:return s.trys.push([1,4,5,6]),y(!0),[4,b({deleteFeatures:Array.isArray(a=new(e6())().readFeature(r))?a:[a],layer:t})];case 2:if(!(l=s.sent()))return[2];return[4,j({layer:t,transaction:l})];case 3:return s.sent(),null==(e=t.getSource())||e.refresh(),f(),[3,6];case 4:return i=s.sent(),N.Z.error(i),n(i),[3,6];case 5:return y(!1),[7];case 6:return[2]}})})(),placement:"bottomRight",children:(0,s.jsx)(ek.ZP,(0,i._)((0,l._)({type:"primary",loading:h,disabled:!r.id,danger:!0,icon:(0,s.jsx)(eF.G,{icon:eP.$aW})},m),{children:v("DeleteButton.title")}))})},ru=e=>{var r=e.feature,t=e.form,a=(0,ep._)(e,["feature","form"]),n=(0,E.useTranslation)().t,o=(0,Z.S)(),u=M();return(0,s.jsx)(ek.ZP,(0,i._)((0,l._)({type:"primary",onClick:()=>{if(t.resetFields(),u((0,e_.uQ)(!1)),o){var e=rt.w.getDigitizeLayer(o);if(e){null==(a=e.getSource())||a.clear();var a,n,l=new(e6())().readFeature(r);if(Array.isArray(l))return;null==(n=e.getSource())||n.addFeature(l)}}},icon:(0,s.jsx)(eF.G,{icon:eP.XnX})},a),{children:n("ResetButton.title")}))},rc=e=>{var r=e.loadComplete,t=void 0!==r&&r;return(0,s.jsx)("div",{className:t?"feedback-icon":"feedback-icon hidden",children:(0,s.jsx)("div",{className:t?"checkmark":"checkmark-hidden"})})},rd=e=>{var r=e.form,t=e.layer,a=e.onError,n=void 0===a?()=>{}:a,u=e.onSuccess,f=void 0===u?()=>{}:u,m=(0,ep._)(e,["form","layer","onError","onSuccess"]),g=(0,d._)((0,o.useState)(!1),2),h=g[0],y=g[1],v=(0,d._)((0,o.useState)(!1),2),x=v[0],b=v[1],j=(0,Z.S)(),w=eq(),S=en(),_=M(),C=A(e=>e.editFeature.formDirty),k=(0,E.useTranslation)().t;return(0,s.jsxs)(ek.ZP,(0,i._)((0,l._)({className:"save-button",type:"primary",onClick:()=>(0,c._)(function(){var e,a,l,i,s,o,u,c;return(0,p.Jh)(this,function(d){switch(d.label){case 0:if(!j||!t||!(0,H.us)(t))return[2];if(!(a=rt.w.getDigitizeLayer(j)))return N.Z.error("Cannot find the digitize layer"),n(),[2];if(!(l=null==(e=a.getSource())?void 0:e.getFeatures())||0===l.length)return N.Z.error("Cannot save feature without geometry"),n(k("SaveButton.errorNoGeometry")),[2];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,r.validateFields()];case 2:return d.sent(),[3,4];case 3:return n(i=d.sent()),N.Z.warn("Validation has failed: ",i),[2];case 4:return d.trys.push([4,7,8,9]),y(!0),[4,w({upsertFeatures:l,form:r,layer:t})];case 5:if(!(o=d.sent()))return[2];return[4,S({layer:t,transaction:o})];case 6:return u=d.sent(),null==(s=t.getSource())||s.refresh(),b(!0),setTimeout(()=>{b(!1)},3e3),_((0,e_.uQ)(!1)),f(u),[3,9];case 7:return c=d.sent(),N.Z.error(c),n(c),[3,9];case 8:return y(!1),[7];case 9:return[2]}})})(),loading:h,disabled:!C,icon:(0,s.jsx)(eF.G,{icon:eP.EdJ})},m),{children:[k("SaveButton.title"),(0,s.jsx)(rc,{loadComplete:x})]}))},rp=e=>{var r=e.feature,t=e.layer,a=e.form,n=e.onSaveSuccess,l=e.onSaveError,i=e.onDeleteSuccess,o=e.onDeleteError,u=A(e=>e.editFeature.userEditMode);return(0,s.jsxs)("div",{className:"edit-feature-toolbar",children:[u.includes("CREATE")||u.includes("UPDATE")?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ru,{feature:r,form:a}),(0,s.jsx)(rd,{form:a,layer:t,onSuccess:void 0===n?()=>{}:n,onError:void 0===l?()=>{}:l})]}):(0,s.jsx)(s.Fragment,{}),u.includes("DELETE")&&(0,s.jsx)(ro,{feature:r,layer:t,onSuccess:void 0===i?()=>{}:i,onError:void 0===o?()=>{}:o})]})},rf=e=>{var r=e.feature,t=e.layer,a=(0,E.useTranslation)().t,n=e1(),f=eD(),m=(0,d._)((0,o.useState)(),2),g=m[0],h=m[1],y=(0,d._)((0,o.useState)(),2),v=y[0],x=y[1],b=(0,d._)((0,o.useState)(),2),j=b[0],w=b[1],S=(0,d._)((0,eA.useForm)(),1)[0],_=(0,Z.S)(),C=M(),k=(0,ea.Z)(),L=(0,o.useCallback)(e=>(0,c._)(function(){var r,a,l,i;return(0,p.Jh)(this,function(s){switch(s.label){case 0:if(!t||!(0,H.us)(t))return[2];return a=(r=document.implementation.createDocument(null,"root")).createElement("Filter"),(l=r.createElement("ResourceId")).setAttribute("rid",e),a.appendChild(l),r.documentElement.appendChild(a),[4,n({layer:t,filter:a},"2.0.0")];case 1:return(null==(i=s.sent())?void 0:i.features[0])&&C((0,e_.hr)(null==i?void 0:i.features[0])),[2]}})})(),[C,n,t]),T=(0,o.useCallback)(()=>(0,c._)(function(){var e,a;return(0,p.Jh)(this,function(n){switch(n.label){case 0:if(!_||!k)return[2];if((null==(e=t.get("editFormConfig"))?void 0:e.length)===0)return N.Z.warn(`Layer ${t.get("name")} has no 'editFormConfig' set`),[2];return[4,Promise.all(Object.entries(a=structuredClone(null==r?void 0:r.properties)||{}).map(r=>{var t=(0,d._)(r,2),n=t[0],s=t[1];return(0,c._)(function(){var r,t,o,u,d,m,g,h;return(0,p.Jh)(this,function(y){switch(y.label){case 0:if((null==(r=null==e?void 0:e.filter(e=>{var r;return null==(r=e.children)?void 0:r.find(e=>e.propertyName===n)}))?void 0:r.length)>1&&N.Z.warn(`Property ${n} is configured in multiple tabs. Is this intended?`),!(r&&r[0]))return[3,7];if((null==(t=r[0].children)?void 0:t.some(e=>e.propertyName===n&&"DATE"===e.component))&&((d=ei()(s)).isValid()?a[n]=d:(N.Z.warn("Could not parse date"),a[n]=null)),!(null==(o=r[0].children)?void 0:o.some(e=>e.propertyName===n&&"UPLOAD"===e.component)))return[3,6];if(!s)return[3,5];y.label=1;case 1:if(y.trys.push([1,3,,4]),!eJ((m=JSON.parse(s))[0]))throw Error("File config is no valid SHOGun file.");return g=m,a[n]=g,[4,Promise.all(g.map(e=>(0,c._)(function(){var r,t,a,n,s,o;return(0,p.Jh)(this,function(u){switch(u.label){case 0:if(!(n=null==(t=g[0].response)||null==(r=t.fileType)?void 0:r.startsWith("image/")))return[3,2];return[4,f(`${k.getBasePath()}imagefiles/${null==e||null==(a=e.response)?void 0:a.fileUuid}/thumbnail`)];case 1:return o=u.sent(),[3,3];case 2:o=void 0,u.label=3;case 3:return s=o,[2,(0,i._)((0,l._)({},e),{thumbUrl:s,url:n?void 0:e.url})]}})})()))];case 2:return a[n]=y.sent(),[3,4];case 3:return h=y.sent(),N.Z.error("Could not parse file list from JSON config: ",h),a[n]=[],[3,4];case 4:return[3,6];case 5:a[n]=[],y.label=6;case 6:if(null==(u=r[0].children)?void 0:u.some(e=>e.propertyName===n&&"REFERENCE_TABLE"===e.component))try{a[n]=JSON.parse(a[n])}catch(e){N.Z.warn("Could not parse the input for the REFERENCE_TABLE",e)}y.label=7;case 7:return[2]}})})()}))];case 1:return n.sent(),x(a),S.resetFields(),S.setFieldsValue(a),h(e),[2]}})})(),[_,k,t,null==r?void 0:r.properties,S,f]);return(0,o.useEffect)(()=>{T()},[T]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(rl,{feature:r}),j&&(0,s.jsx)(z.Z,{className:"error-alert",message:j,type:"error",showIcon:!0}),(0,s.jsx)(rp,{feature:r,layer:t,form:S,onSaveSuccess:e=>{if(e){w(void 0);var t,a=null==(t=new DOMParser().parseFromString(e,"text/xml").getElementsByTagName("ogc:FeatureId").item(0))?void 0:t.getAttribute("fid");if("none"===a){var n=r.id;if(!n)return;L(n)}else a&&L(a)}},onSaveError:e=>{if("object"==typeof e&&null!==e&&"errorFields"in e){var r;w((r=[],(e.errorFields||[]).forEach(e=>{Array.isArray(e.errors)&&r.push(...e.errors)}),r.map((e,t)=>(0,s.jsxs)(u().Fragment,{children:[e,t!==r.length-1&&(0,s.jsx)("br",{})]},t))))}else"string"==typeof e?w(e):w(a("EditFeatureFullForm.saveErrorMsg"))},onDeleteSuccess:()=>{w(void 0),C((0,e_.hr)(null))},onDeleteError:()=>{w(a("EditFeatureFullForm.deleteErrorMsg"))}}),(0,s.jsx)(rs,{tabConfig:g,initialValues:v,form:S})]})},rm=e=>{var r,t,a,n,i,u,f,m=e.layer,g=e.onLockSuccess,h=void 0===g?()=>{}:g,y=e.onLockError,v=void 0===y?()=>{}:y,x=e.onCreate,b=void 0===x?()=>{}:x,j=(0,d._)((0,o.useState)(!1),2),w=j[0],S=j[1],_=eK(),C=(r=(0,ea.Z)(),(0,o.useCallback)(e=>(0,c._)(function(){var t,a,n,i,s,o,u,c;return(0,p.Jh)(this,function(p){switch(p.label){case 0:if((n=e.layer.getSource())instanceof Q()&&(a=n.getUrl()),n instanceof er()&&(a=(i=n.getUrls())?i[0]:void 0),!a||(a.endsWith("?")&&(a=a.slice(0,-1)),!(s=(e=>{var r,t,a=e.feature.id,n=e.feature.properties;if(!a||!n)return void N.Z.warn("Either the id of the feature or its properties (or even both) aren't available");t="number"==typeof a?a:parseInt(a.split(".")[1],10);var l=Object.entries(n).find(e=>{var r=(0,d._)(e,2)[1];return r===t||r===t.toString()});if(!l)return void N.Z.warn("Count not detect the id property");var i=l[0],s=null==(r=e.layer.getSource())?void 0:r.getParams().LAYERS,o=document.createElementNS("https://www.opengis.net/wfs/2.0","LockFeature");o.setAttribute("service","WFS"),o.setAttribute("version","2.0.0"),o.setAttribute("expiry","300"),o.setAttribute("lockAction","SOME");var u=document.createElementNS("https://www.opengis.net/wfs/2.0","Query");u.setAttribute("typeNames",s);var c=document.createElementNS("https://www.opengis.net/fes/2.0","Filter"),p=document.createElementNS("https://www.opengis.net/fes/2.0","PropertyIsEqualTo"),f=document.createElementNS("https://www.opengis.net/fes/2.0","ValueReference"),m=document.createTextNode(i);f.appendChild(m);var g=document.createElementNS("https://www.opengis.net/fes/2.0","Literal"),h=document.createTextNode(t.toString());return g.appendChild(h),p.appendChild(f),p.appendChild(g),c.appendChild(p),u.appendChild(c),o.appendChild(u),o})({layer:e.layer,feature:e.feature}))))return[2];return o={"Content-Type":"application/xml"},[4,fetch(a,{method:"POST",headers:(null==(t=e.layer)?void 0:t.get("useBearerToken"))?(0,l._)({},o,(0,et.a)(null==r?void 0:r.getKeycloak())):o,body:new XMLSerializer().serializeToString(s)})];case 1:if(!(u=p.sent()).ok)throw Error("No successful response while executing a WFS-LockFeature");return[4,u.text()];case 2:if(c=p.sent(),new DOMParser().parseFromString(c,"text/xml").getElementsByTagName("wfs:FeaturesNotLocked").length>0)throw Error(`Error while locking a feature: ${c}`);return[2,c]}})})(),[r])),k=M(),L=(0,Z.S)(),T=(0,E.useTranslation)().t,P=A(e=>e.editFeature.userEditMode);return t=e=>(0,c._)(function(){var r,t;return(0,p.Jh)(this,function(a){switch(a.label){case 0:if(!(e.features.length&&(P.includes("UPDATE")||P.includes("DELETE"))))return[3,6];if(r=e.features[0],!m||!r)return[2];if(!K().wfsLockFeatureEnabled)return[3,5];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,C({layer:m,feature:r})];case 2:if(!(t=a.sent()))return[2];return k((0,e_.hr)(r)),h(t),[3,4];case 3:return v(a.sent()),[3,4];case 4:return[3,6];case 5:k((0,e_.hr)(r)),a.label=6;case 6:return[2]}})})(),n=(0,Z.S)(),i=(0,ea.Z)(),u=(0,o.useCallback)(e=>(0,c._)(function(){var r,s,o,u,c,d,f,g;return(0,p.Jh)(this,function(p){switch(p.label){case 0:if(!n||!m||(r=e.coordinate,!(s=n.getView().getResolution()))||(u=null==(o=m.getSource())?void 0:o.getFeatureInfoUrl(r,s,n.getView().getProjection(),{INFO_FORMAT:"application/json",BUFFER:10}),c={"Content-Type":"application/json"},!u))return[2];p.label=1;case 1:return p.trys.push([1,4,5,6]),n.getTargetElement().style.cursor="wait",[4,fetch(u,{method:"GET",headers:m.get("useBearerToken")?(0,l._)({},c,(0,et.a)(null==i?void 0:i.getKeycloak())):c})];case 2:if(!(d=p.sent()).ok)throw Error("No successful response");return[4,d.json()];case 3:return f=p.sent(),t&&t(f),[3,6];case 4:return g=p.sent(),N.Z.error("Error: ",g),a&&a(),[3,6];case 5:return n.getTargetElement().style.cursor="",[7];case 6:return[2]}})})(),[i,m,n,t,a]),f=(0,o.useCallback)(e=>{if(n&&m&&!e.dragging){var r=m.getData(e.pixel);if(r instanceof Uint8ClampedArray){var t=r&&r[3]>0;n.getTargetElement().style.cursor=t?"pointer":""}}},[m,n]),(0,o.useEffect)(()=>{if(n)return n.on("pointermove",f),n.on("singleclick",u),()=>{n.un("pointermove",f),n.un("singleclick",u)}},[n,f,u]),(0,s.jsxs)("div",{className:"edit-feature-switch",children:[P.includes("CREATE")&&(0,s.jsxs)(s.Fragment,{children:[P.includes("UPDATE")&&(0,s.jsx)("div",{children:T("EditFeatureSwitch.usageHint")}),(0,s.jsx)(ek.ZP,{loading:w,onClick:()=>(0,c._)(function(){var e;return(0,p.Jh)(this,function(r){switch(r.label){case 0:return[4,(0,c._)(function(){var e,r,t,a,n;return(0,p.Jh)(this,function(l){switch(l.label){case 0:if(!L||!m)return[2];l.label=1;case 1:return l.trys.push([1,3,4,5]),S(!0),[4,_(m)];case 2:if(!(t=l.sent()))return[2];switch(null==(a=null==(r=t.featureTypes[0])||null==(e=r.properties)?void 0:e.find(e=>eW(e.type)))?void 0:a.type){case"gml:MultiPoint":return[2,"MultiPoint"];case"gml:Point":return[2,"Point"];case"gml:MultiLineString":return[2,"MultiLineString"];case"gml:LineString":return[2,"LineString"];case"gml:MultiPolygon":return[2,"MultiPolygon"];case"gml:Polygon":return[2,"Polygon"];case"xsd:boolean":case"xsd:date":case"xsd:int":case"xsd:number":case"xsd:string":case void 0:return[2]}return[3,5];case 3:return n=l.sent(),N.Z.error(n),[3,5];case 4:return S(!1),[7];case 5:return[2]}})})()];case 1:if(!(e=r.sent()))return[2];return k((0,e_.hr)({type:"Feature",properties:{},geometry:{type:e,coordinates:[]}})),b(),[2]}})})(),children:T("EditFeatureSwitch.createFeature")})]}),!P.includes("CREATE")&&(P.includes("UPDATE")||P.includes("DELETE"))&&(0,s.jsx)("div",{children:T("EditFeatureSwitch.limitedUsageHint")})]})},rg=e=>{var r=(0,a._)({},(0,n._)(e)),t=(0,E.useTranslation)().t,u=(0,d._)((0,o.useState)(),2),f=u[0],g=u[1],h=(0,d._)((0,o.useState)(!1),2),y=h[0],v=h[1],x=(0,d._)((0,o.useState)(t("EditFeatureDrawer.featureEditor")),2),b=x[0],j=x[1],w=A(e=>e.editFeatureDrawerOpen),S=A(e=>e.editFeature.layerId),_=A(e=>e.editFeature.feature),C=A(e=>e.editFeature.formDirty),k=(0,Z.S)(),L=M(),P=eq(),F=en();(0,o.useEffect)(()=>{if(k&&S){var e=T.C.getLayerByOlUid(k,S);if(!e||!(0,H.us)(e))return void N.Z.warn(`Could not find layer with id ${S}`);j(`${t("EditFeatureDrawer.featureEditor")} - ${e.get("name")}`),g(e)}},[k,S,t]);var D=()=>(0,c._)(function(){return(0,p.Jh)(this,function(e){switch(e.label){case 0:return[4,(0,c._)(function(){var e,r,t;return(0,p.Jh)(this,function(a){switch(a.label){case 0:if(!f||!_||!_.id||!K().wfsLockFeatureEnabled)return[2];a.label=1;case 1:return a.trys.push([1,4,,5]),(e=new(Y())).setId(_.id),[4,P({layer:f,deleteFeatures:[],upsertFeatures:[e]})];case 2:if(!(r=a.sent()))return[2];return[4,F({layer:f,transaction:r})];case 3:return a.sent(),[3,5];case 4:return t=a.sent(),N.Z.error("Error while releasing the lock on the feature: ",t),[3,5];case 5:return[2]}})})()];case 1:return e.sent(),L((0,eY.Cp)()),L((0,e_.uQ)(!1)),L((0,e_.mc)()),v(!1),[2]}})})();return(0,s.jsxs)(eX,(0,i._)((0,l._)({className:"map-drawer edit-feature-drawer",onClose:()=>{f&&_&&C?m.Z.confirm({maskClosable:!1,title:t("EditFeatureDrawer.closeDrawerWarnTitle"),content:t("EditFeatureDrawer.closeDrawerWarnContent"),okType:"danger",onOk:D}):D()},open:w,title:b},r),{children:[!f&&(0,s.jsx)(z.Z,{message:t("EditFeatureDrawer.noLayerFoundError"),type:"error",showIcon:!0}),y&&(0,s.jsx)(z.Z,{message:t("EditFeatureDrawer.isFeatureLockedErrorMsg"),type:"error",showIcon:!0}),f&&S&&!_&&(0,s.jsx)(rm,{layer:f,onLockSuccess:()=>{v(!1)},onLockError:()=>{v(!0)},onCreate:()=>{v(!1)}}),f&&_&&(0,s.jsx)(rf,{feature:_,layer:f})]}))},rh=t(11843),ry=t(40440),rv=t(33327),rx=t.n(rv),rb=t(44290),rj=t.n(rb),rw=t(89747),rS=t(10269),r_=t.n(rS),rC=t(86849),rE=e=>{var r,t=e.opener,a=(0,ep._)(e,["opener"]),n=(0,E.useTranslation)().t,c=A(e=>e.appInfo),p=A(e=>e.logoPath),f=A(e=>e.description),g=(0,d._)((0,o.useState)(!1),2),h=g[0],y=g[1],v=()=>{y(!h)};return r=t?u().cloneElement(t,{onClick:v}):(0,s.jsx)("button",{onClick:v,children:"Open"}),(0,s.jsxs)(s.Fragment,{children:[r,(0,s.jsxs)(m.Z,(0,i._)((0,l._)({className:"application-info",title:n("ApplicationInfo.title"),centered:!0,open:h,onOk:v,onCancel:v,footer:null},a),{children:[(0,s.jsx)("img",{className:"logo",src:p,alt:"Logo"}),(0,s.jsx)("div",{className:"description",children:f}),(0,s.jsx)(rC.Z,{title:n("ApplicationInfo.clientVersionTitle"),value:"10.1.0"}),c.version&&c.buildTime&&(0,s.jsx)(rC.Z,{title:n("ApplicationInfo.backendVersionTitle"),value:`${c.version} (${c.buildTime})`})]}))]})},rN=e=>{var r,t,u=(0,a._)({},(0,n._)(e)),c=G(),d=(0,E.useTranslation)().t,p=A(e=>e.legal),f=(0,Z.S)(),m=(e,r)=>{c.forEach(t=>{if((n=t.integration)&&"footer"===n.placement&&(null==(a=t.integration)?void 0:a.placementOrientation)===e){var a,n,l,i,o=t.key,u=t.wrappedComponent;r.splice(null!=(i=null==(l=t.integration)?void 0:l.insertionIndex)?i:0,0,(0,s.jsx)(u,{},o))}})};return((0,o.useEffect)(()=>{f&&(f.getControls().getArray().find(e=>e instanceof rj())||f.addControl(new(rj())({target:"scale-line-container"})))},[f]),(0,o.useEffect)(()=>{f&&(f.getControls().getArray().find(e=>e instanceof rx())||f.addControl(new(rx())({coordinateFormat:(0,rw.createStringXY)(2),projection:f.getView().getProjection(),target:"mouse-position"})))},[f]),f)?(0,s.jsxs)("div",(0,i._)((0,l._)({className:"footer"},u),{children:[(0,s.jsx)("div",{className:"item-container left-items",children:(m("left",r=[(0,s.jsx)("div",{id:"scale-line-container","aria-label":"scale-line"},"scale-line-container"),(0,s.jsx)(rh.Z,{type:"vertical"},"scale-line-divider"),(0,s.jsxs)("div",{className:"scale-combo","aria-label":"scale-combo",children:[d("Footer.scale"),":\xa0",(0,s.jsx)(r_(),{"aria-label":"scalecombo-dropdown"}),(0,s.jsx)(rh.Z,{type:"vertical"})]},"scale-combo-container"),(0,s.jsxs)("div",{className:"reference-system","aria-label":"reference-system",children:[d("Footer.refSystem"),": ",f.getView().getProjection().getCode(),(0,s.jsx)(rh.Z,{type:"vertical"})]},"reference-system-container"),(0,s.jsxs)("div",{className:"mouse-position-wrapper",children:[d("Footer.mousePosition"),":\xa0",(0,s.jsx)("div",{id:"mouse-position",className:"mouse-position","aria-label":"mouse-position"})]},"mouse-position-container")]),r)}),(0,s.jsx)("div",{className:"item-container right-items",children:(t=[(0,s.jsx)(ek.ZP,{onClick:()=>{window.open(p.contact,"_blank")},type:"link",children:d("Footer.contact")},"open-contact"),(0,s.jsx)(ek.ZP,{onClick:()=>{window.open(p.imprint,"_blank")},type:"link",children:d("Footer.imprint")},"open-imprint"),(0,s.jsx)(ek.ZP,{onClick:()=>{window.open(p.privacy,"_blank")},type:"link",children:d("Footer.privacypolicy")},"open-privacy"),(0,s.jsx)(rE,{opener:(0,s.jsx)(ry.Z,{title:d("Footer.aboutTooltip"),children:(0,s.jsx)(ek.ZP,{type:"link","aria-label":"info-opener",children:d("Footer.about")})})},"application-info")],c.length>0&&m("right",t),t)})]})):(0,s.jsx)(s.Fragment,{})},rk="documentationbutton",rL=e=>{var r=e.className,t=(0,E.useTranslation)().t,a=r?`${rk} ${r}`:rk;return(0,s.jsx)(ry.Z,{title:t("DocumentationButton.tooltip"),children:(0,s.jsx)(ek.ZP,{type:"link","aria-label":"documentation-button",onClick:()=>window.open("/gis-docs","_blank"),className:a,icon:(0,s.jsx)(eF.G,{icon:eP.FDd})})})},rT=t(1695),rP=t(7739),rF=t.n(rP),rZ=t(36426),rD=t.n(rZ),rM=t(27547),rA=t(98122),rO=t(91754),rU=t(45540),rI=t(71136),r$=t(81316),rR=t(87044),rG=t(14622),rB=t(99956),rV=t.n(rB),rJ=t(76823),rz=t.n(rJ),rW=t(23173),rK=t.n(rW),rq=t(50268),rY=t.n(rq),rH=t(42212),rX=t(63646),rQ=t.n(rX),r0=t(4987),r1=e=>{var r,t,a=e.geocoderSearchEngine,n=e.dataSearchEngine,l=(0,Z.S)(),i=(0,E.useTranslation)().t,u=M(),f=(0,o.useRef)(null),m=(0,o.useMemo)(()=>new(e6()),[]),h=(0,d._)((0,o.useState)(!!a),2),y=h[0],v=h[1],b=(0,d._)((0,o.useState)(!!n),2),j=b[0],w=b[1],S=(0,d._)((0,o.useState)(null==(t=null==(r=K().search)?void 0:r.defaultUseViewBox)||t),2),_=S[0],C=S[1],k=(0,d._)((0,o.useState)(""),2),L=k[0],T=k[1],P=(0,d._)((0,o.useState)(!1),2),F=P[0],D=P[1],A=(0,d._)((0,o.useState)(!1),2),O=A[0],U=A[1],I=(0,d._)((0,o.useState)(!1),2),$=I[0],R=I[1],G=(0,d._)((0,o.useState)([]),2),B=G[0],V=G[1],J=ra();(0,o.useEffect)(()=>(window.addEventListener("mousedown",z),()=>{window.removeEventListener("mousedown",z)}),[]);var z=e=>{for(var r=e.target;r;)r=r.parentNode;f.current&&f.current.contains(e.target)||U(!1)},W=(0,o.useMemo)(()=>{var e={items:[{label:(0,s.jsx)(em.Z,{checked:_,onChange:e=>C(e.target.checked),children:i("MultiSearch.searchInViewBox")}),key:"viewbox"}]};return a&&e.items.push({label:(0,s.jsx)(em.Z,{checked:y,onChange:e=>v(e.target.checked),children:i("MultiSearch.searchGeocoder")}),key:"geocoder"}),n&&e.items.push({label:(0,s.jsx)(em.Z,{checked:j,onChange:e=>w(e.target.checked),children:i("MultiSearch.searchData")}),key:"data"}),e},[_,i,a,n,y,j]),q=(0,o.useCallback)(()=>(0,c._)(function(){var e,r,t,i,s,o,u,c,d,f,m,g;return(0,p.Jh)(this,function(p){switch(p.label){case 0:if(!l||!y&&!j)return[2];if(t=null!=(r=null==(e=K().search)?void 0:e.minChars)?r:3,L.length<t)return Y(),[2];if(D(!0),_&&(o=null==l?void 0:l.getView().getProjection(),(u=null==l||null==(s=l.getView())?void 0:s.calculateExtent())&&(i=(0,rA.transformExtent)(u,o,"EPSG:4326"))),c=[],!(j&&n))return[3,5];p.label=1;case 1:return p.trys.push([1,3,4,5]),[4,n(L,i)];case 2:if(!(d=p.sent()))throw Error("No response from data search engine.");return c.push(...d),[3,5];case 3:return f=p.sent(),N.Z.error("Error while data search: \n",f),[3,5];case 4:return y||D(!1),[7];case 5:if(!(y&&a))return[3,10];p.label=6;case 6:return p.trys.push([6,8,9,10]),[4,a(L,i)];case 7:if(!(m=p.sent()))throw Error("No response from geocoder search engine.");return c.push(...m),[3,10];case 8:return g=p.sent(),N.Z.error("Error while geocoder search: \n",g),[3,10];case 9:return D(!1),[7];case 10:return V(c.every(e=>0===e.features.length)?[]:c),U(!0),[2]}})})(),[l,y,j,L,_,n,a]);(0,o.useEffect)(()=>{var e,r,t=setTimeout(()=>{q()},null!=(r=null==(e=K().search)?void 0:e.delay)?r:1e3);return()=>clearTimeout(t)},[q]);var Y=()=>{V([])},H=e=>{var r=e.feature.get("layer");if(null==r?void 0:r.get("editable"))return[(0,s.jsx)(s.Fragment,{})]},X=(0,o.useMemo)(()=>new(rY())({stroke:new(rK())({color:"rgb(255,0,0)",width:2}),fill:new(rz())({color:"rgba(255,255,255, 0.5)"}),image:new(rV())({radius:10,fill:new(rz())({color:"rgba(255,255,255, 0.5)"}),stroke:new(rK())({color:"rgb(255,0,0)",width:3})})}),[]);return(0,s.jsxs)("div",{className:"multi-search",ref:f,children:[(0,s.jsxs)(rR.Z.Compact,{children:[(0,s.jsx)(g.Z,{value:L,disabled:!y&&!j,onChange:e=>{D(""!==e.target.value),T(e.target.value)},allowClear:!0,onFocus:()=>U(!0),placeholder:y&&j?i("MultiSearch.searchPlaceholder"):!y&&j?i("MultiSearch.searchPlaceholderDataOnly"):y&&!j?i("MultiSearch.searchPlaceholderGeocoderOnly"):void 0,prefix:(0,s.jsx)(rO.Z,{}),suffix:F?(0,s.jsx)(rU.Z,{}):null}),(0,s.jsx)(rG.Z,{menu:W,trigger:["click"],onOpenChange:R,open:$,children:(0,s.jsx)(ry.Z,{title:i("MultiSearch.settingsTooltip"),placement:"right",children:(0,s.jsx)(ek.ZP,{icon:(0,s.jsx)(rI.Z,{})})})})]}),(()=>{if(L.length<2||!O||F||!B)return null;var e=B.length;return 0===e?(0,s.jsx)("div",{className:"no-search-result-div",children:(0,s.jsx)(r$.Z,{image:r$.Z.PRESENTED_IMAGE_SIMPLE})}):(0,s.jsx)(rQ(),{searchResults:B,numTotal:e,accordion:!0,searchTerms:L.split(" "),actionsCreator:H,layerStyle:X,onClick:e=>{if(U(!1),(i=null==(a=e.feature.getGeometry())?void 0:a.getExtent())&&(null==l||l.getView().fit(i,{size:l.getSize(),padding:J(null==(n=K().search)?void 0:n.showSearchResultDrawer)})),(null==(r=K().search)?void 0:r.activateLayerOnClick)&&(c=null==(s=e)||null==(o=s.feature)?void 0:o.get("layer"))&&l&&!c.getVisible()&&(c.setVisible(!0),rH.kn.setParentsVisible(l,l.getLayerGroup().getLayers(),(0,x.getUid)(c))),null==(t=K().search)?void 0:t.showSearchResultDrawer){var r,t,a,n,i,s,o,c,d,p=m.writeFeatureObject(e.feature);null==(d=p.properties)||delete d.layer,u((0,r0.ef)({geoJSONFeature:p,layerId:(0,x.getUid)(e.feature.get("layer")),drawerVisibility:!0})),T("")}}})})()]})},r2=e=>{var r,t,i,u,f,m,g,h,y,v,x,b,j,w=(0,a._)({},(0,n._)(e)),S=A(e=>e.searchEngines.includes("nominatim")),_=A(e=>e.searchEngines.includes("solr")),C=A(e=>e.searchEngines.includes("wfs")),k=(r=(0,Z.S)(),t=e1(),i=eK(),u=(0,o.useCallback)((e,r)=>e.replace(/{\s*(\w+?)\s*}/g,(e,t)=>r.getProperties()[t]||""),[]),f=(0,o.useCallback)((e,r,t)=>{var a=null==t?void 0:t.get("searchConfig");if(null==a?void 0:a.displayTemplate)return u(a.displayTemplate,r);var n=!0,l=!1,i=void 0;try{for(var s,o=Object.entries(r.getProperties())[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var c=(0,d._)(s.value,2),p=c[0],f=c[1],m=null==f?void 0:f.toString();if(m.toLowerCase().indexOf(null==e?void 0:e.toLowerCase())>-1)return`${m} [${p}]`}}catch(e){l=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(l)throw i}}return r.getId()},[u]),(0,o.useCallback)((e,a)=>(0,c._)(function(){var n,l,s,o,u,c,d,m,g,h,y,v,x,b,j,w,S,_,C,E;return(0,p.Jh)(this,function(k){switch(k.label){case 0:if(!r)return[2];if(0===(n=r.getAllLayers().filter(e=>e.get("searchable"))).length)return N.Z.warn("No queryable layer found."),[2];l=[],s=[],o=!0,u=!1,c=void 0,k.label=1;case 1:k.trys.push([1,6,7,8]),d=function(){var n,o,u,c,d,f,m,h,y,v,x,b,j;return(0,p.Jh)(this,function(p){switch(p.label){case 0:if(n=g.value,!(0,H.us)(n))return N.Z.warn("Layer type not supported in search: ",n),[2,"continue"];if(!((d=null==n?void 0:n.get("searchConfig"))&&d.attributes))return N.Z.warn("No search configuration given for layer: ",n),[2,"continue"];return[4,i(n)];case 1:if(!(f=p.sent()))return N.Z.warn("No successful DescribeFeatureType for layer: ",n),[2,"continue"];if(!(m=null==(u=n.getSource())||null==(o=u.getParams())?void 0:o.LAYERS))return N.Z.warn("No layer name available for layer: ",n),[2,"continue"];if(!(h=f.featureTypes.find(e=>{var r;return e.typeName===m||e.typeName===(null==(r=m.split(":"))?void 0:r[1])})))return N.Z.warn("No corresponding feature type for layer: ",n),[2,"continue"];if(0===(y=d.attributes.map(r=>{var t=h.properties.find(e=>e.name===r);if(!t)return N.Z.warn(`Attribute "${r}" not found in feature type "${h.typeName}" for layer "${n.get("name")}".`),null;if("string"===t.localType)return(0,rM.like)(r,`*${e}*`,"*",".","!",!1);if("number"!==t.localType&&"int"!==t.localType)return N.Z.warn(`Attribute "${r}" with type "${t.localType}" not supported for search in layer "${n.get("name")}".`),null;var a=Number(e);return isNaN(a)?null:(0,rM.equalTo)(r,a)}).filter(e=>null!==e)).length)return N.Z.warn("No valid filter available for layer: ",n),[2,"continue"];return v=[],d.displayTemplate&&(x=/{\s*(\w+?)\s*}/g,v.push(...Array.from(d.displayTemplate.matchAll(x),e=>e[1]))),(null==(c=K().search)?void 0:c.showSearchResultDrawer)&&v.push(...(null==(j=d.resultDrawerConfig)||null==(b=j.children)?void 0:b.map(e=>e.propertyName))||[]),l.push(t({layer:n,filter:1===y.length?y[0]:(0,rM.or)(...y),bbox:a?(0,rA.transformExtent)(a,"EPSG:4326",r.getView().getProjection()):void 0,maxFeatures:10,propertyNames:Array.from(new Set(v))})),s.push(n),[2]}})},m=n[Symbol.iterator](),k.label=2;case 2:if(o=(g=m.next()).done)return[3,5];return[5,(0,p.XA)(d())];case 3:k.sent(),k.label=4;case 4:return o=!0,[3,2];case 5:return[3,8];case 6:return h=k.sent(),u=!0,c=h,[3,8];case 7:try{o||null==m.return||m.return()}finally{if(u)throw c}return[7];case 8:return[4,Promise.allSettled(l)];case 9:v=(y=k.sent().map((e,r)=>({value:"fulfilled"===e.status?e.value:void 0,reason:"rejected"===e.status?e.reason:void 0,status:e.status,layer:s[r]}))).filter(e=>"fulfilled"===e.status),y.filter(e=>"rejected"===e.status).forEach(e=>{N.Z.error(`Error while fetching the layer search results for layer "${e.layer.get("name")}": `,e.reason)}),x=new(e6()),b=[],j=!0,w=!1,S=void 0;try{for(_=function(){var t=E.value,a=x.readFeatures(t.value,{featureProjection:r.getView().getProjection()});a.forEach(r=>{r.set("title",f(e,r,t.layer)),r.set("layer",t.layer)}),b.push({title:t.layer.get("name"),features:a})},C=v[Symbol.iterator]();!(j=(E=C.next()).done);j=!0)_()}catch(e){w=!0,S=e}finally{try{j||null==C.return||C.return()}finally{if(w)throw S}}return[2,b]}})})(),[t,i,f,r])),L=(m=(0,Z.S)(),g=(0,ea.Z)(),h=(0,o.useCallback)(e=>(0,c._)(function(){var r,t,a,n,i,s,o,u,c;return(0,p.Jh)(this,function(d){switch(d.label){case 0:return a={q:e.query,rows:null!=(r=e.rowsPerQuery)?r:100,defType:null!=(t=e.queryParser)?t:"edismax"},e.fieldList?a.qf=e.fieldList:a.qf=null!=(n=e.coreName)?n:"search",e.viewBox&&(a.fq=`geometry:[${e.viewBox[1]},${e.viewBox[0]} TO ${e.viewBox[3]},${e.viewBox[2]}]`),e.useSolrHighlighting&&(a.hl=!0,a["hl.fl"]="*",a["hl.tag.pre"]=null!=(i=e.tagPre)?i:"<b>",a["hl.tag.post"]=null!=(s=e.tagPost)?s:"</b>",a["hl.requireFieldMatch"]=null==(o=e.requireFieldMatch)||o),u={"Content-Type":"application/json"},[4,fetch(e.searchUrl,{method:"POST",headers:(0,l._)({},u,(0,et.a)(null==g?void 0:g.getKeycloak())),body:JSON.stringify(a)})];case 1:if(!(c=d.sent()).ok)throw Error("Failed to execute Solr query");return[4,c.json()];case 2:return[2,d.sent()]}})})(),[g]),y=(0,o.useCallback)((e,r)=>e.replace(/{\s*(\w+?)\s*}/g,(e,t)=>{var a;return(null==(a=r[t])?void 0:a.toString())||""}),[]),v=(0,o.useCallback)((e,r,t)=>{if(!m)return"";var a=T.C.getLayerByNameParam(m,r.featureType[0]),n=null==a?void 0:a.get("searchConfig"),l=["geometry"],i="";if(null==n?void 0:n.displayTemplate)return y(n.displayTemplate,r);if(t){var s=Object.keys(t).filter(e=>!l.includes(e));if(s.length>0){var o=t[s[0]];return`${o} [${s[0]}]`}}return Object.keys(r).filter(e=>!l.includes(e)).forEach(t=>{var a,n=null==(a=r[t])?void 0:a.toString();!i&&n.toLowerCase().indexOf(e.toLowerCase())>-1&&(i=`${n} [${t}]`)}),i||(i=r.id),i},[m,y]),x=(0,o.useCallback)((e,r)=>{var t=["category","id","featureType","geometry","search","_version_"];Object.keys(r).filter(e=>!t.includes(e)).forEach(t=>{var a=r[t];void 0!==a&&e.set(t,a)})},[]),(0,o.useCallback)((e,r)=>(0,c._)(function(){var t,a,n,i,s,o,u,c,f,g,y,b,j,w,S,_,C,E,k,L,P,F,Z,D,M,A,O,U,I,$,R,G,B;return(0,p.Jh)(this,function(p){switch(p.label){case 0:var V,J,z,W,q,X;if(!m)return[2];i=null!=(n=null==(t=K().search)?void 0:t.solrBasePath)?n:"/search/query",J=(V={searchValue:e,map:m}).searchValue,z=V.map,W=J.trim().replaceAll(/[()\\\-_.//]/g," ").split(" ").map(e=>e.trim()).filter(e=>""!==e),q=[],X=z.getAllLayers().filter(e=>e.get("searchable")),Object.entries(rF()(X,e=>{var r;return null==(r=e.get("searchConfig"))?void 0:r.attributes})).forEach(e=>{var r=(0,d._)(e,2),t=r[0],a=r[1].filter(e=>(0,H.us)(e)).map(e=>{var r,t;return null==(t=e.getSource())||null==(r=t.getParams())?void 0:r.LAYERS}).map(e=>`featureType:"${e}"`).join(" OR "),n=`(${a}) AND (${W.map(e=>`(${e.trim()}^4 OR *${e.trim()}*^2 OR ${e.trim()}~1)`).join(" AND ")})`;q.push({query:n,fieldList:"undefined"!==t?t.split(",").join(" "):void 0})}),s=q,o=[],u=!0,c=!1,f=void 0;try{for(g=s[Symbol.iterator]();!(u=(y=g.next()).done);u=!0)b=y.value,o.push(h({searchUrl:i,query:b.query,fieldList:b.fieldList,rowsPerQuery:null==(w=K().search)||null==(j=w.solrQueryConfig)?void 0:j.rowsPerQuery,queryParser:null==(_=K().search)||null==(S=_.solrQueryConfig)?void 0:S.queryParser,coreName:null==(C=K().search)?void 0:C.coreName,useSolrHighlighting:null==(E=K().search)?void 0:E.useSolrHighlighting,tagPre:null==(L=K().search)||null==(k=L.solrQueryConfig)?void 0:k.tagPre,tagPost:null==(F=K().search)||null==(P=F.solrQueryConfig)?void 0:P.tagPost,requireFieldMatch:null==(D=K().search)||null==(Z=D.solrQueryConfig)?void 0:Z.requireFieldMatch,viewBox:r}))}catch(e){c=!0,f=e}finally{try{u||null==g.return||g.return()}finally{if(c)throw f}}return[4,Promise.allSettled(o)];case 1:return A=(M=p.sent().map(e=>({value:"fulfilled"===e.status?e.value:void 0,reason:"rejected"===e.status?e.reason:void 0,status:e.status}))).filter(e=>"fulfilled"===e.status),M.filter(e=>"rejected"===e.status).forEach(e=>{N.Z.error("Error while fetching the solr results for layer ",e.reason)}),O=A.flatMap(e=>{var r,t;return null==(t=e.value)||null==(r=t.response)?void 0:r.docs}).filter(e=>e),U=Object.assign({},...A.map(e=>{var r;return null==(r=e.value)?void 0:r.highlighting})),I=new(rD()),$=[],(null==(a=K().search)?void 0:a.groupByCategory)?R=rF()(O,e=>{var r;return null==e||null==(r=e.category)?void 0:r[0]}):(G=m.getAllLayers().filter(e=>e.get("searchable")),B=O.map(e=>{var r,t=null==(r=G.filter(e=>(0,H.us)(e)).find(r=>{var t,a,n;return(null==(a=r.getSource())||null==(t=a.getParams())?void 0:t.LAYERS)===(null==e||null==(n=e.featureType)?void 0:n[0])}))?void 0:r.get("name");return(0,l._)({layerTitle:t},e)}),R=rF()(B,e=>null==e?void 0:e.layerTitle)),Object.keys(R).forEach(r=>{var t=R[r].map(r=>{if(null==r||null==(l=r.geometry)?void 0:l[0]){var t=r.id,a=I.readGeometry(r.geometry[0],{dataProjection:"EPSG:4326",featureProjection:m.getView().getProjection()}),n=new(Y())({geometry:a});if(x(n,r),n.set("title",v(e,r,null==U?void 0:U[t])),null==(i=r.featureType)?void 0:i[0]){var l,i,s,o,u=T.C.getLayerByNameParam(m,null==(o=r.featureType)?void 0:o[0]);u&&(n.set("layer",u),s=u.get("name"))}else s=t.substring(0,t.lastIndexOf("_"));return n.set("ftName",s),n}}).filter(e=>e);$.push({title:r,features:t})}),[2,$]}})})(),[x,h,v,m])),P=(b=(0,Z.S)(),j=(0,E.useTranslation)().t,(0,o.useCallback)((e,r)=>(0,c._)(function(){var t,a,n,l,i;return(0,p.Jh)(this,function(s){switch(s.label){case 0:if(!b)return[2];return[4,(0,rT.AH)({bounded:r?1:void 0,viewBox:r?null==r?void 0:r.toString():void 0,countryCodes:"",nominatimBaseUrl:null!=(a=null==(t=K().search)?void 0:t.nominatimUrl)?a:"https://nominatim.openstreetmap.org/search?"})(e)];case 1:return n=s.sent(),l=new(e6()),i=null==n?void 0:n.features.filter(e=>!ej()(null==e?void 0:e.properties.geojson)).map(e=>{var r=l.readFeature(e.geometry,{dataProjection:"EPSG:4326",featureProjection:b.getView().getProjection()});if(!Array.isArray(r))return r.setProperties(e.properties),r.set("title",e.properties.display_name),r}).filter(e=>void 0!==e),[2,[{title:j("useNominatimSearchEngine.title"),features:null!=i?i:[]}]]}})})(),[b,j]));return S||_||C?(0,s.jsx)("div",{className:"search","aria-label":"search-field",children:(0,s.jsx)(r1,(0,l._)({"aria-label":"search",geocoderSearchEngine:(()=>{if(S)return P})(),dataSearchEngine:_&&C?void N.Z.warn("Both solr and wfs search are configured. Only one of them can be used at the same time."):_?L:C?k:void 0},w))}):(N.Z.warn("Neither nominatim, solr nor wfs search is configured."),(0,s.jsx)(s.Fragment,{}))},r3=t(88495),r4=t(39111),r5=e=>{var r=e.className,t=e.imageSrc,a=e.userMenu,n=e.userName,o=e.style,u=(0,ep._)(e,["className","imageSrc","userMenu","userName","style"]),c="userchip",d=()=>{var e=r?`${r} ${c}`:c;return(0,s.jsxs)("div",{className:e,style:o,children:[(0,s.jsx)(r4.Z,(0,i._)((0,l._)({src:t,size:"large",className:"userimage"},u),{children:t?"":eE()(n)?n.split(" ").map(e=>{var r;return null!=(r=e[0])?r:""}).join("").toUpperCase():"??"})),(0,s.jsx)("span",{className:"username",children:n})]})};return(null==a?void 0:a.items)?(0,s.jsx)(rG.Z,{menu:a,trigger:["click"],getPopupContainer:()=>document.getElementsByClassName(c)[0],children:d()}):d()},r6=()=>{var e,r,t,a,n,l,i,u,f,m,g,h,y,v,x,b,j,w,S,_,C,N,k,L,T,P=(0,E.useTranslation)().t,F=(0,d._)((0,o.useState)(),2),Z=F[0],D=F[1],M=(0,ea.Z)(),O=null==M?void 0:M.getKeycloak(),U=A(e=>e.user);return(0,o.useEffect)(()=>{(0,c._)(function(){return(0,p.Jh)(this,function(e){switch(e.label){case 0:return[4,null==O?void 0:O.createLoginUrl()];case 1:return D(e.sent()),[2]}})})()},[O]),(0,s.jsx)("div",{className:"user-menu",children:e4()(U)?(0,s.jsx)(ry.Z,{title:P("UserMenu.loginTooltip"),children:(0,s.jsx)(ek.ZP,{type:"link",onClick:()=>{O&&O.login()},icon:(0,s.jsx)(eF.G,{icon:eP.Yem}),children:P("UserMenu.loginMenuTitle")})}):(0,s.jsx)(r5,{size:"small",imageSrc:(r=(e={email:null!=(T=null==(L=U.providerDetails)?void 0:L.email)?T:"",size:28}).email,t=e.size,a=e.rating,n=e.defaultImage,l=e.force,i=(void 0===r?"":r).toLowerCase(),u=(0,r3.md5)(i),f=`https://www.gravatar.com/avatar/${u}?s=${void 0===t?80:t}&r=${void 0===a?"g":a}&d=${void 0===n?"identicon":n}`,void 0!==l&&l&&(f=`${f}&f=y`),f),userName:(0,s.jsx)(eF.G,{icon:eP.gc2}),userMenu:(S={key:"username",label:(0,s.jsxs)("div",{className:"username-menu-item","aria-label":"user-name",children:[(0,s.jsx)("span",{className:"item-username",children:null!=(b=null==(m=U.providerDetails)?void 0:m.username)?b:U.authProviderId}),(0,s.jsx)("br",{}),(0,s.jsx)("span",{className:"item-fullname",children:`${null!=(j=null==(g=U.providerDetails)?void 0:g.firstName)?j:""} ${null!=(w=null==(h=U.providerDetails)?void 0:h.lastName)?w:""}`})]})},_={type:"divider"},C={key:"settings",icon:(0,s.jsx)(eF.G,{icon:eP.gNZ}),label:P("UserMenu.settingsMenuTitle")},N={key:"logout",icon:(0,s.jsx)(eF.G,{icon:eP.HEx}),label:(0,s.jsx)("div",{"aria-label":"logout",children:P("UserMenu.logoutMenuTitle")})},{items:Array.isArray(k=null==O||null==(x=O.tokenParsed)||null==(v=x.resource_access)||null==(y=v.account)?void 0:y.roles)&&k.indexOf("manage-account")>-1?[S,_,C,_,N]:[S,_,N],onClick:e=>{switch(e.key){case"settings":O&&O.accountManagement();break;case"logout":O&&O.logout({redirectUri:Z})}}})})})},r8=e=>{var r,t,o,u=(0,a._)({},(0,n._)(e)),c=A(e=>e.title),d=A(e=>e.logoPath),p=A(e=>e.userMenu.visible),f=G(),m=(e,r)=>{f.forEach(t=>{if((n=t.integration)&&"header"===n.placement&&(null==(a=t.integration)?void 0:a.placementOrientation)===e){var a,n,l,i,o=t.key,u=t.wrappedComponent;r.splice(null!=(i=null==(l=t.integration)?void 0:l.insertionIndex)?i:0,0,(0,s.jsx)(u,{},o))}})};return(0,s.jsxs)("div",(0,i._)((0,l._)({className:"header"},u),{children:[(0,s.jsx)("div",{className:"item-container left-items",children:(m("left",r=[(0,s.jsx)("img",{className:"logo","aria-label":"logo",src:d},"logo"),(0,s.jsx)("div",{className:"title","aria-label":"title",children:c},"title")]),r)}),(0,s.jsx)("div",{className:"item-container center-items",children:(m("center",t=[(0,s.jsx)(r2,{"aria-label":"search-input",name:"search-input",className:"search-input"},"search")]),t)}),(0,s.jsx)("div",{className:"item-container right-items",children:(m("right",o=[(()=>{if(K().documentationButtonVisible)return(0,s.jsx)(rL,{},"docs-button")})(),(()=>{var e;if(p&&(null==(e=K().keycloak)?void 0:e.enabled))return(0,s.jsx)("div",{"aria-label":"user-menu",children:(0,s.jsx)(r6,{},"user-menu")},"user-menu")})()].filter(e=>void 0!==e)),o)})]}))},r7=t(29097),r9=t(28641),te=t.n(r9),tr=t(23578),tt=t(91885),ta=e=>{var r=e.layer,t=(0,ep._)(e,["layer"]),a=(0,d._)((0,o.useState)(!1),2),n=a[0],u=a[1],f=(0,d._)((0,o.useState)(),2),m=f[0],g=f[1],h=(0,d._)((0,o.useState)(),2),y=h[0],v=h[1],x=(0,ea.Z)(),b=(0,E.useTranslation)().t,j=(0,o.useCallback)(()=>(0,c._)(function(){var e;return(0,p.Jh)(this,function(t){switch(t.label){case 0:if(t.trys.push([0,2,3,4]),u(!0),g(""),!r||!r.get("shogunId"))throw Error("No layer provided or the layer has no shogunId set");return[4,null==x?void 0:x.layer().findOne(r.get("shogunId"))];case 1:return v(t.sent()),[3,4];case 2:return e=t.sent(),N.Z.error(e),g(b("LayerConfiguration.errorMessage")),[3,4];case 3:return u(!1),[7];case 4:return[2]}})})(),[b,x,r]);return((0,o.useEffect)(()=>{j()},[j]),m)?(0,s.jsx)(z.Z,{type:"error",closable:!0,message:m}):(0,s.jsx)(tt.Z,{spinning:n,children:(0,s.jsx)("pre",(0,i._)((0,l._)({className:"layer-configuration"},t),{children:(0,s.jsx)("code",{children:JSON.stringify(y,null,"  ")})}))})},tn=e=>{var r=e.layer,t=(0,ep._)(e,["layer"]),a=(0,d._)((0,o.useState)(!1),2),n=a[0],u=a[1],f=(0,d._)((0,o.useState)(),2),m=f[0],g=f[1],h=(0,d._)((0,o.useState)(),2),y=h[0],v=h[1],x=(0,ea.Z)(),b=(0,E.useTranslation)().t,j=(0,o.useCallback)(()=>(0,c._)(function(){var e;return(0,p.Jh)(this,function(t){switch(t.label){case 0:if(!r||!(0,H.us)(r))return[2];t.label=1;case 1:return t.trys.push([1,3,4,5]),u(!0),v(""),g(void 0),[4,L.Z.getWmsCapabilitiesByLayer(r,{headers:(0,l._)({},r.get("useBearerToken")?(0,l._)({},(0,et.a)(null==x?void 0:x.getKeycloak())):void 0)})];case 2:return g(t.sent()),[3,5];case 3:return e=t.sent(),N.Z.error(e),v(b("LayerDetails.errorMessage")),[3,5];case 4:return u(!1),[7];case 5:return[2]}})})(),[b,x,r]);(0,o.useEffect)(()=>{j()},[j]);var w=()=>{var e;if(r&&(0,H.us)(r))return null==(e=r.getSource())?void 0:e.getParams().LAYERS},S=()=>{if(r&&(0,H.us)(r)){if(r.getSource()instanceof Q()&&(e=r.getSource().getUrl()),r.getSource()instanceof er()){var e,t=r.getSource().getUrls();e=t?t[0]:void 0}if(e)return k.V.createValidGetCapabilitiesRequest(e,"WMS","1.3.0")}},_=()=>{var e,r,t=null==m||null==(r=m.Capability)||null==(e=r.Layer)?void 0:e.Layer,a=w();return Array.isArray(t)?null==t?void 0:t.find(e=>(null==e?void 0:e.Name)===a):t},C=()=>{var e=_();if(e&&e.EX_GeographicBoundingBox)return[e.EX_GeographicBoundingBox.westBoundLongitude,e.EX_GeographicBoundingBox.southBoundLatitude,e.EX_GeographicBoundingBox.eastBoundLongitude,e.EX_GeographicBoundingBox.northBoundLatitude].join(", ")},T=()=>{var e=_();if(e)return e.MinScaleDenominator},P=()=>{var e=_();if(e)return e.MaxScaleDenominator},F=()=>{var e=_();if(e)return e.Abstract},Z=()=>{var e;return null==m||null==(e=m.Service)?void 0:e.Abstract},D=()=>{var e,r;return null==m||null==(r=m.Service)||null==(e=r.ContactInformation)?void 0:e.ContactElectronicMailAddress},M=()=>{var e=_();if(e)return e.Title},A=()=>{var e;return null==m||null==(e=m.Service)?void 0:e.AccessConstraints};return y?(0,s.jsx)(z.Z,{type:"error",closable:!0,message:y}):(0,s.jsx)(tt.Z,{spinning:n,children:(0,s.jsxs)(ef.Z,(0,i._)((0,l._)({className:"layer-details",layout:"horizontal",size:"small",labelAlign:"left",labelWrap:!0,labelCol:{flex:"150px"}},t),{children:[(0,s.jsx)(ef.Z.Item,{name:"layerName",label:b("LayerDetails.layerNameLabel"),children:(0,s.jsx)("span",{children:w()?w():b("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(ef.Z.Item,{name:"layerTitle",label:b("LayerDetails.layerTitleLabel"),children:(0,s.jsx)("span",{children:M()?M():b("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(ef.Z.Item,{name:"service-abstract",label:b("LayerDetails.serviceAbstractLabel"),children:(0,s.jsx)("span",{children:Z()?Z():b("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(ef.Z.Item,{name:"abstract",label:b("LayerDetails.abstractLabel"),children:(0,s.jsx)("span",{children:F()?F():b("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(ef.Z.Item,{name:"accessConstraints",label:b("LayerDetails.accessConstraintsLabel"),children:(0,s.jsx)("span",{children:A()?A():b("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(ef.Z.Item,{name:"CapabilitiesUrl",label:b("LayerDetails.capabilitiesUrlLabel"),children:(0,s.jsx)("a",{href:S(),children:S()})}),(0,s.jsx)(ef.Z.Item,{name:"contact",label:b("LayerDetails.contactLabel"),children:D()?(0,s.jsx)("a",{href:`mailto:${D()}`,children:D()}):(0,s.jsx)("span",{children:b("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(ef.Z.Item,{name:"minScale",label:b("LayerDetails.minScaleLabel"),children:(0,s.jsx)("span",{children:T()?T():b("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(ef.Z.Item,{name:"maxScale",label:b("LayerDetails.maxScaleLabel"),children:(0,s.jsx)("span",{children:P()?P():b("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(ef.Z.Item,{name:"bbox",label:b("LayerDetails.bboxLabel"),children:(0,s.jsx)("span",{children:C()?C():b("LayerDetails.noDataPlaceholder")})})]}))})},tl=e=>{var r=(0,a._)({},(0,n._)(e)),t=(0,d._)((0,o.useState)(),2),u=t[0],c=t[1],p=(0,d._)((0,o.useState)(!1),2),f=p[0],g=p[1],h=A(e=>e.layerDetailsModal.visible),y=A(e=>e.layerDetailsModal.layerId),v=M(),x=(0,Z.S)(),b=(0,E.useTranslation)().t;return(0,o.useEffect)(()=>{if(x){if(!y)return void c(void 0);var e=T.C.getLayerByOlUid(x,y);e instanceof te()&&c(e)}},[x,y]),(0,s.jsxs)(m.Z,(0,i._)((0,l._)({className:"layer-details-modal",title:(0,s.jsxs)("div",{className:"title-group",children:[(0,s.jsx)("span",{children:b("LayerDetailsModal.title",{layerName:null==u?void 0:u.get("name")})}),(null==u?void 0:u.get("shogunId"))&&(0,s.jsx)(ry.Z,{title:b(f?"LayerDetailsModal.internalConfigurationButtonTooltipPressed":"LayerDetailsModal.internalConfigurationButtonTooltip"),children:(0,s.jsx)(ek.ZP,{type:"link",className:f?"pressed":"",icon:(0,s.jsx)(r7.Z,{}),onClick:()=>{g(!f)}})})]}),open:h,onCancel:()=>{v((0,tr.Cp)()),v((0,tr.uF)(void 0))},width:800,footer:!1},r),{children:[(0,s.jsx)(tn,{layer:u,hidden:f}),(null==u?void 0:u.get("shogunId"))&&(0,s.jsx)(ta,{layer:u,hidden:!f})]}))},ti=t(26501),ts=t(33405),to=t.n(ts),tu=()=>{var e=(0,E.useTranslation)().t,r=(0,Z.S)(),t=(0,d._)((0,o.useState)(!1),2),a=t[0],n=t[1],i=A(e=>e.mapToolbarVisible.visible),u=A(e=>e.stylingDrawerVisibility),c=A(e=>e.editFeatureDrawerOpen),p=A(e=>e.searchResult.drawerVisibility),f={tooltipPlacement:"left",tooltipProps:{mouseEnterDelay:.5}};return(0,s.jsx)(s.Fragment,{children:i&&(0,s.jsxs)(rn,{id:"map-toolbar",className:u||c||p?"drawer-open":"",alignment:"vertical",role:"toolbar",children:[r&&(0,s.jsx)(to(),(0,l._)({"aria-label":"zoom-in",tooltip:e("MapToolbar.zoomInTooltip"),icon:(0,s.jsx)(eF.G,{icon:eP.r8p})},f)),r&&(0,s.jsx)(to(),(0,l._)({"aria-label":"zoom-out",tooltip:e("MapToolbar.zoomOutTooltip"),delta:-1,icon:(0,s.jsx)(eF.G,{icon:eP.Kl4})},f)),r&&(0,s.jsx)(ti.GeoLocationButton,(0,l._)({"aria-label":"geolocation",showMarker:!0,follow:!0,pressed:a,onChange:()=>n(!a),tooltip:e("MapToolbar.geoLocation"),icon:(0,s.jsx)(eF.G,{icon:eP.iUi}),pressedIcon:(0,s.jsx)(eF.G,{icon:eP.GrN})},f))]})})},tc=t(35586),td=t.n(tc),tp=t(41357),tf=t.n(tp),tm=t(50876),tg=t.n(tm),th=t(49968),ty=e=>{let r;var t=e.value,a=e.attributeName,n=e.resultDrawerConfig,l=t;if(Array.isArray(t)&&1===t.length&&"string"==typeof t[0]&&(l=t[0]),"string"==typeof l&&(r=l,/^(?:\w+:)?\/\/([^\s.]+\.\S{2}|localhost[:?\d]*)\S*$/.test(r))&&n){var i,o,u=null==(i=n.children)?void 0:i.find(e=>e.displayName===a),c=(null==u||null==(o=u.fieldProps)?void 0:o.urlDisplayValue)||l;return(0,s.jsx)("a",{href:l,target:"_blank",rel:"noopener noreferrer",children:c})}return(0,s.jsx)(s.Fragment,{children:null==l||"object"==typeof l?"":l})},tv=e=>{var r,t,u=(0,a._)({},(0,n._)(e)),c=M(),d=(0,Z.S)(),p=A(e=>e.searchResult.drawerVisibility),f=A(e=>e.searchResult.geoJSONFeature),m=A(e=>e.searchResult.layerId),g=(0,o.useMemo)(()=>f?new(e6())().readFeature(f):null,[f]),h=(0,o.useMemo)(()=>m&&d?T.C.getLayerByOlUid(d,m):null,[m,d]),y=(0,th.n)(()=>new(td())({source:new(tf()),style:new(rY())({stroke:new(rK())({color:"rgb(255,0,0)",width:2}),fill:new(rz())({color:"rgba(255,255,255, 0.5)"}),image:new(rV())({radius:10,fill:new(rz())({color:"rgba(255,255,255, 0.5)"}),stroke:new(rK())({color:"rgb(255,0,0)",width:3})})})}),[]),v=(0,o.useCallback)(e=>{y&&y.getSource()&&e&&(y.getSource().clear(),y.getSource().addFeature(e))},[y]);(0,o.useEffect)(()=>{g&&d&&v(g)},[g,d,v]);var x=(0,E.useTranslation)().t,b=null!=(t=null==h||null==(r=h.get("searchConfig"))?void 0:r.resultDrawerConfig)?t:null;(0,o.useEffect)(()=>{g&&(null==b?void 0:b.children)&&b.children.map(e=>e.propertyName).forEach(e=>{var r=g.get(e);Array.isArray(r)&&1===r.length&&"string"==typeof r[0]&&g.set(e,r[0])})},[g,null==b?void 0:b.children]);var j=(0,o.useMemo)(()=>(null==b?void 0:b.children)?b.children.map(e=>e.propertyName):void 0,[b]),w=(0,o.useMemo)(()=>(null==b?void 0:b.children)?Object.fromEntries(b.children.map(e=>{var r;return[e.propertyName,null!=(r=e.displayName)?r:""]})):void 0,[b]),S=[{title:x("FeaturePropertyGrid.key"),dataIndex:"attributeName",key:"attributeName",width:"50%",ellipsis:!0,defaultSortOrder:"ascend",sorter:(e,r)=>e.key.localeCompare(r.key)},{title:x("FeaturePropertyGrid.value"),dataIndex:"attributeValue",key:"attributeValue",width:"50%",ellipsis:!0,render:(e,r)=>(0,s.jsx)(ty,{value:e,attributeName:r.attributeName,resultDrawerConfig:b})}];return(0,s.jsx)(eX,(0,i._)((0,l._)({title:x("SearchResultDrawer.title"),placement:"right",onClose:()=>{c((0,r0.ef)({drawerVisibility:!1,layerId:null,geoJSONFeature:null})),null==y||y.getSource().clear()},open:p,maskClosable:!1,mask:!1},u),{children:(0,s.jsxs)("div",{children:[g&&(0,s.jsx)("h3",{children:((e,r)=>{if(!e)return"";if(!r){var t;return null!=(t=e.get("title"))?t:""}var a=r.match(/^{(.+)}$/);if(a){var n,l=a[1];return null!=(n=e.get(l))?n:""}return r})(g,null==b?void 0:b.title)}),g&&Object.keys(g.getProperties()).length>1&&(0,s.jsx)(tg(),{className:"property-grid",feature:g,attributeFilter:j,size:"small",sticky:!0,attributeNames:w,columns:S,scroll:{scrollToFirstRowOnChange:!0,y:"calc(100% - 90px)"}})]})}))},tx=t(35757),tb=t(30501),tj=t(16144),tw=t(5652),tS=t(96459),t_=t(27361),tC=t.n(t_),tE=t(50755),tN=e=>{var r=(0,a._)({},(0,n._)(e)),t=(0,E.useTranslation)().t,i=(0,o.useMemo)(()=>{var e,r=tE.Z.language||(null==(e=tE.Z.options)?void 0:e.lng)||"en_US";switch(r){case"en":case"en_GB":case"en_US":r="en_US";break;case"de":r="de_DE";break;case"pl":r="pl_Pl";break;case"cz":r="cs_CZ";break;default:r=""}return tC()(tb.SP,r)||tb.SP.en_US},[]),u={name:t("StylingComponent.defaultStyleName"),rules:[{name:t("StylingComponent.defaultAreaStyleName"),symbolizers:[{kind:"Fill",color:"#00b72b",outlineOpacity:.8,opacity:.5,fillOpacity:.8,outlineWidth:2,outlineColor:"#00b72b"}]},{name:t("StylingComponent.defaultLineStyleName"),symbolizers:[{kind:"Line",color:"#00b72b",width:2,opacity:.8}]},{name:t("StylingComponent.defaultPointStyleName"),symbolizers:[{kind:"Mark",wellKnownName:"circle",color:"#00b72b",strokeColor:"#00b72b",strokeOpacity:.8,opacity:.5,radius:7}],filter:["==","label","undefined"]},{name:t("StylingComponent.defaultTextStyleName"),symbolizers:[{kind:"Text",label:"{{label}}",size:12,font:["sans-serif"],opacity:.8,color:"#00b72b",offset:[5,5],haloColor:"#00b72b",haloWidth:1}],filter:["!=","label","undefined"]}]},f=(0,d._)((0,o.useState)(u),2),m=f[0],g=f[1],h=(0,Z.S)();return(0,o.useEffect)(()=>{if(m&&h){var e=new tS.T,r=T.C.getLayerByName(h,"react-geo_digitize");(0,c._)(function(){var t,a,n,l,i,s,o,u,c,d,f,g,h,y;return(0,p.Jh)(this,function(p){switch(p.label){case 0:i=!0,s=!1,o=void 0,p.label=1;case 1:p.trys.push([1,6,7,8]),u=m.rules[Symbol.iterator](),p.label=2;case 2:if(i=(c=u.next()).done)return[3,5];return f={name:"",rules:[d=c.value]},[4,e.writeStyle(f)];case 3:if(!(g=p.sent()).output||d.symbolizers.length<1)return[2];"Fill"===d.symbolizers[0].kind&&(t=g.output),"Text"===d.symbolizers[0].kind&&(l=g.output),"Line"===d.symbolizers[0].kind&&(a=g.output),"Mark"===d.symbolizers[0].kind&&(n=g.output),p.label=4;case 4:return i=!0,[3,2];case 5:return[3,8];case 6:return h=p.sent(),s=!0,o=h,[3,8];case 7:try{i||null==u.return||u.return()}finally{if(s)throw o}return[7];case 8:return y=(e,r)=>{var i,s=null==(i=e.getGeometry())?void 0:i.getType();if(s){if(["MultiPolygon","Polygon","Circle"].includes(s))return"function"==typeof t?t(e,r):t;if(["MultiLineString","LineString"].includes(s))return"function"==typeof a?a(e,r):a;if(["MultiPoint","Point"].includes(s))return e.get("label")?"function"==typeof l?l(e,r):l:"function"==typeof n?n(e,r):n}},r.setStyle(y),[2]}})})().then(()=>N.Z.info("Styles parsed and applied to draw layer."))}},[m,h]),(0,s.jsx)(tw._S.Provider,{value:{locale:i},children:(0,s.jsx)(tj.U,(0,l._)({style:m,onStyleChange:g},r))})},tk=e=>{var r=(0,a._)({},(0,n._)(e)),t=M(),o=A(e=>e.stylingDrawerVisibility),u=(0,E.useTranslation)().t;return(0,s.jsx)(eX,(0,i._)((0,l._)({title:u("StylingDrawer.title"),placement:"right",onClose:()=>{t((0,tx.ah)(!1))},open:o,maskClosable:!1,mask:!1},r),{children:(0,s.jsx)(tN,{})}))},tL=t(98930),tT=t(1581),tP=t.n(tT),tF=t(37669),tZ=t(12416),tD=t(41354),tM=t(2803),tA=h.Z.Option,tO=()=>{var e=Object.keys(tE.Z.services.resourceStore.data);return(0,s.jsx)("div",{className:"language-select","aria-label":"language-selector",children:(0,s.jsx)(h.Z,{defaultValue:tE.Z.language||"en",onChange:e=>{tE.Z.changeLanguage(e)},children:e.map(e=>(0,s.jsx)(tA,{value:e,children:e.toUpperCase()},e))})})},tU=t(68428),tI=t(97691),t$=t(32446),tR=t(33411),tG=t(20640),tB=t.n(tG),tV=t(42893),tJ=t(35674),tz=()=>{var e=(0,Z.S)(),r=(0,o.useMemo)(()=>["layerConfig","isExternalLayer","isUploadedLayer","groupName"],[]),t=(0,E.useTranslation)().t,a=e?tJ.k.getLink(e,";",e=>e.get("name"),e=>(e instanceof C()||e instanceof S())&&e.getVisible(),r):"",n=(0,d._)((0,o.useState)(a),2),l=n[0],i=n[1],u=`Hey,\r
check out the layer-composition I created:\r
\r
${l}`;return(0,o.useEffect)(()=>{if(e){var t=[],a=e=>e.get("name"),n=e=>(e instanceof C()||e instanceof S())&&e.getVisible(),l=()=>{i(tJ.k.getLink(e,";",a,n,r))},s=()=>{e.getAllLayers().filter(e=>e.get("isExternalLayer")||e.get("isUploadedLayer")).forEach(e=>{var r=e.get("layerConfig");r&&(r.clientConfig?r.clientConfig.opacity=e.getOpacity():r.clientConfig={opacity:e.getOpacity()},e.set("layerConfig",r))}),l()},o=e=>{var r=e.getLayers().getArray(),a=!0,n=!1,i=void 0;try{for(var u,c=r[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var d=u.value;if(d instanceof j())o(d);else{var p=d.on("change:visible",l),f=d.on("change:opacity",s);t.push(p,f)}}}catch(e){n=!0,i=e}finally{try{a||null==c.return||c.return()}finally{if(n)throw i}}},u=e.getView().on("change:center",l),c=e.getView().on("change:resolution",l);return o(e.getLayerGroup()),s(),()=>{(0,tV.unByKey)(u),(0,tV.unByKey)(c),(0,tV.unByKey)(t)}}},[r,e,t]),(0,s.jsxs)("div",{className:"permalink-wrapper",children:[(0,s.jsxs)("div",{className:"icons",children:[(0,s.jsx)(ry.Z,{title:t("Permalink.whatsAppTooltip"),children:(0,s.jsx)(tU.Z,{onClick:function(){var e=new URL("https://wa.me");e.searchParams.set("text",u),window.open(e)}})}),(0,s.jsx)(ry.Z,{title:t("Permalink.mailTooltip"),children:(0,s.jsx)(tI.Z,{onClick:function(){var e=new URL("mailto:");e.searchParams.set("subject","SHOGun Web-GIS"),e.searchParams.set("body",u),window.open(e.toString().replace(/\+/g,"%20"),"_self")}})})]}),(0,s.jsxs)("div",{className:"link","aria-label":"permalink-url",children:[(0,s.jsx)(g.Z,{value:l,readOnly:!0}),(0,s.jsx)(ry.Z,{title:t("Permalink.copyTooltip"),children:(0,s.jsx)(t$.Z,{onClick:function(){tB()(l)?tR.ZP.info(t("Permalink.copiedToClipboard")):tR.ZP.info(t("Permalink.copyToClipboardFailed"))}})})]})]})},tW=t(59418),tK=t(57795),tq=t(55002),tY=t(99865),tH=t(19867),tX=t(16827),tQ=t(86954),t0=t(50122),t1=t(97955),t2=t(11032);class t3 extends t2.N{serialize(e,r){var t=super.serialize(e,r);return t.baseURL.startsWith("/geoserver/ows")&&(t.baseURL=`http://shogun-geoserver:8080${t.baseURL}`),t.baseURL.startsWith("/geoserver/SHOGUN")&&(t.baseURL=`http://shogun-geoserver:8080${t.baseURL}`),t}}var t4=t3,t5=class extends t4{serialize(e,r){var t=(0,l._)({tileSize:[512,512]},r),a=e.getSource();if(a&&this.validateSource(a))return(0,l._)({},super.serialize(e,t),{type:t1.n.TYPE_WMS},r)}},t6=e=>{var r=e.value,t=e.id,a=e.placeholder,n=e.maxLength,i=(0,ep._)(e,["value","id","placeholder","maxLength"]),u=M();return(0,o.useEffect)(()=>{ej()(t)||u((0,t0.eV)({[t]:r}))},[r,t,u]),(0,s.jsx)(g.Z,(0,l._)({id:t,value:r,placeholder:a,maxLength:n,showCount:!!(n&&n>1)},i))},t8=e=>{var r=e.printManager,t=e.onValueChange,a=e.placeholder,n=e.value,u=(0,ep._)(e,["printManager","onValueChange","placeholder","value"]),c=(0,d._)((0,o.useState)(n),2),p=c[0],f=c[1],m=(0,o.useRef)(p);return(0,o.useEffect)(()=>{m.current=n},[n]),(0,o.useEffect)(()=>{r&&(r.setLayout(p),m.current!==p&&t())},[r,p,t,n]),(0,o.useEffect)(()=>{f(n)},[n]),(0,s.jsx)(h.Z,(0,i._)((0,l._)({placeholder:void 0===a?"Bitte w\xe4hlen Sie eine Vorlage aus":a,value:p,onChange:f},u),{children:null==r?void 0:r.getLayouts().map(e=>(0,s.jsx)(h.Z.Option,{value:e.name,children:e.name},e.name))}))},t7=e=>{var r=e.printManager,t=e.placeholder,a=e.value,n=e.outputFormats,u=(0,ep._)(e,["printManager","placeholder","value","outputFormats"]),c=(0,d._)((0,o.useState)(a),2),p=c[0],f=c[1];return(0,o.useEffect)(()=>{r&&r.setOutputFormat(p)},[r,p]),(0,o.useEffect)(()=>{f(a)},[a]),(0,s.jsx)(h.Z,(0,i._)((0,l._)({placeholder:t,value:p,onChange:f},u),{children:n.map(e=>(0,s.jsx)(h.Z.Option,{value:e,children:e.toLocaleUpperCase()},e))}))},t9=e=>{var r=e.printManager,t=e.placeholder,a=e.value,n=(0,ep._)(e,["printManager","placeholder","value"]),u=(0,d._)((0,o.useState)(a),2),c=u[0],p=u[1];return(0,o.useEffect)(()=>{r&&r.setDpi(c)},[r,c]),(0,o.useEffect)(()=>{p(a)},[a]),(0,s.jsx)(h.Z,(0,i._)((0,l._)({placeholder:t,value:c,onChange:p},n),{children:null==r?void 0:r.getDpis().map(e=>(0,s.jsx)(h.Z.Option,{value:e,children:`${e} DPI`},e))}))},ae=t(25764),ar=e=>{var r=e.printManager,t=e.placeholder,a=e.value,n=(0,ep._)(e,["printManager","placeholder","value"]),u=(0,Z.S)(),c=(0,d._)((0,o.useState)(0),2),p=c[0],f=c[1];return(0,o.useEffect)(()=>{r&&p&&r.setScale(p)},[r,p]),(0,o.useEffect)(()=>{var e=()=>{var e=r.getScale();e&&f(e)},t=null==u?void 0:u.getInteractions().getArray().find(e=>e.get("name")===ae.C.TRANSFORM_INTERACTION_NAME);if(r&&t)return t.on("scaling",e),()=>{t.on("scaling",e)}},[r,u]),(0,o.useEffect)(()=>{a&&f(a)},[a]),(0,s.jsx)(h.Z,(0,i._)((0,l._)({placeholder:t,value:p,onChange:f},n),{children:null==r?void 0:r.getScales().map(e=>(0,s.jsx)(h.Z.Option,{value:e,children:`1 : ${e.toLocaleString()}`},e))}))};t(26398).j.getLegendGraphicUrl=e=>{if(e.get("legendUrl"))return e.get("legendUrl");if(e.getSource()instanceof er()||e.getSource()instanceof Q()){var r=e.get("customPrintLegendParams"),t=e.getSource(),a=t.getParams(),n=a.LAYERS,i=a.VERSION,s=a.FORMAT,o=t instanceof Q()?t.getUrl():t.getUrls()[0];o.startsWith("/geoserver/ows")&&(o=`http://shogun-geoserver:8080${o}`);var u=(0,l._)({LAYER:n.split(",")[0],VERSION:i||"1.3.0",SERVICE:"WMS",REQUEST:"GetLegendGraphic",FORMAT:s||"image/png"},r),c=Object.keys(u).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(u[e])}`).join("&");return o.startsWith("/geoserver/SHOGUN")?(o=`http://shogun-geoserver:8080${o}/service?`,`${o}${c}`):o.endsWith("?")?`${o}${c}`:`${o}?${c}`}return""};var at=e=>{var r,t=e.active,a=e.customPrintScales,n=void 0===a?[]:a,u=e.layerBlackList,f=void 0===u?[]:u,m=e.outputFormats,g=(0,ep._)(e,["active","customPrintScales","layerBlackList","outputFormats"]),h=(0,d._)(ef.Z.useForm(),1)[0],y=(0,E.useTranslation)(),v=y.t,x=y.i18n,b=(0,Z.S)(),w=M(),S=x.language,_=(0,ea.Z)(),C=A(e=>e.print.customMapParams),k=A(e=>e.print.customParams),L=A(e=>e.print.printApp),P=(0,d._)((0,o.useState)(null),2),F=P[0],D=P[1],O=(0,d._)((0,o.useState)(!1),2),U=O[0],I=O[1],$=(0,d._)((0,o.useState)(null),2),R=$[0],G=$[1],B=(0,o.useCallback)(e=>{if(b){var r=e.get("name");return r&&!f.includes(r)&&e.getVisible()&&!(e instanceof j())&&T.C.layerInResolutionRange(e,b)}},[b,f]),V=(0,o.useCallback)(e=>{if(ej()(b))return!1;var r=e.get("name"),t=!f.includes(r),a=!e.get("hideLegendInPrint"),n=e.getVisible()&&T.C.layerInResolutionRange(e,b),l=!(e instanceof j());if(t&&a&&n&&l){var i=null==b?void 0:b.getView().getResolution();return i&&e.set("customPrintLegendParams",{SCALE:T.C.getScaleForResolution(i,"m")}),!0}return!1},[b,f]),J=(0,o.useCallback)(e=>b?T.C.getAllLayers(b).filter(r=>{var t=r.get("name");return t&&!t.includes("react-geo")&&r.getVisible()&&!(r instanceof j())&&r!==e}):[],[b]),W=(0,o.useCallback)(e=>{var r=e.getExtentLayer();if(!r)return"";var t=J(r),a=[];return t.filter(e=>{var r,t;return e.getSource&&(null==(r=e.getSource())?void 0:r.getAttributions)&&(null==(t=e.getSource())?void 0:t.getAttributions())}).forEach(e=>{var r=tQ.Z.getLayerAttributionsText(e,",",!0);a.includes(r)||a.push(r)}),a.join(", ").trim()},[J]),q=(0,o.useCallback)(()=>(0,c._)(function(){var e,r,t,a,i,s,o,u,c,d;return(0,p.Jh)(this,function(p){switch(p.label){case 0:if(ej()(b))return[2];s={url:null!=(i=null==(e=K().print)?void 0:e.url)?i:"/print",map:b,customPrintScales:null==b||null==(a=b.getView())||null==(t=a.getResolutions())||null==(r=t.map(e=>{var r,t,a=null==b||null==(t=b.getView())||null==(r=t.getProjection())?void 0:r.getUnits();if(void 0!==e){var n=T.C.getScaleForResolution(e,a);if(void 0!==n)return T.C.roundScale(n)}}).filter(e=>void 0!==e))?void 0:r.reverse(),timeout:6e4,layerFilter:B,headers:(0,l._)({},(0,et.a)(null==_?void 0:_.getKeycloak())),transformOpts:{rotate:!1},serializers:[new tY.o,new tK.o,new tq.S,new tH.g,new tX.N,new t4,new t5],legendFilter:V},n.length>0&&(s=(0,l._)({},s,{customPrintScales:n.toReversed()})),o=new tW.C(s),p.label=1;case 1:return p.trys.push([1,8,,9]),[4,o.init()];case 2:if(p.sent(),c=o.getPrintApps(),L)return[3,5];if(!(c&&S&&c.includes(S)))return[3,4];return[4,o.setPrintApp(S)];case 3:p.sent(),p.label=4;case 4:return[3,7];case 5:return[4,o.setPrintApp(L)];case 6:p.sent(),p.label=7;case 7:return o.setOutputFormat(o.getOutputFormats()[0]),o.setDpi(o.getDpis()[0]),o.setLayout(null==(u=o.getLayouts()[0])?void 0:u.name),[2,o];case 8:return d=p.sent(),G(()=>v("PrintForm.managerErrorMessage")),N.Z.error("Could not initialize print manager: ",d),[3,9];case 9:return[2]}})})(),[b,B,_,V,n,L,S,v]);return(0,o.useEffect)(()=>{F&&w((0,t0.eV)({attributions:W(F)}))},[w,W,F]),(0,eZ.b)(()=>(0,c._)(function(){var e;return(0,p.Jh)(this,function(r){switch(r.label){case 0:if(!t)return[3,3];if(F)return[3,2];return h.resetFields(),[4,q()];case 1:(e=r.sent())&&D(e),r.label=2;case 2:return[3,4];case 3:null==F||F.shutdownManager(),D(null),r.label=4;case 4:return[2]}})})(),[F,t,q,h]),(0,o.useEffect)(()=>{F&&(k&&F.setCustomParams(k),C&&F.setCustomMapParams(C))},[F,k,C]),(0,s.jsxs)("div",{className:"print","aria-label":"print-form",children:[R&&(0,s.jsx)(z.Z,{className:"print-alert",message:R,type:"error",closable:!0,showIcon:!0,onClose:()=>{G(null)}}),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ef.Z,(0,i._)((0,l._)({form:h,className:"print-form",labelAlign:"left",labelCol:{flex:"90px"}},g),{children:(null==F?void 0:F.isInitiated())&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ef.Z.Item,{"aria-label":"print-title",name:"title",label:v("PrintForm.title"),initialValue:v("PrintForm.initialTitle"),children:(0,s.jsx)(t6,{"aria-label":"print-title-input",maxLength:50,placeholder:v("PrintForm.titlePlaceholder")})}),(0,s.jsx)(ef.Z.Item,{"aria-label":"print-comment",name:"comment",label:v("PrintForm.comment"),children:(0,s.jsx)(t6,{"aria-label":"print-comment-input",maxLength:200,placeholder:v("PrintForm.commentPlaceholder")})}),(0,s.jsx)(ef.Z.Item,{"aria-label":"print-layout",name:"layout",label:v("PrintForm.layout"),initialValue:null==F||null==(r=F.getLayouts()[0])?void 0:r.name,children:(0,s.jsx)(t8,{"aria-label":"print-layout-input",printManager:F,onValueChange:()=>{h.setFieldValue("dpi",null==F?void 0:F.getDpis()[0])}})}),(0,s.jsx)(ef.Z.Item,{"aria-label":"print-scale",name:"scale",label:v("PrintForm.scale"),initialValue:null==F?void 0:F.getClosestScaleToFitMap(),children:(0,s.jsx)(ar,{"aria-label":"print-scale-input",printManager:F})}),(0,s.jsx)(ef.Z.Item,{"aria-label":"print-dpi",name:"dpi",label:v("PrintForm.dpi"),initialValue:F.getDpis()[0],children:(0,s.jsx)(t9,{"aria-label":"print-dpi-input",printManager:F,placeholder:v("PrintForm.resolutionPlaceholder")})}),(0,s.jsx)(ef.Z.Item,{"aria-label":"print-format",name:"format",label:v("PrintForm.format"),initialValue:"pdf",children:(0,s.jsx)(t7,{"aria-label":"print-format-input",printManager:F,outputFormats:void 0===m?["pdf","png"]:m,placeholder:v("PrintForm.outputFormatPlaceholder")})})]})})),(0,s.jsx)(ek.ZP,{"aria-label":"create-print",className:"print-button tool-menu-button",disabled:!(null==F?void 0:F.isInitiated()),icon:(0,s.jsx)(eF.G,{icon:eP.q7m}),loading:U,onClick:()=>(0,c._)(function(){var e,r;return(0,p.Jh)(this,function(t){switch(t.label){case 0:if(t.trys.push([0,2,3,4]),G(null),I(!0),!F)return[2];return[4,F.print(!1)];case 1:if(!(e=t.sent()))throw Error("No download URL available, the job has failed.");return window.open(e),[3,4];case 2:return r=t.sent(),G(v("PrintForm.printJobErrorMsg")||null),N.Z.error(r),[3,4];case 3:return I(!1),[7];case 4:return[2]}})})(),children:v("PrintForm.downloadBtnText")})]})]})},aa=t(5737),an=t(71230),al=t(16121),ai=t.n(al),as=t(34571),ao=e=>{var r=e.keyName,t=e.onChange,a=void 0===t?()=>{}:t,n=e.options,l=(0,E.useTranslation)().t;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ef.Z.Item,{name:[r,"name"],rules:[{required:!0,message:l("AttributionRow.missingKey")},e=>{var r=e.getFieldsValue;return{validator(e,t){var a=r(!0);return a.fields&&Object.entries(a.fields).filter(e=>{var r=(0,d._)(e,2)[1];return(null==r?void 0:r.name)===t}).length>1?Promise.reject(Error(l("AttributionRow.keyInUse"))):Promise.resolve()}}}],children:(0,s.jsx)(as.Z,{placeholder:l("AttributionRow.keyPlaceholder"),onChange:e=>{a(e)},options:null==n?void 0:n.map(e=>({value:e}))})}),(0,s.jsx)(ef.Z.Item,{name:[r,"value"],rules:[{required:!0,message:l("AttributionRow.missingValue")}],children:(0,s.jsx)(g.Z,{placeholder:l("AttributionRow.valuePlaceholder"),onChange:e=>{a(e.target.value)}})})]})},au=e=>{var r=e.selectedFeature,t=(0,ep._)(e,["selectedFeature"]),a=(0,d._)((0,o.useState)(!0),2),n=a[0],u=a[1],m=(0,d._)((0,o.useState)([]),2),g=m[0],h=m[1],y=(0,d._)((0,o.useState)([]),2),v=y[0],x=y[1],b=(0,d._)(f.ZP.useNotification(),2)[1],j=(0,d._)(ef.Z.useForm(),1)[0],w=(0,Z.S)(),S=void 0!==r,_=(0,E.useTranslation)().t,C=(0,o.useCallback)(e=>{var r,t=null==(r=e.fields)?void 0:r.map(e=>{var r;return null==e||null==(r=e.name)?void 0:r.toLowerCase()}).filter(e=>void 0!==e);x(g.filter(e=>!(null==t?void 0:t.includes(e.toLowerCase()))))},[g]);(0,o.useEffect)(()=>{if(w){var e,t=null==r?void 0:r.getProperties();if(j.setFieldValue("fields",[]),t){var a=Object.entries(Object.fromEntries(Object.entries(t).filter(e=>!((0,d._)(e,2)[1]instanceof ai())).map(e=>{var r=(0,d._)(e,2);return[r[0],r[1]]}))).map(e=>{var r=(0,d._)(e,2);return{name:r[0],value:r[1]}});j.setFieldValue("fields",a)}var n=null==(e=rt.w.getDigitizeLayer(w).getSource())?void 0:e.getFeatures(),l=new Set;null==n||n.forEach(e=>{Object.keys(e.getProperties()).forEach(r=>{e.get(r)instanceof ai()||l.add(r)})}),h(Array.from(l))}},[r,j,w]);var k=()=>(0,c._)(function(){var e;return(0,p.Jh)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,j.validateFields()];case 1:return r.sent(),u(!0),[3,3];case 2:return e=r.sent(),u(!1),N.Z.error(e),[3,3];case 3:return[2]}})})();return(0,s.jsxs)(eH.Z,(0,i._)((0,l._)({title:_("Attribution.title"),className:"attribution-drawer",placement:"right",mask:!1,maskClosable:!1,closable:!1,open:S},t),{children:[!r&&(0,s.jsx)(s.Fragment,{children:_("Attribution.select")}),(0,s.jsx)(an.Z,{children:(0,s.jsxs)(ef.Z,{onFinish:e=>{if(r){for(var t in f.ZP.destroy(),f.ZP.success({message:_("notificationApplyText.title"),placement:"top",duration:3.5}),r.getProperties())r.get(t)instanceof ai()||r.unset(t);e.fields&&Object.values(e.fields).forEach(e=>{(null==e?void 0:e.name)&&r.set(e.name,e.value)})}},autoComplete:"off",form:j,onValuesChange:(e,r)=>{C(r)},children:[(0,s.jsx)(ef.Z.List,{name:"fields",children:(e,t)=>{var a=t.add,n=t.remove;return(0,s.jsxs)(s.Fragment,{children:[e.map(e=>(0,s.jsxs)("div",{className:"attribute-row",children:[(0,s.jsx)(ao,{keyName:e.name,onChange:k,options:v},e.key),(0,s.jsxs)(e$.Z,{title:_("AttributionPopConfirm.title"),okText:_("AttributionPopConfirm.okText"),cancelText:_("AttributionPopConfirm.cancelText"),placement:"topRight",onConfirm:()=>{f.ZP.destroy(),f.ZP.info({message:_("notificationDeleteText.title"),description:_("notificationDeleteText.info"),placement:"top",duration:6}),n(e.name)},children:[b,(0,s.jsx)(ek.ZP,{className:"remove-attribute-button",type:"primary",danger:!0,icon:(0,s.jsx)(eF.G,{icon:aa.El_})})]})]},e.key)),(0,s.jsx)(ef.Z.Item,{children:r?(0,s.jsx)(ek.ZP,{type:"dashed",onClick:()=>{a()},className:"add-attribute-button",icon:(0,s.jsx)(eF.G,{icon:eP.r8p}),children:_("Attribution.add")}):(0,s.jsx)(s.Fragment,{})})]})}}),(0,s.jsx)(ef.Z.Item,{children:(0,s.jsx)(ek.ZP,{className:"submit-attributes-button",type:"primary",htmlType:"submit",disabled:!n,hidden:!r,children:_("Attribution.submit")})})]})})]}))},ac=t(92848),ad=m.Z.confirm,ap="deleteallbutton",af=e=>{var r=e.className,t=e.digitizeLayer,a=(0,ep._)(e,["className","digitizeLayer"]),n=(0,d._)((0,o.useState)(null),2),i=n[0],u=n[1],c=(0,Z.S)(),p=(0,E.useTranslation)().t;if((0,o.useEffect)(()=>{c&&(t?u([t]):u([rt.w.getDigitizeLayer(c)]))},[c,t]),!i)return null;var f=r?`${ap} ${r}`:ap;return(0,s.jsx)(F(),(0,l._)({onClick:()=>{ad({title:p("DeleteAllButton.deleteAll"),content:p("DeleteAllButton.confirmMessage"),icon:(0,s.jsx)(ac.Z,{}),onOk(){var e;null==(e=i[0].getSource())||e.clear()}})},className:f},a))},am=eN.Z.Dragger,ag=e=>{var r=e.className,t=e.footer,a=e.width,n=e.onCancel,u=e.onSuccess,c=e.onFailure,p=(0,ep._)(e,["className","footer","width","onCancel","onSuccess","onFailure"]),f=(0,d._)((0,o.useState)(!1),2),g=f[0],h=f[1],y=(0,d._)((0,o.useState)(""),2),v=y[0],x=y[1],b=(0,Z.S)(),j=(0,E.useTranslation)().t,w=["json","geojson"],S=["application/json","application/geo+json","application/geojson"];return(0,s.jsxs)(m.Z,(0,i._)((0,l._)({title:j("ImportDataModal.title"),onCancel:e=>{x(""),h(!1),null==n||n(e)},className:void 0===r?"import-data-modal":r,width:void 0===a?600:a,footer:void 0!==t&&t},p),{children:[v&&(0,s.jsx)(z.Z,{message:v,closable:!0,type:"error"}),(0,s.jsx)(tt.Z,{spinning:g,children:(0,s.jsxs)(am,{customRequest:e=>{var r=e.file,t=e.onSuccess,a=e.onError;if(r instanceof File&&b){var n=new FileReader;n.onload=()=>{try{var e=new(e6())().readFeatures(n.result,{featureProjection:b.getView().getProjection()});null==t||t(e)}catch(e){null==a||a(e),N.Z.error("Error while reading the file: ",e)}},n.readAsText(r)}},accept:[...w.map(e=>`.${e}`),S].join(","),maxCount:1,showUploadList:!1,beforeUpload:e=>{var r=e.type,t=e.name.split(".").pop();return x(""),!!S.includes(r)&&(!t||!!w.includes(t))||(x(j("ImportDataModal.error.supportedFormats",{supportedFormats:S.join(", ")})),!1)},onChange:e=>{var r=e.file.status,t=e.file.response;if(b)if("uploading"===r)h(!0);else if("done"===r){var a=rt.w.getDigitizeLayer(b).getSource();null==a||a.addFeatures(t||[]),h(!1),tR.ZP.success(j("ImportDataModal.success")),null==u||u(t||[])}else"error"===r&&(h(!1),x(j("ImportDataModal.error.parsing")),null==c||c(e.file.error))},children:[(0,s.jsx)("p",{className:"ant-upload-drag-icon",children:(0,s.jsx)(eF.G,{icon:eP.cf$})}),(0,s.jsx)("p",{className:"ant-upload-text",children:j("ImportDataModal.description")}),(0,s.jsx)("p",{className:"ant-upload-hint",children:j("ImportDataModal.hint")})]})})]}))},ah=()=>{var e=M(),r=(0,E.useTranslation)().t,t=A(e=>e.stylingDrawerVisibility);return(0,s.jsx)(ek.ZP,{type:"link",onClick:()=>{e((0,tx.ah)(!t))},icon:(0,s.jsx)(eF.G,{icon:eP.XsY}),children:r(t?"StylingDrawer.closeColorPalette":"StylingDrawer.openColorPalette")})},ay=e=>{var r=e.showDrawPoint,t=e.showDrawLine,a=e.showDrawPolygon,n=e.showDrawCircle,l=e.showDrawRectangle,i=e.showDrawAnnotation,u=e.showModifyFeatures,c=e.showUploadFeatures,p=e.showDeleteFeatures,f=(0,d._)((0,o.useState)(),2),m=f[0],g=f[1],h=(0,d._)((0,o.useState)(),2),y=h[0],v=h[1],x=(0,d._)((0,o.useState)(!1),2),b=x[0],j=x[1],w=(0,E.useTranslation)().t,S=(0,Z.S)(),_=(0,o.useCallback)((e,r)=>{v(r),"draw-modify"!==r&&g(void 0)},[]),C=(0,o.useCallback)(e=>{e.selected.length>0?g(e.selected[0]):g(void 0)},[]),N=()=>{j(!1)};return S?(0,s.jsxs)("div",{className:"draw-tools",children:[(0,s.jsxs)(rr.ToggleGroup,{selected:y,onChange:_,children:[r?(0,s.jsxs)(e9(),{drawType:"Point",pressed:!1,type:"link",value:"draw-point",children:[(0,s.jsx)(eF.G,{icon:eP.diR}),(0,s.jsx)("span",{className:"draw-point",children:w("Draw.point")})]},"draw-point"):(0,s.jsx)(s.Fragment,{}),t?(0,s.jsxs)(e9(),{drawType:"LineString",type:"link",value:"draw-line",children:[(0,s.jsx)(eF.G,{icon:eP.hx$}),(0,s.jsx)("span",{className:"draw-line",children:w("Draw.line")})]},"draw-line"):(0,s.jsx)(s.Fragment,{}),a?(0,s.jsxs)(e9(),{value:"draw-polygon",drawType:"Polygon",type:"link",children:[(0,s.jsx)(eF.G,{icon:eP.Kak}),(0,s.jsx)("span",{className:"draw-polygon",children:w("Draw.polygon")})]},"draw-polygon"):(0,s.jsx)(s.Fragment,{}),n?(0,s.jsxs)(e9(),{value:"draw-circle",drawType:"Circle",type:"link",children:[(0,s.jsx)(eF.G,{icon:eP.IJ7}),(0,s.jsx)("span",{className:"draw-circle",children:w("Draw.circle")})]},"draw-circle"):(0,s.jsx)(s.Fragment,{}),l?(0,s.jsxs)(e9(),{drawType:"Rectangle",type:"link",value:"draw-rectangle",children:[(0,s.jsx)(eF.G,{icon:eP.pL1}),(0,s.jsx)("span",{className:"draw-rectangle",children:w("Draw.rectangle")})]},"draw-rectangle"):(0,s.jsx)(s.Fragment,{}),i?(0,s.jsxs)(e9(),{drawType:"Text",modalPromptCancelButtonText:w("Draw.modalPromptCancelButtonText"),modalPromptOkButtonText:w("Draw.modalPromptOkButtonText"),modalPromptTitle:w("Draw.modalPromptTitle"),type:"link",value:"draw-text",children:[(0,s.jsx)(eF.G,{icon:eP.yGG}),(0,s.jsx)("span",{className:"draw-text",children:w("Draw.text")})]},"draw-text"):(0,s.jsx)(s.Fragment,{}),(0,s.jsx)(ah,{},"styling"),u?(0,s.jsxs)(re.ModifyButton,{value:"draw-modify",type:"link",onFeatureSelect:C,children:[(0,s.jsx)(eF.G,{icon:eP.Yai}),(0,s.jsx)("span",{className:"draw-modify",children:w("Draw.modify")})]},"draw-modify"):(0,s.jsx)(s.Fragment,{}),p?(0,s.jsxs)(e8.DeleteButton,{value:"draw-delete",type:"link",children:[(0,s.jsx)(eF.G,{icon:eP.xf2}),(0,s.jsx)("span",{className:"draw-delete",children:w("Draw.delete")})]},"draw-delete"):(0,s.jsx)(s.Fragment,{})]}),p?(0,s.jsxs)(af,{value:"draw-delete-all",type:"link",children:[(0,s.jsx)(eF.G,{icon:eP.$aW}),(0,s.jsx)("span",{className:"draw-delete-all",children:w("DeleteAllButton.deleteAll")})]}):(0,s.jsx)(s.Fragment,{}),c?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ek.ZP,{onClick:()=>{j(!0)},"aria-label":"draw-upload",type:"link",icon:(0,s.jsx)(eF.G,{icon:eP.cf$}),children:(0,s.jsx)("span",{className:"draw-upload",children:w("Draw.upload")})}),(0,s.jsx)(ag,{open:b,onCancel:N,onSuccess:N})]}):(0,s.jsx)(s.Fragment,{}),c?(0,s.jsxs)(F(),{value:"draw-export",onClick:()=>{var e=[];if(S){var r,t=S.getView().getProjection().getCode(),a=null==(r=rt.w.getDigitizeLayer(S).getSource())?void 0:r.getFeatures();if(a&&a.length>0){a.forEach(r=>{var a,n=r.clone();null==(a=n.getGeometry())||a.transform(t,"EPSG:4326"),e.push(n)});var n=new Blob([new(e6())().writeFeatures(e)],{type:"application/geo+json"}),l=window.URL.createObjectURL(n),i=document.createElement("a");i.href=l,i.setAttribute("download","exportedFeatures.geojson"),document.body.appendChild(i),i.click(),document.body.removeChild(i)}}},type:"link",children:[(0,s.jsx)(eF.G,{icon:eP.q7m}),(0,s.jsx)("span",{className:"draw-export",children:w("Draw.export")})]}):(0,s.jsx)(s.Fragment,{}),(0,s.jsx)(au,{selectedFeature:m})]}):(0,s.jsx)(s.Fragment,{})},av=t(96486),ax=t(20413),ab=t(60878),aj=e=>{var r=(0,Z.S)(),t=(0,o.useCallback)(()=>(0,c._)(function(){var t,a,n,l,i;return(0,p.Jh)(this,function(s){return!r||T.C.getLayerByName(r,e.layerName)||(t=new(tf()),a=new(rz())({color:"rgba(255, 255, 255, 0.15)"}),n=new(rK())({color:"rgba(209, 70, 47, 1)",width:2}),l=new(rY())({fill:a,stroke:n,image:new(rV())({radius:5,fill:a,stroke:n})}),(i=new(td())({source:t,style:l})).set("name",e.layerName),r.addLayer(i)),[2]})})(),[r,e.layerName]),a=(0,o.useCallback)(()=>{if(r){var t=T.C.getLayerByName(r,e.layerName);t&&r.removeLayer(t)}},[r,e.layerName]);(0,o.useEffect)(()=>(t(),()=>a()),[a,t])},aw=t(1445),aS=t(66678),a_=t.n(aS),aC=e=>{var r=e.exportFilter,t=e.features,a=e.layer,n=e.selectedFeature,i=(0,ep._)(e,["exportFilter","features","layer","selectedFeature"]),o=(0,E.useTranslation)().t,u=M(),c=(0,Z.S)(),p=ra(),f=A(e=>e.featureInfo.activeCopyTools),m=A(e=>e.editFeature.userEditMode),g=m.includes("CREATE")||m.includes("DELETE")||m.includes("UPDATE"),h=null==a?void 0:a.get("editable");return(0,s.jsxs)("div",{className:"pagination-toolbar",children:[(0,s.jsx)(aw.Z,(0,l._)({simple:!0,total:t.length,size:"small",pageSize:1},i)),(0,s.jsxs)("div",{className:"copy-buttons",children:[g&&(0,s.jsx)(ry.Z,{title:o(h?"PaginationToolbar.editFeature":"PaginationToolbar.editDisabled"),children:(0,s.jsx)(ek.ZP,{type:"text",size:"small",onClick:()=>{if(a&&c){var e=new(e6())().writeFeature(n);try{var r=JSON.parse(e),t=rt.w.getDigitizeLayer(c);if(!t)return;var l=t.getSource();if(!l||(l.clear(),l.addFeature(n),(0,eu.isEmpty)(l.getExtent())))return;c.getView().fit(l.getExtent(),{padding:p()}),u((0,e_.vN)((0,x.getUid)(a))),u((0,e_.hr)(r)),u((0,eY.$Z)())}catch(e){N.Z.error("Could not parse GeoJSON: ",e)}}},icon:(0,s.jsx)(eF.G,{icon:eP.Xcf}),disabled:!h})},"edit"),(null==f?void 0:f.includes(tF.r1.COPY_AS_GEOJSON))&&(0,s.jsx)(ry.Z,{title:o("PaginationToolbar.copyAsGeoJson"),children:(0,s.jsx)(ek.ZP,{type:"text",size:"small",onClick:()=>{if(n){var e=n.clone();if(r){var t=Object.entries(e.getProperties()),a=t.filter(e=>{var t=(0,d._)(e,2);return r(t[0],t[1])}),l=!0,i=!1,s=void 0;try{for(var o,u=t[Symbol.iterator]();!(l=(o=u.next()).done);l=!0){var c=(0,d._)(o.value,2),p=c[0];c[1]instanceof ai()||e.unset(p)}}catch(e){i=!0,s=e}finally{try{l||null==u.return||u.return()}finally{if(i)throw s}}e.setProperties(Object.fromEntries(a))}tB()(new(e6())().writeFeature(e))}},icon:(0,s.jsx)(eF.G,{icon:eP.E9T})})}),(null==f?void 0:f.includes(tF.r1.COPY_AS_OBJECT))&&(0,s.jsx)(ry.Z,{title:o("PaginationToolbar.copyAsObject"),children:(0,s.jsx)(ek.ZP,{type:"text",size:"small",onClick:()=>{if(n){var e=Object.entries(a_()(n.getProperties())).filter(e=>!((0,d._)(e,2)[1]instanceof ai()));r&&(e=e.filter(e=>{var t=(0,d._)(e,2);return r(t[0],t[1])})),tB()(JSON.stringify(Object.fromEntries(e)))}},icon:(0,s.jsx)(eF.G,{icon:eP.OGB})})})]})]})},aE=e=>{var r=e.features,t=e.layerName,a=e.layer,n=e.tabConfig,i=(0,ep._)(e,["features","layerName","layer","tabConfig"]),u=(0,d._)((0,o.useState)(1),2),c=u[0],p=u[1],f=(0,d._)((0,o.useState)(),2),m=f[0],g=f[1],h=(0,d._)((0,o.useState)("0"),2),y=h[0],v=h[1],x=(0,Z.S)(),b=`selection-layer-${t}`;if(aj({layerName:b}),(0,o.useEffect)(()=>{if(x){var e,t=T.C.getLayerByName(x,b);t&&(null==(e=t.getSource())||e.clear(),p(1),r.length>0&&(v("0"),g(r[0])))}},[r,x,b]),(0,o.useEffect)(()=>{if(m&&x){var e,r,t=T.C.getLayerByName(x,b);t&&(null==(e=t.getSource())||e.clear(),null==(r=t.getSource())||r.addFeature(m))}},[m,x,b]),!n||!m)return(0,s.jsx)(s.Fragment,{});var j=n.filter(e=>!ej()(e)).map((e,r)=>({label:e.title,key:`${r}`,forceRender:!0,children:(0,s.jsx)(eO,{name:e.title,feature:m,formConfig:e.children})}));return(0,s.jsxs)("div",{className:"feature-info-tabs",children:[(0,s.jsx)(aC,{current:c,exportFilter:e=>{var r=!1,t=!0,a=!1,l=void 0;try{for(var i,s=n[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var o=i.value;if(o.children){var u=!0,c=!1,d=void 0;try{for(var p,f=o.children[Symbol.iterator]();!(u=(p=f.next()).done);u=!0)if(p.value.propertyName===e){r=!0;break}}catch(e){c=!0,d=e}finally{try{u||null==f.return||f.return()}finally{if(c)throw d}}}}}catch(e){a=!0,l=e}finally{try{t||null==s.return||s.return()}finally{if(a)throw l}}return r},features:r,layer:a,onChange:e=>{e<1||(p(e),g(r[e-1]))},selectedFeature:m}),(0,s.jsx)(ri.Z,(0,l._)({items:j,activeKey:y,defaultActiveKey:"0",onTabClick:e=>{v(e)}},i))]})},aN=e=>{var r=e.features,t=e.layerName,a=e.layer,n=(0,ep._)(e,["features","layerName","layer"]),i=(0,d._)((0,o.useState)(),2),u=i[0],c=i[1],p=(0,d._)((0,o.useState)(),2),f=p[0],m=p[1],g=(0,d._)((0,o.useState)([]),2),h=g[0],y=g[1],v=(0,Z.S)(),x=(0,E.useTranslation)().t,b=`selection-layer-${t}`;aj({layerName:b}),(0,o.useEffect)(()=>{if(v){var e,t=T.C.getLayerByName(v,b);t&&(null==(e=t.getSource())||e.clear(),c(1),r.length>0&&m(r[0]))}},[r,v,b]),(0,o.useEffect)(()=>{if(f&&v){var e,r,t=T.C.getLayerByName(v,b);t&&(y(Object.entries(f.getProperties()).filter(e=>(0,d._)(e,2)[1]instanceof ai()).map(e=>(0,d._)(e,1)[0])),null==(e=t.getSource())||e.clear(),null==(r=t.getSource())||r.addFeature(f))}},[f,v,b]);var j=e=>{c(e),m(r[e-1])};if(!f)return(0,s.jsx)(s.Fragment,{});var w=f.getKeys().filter(e=>!h.includes(e.toLocaleLowerCase()));return(0,s.jsx)(tg(),(0,l._)({className:"property-grid",feature:f,attributeFilter:w,size:"small",sticky:!0,title:()=>(0,s.jsx)(aC,{features:r,selectedFeature:f,current:u,layer:a,onChange:j}),columns:[{title:x("FeaturePropertyGrid.key"),dataIndex:"attributeName",key:"attributeName",width:"50%",ellipsis:!0,defaultSortOrder:"ascend",sorter:(e,r)=>e.key.localeCompare(r.key)},{title:x("FeaturePropertyGrid.value"),dataIndex:"attributeValue",key:"attributeValue",width:"50%",ellipsis:!0}],scroll:{scrollToFirstRowOnChange:!0,y:"calc(100% - 90px)"}},n))},ak=e=>{var r=(0,a._)({},(0,n._)(e)),t=(0,E.useTranslation)().t,i=(0,Z.S)(),u=(0,ea.Z)(),c=G(),p=M(),f=(0,d._)((0,o.useState)(void 0),2),m=f[0],g=f[1],h=A(e=>e.featureInfo.enabled),y=e=>{g(e)},v=e=>{if(!ej()(i))return i.getAllLayers().findIndex(r=>{if((0,H.us)(r)){var t=r.getSource(),a=x(null==t?void 0:t.getParams().LAYERS);return x(e)===a}return!1})},x=e=>e.split(":").length>1?e.split(":")[1]:e.split(":")[0];return i&&h?(0,s.jsx)("div",{className:"feature-info-panel",children:(0,s.jsx)(ax.CoordinateInfo,(0,l._)({active:h,drillDown:!0,featureCount:10,fetchOpts:e=>({headers:(0,l._)({},e.get("useBearerToken")?(0,l._)({},(0,et.a)(null==u?void 0:u.getKeycloak())):void 0)}),layerFilter:e=>!!e.getVisible()&&!!e.get("hoverable")&&(!!(e instanceof S()&&e.getSource()instanceof Q())||e instanceof C()&&e.getSource()instanceof er()),onSuccess:e=>{var r=e.features,t=(0,av.groupBy)(r,"featureType"),a=(0,av.mapValues)(t,e=>e.map(e=>e.feature)),n={},l=!0,i=!1,s=void 0;try{for(var o,u=Object.entries(a)[Symbol.iterator]();!(l=(o=u.next()).done);l=!0){var c=(0,d._)(o.value,2),f=c[0],m=c[1];n[f]=new(e6())().writeFeatures(m)}}catch(e){i=!0,s=e}finally{try{l||null==u.return||u.return()}finally{if(i)throw s}}var h=r.map(e=>({layerName:e.featureType,index:v(e.featureType)})).sort((e,r)=>ej()(e.index)||ej()(r.index)?0:r.index-e.index);h.length>0&&g(h[0].layerName),p((0,ab.wl)(n))},resultRenderer:e=>{if(ej()(i))return(0,s.jsx)(s.Fragment,{});var r=e.features,a=e.loading;if(0===r.length)return(0,s.jsx)("span",{className:"usage-hint",children:t("FeatureInfo.usageHint")});var n=[];return Object.entries((0,av.groupBy)(r,"featureType")).forEach(e=>{var r=(0,d._)(e,2),t=r[0],a=r[1],l=!1,o=a.map(e=>e.feature),u=i.getAllLayers(),p=v(t);if(!ej()(p)){var f=u[p];c.forEach(e=>{var r;if((r=e.integration)&&"feature-info"===r.placement&&(Array.isArray(e.integration.layers)&&e.integration.layers.includes(t)||!e.integration.layers)){var a=e.key,i=e.wrappedComponent;n.push({label:t,index:p,key:t,children:(0,s.jsx)(i,{},a)}),l=!0}}),l||n.push({label:(null==f?void 0:f.get("name"))||t,index:p,key:t,children:(0,s.jsx)("div",{children:(null==f?void 0:f.get("featureInfoFormConfig"))?(0,s.jsx)(aE,{tabConfig:null==f?void 0:f.get("featureInfoFormConfig"),features:o,layerName:t,layer:f}):(0,s.jsx)(aN,{features:o,layerName:t,layer:f})},t)})}}),n.sort((e,r)=>r.index-e.index),(0,s.jsx)(tt.Z,{spinning:a,children:(0,s.jsx)(ri.Z,{destroyInactiveTabPane:!0,items:n,activeKey:m,defaultActiveKey:n[0].key,onTabClick:y})})}},r))}):(0,s.jsx)(s.Fragment,{})},aL=t(10255),aT=t(46502),aP=t.n(aT),aF=t(43356),aZ=t(85958),aD=t.n(aZ),aM=t(92766),aA=t.n(aM),aO="YYYY-MM-DD",aU=e=>{var r=e.layer,t=(0,ep._)(e,["layer"]),a=(0,d._)((0,o.useState)(),2),n=a[0],i=a[1],u=(0,d._)((0,o.useState)(),2),c=u[0],p=u[1],f=(0,d._)((0,o.useState)(),2),m=f[0],g=f[1],h=(0,o.useMemo)(()=>{if(ej()(c)||ej()(m))return[];var e=c.clone().add(m.diff(c)/2);return[{timestamp:c,markConfig:{label:c.format(aO)}},{timestamp:e,markConfig:{label:e.format(aO)}},{timestamp:m,markConfig:{label:m.format(aO),style:{left:"unset",right:0,transform:"translate(50%)"}}}]},[m,c]),y=(0,E.useTranslation)().t;return(0,o.useEffect)(()=>{var e,t=r.get("dimension");if(t&&(t.values&&(e=t.values.split(",")),e&&0!==e.length)){p(ei()(e[0])),g(ei()(e[e.length-1])),i(ei()(e[e.length-1]));var a={};if(e.forEach(e=>{a[e]=ei()(e).format("YYYY-MM-DD")}),"current"===e.default){var n=[NaN,""];Object.values(a).forEach(e=>{var r=ei()().diff(ei()(e));r<n[0]&&(n=[r,e])}),i(ei()(n[1]))}}},[r]),(0,s.jsxs)("div",{className:"wms-time-slider",children:[(0,s.jsxs)(rh.Z,{children:[(0,s.jsx)(eF.G,{icon:eP.SZw}),y("WmsTimeSlider.title")]}),h&&c&&m?(0,s.jsx)(aA(),(0,l._)({defaultValue:ei()(),formatString:aO,marks:h,max:m,min:c,onChange:e=>{var t;i(e),null==(t=r.getSource())||t.updateParams({TIME:Array.isArray(e)?e[0].format(aO):e.format(aO)})},value:n},t)):(0,s.jsx)("span",{children:y("WmsTimeSlider.default")})]})},aI=e=>{var r,t=e.layer,a=e.visibleLegendsIds,n=e.setVisibleLegendsIds,u=(0,ep._)(e,["layer","visibleLegendsIds","setVisibleLegendsIds"]),m=(0,d._)((0,o.useState)(!1),2),g=m[0],h=m[1],y=(0,d._)((0,o.useState)(!1),2),v=y[0],b=y[1],w=M(),S=(0,ea.Z)(),_=(0,Z.S)(),C=ra(),k=(0,E.useTranslation)().t,L=null!=(r=t.get("downloadConfig"))?r:null,P=A(e=>e.editFeature.userEditMode),F=A(e=>e.layerTree.metadataVisible),D=e=>{var r=[e],t=!0,a=!1,n=void 0;try{for(var l,i=e.getLayers().getArray()[Symbol.iterator]();!(t=(l=i.next()).done);t=!0){var s=l.value;s instanceof j()&&r.push(...D(s))}}catch(e){a=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(a)throw n}}return r},O=e=>{(!_?[]:D(_.getLayerGroup()).filter(r=>r.getLayers().getArray().includes(e))).forEach(r=>r.getLayers().remove(e))},U=[];if((0,H.us)(t)&&U.push({label:(0,s.jsx)(tt.Z,{spinning:v,children:k("LayerTreeContextMenu.layerZoomToExtent")}),key:"zoomToExtent"}),(0,H.us)(t)&&t.getVisible()){var I=a.includes((0,x.getUid)(t));U.push({label:I?k("LayerTreeContextMenu.hideLegend"):k("LayerTreeContextMenu.showLegend"),key:"toggleLegend"})}if((t.get("isExternalLayer")||t.get("isUploadedLayer"))&&U.push({label:k("LayerTreeContextMenu.removeLayer"),key:"removeExternal"}),L){var $=L.map(e=>{var r;return{label:k("LayerTreeContextMenu.downloadLayer",{formatName:null!=(r=e.formatName)?r:"XML"}),key:`downloadLayer|${encodeURI(e.downloadUrl)}`}});U.push(...$)}return t.get("editable")&&(P.includes("CREATE")||P.includes("UPDATE")||P.includes("DELETE"))&&U.push({label:k("LayerTreeContextMenu.editLayer"),key:"editLayer"}),F&&U.push({label:k("LayerTreeContextMenu.layerDetails"),key:"layerDetails"}),(0,s.jsx)("div",{"aria-label":"layer-context",children:(0,s.jsx)(rG.Z,(0,i._)((0,l._)({menu:{items:U,onClick:e=>{let r;switch((null==e?void 0:e.key.startsWith("downloadLayer"))&&(r=decodeURI(e.key.split("|")[1]),(0,c._)(function(){var e,a;return(0,p.Jh)(this,function(n){switch(n.label){case 0:if(!t)return[2];return[4,fetch(r,{method:"GET",headers:(0,l._)({},t.get("useBearerToken")?(0,l._)({},(0,et.a)(null==S?void 0:S.getKeycloak())):void 0)})];case 1:return[4,n.sent().blob()];case 2:return e=n.sent(),(a=document.createElement("a")).href=URL.createObjectURL(e),a.setAttribute("download",t.get("name")),a.click(),[2]}})})()),null==e?void 0:e.key){case"zoomToExtent":(0,c._)(function(){var e,r;return(0,p.Jh)(this,function(a){switch(a.label){case 0:if(!_)return[2];b(!0),a.label=1;case 1:return a.trys.push([1,3,4,5]),[4,tQ.Z.getExtentForLayer(t,{headers:t.get("useBearerToken")?(0,l._)({},(0,et.a)(null==S?void 0:S.getKeycloak())):{}})];case 2:return e=a.sent(),e=(0,rA.transformExtent)(e,"EPSG:4326",_.getView().getProjection()),_.getView().fit(e,{padding:C()}),[3,5];case 3:return r=a.sent(),N.Z.error(r),f.ZP.error({message:k("LayerTreeContextMenu.extentError")}),[3,5];case 4:return b(!1),[7];case 5:return[2]}})})();break;case"removeExternal":if(_){O(t);var i=T.C.getLayerByName(_,k("AddLayerModal.externalWmsFolder")),s=T.C.getLayerByName(_,k("UploadDataModal.uploadedDataFolder"));i&&0===i.getLayers().getLength()&&O(i),s&&0===s.getLayers().getLength()&&O(s)}break;case"toggleLegend":var o=(0,x.getUid)(t),u=[...a];u.includes(o)?u.splice(u.indexOf(o),1):u.push(o),n(u);break;case"editLayer":w((0,e_.hr)(null)),w((0,e_.vN)((0,x.getUid)(t))),w((0,eY.$Z)());break;case"layerDetails":w((0,tr.uF)((0,x.getUid)(t))),w((0,tr.$Z)())}h(!1)}},placement:"bottomLeft",onOpenChange:h,open:g,trigger:["click"]},u),{children:(0,s.jsx)(eF.G,{icon:eP.iV1})}))})},a$=()=>(0,s.jsxs)("div",{className:"layer-node-title-loading-animation",children:[(0,s.jsx)("span",{className:"dot-one",children:"."}),(0,s.jsx)("span",{className:"dot-two",children:"."}),(0,s.jsx)("span",{className:"dot-three",children:"."})]}),aR=e=>{var r,t,i=(0,a._)({},(0,n._)(e)),u=(0,Z.S)(),c=(0,ea.Z)(),p=(0,E.useTranslation)().t,f=null==u?void 0:u.getAllLayers().map(e=>(0,x.getUid)(e)),m=null!=(r=A(e=>e.layerTree.showLegends))&&r,g=null!=(t=A(e=>e.layerTree.layerIconsVisible))&&t,h=(0,d._)((0,o.useState)(m&&null!=f?f:[]),2),y=h[0],v=h[1],b=(0,d._)((0,o.useState)({}),2),w=b[0],_=b[1],N=(0,d._)((0,o.useState)(),2),k=N[0],L=N[1],P=(0,o.useCallback)(()=>{u&&T.C.getAllLayers(u).forEach(e=>{if(e instanceof te()){var r=e.getSource();r instanceof er()&&(r.hasListener("tileloadstart")||r.on("tileloadstart",U),r.hasListener("tileloadend")||r.hasListener("tileloaderror")||r.on(["tileloadend","tileloaderror"],I)),r instanceof Q()&&(r.hasListener("imageloadstart")||r.on("imageloadstart",U),r.hasListener("imageloadend")||r.hasListener("imageloaderror")||r.on(["imageloadend","imageloaderror"],I))}})},[u]),F=(0,o.useCallback)(()=>{var e=null==u?void 0:u.getAllLayers().map(e=>(0,x.getUid)(e));(null==e?void 0:e.length)!==(null==f?void 0:f.length)&&P()},[u,f,P]),D=(0,o.useMemo)(()=>({SCALE:k,LEGEND_OPTIONS:"fontAntiAliasing:true;forceLabels:on",TRANSPARENT:!0}),[k]),M=(0,o.useMemo)(()=>(0,l._)({},(0,et.a)(null==c?void 0:c.getKeycloak())),[c]),O=(0,o.useCallback)(e=>{var r=e.map.getView(),t=r.getProjection().getUnits()||"m",a=r.getResolution();L(a?T.C.getScaleForResolution(a,t):void 0)},[]);(0,o.useEffect)(()=>{if(u)return O(new aL.Z("moveend",u)),u.on("moveend",O),()=>{u.un("moveend",O)}},[u,O]),(0,o.useEffect)(()=>{if(u)return P(),u.getLayers().on("change",F),()=>{T.C.getAllLayers(u).forEach(e=>{if(e instanceof te()){var r=e.getSource();r.hasListener("tileloadstart")&&r.un("tileloadstart",U),r.hasListener("tileloadend")&&r.un("tileloadend",I),r.hasListener("tileloaderror")&&r.un("tileloaderror",I)}}),u.getLayers().un("change",F)}},[u,P,F]);var U=e=>{_(r=>{var t=(0,x.getUid)(e.target),a=structuredClone(r);return a[t]&&a[t].loaded>=a[t].loading?(a[t].loading=1,a[t].loaded=0,a[t].percent=0):(a[t]||(a[t]={loading:0,loaded:0,percent:0}),a[t].loading=Number.isInteger(a[t].loading)?a[t].loading+1:1),a})},I=e=>{_(r=>{var t=(0,x.getUid)(e.target),a=structuredClone(r);a[t]||(a[t]={loading:0,loaded:0,percent:0}),a[t].loaded=Number.isInteger(a[t].loaded)?a[t].loaded+1:1;var n=Math.round(a[t].loaded/a[t].loading*100);return n>a[t].percent&&(a[t].percent=n),a})};return u?(0,s.jsx)(aP(),(0,l._)({"aria-label":"layertree",className:"layertree",nodeTitleRenderer:e=>{if(u){var r,t=e instanceof te()&&(0,x.getUid)(e.getSource())?null==(r=w[(0,x.getUid)(e.getSource())])?void 0:r.percent:100;return e instanceof j()?(0,s.jsx)("div",{"aria-label":"layer-group",children:e.get("name")}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"tree-node-header","aria-label":"tree-node-header",children:[(0,s.jsxs)("span",{"aria-label":"layer-name",className:"layer-name",children:[e.get("name"),(0,s.jsx)("span",{className:"loading-dots",children:t<100&&(0,s.jsx)(a$,{})}),(0,s.jsxs)("span",{className:"layer-icons-group",children:[e.get("searchable")&&g&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(ry.Z,{title:p("ToolMenu.searchable"),children:(0,s.jsx)(eF.G,{icon:eP.Y$T,className:"layer-icon"})})}),e.get("hoverable")&&e.get("visible")&&g&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(ry.Z,{title:p("ToolMenu.queryable"),children:(0,s.jsx)(eF.G,{icon:eP.DBf,className:"layer-icon"})})}),e.get("editable")&&g&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(ry.Z,{title:p("ToolMenu.editable"),children:(0,s.jsx)(eF.G,{icon:eP.IwR,className:"layer-icon"})})})]})]}),(e instanceof C()||e instanceof S())&&(0,s.jsx)("div",{"aria-label":"layer-context-menu",children:(0,s.jsx)(aI,{layer:e,visibleLegendsIds:y,setVisibleLegendsIds:v})})]}),e.get("visible")&&(0,s.jsx)("div",{className:"layer-transparency",role:"button","aria-label":"transparency-slider",tabIndex:0,onClick:e=>e.stopPropagation(),onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),e.stopPropagation())},onDragStart:e=>{e.stopPropagation(),e.preventDefault()},draggable:!0,children:(0,s.jsx)(aD(),{tooltip:{formatter:e=>`${p("LayerTree.transparency")}: ${e}%`},layer:e})}),e.get("visible")&&"WMSTIME"===e.get("type")&&(0,s.jsx)("div",{className:"layer-time-slider",children:(0,s.jsx)(aU,{layer:e})}),e.get("visible")&&(0,H.us)(e)&&y.includes((0,x.getUid)(e))&&(0,s.jsx)(aF.Legend,{layer:e,errorMsg:p("LayerTree.noLegendAvailable"),extraParams:D,headers:e.get("useBearerToken")?M:void 0})]})}},filterFunction:e=>e instanceof j()||!(e instanceof td())||!ej()(e.get("shogunId")),draggable:!0},i)):(0,s.jsx)(s.Fragment,{})},aG=t(44126),aB=t.n(aG),aV=t(52746),aJ=e=>{var r=e.showMeasureDistance,t=e.showMeasureArea,a=(0,E.useTranslation)().t,n=(0,Z.S)(),l=(0,o.useMemo)(()=>{if(ej()(n))return!0;var e=aB().Proj(n.getView().getProjection().getCode()),r=tC()(e,"projName");return e4()(r)||"longlat"===r||"geocent"===r},[n]),i=(0,d._)((0,o.useState)(),2),u=i[0],c=i[1];return n?(0,s.jsxs)(rr.ToggleGroup,{className:"measure-tools",selected:u,onChange:(e,r)=>{c(r)},children:[r?(0,s.jsxs)(aV.MeasureButton,{geodesic:l,value:"line",measureType:"line",type:"link",continueLineMsg:a("Measure.clicktodrawline"),children:[(0,s.jsx)(eF.G,{icon:eP.SoD}),(0,s.jsx)("span",{className:"measure-text",children:a("Measure.line")})]}):(0,s.jsx)(s.Fragment,{}),t?(0,s.jsxs)(aV.MeasureButton,{geodesic:l,value:"poly",measureType:"polygon",type:"link",continuePolygonMsg:a("Measure.clicktodrawarea"),children:[(0,s.jsx)(eF.G,{icon:eP.ubJ}),(0,s.jsx)("span",{className:"measure-text",children:a("Measure.area")})]}):(0,s.jsx)(s.Fragment,{})]}):(0,s.jsx)(s.Fragment,{})},az=e=>{var r,t=e.collapseWidth,a=void 0===t?40:t,n=e.minWidth,u=void 0===n?240:n,c=e.maxWidth,p=void 0===c?600:c,f=(0,ep._)(e,["collapseWidth","minWidth","maxWidth"]),m=(0,E.useTranslation)().t,g=(0,Z.S)(),h=G(),y=M(),v=A(e=>e.toolMenu.availableTools),x=A(e=>e.toolMenu.activeKeys),b=A(e=>e.toolMenu.maxHeight),j=(0,ea.Z)(),w=null==j?void 0:j.getKeycloak(),S=(0,d._)((0,o.useState)(!1),2),_=S[0],C=S[1],N=(0,d._)((0,o.useState)([]),2),k=N[0],L=N[1],T=(0,d._)((0,o.useState)(!1),2),P=T[0],F=T[1],D=(0,d._)((0,o.useState)(320),2),U=D[0],I=D[1],$=(0,d._)((0,o.useState)(U),2),R=$[0],B=$[1];(0,o.useEffect)(()=>{var e=window.matchMedia("only screen and (max-width: 450px) and (orientation: portrait),only screen and (max-width: 750px) and (orientation: landscape), only screen and (max-width: 580px)"),r=RegExp("/Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile|Kindle|NetFront|Silk-Accelerated|(hpw|web)OS|Fennec|Minimo|Opera M(obi|ini)|Blazer|Dolfin|Dolphin|Skyfire|Zune/");(e.matches||r.test(window.navigator.userAgent))&&(C(!0),I(a))},[a]),(0,o.useEffect)(()=>{k.length<1&&(v.includes("default")?L(["measure_tools","draw_tools","feature_info","print","tree","permalink","language_selector"]):L(v))},[k,v]),(0,o.useEffect)(()=>{var e=["print","measure_tools","draw_tools","feature_info","tree"];if(e.filter(e=>x.includes(e)).length>1){var r=x.slice(0,x.length-1).reverse().find(r=>e.includes(r));r&&y((0,tD.wG)(x.filter(e=>e!==r)))}y((0,tF.$f)(x.includes("feature_info"))),y((0,tZ.cm)(x.includes("tree")))},[x,y]);var V=A(e=>e.layerTree.activeUploadTools),J=(0,o.useCallback)(()=>{F(!0)},[]),z=(0,o.useCallback)(()=>{F(!1)},[]),W=(0,o.useCallback)(e=>{if(P&&!_){var r=e.clientX-document.body.offsetLeft;r>u&&r<p&&(I(r),B(r))}},[P,_,u,p]);return(0,o.useEffect)(()=>(document.addEventListener("mousemove",W),document.addEventListener("mouseup",z),()=>{document.removeEventListener("mousemove",W),document.removeEventListener("mouseup",z)}),[W,z]),(0,s.jsxs)("div",{"aria-label":"tool-menu",className:`tool-menu ${_?"collapsed":""}`,style:{width:U,maxHeight:null!=b?b:"100%"},children:[(0,s.jsx)(tL.Z,(0,l._)({expandIconPosition:"end",activeKey:x,destroyOnHidden:!0,onChange:e=>{C(!1),y((0,tD.wG)(tP()(e))),_&&I(R)},items:(r=[],k.forEach(e=>{var t=(e=>{switch(e){case"measure_tools":return{icon:eP.KxN,title:m("ToolMenu.measure"),wrappedComponent:(0,s.jsx)(aJ,{showMeasureDistance:v.includes("default")||v.includes("measure_tools_distance"),showMeasureArea:v.includes("default")||v.includes("measure_tools_area")})};case"draw_tools":return{icon:eP.q2v,title:m("ToolMenu.draw"),wrappedComponent:(0,s.jsx)(ay,{showDrawPoint:v.includes("default")||v.includes("draw_tools_point"),showDrawLine:v.includes("default")||v.includes("draw_tools_line"),showDrawPolygon:v.includes("default")||v.includes("draw_tools_polygon"),showDrawCircle:v.includes("default")||v.includes("draw_tools_circle"),showDrawRectangle:v.includes("default")||v.includes("draw_tools_rectangle"),showDrawAnnotation:v.includes("default")||v.includes("draw_tools_annotation"),showModifyFeatures:v.includes("default")||v.includes("draw_tools_modify"),showUploadFeatures:v.includes("default")||v.includes("draw_tools_upload"),showDownloadFeatures:v.includes("default")||v.includes("draw_tools_download"),showDeleteFeatures:v.includes("default")||v.includes("draw_tools_delete"),showStyleFeatures:v.includes("default")||v.includes("draw_tools_style")})};case"feature_info":return{icon:eP.DBf,title:m("ToolMenu.featureInfo"),wrappedComponent:(0,s.jsx)(ak,{})};case"print":return{icon:eP.kwI,title:m("ToolMenu.print"),wrappedComponent:g?(0,s.jsx)(at,{active:x.includes("print"),layerBlackList:["react-geo_measure","hoverVectorLayer"]}):(0,s.jsx)(s.Fragment,{})};case"tree":var r,t,a;return{icon:eP.aC2,title:m("ToolMenu.layertree"),wrappedComponent:(0,s.jsxs)("div",{className:"tree-wrapper",children:[(0,s.jsx)(aR,{}),(null==V?void 0:V.includes(tZ.Sv.addWMS))&&(0,s.jsx)(ek.ZP,{className:"add-wms-button tool-menu-button",icon:(0,s.jsx)(eF.G,{icon:eP.r8p}),onClick:()=>y((0,O.$Z)()),children:m("ToolMenu.addWms")}),w&&(null==(a=K().geoserver)||null==(t=a.upload)||null==(r=t.authorizedRoles)?void 0:r.some(e=>w.hasResourceRole(e,w.clientId)))&&(null==V?void 0:V.includes(tZ.Sv.dataUpload))&&(0,s.jsx)(ek.ZP,{className:"upload-data-button tool-menu-button",icon:(0,s.jsx)(eF.G,{icon:eP.cf$}),onClick:()=>y((0,tM.$Z)()),children:m("ToolMenu.uploadData")})]})};case"permalink":return{icon:eP.M6U,title:m("Permalink.title"),wrappedComponent:(0,s.jsx)(tz,{})};case"language_selector":return{icon:eP.BCn,title:m("ToolMenu.languageSelect"),wrappedComponent:(0,s.jsx)(tO,{})}}})(e);if(t){var a=t.icon,n=t.title,l=t.wrappedComponent;r.push({key:e,label:(0,s.jsxs)(s.Fragment,{children:[a?(0,s.jsx)(eF.G,{icon:a}):void 0,(0,s.jsx)("span",{children:n})]}),children:l})}}),h&&h.forEach(e=>{var t;if((t=e.integration)&&"tool-menu"===t.placement){var a=e.key,n=e.wrappedComponent,o=e.integration,u=o.label,c=o.insertionIndex,d=o.icon,p=(0,ep._)(e.integration,["label","insertionIndex","icon"]),f=(0,i._)((0,l._)({key:a,label:(0,s.jsxs)(s.Fragment,{children:[d?(0,s.jsx)(eF.G,{icon:d}):void 0,(0,s.jsx)("span",{children:m(void 0===u?"Plugin":u)})]})},p),{children:(0,s.jsx)(n,{})});r.splice(null!=c?c:0,0,f)}}),r)},f)),(0,s.jsx)(ry.Z,{placement:"right",title:_?m("ToolMenu.expand"):m("ToolMenu.collapse"),children:(0,s.jsx)(ek.ZP,{className:"collapse-btn","aria-label":"collapse-button",icon:_?(0,s.jsx)(eF.G,{icon:eP._tD}):(0,s.jsx)(eF.G,{icon:eP.A35}),onClick:()=>{y((0,tD.wG)([])),C(!_),_?I(R):I(a)}})}),_?(0,s.jsx)(s.Fragment,{}):(0,s.jsx)("div",{className:"dynamicWidth",role:"button",tabIndex:0,onMouseDown:J,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),J())}})]})},aW=t(28837),aK=t(47613),aq=eN.Z.Dragger,aY=e=>{var r=(0,a._)({},(0,n._)(e)),t=(0,d._)((0,o.useState)(""),2),u=t[0],f=t[1],g=(0,d._)((0,o.useState)(""),2),h=g[0],y=g[1],v=(0,d._)((0,o.useState)(!1),2),x=v[0],b=v[1],w=A(e=>e.uploadDataModal.visible),S=A(e=>e.user),_=M(),C=(0,Z.S)(),k=(0,ea.Z)(),L=(0,E.useTranslation)().t;return(0,s.jsxs)(m.Z,(0,i._)((0,l._)({className:"upload-data-modal",title:L("UploadDataModal.title"),open:w,onCancel:()=>{f(""),y(""),_((0,tM.Cp)())},width:600,footer:!1},r),{children:[h&&(0,s.jsx)(z.Z,{message:h,closable:!0,type:"success"}),u&&(0,s.jsx)(z.Z,{message:u,closable:!0,type:"error"}),(0,s.jsx)(tt.Z,{spinning:x,children:(0,s.jsxs)(aq,{customRequest:e=>(0,c._)(function(){var r,t,a,n,s,o,u,f,m,g,h,y,v,x,b;return(0,p.Jh)(this,function(j){switch(j.label){case 0:n=e.onError,s=e.onSuccess,u=(o=e.file).name.split("."),f=o.type,g=null!=(m=null==(r=K().geoserver)?void 0:r.base)?m:"/geoserver",y=null!=(h=null==(a=K().geoserver)||null==(t=a.upload)?void 0:t.workspace)?h:"SHOGUN",v=`${u[0]}_${Date.now()}`.toUpperCase(),x={file:o,baseUrl:g,workspace:y,storeName:v,layerName:v},j.label=1;case 1:let w;if(j.trys.push([1,6,,7]),"image/tiff"!==f)return[3,3];return[4,(w=x,(0,c._)(function(){var e,r,t,a,n,s;return(0,p.Jh)(this,function(o){switch(o.label){case 0:return r=w.baseUrl,t=w.workspace,a=w.storeName,n=w.layerName,s=w.file,[4,fetch(`${r}/rest/workspaces/${t}/coveragestores/${a}/file.geotiff?configure=none`,{method:"PUT",headers:(0,i._)((0,l._)({},(0,et.a)(null==k?void 0:k.getKeycloak())),{"Content-Type":"image/tiff"}),body:s})];case 1:if(!o.sent().ok)throw Error(L("UploadDataModal.error.general",{fileName:s.name}));return[4,fetch(`${r}/rest/workspaces/${t}/coveragestores/${a}/coverages`,{method:"POST",headers:(0,i._)((0,l._)({},(0,et.a)(null==k?void 0:k.getKeycloak())),{"Content-Type":"application/json"}),body:JSON.stringify({coverage:{enabled:!0,name:n,nativeName:n,title:n,keywords:{string:["User upload",`Uploaded by ${null==(e=S.providerDetails)?void 0:e.username}`]}}})})];case 2:if(!o.sent().ok)throw Error(L("UploadDataModal.error.general",{fileName:s.name}));return[2]}})})())];case 2:j.sent(),j.label=3;case 3:let _;if("application/zip"!==f)return[3,5];return[4,(_=x,(0,c._)(function(){var e,r,t,a,n,s,o,u,c;return(0,p.Jh)(this,function(p){switch(p.label){case 0:return r=_.baseUrl,t=_.workspace,a=_.storeName,n=_.layerName,s=_.file,[4,aW.Shapefile.load(s)];case 1:if(o=p.sent(),u="",c={attribute:[]},1!==Object.entries(o).length)throw Error(L("UploadDataModal.error.zipContent"));return Object.entries(o).forEach(e=>{var r=(0,d._)(e,2),t=r[0],a=r[1];u=t;var n=a.parse("dbf",{properties:!1});c.attribute=n.fields.map(e=>({name:e.name,minOccurs:0,maxOccurs:1,nillable:!0,binding:(e=>{switch(e){case"C":return"java.lang.String";case"D":return"java.util.Date";case"N":return"java.lang.Long";case"F":return"java.lang.Double";case"L":return"java.lang.Boolean";default:return null}})(e.type),length:e.length}));var l=a.parse("shx");c.attribute.push({name:"the_geom",minOccurs:0,maxOccurs:1,nillable:!0,binding:{0:null,1:"org.locationtech.jts.geom.Point",3:"org.locationtech.jts.geom.LineString",5:"org.locationtech.jts.geom.Polygon",8:"org.locationtech.jts.geom.MultiPoint",11:"org.locationtech.jts.geom.Point",13:"org.locationtech.jts.geom.LineString",15:"org.locationtech.jts.geom.Polygon",18:"org.locationtech.jts.geom.MultiPoint",21:"org.locationtech.jts.geom.Point",23:"org.locationtech.jts.geom.LineString",25:"org.locationtech.jts.geom.Polygon",28:"org.locationtech.jts.geom.MultiPoint",31:null}[l.header.type]})}),[4,fetch(`${r}/rest/workspaces/${t}/datastores/${a}/file.shp?configure=none`,{method:"PUT",headers:(0,i._)((0,l._)({},(0,et.a)(null==k?void 0:k.getKeycloak())),{"Content-Type":"application/zip"}),body:s})];case 2:if(!p.sent().ok)throw Error(L("UploadDataModal.error.general",{fileName:s.name}));return[4,fetch(`${r}/rest/workspaces/${t}/datastores/${a}/featuretypes`,{method:"POST",headers:(0,i._)((0,l._)({},(0,et.a)(null==k?void 0:k.getKeycloak())),{"Content-Type":"application/json"}),body:JSON.stringify({featureType:{enabled:!0,name:n,nativeName:u,title:n,attributes:c,keywords:{string:["User upload",`Uploaded by ${null==(e=S.providerDetails)?void 0:e.username}`]}}})})];case 3:if(!p.sent().ok)throw Error(L("UploadDataModal.error.general",{fileName:s.name}));return[2]}})})())];case 4:j.sent(),j.label=5;case 5:return s&&s({baseUrl:g,workspace:y,layerName:v}),[3,7];case 6:return b=j.sent(),n&&n({name:"UploadError",message:b instanceof Error?b.message:L("UploadDataModal.error.general",{fileName:o.name})}),[3,7];case 7:return[2]}})})(),accept:"image/tiff,application/zip",maxCount:1,showUploadList:!1,beforeUpload:e=>{var r,t,a,n=null!=(a=null==(t=K().geoserver)||null==(r=t.upload)?void 0:r.limit)?a:2e8,l=e.type,i=e.size;if(f(""),y(""),i>n)return f(L("UploadDataModal.error.maxSize",{maxSize:n/1e6})),!1;var s=["application/zip","image/tiff"];return!!s.includes(l)||(f(L("UploadDataModal.error.supportedFormats",{supportedFormats:s.join(", ")})),!1)},onChange:e=>(0,c._)(function(){var r,t,a;return(0,p.Jh)(this,function(n){if("uploading"===(r=e.file).status&&b(!0),"done"===r.status){if(!k||!r.response)return[2];t={name:r.response.layerName,type:"TILEWMS",clientConfig:{hoverable:!0},sourceConfig:{url:`${r.response.baseUrl}/ows?`,layerNames:`${r.response.workspace}:${r.response.layerName}`,useBearerToken:!0}},(a=new aK.Z({client:k}).parseTileLayer(t)).set("layerConfig",t),a.set("isUploadedLayer",!0),a.set("groupName",L("UploadDataModal.uploadedDataFolder"));if(C){var l=L("UploadDataModal.uploadedDataFolder"),i=T.C.getLayerByName(C,l);if(!i){i=new(j())({layers:[],properties:{name:l}});var s=C.getLayerGroup().getLayers();s.insertAt((null==s?void 0:s.getLength())||0,i)}i.getLayers().getArray().includes(a)||i.getLayers().push(a)}y(L("UploadDataModal.success",{fileName:r.name,layerName:r.response.layerName})),b(!1)}else"error"===r.status&&(b(!1),N.Z.error(r.error),r.error&&r.error.message?f(r.error.message):f(L("UploadDataModal.error.general",{fileName:r.name})));return[2]})})(),children:[(0,s.jsx)("p",{className:"ant-upload-drag-icon",children:(0,s.jsx)(eF.G,{icon:eP.cf$})}),(0,s.jsx)("p",{className:"ant-upload-text",children:L("UploadDataModal.description")}),(0,s.jsx)("p",{className:"ant-upload-hint",children:L("UploadDataModal.hint")})]})})]}))},aH=e=>{var r=(0,a._)({},(0,n._)(e));return(0,c._)(function(){var e,r,t,a,n,l,i,s,o,c,d,f,m,g,h,y,v,x,b;return(0,p.Jh)(this,function(w){switch(w.label){case 0:var _;if(e=(0,Z.S)(),r=(0,ea.Z)(),_=window.location.search,t=u().useMemo(()=>new URLSearchParams(_),[_]),a=(0,E.useTranslation)().t,n=t.get("layers"),!e||(l=e=>e.get("name"),i=e=>e instanceof C()||e instanceof S(),!(s=tJ.k.applyLink(e,";",l,i))))return[2];o=r=>{var t=new(j())({layers:[]});t.set("name",r);var a=e.getLayerGroup().getLayers();return a.insertAt((null==a?void 0:a.getLength())||0,t),t},w.label=1;case 1:if(w.trys.push([1,10,,11]),c=JSON.parse(s),!r)throw Error("Client is not available");d=new aK.Z({client:r}),f=!0,m=!1,g=void 0,w.label=2;case 2:w.trys.push([2,7,8,9]),h=function(){var r,t,l,i,s;return(0,p.Jh)(this,function(u){switch(u.label){case 0:if(r=v.value,e4()(null==r?void 0:r.layerConfig))return[3,2];return t=r.layerConfig,[4,d.parseLayer(t)];case 1:if(!(l=u.sent())||(r.isExternalLayer&&l.set("isExternalLayer",r.isExternalLayer),r.isUploadedLayer&&l.set("isUploadedLayer",r.isUploadedLayer),l.set("groupName",r.groupName),l.set("layerConfig",r.layerConfig),l.setVisible(!!(null==n?void 0:n.split(";").some(e=>e===t.name))),!(l.get("isExternalLayer")||l.get("isUploadedLayer"))))return[2,"continue"];i=void 0,l.get("groupName")?(i=T.C.getLayerByName(e,l.get("groupName")))||(i=o(l.get("groupName"))):(i=null==(s=T.C.getLayersByProperty(e,"isExternalLayerGroup",!0))?void 0:s[0])||(i=o(a("AddLayerModal.externalWmsFolder"))).set("isExternalLayerGroup",!0),T.C.getLayerByName(e,l.get("name"))||i.getLayers().push(l),u.label=2;case 2:return[2]}})},y=c[Symbol.iterator](),w.label=3;case 3:if(f=(v=y.next()).done)return[3,6];return[5,(0,p.XA)(h())];case 4:w.sent(),w.label=5;case 5:return f=!0,[3,3];case 6:return[3,9];case 7:return x=w.sent(),m=!0,g=x,[3,9];case 8:try{f||null==y.return||y.return()}finally{if(m)throw g}return[7];case 9:return[3,11];case 10:return b=w.sent(),N.Z.error(b),[3,11];case 11:return[2]}})})(),(0,o.useEffect)(()=>{var e=document.querySelectorAll(".loadmask")[0];e&&e.classList.add("loadmask-hidden")},[]),(0,s.jsxs)("div",(0,i._)((0,l._)({className:"App"},r),{children:[(0,s.jsx)(r8,{}),(0,s.jsx)(B,{}),(0,s.jsx)(az,{}),(0,s.jsx)(tu,{}),(0,s.jsx)(rN,{}),(0,s.jsx)(J,{}),(0,s.jsx)(U,{}),(0,s.jsx)(aY,{}),(0,s.jsx)(rg,{}),(0,s.jsx)(tl,{}),(0,s.jsx)(tk,{}),(0,s.jsx)(tv,{})]}))},aX=aH},10562:function(){},96281:function(){}}]);
//# sourceMappingURL=3722.af00a4977823b511.js.map