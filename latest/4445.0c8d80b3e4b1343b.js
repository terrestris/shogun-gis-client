"use strict";(self.webpackChunk_terrestris_shogun_gis_client=self.webpackChunk_terrestris_shogun_gis_client||[]).push([["4445"],{11125:function(e,r,t){t.r(r),t.d(r,{App:function(){return ne},default:function(){return nr}});var a=t(58106),n=t(32206),l=t(91439),i=t(46439),s=t(85893),o=t(9948),u=t.n(o),c=t(92485),d=t(87719),f=t(65353),p=t(79718),m=t(58155),g=t(64614),h=t(32676),v=t(88983),y=t(62530),x=t(49179),b=t(55405),j=t.n(b),w=t(58875),S=t.n(w),_=t(10961),C=t.n(_),E=t(29435),N=t(12038),L=t(92212),k=t(81629),F=t(54388),T=t(53573),P=t.n(T),Z=t(39660),D=t(4649),M=()=>(0,D.useDispatch)(),A=D.useSelector,O=t(56511),U=e=>{var r=(0,a._)({},(0,n._)(e)),t=(0,d._)((0,o.useState)(!1),2),u=t[0],b=t[1],w=(0,d._)((0,o.useState)([]),2),_=w[0],T=w[1],D=(0,d._)((0,o.useState)([]),2),U=D[0],I=D[1],$=(0,d._)((0,o.useState)(""),2),R=$[0],G=$[1],V=(0,d._)((0,o.useState)("https://sgx.geodatenzentrum.de/wms_topplus_open"),2),B=V[0],J=V[1],z=(0,d._)((0,o.useState)(),2),W=z[0],K=z[1],q=(0,d._)((0,o.useState)("1.3.0"),2),Y=q[0],H=q[1],X=A(e=>e.addLayerModal.visible),Q=M(),ee=(0,Z.S)(),er=(0,E.useTranslation)().t;(0,o.useEffect)(()=>{X&&K(L.V.createValidGetCapabilitiesRequest(B,"WMS",Y))},[Y,X,B]);var et=()=>{I([]),T([]),Q((0,O.Cp)())},ea=e=>{if(ee){var r=er("AddLayerModal.externalWmsFolder"),t=F.C.getLayerByName(ee,r),a=!!t;if(t||(t=new(j())({layers:[]})).set("name",r),e.forEach(e=>{if(!t.getLayers().getArray().includes(e)){if(e.set("isExternalLayer",!0),e instanceof S()&&(a=null==(n=e.getSource())?void 0:n.getUrl()),e instanceof C()){var r,a,n,l,i=null==(l=e.getSource())?void 0:l.getUrls();a=(null==i?void 0:i.length)===1?i[0]:void 0}var s={name:e.get("name"),type:e instanceof C()?"TILEWMS":"WMS",opacity:e.getOpacity(),sourceConfig:{layerNames:null==(r=e.getSource())?void 0:r.getParams().LAYERS,url:a,useBearerToken:!1}};e.set("layerConfig",s),t.getLayers().push(e)}}),!a){var n=ee.getLayerGroup().getLayers();n.insertAt((null==n?void 0:n.getLength())||0,t)}et()}};return(0,s.jsxs)(m.Z,(0,i._)((0,l._)({className:"add-layer-modal",title:er("AddLayerModal.title"),open:X,onCancel:et,width:600,footer:[(0,s.jsx)(P(),{"aria-label":"add-all",disabled:(null==_?void 0:_.length)<1,onClick:()=>{ea(_)},children:er("AddLayerModal.addAllLayers")},"add-all"),(0,s.jsx)(P(),{"aria-label":"add-selected",disabled:(null==U?void 0:U.length)<1,onClick:()=>{ea(_.filter(e=>U.includes((0,x.getUid)(e))))},children:er("AddLayerModal.addSelectedLayers")},"add-selected")]},r),{children:[(0,s.jsx)("span",{children:er("AddLayerModal.requestWmsGetCapabilitiesInstruction")}),(0,s.jsx)(g.Z.Search,{"aria-label":"input-search",className:"url-input",placeholder:er("AddLayerModal.inputPlaceholder"),value:B,onChange:e=>{var r=e.target.value;G(L.V.isValid(r.trim())?"":"error"),J(e.target.value)},onSearch:()=>(0,c._)(function(){var e,r;return(0,f.Jh)(this,function(t){switch(t.label){case 0:if(!W)return[2];t.label=1;case 1:return t.trys.push([1,3,4,5]),b(!0),[4,k.Z.getWmsCapabilities(W)];case 2:return e=t.sent(),T(k.Z.getLayersFromWmsCapabilities(e,"Title")),[3,5];case 3:return r=t.sent(),p.ZP.error({message:er("AddLayerModal.errorMessage"),description:er("AddLayerModal.errorDescription")}),N.Z.error(r),[3,5];case 4:return b(!1),[7];case 5:return[2]}})})(),status:R,enterButton:!0,addonBefore:(0,s.jsx)(h.Z,{"aria-label":"select-version",defaultValue:"1.3.0",onChange:H,options:[{value:"1.3.0",label:`${er("AddLayerModal.version")} 1.3.0`},{value:"1.1.1",label:`${er("AddLayerModal.version")} 1.1.1`}]})}),""!==R&&(0,s.jsx)(v.Z,{className:"error",children:er("AddLayerModal.invalidUrlErrorMsg")}),(0,s.jsx)(y.Z,{"aria-label":"wms-table",loading:u,columns:[{title:er("AddLayerModal.columnTitle"),render:(e,r)=>r.get("title")}],scroll:{y:250},rowKey:e=>(0,x.getUid)(e),rowSelection:{selectedRowKeys:U,onChange:I},pagination:!1,dataSource:_})]}))},I=t(44568),$=t(89282),R=t(17126),G=()=>(0,o.useContext)(R.ZP),V=e=>{var r=(0,a._)({},(0,n._)(e)),t=(0,Z.S)(),u=G(),c=(0,E.useTranslation)(),d=c.t,f=c.i18n;(0,o.useEffect)(()=>{if(t){var e=F.C.getLayersByProperty(t,"isExternalLayerGroup",!0);if((null==e?void 0:e.length)===1){var r=e[0],a=e[0].get("name");r.set("name",d("AddLayerModal.externalWmsFolder"));var n=new I.ObjectEvent("change:layers","name",a);r.dispatchEvent(n)}}},[f.language,t,d]);var p=[];return(u&&u.forEach(e=>{var r;if((r=e.integration)&&"map"===r.placement){var t=e.key,a=e.wrappedComponent;p.push((0,s.jsx)(a,{},t))}}),t)?(0,s.jsx)($.MapComponent,(0,i._)((0,l._)({map:t},r),{children:p})):(0,s.jsx)(s.Fragment,{})},B=t(30143),J=()=>{var e=G(),r=(0,E.useTranslation)().t,t=()=>{var r=null;return e.forEach(e=>{var t;if((t=e.integration)&&"cookie-banner"===t.placement){var a=e.key,n=e.wrappedComponent;r=(0,s.jsx)(n,{},a)}}),r};return(0,s.jsx)(B.Gk,{disableStyles:!0,location:"bottom",buttonText:r("CookieBanner.button"),cookieName:"SHOGun-Session-Cookie",buttonClasses:"cookie-button",containerClasses:"cookie-container",contentClasses:"cookie-content",expires:150,children:t()?t():r("CookieBanner.info")},"default-cookie-consent")},z=t(33357),W=t(87617),K=t.n(W),q=t(16120),Y=t.n(q),H=t(68191),X=t(24955),Q=t.n(X),ee=t(74958),er=t.n(ee),et=t(78459),ea=t(71797),en=()=>{var e=(0,ea.Z)(),r=e=>["wfs:FAILED","ows:ExceptionReport"].some(r=>e.getElementsByTagName(r).length>0);return(0,o.useCallback)(t=>(0,c._)(function(){var a,n,i,s,o,u,c;return(0,f.Jh)(this,function(d){switch(d.label){case 0:if((i=t.layer.getSource())instanceof Q()&&(n=i.getUrl()),i instanceof er()&&(n=(s=i.getUrls())?s[0]:void 0),!n)return[2];return n.endsWith("?")&&(n=n.slice(0,-1)),o={"Content-Type":"application/xml"},[4,fetch(n,{method:"POST",headers:(null==(a=t.layer)?void 0:a.get("useBearerToken"))?(0,l._)({},o,(0,et.a)(null==e?void 0:e.getKeycloak())):o,body:new XMLSerializer().serializeToString(t.transaction)})];case 1:if(!(u=d.sent()).ok)throw Error("No successful response while executing a WFS-Transaction");return[4,u.text()];case 2:if(c=d.sent(),r(new DOMParser().parseFromString(c,"text/xml")))throw Error(`Something failed: ${c}`);return[2,c]}})})(),[e])},el=t(27484),ei=t.n(el),es=t(50361),eo=t.n(es),eu=t(28287),ec=t(39244),ed=t.n(ec),ef=t(91007),ep=t(11992),em=t(19478),eg=t(80264),eh=t(36192),ev=t(96973),ey=t(23279),ex=t.n(ey),eb=t(14293),ej=t.n(eb),ew=t(13218),eS=t.n(ew),e_=t(63364),eC=t(47037),eE=t.n(eC),eN=t(24512),eL=t(76534),ek=t(58548),eF=e=>{var r=e.readOnly,t=e.fieldConfig,a=(0,ef._)(e,["readOnly","fieldConfig"]),n=(0,ea.Z)(),o=(0,E.useTranslation)().t;return n?(0,s.jsx)(eN.Z,(0,i._)((0,l._)({multiple:!0,name:"file",action:"/files/uploadToFileSystem",withCredentials:!0,headers:(0,l._)({},(0,ek.y)(),(0,et.a)(n.getKeycloak())),onRemove:e=>(0,c._)(function(){var r,t;return(0,f.Jh)(this,function(a){switch(a.label){case 0:if(!(t=null==e||null==(r=e.response)?void 0:r.fileUuid))return[3,2];return[4,fetch(`${null==n?void 0:n.getBasePath()}files/${t}`,{method:"DELETE",credentials:"same-origin",headers:(0,l._)({},(0,ek.y)(),(0,et.a)(null==n?void 0:n.getKeycloak()))})];case 1:return[2,a.sent()];case 2:return[2]}})})(),onPreview:e=>(0,c._)(function(){var r,t,a,i,s,o;return(0,f.Jh)(this,function(u){switch(u.label){case 0:if(!n||(t=null==(r=e.response)?void 0:r.fileName,a=`/files/${null==r?void 0:r.fileUuid}`,ej()(t)||ej()(null==r?void 0:r.fileUuid)))return[2];return i=document.createElement("a"),document.body.appendChild(i),[4,fetch(a,{headers:(0,l._)({},(0,et.a)(n.getKeycloak()))})];case 1:return[4,u.sent().blob()];case 2:return s=u.sent(),o=window.URL.createObjectURL(s),i.href=o,i.download=t,i.click(),window.URL.revokeObjectURL(o),[2]}})})()},null==t?void 0:t.fieldProps,a),{children:!(void 0!==r&&r)&&(0,s.jsx)(eL.ZP,{children:o("FileUpload.upload")})})):(0,s.jsx)(s.Fragment,{})},eT=t(84131),eP=t(62163),eZ=t(76383),eD=()=>{var e=(0,ea.Z)();return(0,o.useCallback)(r=>(0,c._)(function(){var t;return(0,f.Jh)(this,function(a){switch(a.label){case 0:if(ej()(r))return[2,Promise.reject(Error(`Passed url '${r}' is null or undefined`))];return[4,fetch(r,{credentials:"include",headers:(0,l._)({},(0,et.a)(null==e?void 0:e.getKeycloak()))})];case 1:return[4,a.sent().blob()];case 2:return t=a.sent(),[2,new Promise((e,r)=>{try{var a=new FileReader;a.onload=function(){e(this.result)},a.readAsDataURL(t)}catch(e){r(Error(`Error reading file: ${e}`))}})]}})})(),[e])},eM=e=>{var r=e.fieldConfig,t=e.readOnly,a=void 0!==t&&t,n=e.initialFileList,u=(0,ef._)(e,["fieldConfig","readOnly","initialFileList"]),p=(0,d._)((0,o.useState)(!1),2),g=p[0],h=p[1],v=(0,d._)((0,o.useState)(""),2),y=v[0],x=v[1],b=(0,d._)((0,o.useState)(),2),j=b[0],w=b[1],S=(0,ea.Z)(),_=eD(),C=(0,E.useTranslation)().t;return((0,eZ.b)(()=>(0,c._)(function(){return(0,f.Jh)(this,function(e){switch(e.label){case 0:let r;if(!n||0===n.length)return[2];return[4,(r=n,(0,c._)(function(){return(0,f.Jh)(this,function(e){switch(e.label){case 0:return[4,Promise.all(r.map(e=>(0,c._)(function(){var r,t,a;return(0,f.Jh)(this,function(n){switch(n.label){case 0:return t=[(0,l._)({},e)],a={},[4,_(`${null==S?void 0:S.getBasePath()}imagefiles/${null==e||null==(r=e.response)?void 0:r.fileUuid}/thumbnail`)];case 1:return[2,i._.apply(void 0,t.concat([(a.thumbUrl=n.sent(),a.url=void 0,a)]))]}})})()))];case 1:return[2,e.sent()]}})})())];case 1:return w(e.sent()),[2]}})})(),[null==n?void 0:n.length]),S)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eN.Z,(0,i._)((0,l._)({accept:"image/*",multiple:!0,name:"file",action:`${S.getBasePath()}imagefiles/uploadToFileSystem`,withCredentials:!0,listType:"picture-card",headers:(0,l._)({},(0,ek.y)(),(0,et.a)(S.getKeycloak())),onRemove:e=>(0,c._)(function(){var r,t;return(0,f.Jh)(this,function(a){switch(a.label){case 0:if(!(t=null==e||null==(r=e.response)?void 0:r.fileUuid))return[3,2];return[4,fetch(`${null==S?void 0:S.getBasePath()}imagefiles/${t}`,{method:"DELETE",credentials:"same-origin",headers:(0,l._)({},(0,ek.y)(),(0,et.a)(null==S?void 0:S.getKeycloak()))})];case 1:return[2,a.sent()];case 2:return[2]}})})(),onPreview:e=>(0,c._)(function(){var r;return(0,f.Jh)(this,function(t){switch(t.label){case 0:if(r=e.response,ej()(r)||ej()(null==r?void 0:r.fileUuid))return[2];return[4,_(`${null==S?void 0:S.getBasePath()}imagefiles/${r.fileUuid}`)];case 1:return x(t.sent()),h(!0),[2]}})})(),fileList:a?j:void 0},null==r?void 0:r.fieldProps,u),{children:!a&&(0,s.jsxs)("div",{children:[(0,s.jsx)(eP.G,{icon:eT.r8p}),(0,s.jsx)("div",{style:{marginTop:8},children:C("ImageUpload.upload")})]})})),(0,s.jsx)(m.Z,{open:g,footer:null,onCancel:()=>h(!1),children:(0,s.jsx)("img",{alt:"example",style:{width:"100%"},src:y})})]}):(0,s.jsx)(s.Fragment,{})},eA=t(50963),eO=e=>{var r=e.feature,t=e.formConfig,a=(0,ef._)(e,["feature","formConfig"]),n=(0,d._)((0,eA.useForm)(),1)[0];return(0,o.useEffect)(()=>{n.resetFields(),n.setFieldsValue(r.getProperties())},[r,n]),(0,s.jsx)(ep.Z,(0,i._)((0,l._)({className:"feature-info-form",form:n,labelCol:{span:8},labelAlign:"left",labelWrap:!0},a),{children:null==t?void 0:t.map(e=>{var r,t;return(0,s.jsx)(ep.Z.Item,{name:e.propertyName,label:null!=(r=e.displayName)?r:e.propertyName,children:(0,s.jsx)(eI,(0,l._)({label:null!=(t=e.displayName)?t:e.propertyName},e.fieldProps))},e.propertyName)})}))},eU=e=>{var r=e.value,t=e.referenceConfig,a=(0,ef._)(e,["value","referenceConfig"]),n=(0,d._)((0,o.useState)(!1),2),i=n[0],u=n[1],p=(0,d._)((0,o.useState)(),2),g=p[0],h=p[1],v=(0,E.useTranslation)().t,x=e=>{if(null==t?void 0:t.tablePropertyName){var r=/{{([^}]*)}}/g;if(null==t?void 0:t.tablePropertyName.match(r)){for(var a,n=null==t?void 0:t.tablePropertyName;a=r.exec(null==t?void 0:t.tablePropertyName);)n=n.replace(a[0],e[a[1]]);return n}return e[null==t?void 0:t.tablePropertyName]}if(e.id)return e.id},b=[{width:"100%",render:(e,r)=>x(r)?x(r):v("ReferenceTable.defaultRowPlaceholder")},{render:(e,r)=>(0,s.jsx)(eL.ZP,{onClick:()=>j(e,r),icon:(0,s.jsx)(eP.G,{icon:eT.IA$})})}],j=(e,r)=>{var t=new(Y());t.setProperties(r),h(t),u(!0)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(y.Z,(0,l._)({size:"small",showHeader:!1,pagination:!1,columns:b,rowKey:"id",dataSource:(()=>{if(!r)return[];try{var e=JSON.parse(r);if(Array.isArray(e))return e;if(null==e||"number"==typeof e||"boolean"==typeof e||"string"==typeof e)return N.Z.warn("Unsupported value given"),[];if("object"==typeof e)return[e]}catch(e){return N.Z.warn("Error while parsing the table data ",e),[]}})()},a)),(0,s.jsx)(m.Z,{className:"reference-table-modal",open:i,maskClosable:!1,footer:null,width:600,destroyOnClose:!0,title:(()=>{if(!g)return v("ReferenceTable.defaultModalTitle");var e=x(g.getProperties());return e?`${v("ReferenceTable.modalTitle",{referenceValue:e})}`:v("ReferenceTable.defaultModalTitle")})(),onCancel:()=>(0,c._)(function(){return(0,f.Jh)(this,function(e){return u(!1),h(void 0),[2]})})(),children:g&&(0,s.jsx)(eO,{feature:g,formConfig:null==t?void 0:t.featureInfoFormConfig})})]})},eI=e=>{var r,t,a,n=e.dataType,o=void 0===n?"auto":n,u=e.valueMap,c=e.format,d=e.suffix,f=e.value,p=e.referenceConfig,m=e.urlDisplayValue,g=(0,ef._)(e,["dataType","valueMap","format","suffix","value","referenceConfig","urlDisplayValue"]),h=(0,E.useTranslation)().i18n,y="";if(f&&"string"==typeof f&&(null==u?void 0:u.hasOwnProperty(f))&&(f=u[f]),("string"===o||"auto"===o&&"string"==typeof f)&&f&&(y=null==f?void 0:f.toString()),"boolean"===o||"auto"===o&&"boolean"==typeof f||"false"===f||"true"===f)return(0,s.jsx)(em.Z,{checked:"false"!==f&&!1!==f,disabled:!0});("number"===o||"auto"===o&&Number.isFinite(f))&&f&&(y=new Intl.NumberFormat(h.language,{useGrouping:!1}).format(Number(f))),("date"===o||"auto"===o&&ei()(`${f}`).isValid())&&f&&((0,el.isDayjs)(f)||eE()(f)&&ei()(`${f}`).isValid())&&(y=ei()(f).format(void 0===c?"DD.MM.YYYY":c)),"auto"===o&&Array.isArray(f)&&(y=f.join(", ")),("url"===o||"auto"===o&&eE()(f)&&(r=f.toLowerCase(),["http://","https://","ftp://","mailto:"].some(e=>r.startsWith(e))))&&f&&(y=(0,s.jsx)("a",{href:null==f?void 0:f.toString(),target:"_blank",rel:"noreferrer",children:m||(null==f?void 0:f.toString())}));var x=f&&(e=>{if(!f)return null;var r="string"!=typeof e?JSON.stringify(e):e;try{r=JSON.parse(r)}catch(e){return N.Z.trace(e),null}return"object"==typeof r&&null!==r&&eJ(r[0])?r:null})(f);return"auto"===o&&x?(null==(a=x[0].response)||null==(t=a.fileType)?void 0:t.startsWith("image/"))?(0,s.jsx)(eM,{initialFileList:x,disabled:!0,readOnly:!0}):(0,s.jsx)(eF,{defaultFileList:x,disabled:!0,readOnly:!0}):"json"===o||"auto"===o&&f&&(e=>{var r="string"!=typeof e?JSON.stringify(e):e;try{r=JSON.parse(r)}catch(e){return N.Z.trace(e),!1}return"object"==typeof r&&null!==r})(f)?(0,s.jsx)(eU,{value:"string"==typeof f?f:JSON.stringify(f),referenceConfig:p}):(d&&(y=(0,s.jsxs)(s.Fragment,{children:[y," ",d]})),(0,s.jsx)(v.Z.Text,(0,i._)((0,l._)({className:"displayfield"},g),{children:y})))},e$=t(21689),eR=t(97398),eG=t.n(eR),eV=t(98508),eB=e=>{var r=e.parentForm,t=e.propertyName,a=e.value,n=e.tablePropertyName,u=e.formConfig,p=e.onChange,g=void 0===p?()=>{}:p,h=(0,ef._)(e,["parentForm","propertyName","value","tablePropertyName","formConfig","onChange"]),v=(0,d._)((0,o.useState)(!1),2),x=v[0],b=v[1],j=(0,d._)((0,o.useState)(),2),w=j[0],S=j[1],_=(0,d._)((0,eA.useForm)(),1)[0],C=(0,E.useTranslation)().t,L=eD(),k=(0,ea.Z)(),F=e=>{if(!n)return null!=(r=e.id)?r:"";var r,t,a=/{{([^}]*)}}/g;if(!n.match(a))return e[n];for(var l=n;t=a.exec(n);)l=l.replace(t[0],e[t[1]]);return l},T=[{width:"100%",defaultSortOrder:"ascend",sorter:(e,r)=>{var t=F(e),a=F(r);return Number.isFinite(t)&&Number.isFinite(a)?t-a:"string"==typeof t&&"string"==typeof a?t.localeCompare(a):0},render:(e,r)=>F(r)},{render:(e,r)=>(0,s.jsx)(eL.ZP,{onClick:()=>Z(r),icon:(0,s.jsx)(eP.G,{icon:eT.Xcf})})},{render:(e,r)=>(0,s.jsx)(e$.Z,{title:C("EditReferenceTable.confirmDeleteTitle"),onConfirm:()=>P(r),placement:"bottomRight",children:(0,s.jsx)(eL.ZP,{danger:!0,icon:(0,s.jsx)(eP.G,{icon:eT.$aW})})})}],P=e=>{var a=r.getFieldsValue();if(!a[t])return void N.Z.warn(`Could not find the property ${t} in the form values`);var n=eo()(a[t]);if(!Array.isArray(n))return void N.Z.warn("The delete candidate is not of required type array");var l=n.findIndex(r=>!!Number.isFinite(r.id)&&r.id===e.id||!!(r.internalId&&r.internalId===e.internalId));if(-1===l)return void N.Z.warn(`Could not find the index (${e.id}) to delete`);n.splice(l,1),g(n)},Z=e=>{var r=new(Y());r.setProperties(e),_.setFieldsValue(r.getProperties()),S(r),b(!0)},D=()=>{var e=eo()(_.getFieldsValue(!0)),a=[];Array.isArray(r.getFieldValue(t))&&(a=eo()(r.getFieldValue(t)));var n=a.findIndex(r=>!!Number.isFinite(r.id)&&r.id===e.id||!!(r.internalId&&r.internalId===e.internalId));n>-1?a[n]=e:a.push(e),_.isFieldsTouched()&&g(a)},M=()=>{_.resetFields(),b(!1),S(void 0)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eL.ZP,{className:"add-reference-button",onClick:()=>{var e=new(Y());e.set("internalId",(0,eV.getUid)(e)),_.setFieldsValue(e.getProperties()),S(e),b(!0)},icon:(0,s.jsx)(eP.G,{icon:eT.r8p})}),(0,s.jsx)(y.Z,(0,l._)({size:"small",showHeader:!1,pagination:!1,columns:T,rowKey:"id",dataSource:(()=>{if(a){if(!Array.isArray(a))return void N.Z.warn("Reference value must be of of type array.");var e=eo()(a);return e.forEach(e=>{Object.entries(e).forEach(r=>{var t=(0,d._)(r,2),n=t[0],s=t[1];return(0,c._)(function(){var r;return(0,f.Jh)(this,function(t){switch(t.label){case 0:if((null==u?void 0:u.some(e=>e.propertyName===n&&"DATE"===e.component))&&(eE()(s)||eG()(s))&&(eE()(a)||eG()(a))&&(ei()(`${a}`).isValid()?e[n]=ei()(`${s}`):(N.Z.warn("Could not parse date"),e[n]=null)),!(null==u?void 0:u.some(e=>e.propertyName===n&&"UPLOAD"===e.component)))return[3,3];if(!Array.isArray(e[n]))return[3,2];return[4,Promise.all(null==(r=e[n])?void 0:r.map(e=>(0,c._)(function(){var r,t,a,n;return(0,f.Jh)(this,function(s){switch(s.label){case 0:if(t=[(0,l._)({},e)],a={},!e.type.startsWith("image"))return[3,2];return[4,L(`${null==k?void 0:k.getBasePath()}imagefiles/${null==e||null==(r=e.response)?void 0:r.fileUuid}/thumbnail`)];case 1:return n=s.sent(),[3,3];case 2:n=void 0,s.label=3;case 3:return[2,i._.apply(void 0,t.concat([(a.thumbUrl=n,a.url=e.type.startsWith("image")?void 0:e.url,a)]))]}})})()))];case 1:return e[n]=t.sent(),[3,3];case 2:e[n]=[],t.label=3;case 3:return[2]}})})()})}),e.every(e=>!!Number.isFinite(e.id)||"string"==typeof e.id&&e.id.length>0)||N.Z.warn("Not all elements in the referenced array contain an id value. This might result in unexpected behaviour"),e}})()},h)),(0,s.jsx)(m.Z,{className:"edit-reference-table-modal",open:x,maskClosable:!1,width:600,destroyOnClose:!0,title:`${C("EditReferenceTable.modalTitle",{referenceValue:w?F(w.getProperties()):void 0})}`,onCancel:()=>{M()},onOk:()=>(0,c._)(function(){var e;return(0,f.Jh)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,_.validateFields()];case 1:return r.sent(),[3,3];case 2:return e=r.sent(),N.Z.warn("Form validation failed: ",e),[2];case 3:return D(),M(),[2]}})})(),children:w&&(0,s.jsx)(ez,{form:_,formConfig:u,applyFormDirty:!1})})]})};function eJ(e){return!ej()(e)&&e.uid&&!ej()(e.name)&&!ej()(e.type)&&!ej()(e.uid)&&eS()(e.response)&&!ej()(e.response.id)&&!ej()(e.response.fileUuid)&&!ej()(e.response.fileName)&&!ej()(e.response.fileType)}var ez=e=>{var r=e.form,t=e.formConfig,a=e.applyFormDirty,n=void 0===a||a,o=(0,ef._)(e,["form","formConfig","applyFormDirty"]),u=(0,ea.Z)(),d=M(),p=A(e=>e.editFeature.formDirty),m=e=>(0,s.jsx)(eI,(0,l._)({},e.fieldProps)),v=e=>{if(u)switch(e.component){case"CHECKBOX":return(0,s.jsx)(em.Z,(0,l._)({},null==e?void 0:e.fieldProps));case"DATE":return(0,s.jsx)(eg.Z,(0,l._)({},null==e?void 0:e.fieldProps));case"DISPLAY":return(0,s.jsx)("span",(0,l._)({},null==e?void 0:e.fieldProps));case"INPUT":return(0,s.jsx)(g.Z,(0,l._)({},null==e?void 0:e.fieldProps));case"NUMBER":return(0,s.jsx)(eh.Z,(0,l._)({},null==e?void 0:e.fieldProps));case"SELECT":return(0,s.jsx)(h.Z,(0,l._)({allowClear:!0},null==e?void 0:e.fieldProps));case"SWITCH":return(0,s.jsx)(ev.Z,(0,l._)({},null==e?void 0:e.fieldProps));case"TEXTAREA":return(0,s.jsx)(g.Z.TextArea,(0,l._)({},null==e?void 0:e.fieldProps));case"UPLOAD":var t;if((null==e||null==(t=e.fieldProps)?void 0:t.type)==="IMAGE")return(0,s.jsx)(eM,(0,l._)({},null==e?void 0:e.fieldProps));return(0,s.jsx)(eF,(0,l._)({},null==e?void 0:e.fieldProps));case"REFERENCE_TABLE":return(0,s.jsx)(eB,(0,l._)({tablePropertyName:e.tablePropertyName,propertyName:e.propertyName,formConfig:e.editFormConfig,parentForm:r},e.fieldProps),e.propertyName);default:return N.Z.error(`Component type "${null==e?void 0:e.component}" is not supported`),(0,s.jsx)(s.Fragment,{})}};return(0,s.jsx)(ep.Z,(0,i._)((0,l._)({className:"edit-feature-form",form:r,labelCol:{span:8},labelAlign:"left",labelWrap:!0,onValuesChange:ex()(e=>(0,c._)(function(){return(0,f.Jh)(this,function(r){return n&&e&&!p&&d((0,e_.uQ)(!0)),[2]})})(),250)},o),{children:null==t?void 0:t.map(e=>{e.readOnly?r=m(e):e.component?r=v(e):(N.Z.warn("FieldConfig is missing `readOnly`, `component` or `dataType` property."),r=(0,s.jsx)(g.Z,{placeholder:""},e.propertyName));var r,t,a={rules:[]};return a.rules=[{required:e.required}],"SWITCH"!==e.component&&"CHECKBOX"!==e.component||e.readOnly||(a.valuePropName="checked"),"UPLOAD"!==e.component||e.readOnly||(a.valuePropName="fileList",a.getValueFromEvent=e=>Array.isArray(e)?e:null==e?void 0:e.fileList),(0,s.jsx)(ep.Z.Item,(0,i._)((0,l._)({name:e.propertyName,label:null!=(t=e.displayName)?t:e.propertyName},a),{children:r}),e.propertyName)})}))},eW=e=>["gml:MultiPoint","gml:Point","gml:MultiLineString","gml:LineString","gml:MultiPolygon","gml:Polygon"].includes(e),eK=()=>{var e=(0,ea.Z)(),r="describeFeatureTypeCache";return(0,o.useCallback)(t=>(0,c._)(function(){var a,n,i,s,o,u,c,d,p,m,g;return(0,f.Jh)(this,function(f){switch(f.label){case 0:if((i=t.getSource())instanceof Q()&&(n=i.getUrl()),i instanceof er()&&(n=(s=i.getUrls())?s[0]:void 0),!n||(n.endsWith("?")&&(n=n.slice(0,-1)),!(o=null==(a=t.getSource())?void 0:a.getParams().LAYERS)))return[2];if(c=(u=JSON.parse(sessionStorage.getItem(r)||"{}"))[o])return[2,c];return d={SERVICE:"WFS",REQUEST:"DescribeFeatureType",VERSION:"2.0.0",OUTPUTFORMAT:"application/json",TYPENAMES:o},p={"Content-Type":"application/json"},[4,fetch(`${n}?${L.V.objectToRequestString(d)}`,{method:"GET",headers:t.get("useBearerToken")?(0,l._)({},p,(0,et.a)(null==e?void 0:e.getKeycloak())):p})];case 1:if(!(m=f.sent()).ok)throw Error("No successful response while executing a WFS-DescribeFeature");return[4,m.json()];case 2:return g=f.sent(),u[o]=g,sessionStorage.setItem(r,JSON.stringify(u)),[2,g]}})})(),[e])},eq=()=>{var e=(0,Z.S)(),r=eK(),t=(0,ea.Z)(),a=A(e=>e.editFeature.userEditMode),n=(0,o.useCallback)((e,r,a)=>{var l=!0,i=!1,s=void 0;try{for(var o,u=Object.entries(e)[Symbol.iterator]();!(l=(o=u.next()).done);l=!0)!function(){var l=(0,d._)(o.value,2),i=l[0],s=l[1];if(Array.isArray(s)){var u=s.map(e=>n(e,r));e[i]=a?JSON.stringify(u):u}if(void 0===s&&(e[i]=null),r.some(e=>{var r;return null==(r=e.children)?void 0:r.some(e=>e.propertyName===i&&e.readOnly)})&&delete e[i],ei()(s).isValid()&&(e[i]=s.toISOString()),Array.isArray(s)&&s.length>0&&eJ(s[0])){var c,f,p=(null==(f=s[0].response)||null==(c=f.fileType)?void 0:c.startsWith("image/"))?"imagefiles/":"files/",m=s.map(e=>{var r,a,n,l,i;return{uid:e.uid,lastModified:e.lastModified,name:e.name,type:e.type,url:`${null==t?void 0:t.getBasePath()}${p}${e.response.fileUuid}`,response:{id:null==(r=e.response)?void 0:r.id,created:null==(a=e.response)?void 0:a.created,fileName:null==(n=e.response)?void 0:n.fileName,fileType:null==(l=e.response)?void 0:l.fileType,fileUuid:null==(i=e.response)?void 0:i.fileUuid}}});e[i]=JSON.stringify(m)}}()}catch(e){i=!0,s=e}finally{try{l||null==u.return||u.return()}finally{if(i)throw s}}return e},[t]);return(0,o.useCallback)(t=>(0,c._)(function(){var l,i,s,o,u,c,d,p,m,g,h,v,y,x,b;return(0,f.Jh)(this,function(f){switch(f.label){case 0:if(!e)return[2];return u=[],c=[],d=[],[4,r(t.layer)];case 1:if(!(p=f.sent()))return[2];return m=t.layer.get("editFormConfig"),g=null==(i=p.featureTypes[0])||null==(l=i.properties)?void 0:l.find(e=>eW(e.type)),h=!1,null==(s=t.upsertFeatures)||s.forEach(e=>{var r=new(Y()),l=null==(i=e.getGeometry())?void 0:i.clone();if(l&&!(0,eu.isEmpty)(l.getExtent())&&(null==a?void 0:a.includes("EDIT_GEOMETRY"))){var i,s,o=null!=(s=null==g?void 0:g.name)?s:"geom";r.set(o,l),r.setGeometryName(o)}t.form&&r.setProperties(n(eo()(t.form.getFieldsValue()),m,!0));var d=!!e.getId();h||(h=d),d&&r.setId(e.getId()),(d?c:u).push(r)}),v={featureNS:p.targetNamespace,featurePrefix:p.targetPrefix,featureType:null==(o=t.layer.getSource())?void 0:o.getParams().LAYERS,srsName:e.getView().getProjection().getCode(),version:"1.1.0",nativeElements:[]},y=new(ed())().writeTransaction(u,c,d,v),h&&K().wfsLockFeatureEnabled&&((b=document.createElementNS("https://www.opengis.net/wfs","LockId")).appendChild(document.createTextNode("GeoServer")),null==(x=y.getRootNode())||x.appendChild(b)),[2,y]}})})(),[e,a,r,n])},eY=t(67187),eH=t(12477),eX=e=>{var r=e.open,t=e.children,a=(0,ef._)(e,["open","children"]),n=(0,Z.S)();return(0,o.useEffect)(()=>{var e;null==(e=document.querySelectorAll("#map")[0])||e.classList.toggle("bisected",!!r)},[r]),(0,s.jsx)(eH.Z,(0,i._)((0,l._)({rootClassName:"map-drawer",mask:!1,open:r,placement:"right",width:getComputedStyle(document.documentElement).getPropertyValue("--drawerWidth"),afterOpenChange:()=>{null==n||n.updateSize()}},a),{children:t}))},eQ=t(64903),e0=t.n(eQ),e1=()=>{var e=(0,ea.Z)(),r=(0,Z.S)(),t=eK();return(0,o.useCallback)(function(a){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"1.1.0";return(0,c._)(function(){var i,s,o,u,c,d,p,m,g,h,v;return(0,f.Jh)(this,function(f){switch(f.label){case 0:if(!r)return[2];return[4,t(a.layer)];case 1:if(!(u=f.sent())||((d=a.layer.getSource())instanceof Q()&&(c=d.getUrl()),d instanceof er()&&(c=(p=d.getUrls())?p[0]:void 0),!c))return[2];return c.endsWith("?")&&(c=c.slice(0,-1)),m=null==(s=u.featureTypes[0])||null==(i=s.properties)?void 0:i.find(e=>eW(e.type)),(g=new(ed())({version:n}).writeGetFeature({srsName:r.getView().getProjection().getCode(),featureNS:u.targetNamespace,featurePrefix:u.targetPrefix,featureTypes:[null==d?void 0:d.getParams().LAYERS],outputFormat:"application/json",maxFeatures:a.maxFeatures,propertyNames:a.propertyNames&&(null==m?void 0:m.name)?[...a.propertyNames,null==m?void 0:m.name]:void 0,bbox:a.bbox,filter:a.filter instanceof e0()?a.filter:void 0,geometryName:null==m?void 0:m.name}))instanceof Element&&a.filter instanceof Element&&g.getElementsByTagName("Query")[0].appendChild(a.filter),h={"Content-Type":"application/json"},[4,fetch(c,{method:"POST",headers:(null==(o=a.layer)?void 0:o.get("useBearerToken"))?(0,l._)({},h,(0,et.a)(null==e?void 0:e.getKeycloak())):h,body:new XMLSerializer().serializeToString(g)})];case 2:if(!(v=f.sent()).ok)throw Error("No successful response while executing a WFS-GetFeature");return[4,v.json()];case 3:return[2,f.sent()]}})})()},[e,t,r])},e2=t(78001),e3=t(41609),e4=t.n(e3),e5=t(38450),e6=t.n(e5),e8=t(20521),e7=t(33846),e9=t.n(e7),re=t(82707),rr=t(59694),rt=t(14292),ra=()=>{var e=(0,o.useCallback)((e,r)=>Number(getComputedStyle(document.body).getPropertyValue(e).replace("px",""))||r,[]);return(0,o.useCallback)(function(){var r,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=document.querySelector(".tool-menu"),n=null!=(r=null==a?void 0:a.clientWidth)?r:0,l=e("--headerHeight",50),i=e("--footerHeight",40),s=0;return t&&(s=e("--drawerWidth",450)),[l,s,i,n]},[e])},rn=e=>{var r=e.alignment,t=e.className,a=void 0===t?"":t,n=e.children,o=(0,ef._)(e,["alignment","className","children"]),u="toolbar",c=a?`${a} ${u}`:u;return(0,s.jsx)("div",(0,i._)((0,l._)({className:`${c} ${void 0===r?"horizontal":r}-toolbar`,role:"toolbar"},o),{children:n}))},rl=e=>{var r,t,a=e.feature,n=e.historyLength,u=void 0===n?10:n,c=(0,o.useRef)({past:[],future:[]}),f=(0,Z.S)(),p=M(),m=ra(),g=(0,d._)((0,o.useState)(),2),h=g[0],v=g[1],y=(0,d._)((0,o.useState)(0),2)[1],x=(0,d._)((0,o.useState)(void 0),2),b=x[0],j=x[1],w=(0,o.useMemo)(()=>new(e6()),[]),S=A(e=>e.editFeature.userEditMode),_=A(e=>e.editFeature.formDirty);(0,o.useEffect)(()=>{if(f)return h||v(rt.w.getDigitizeLayer(f)),()=>{h&&(null==f||f.removeLayer(h))}},[h,f]),(0,o.useEffect)(()=>{c.current.past.length>0&&!_&&p((0,e_.uQ)(!0))},[p,c.current.past]),(0,o.useEffect)(()=>{if(h&&(null==a?void 0:a.id)){null==(e=h.getSource())||e.clear();var e,r=w.readFeature(a);if(!Array.isArray(r)){var t=h.getSource();t&&(t.addFeature(r),y(e=>e+1),(0,eu.isEmpty)(t.getExtent())||null==f||f.getView().fit(t.getExtent(),{padding:m(!0)}))}}},[a,h,w,f,m]);var C=()=>{var e,r=null==h||null==(e=h.getSource())?void 0:e.getFeatures();if(r){var t=w.writeFeaturesObject(r);c.current=(0,i._)((0,l._)({},c.current),{past:[...c.current.past,t].slice(-10)}),y(e=>e+1)}},E={tooltipPlacement:"left",tooltipProps:{mouseEnterDelay:.5}};return h&&S.includes("EDIT_GEOMETRY")?(0,s.jsxs)(rn,{className:"geometry-edit-tb",alignment:"vertical",children:[(0,s.jsxs)(rr.ToggleGroup,{selected:b,onChange:(e,r)=>{j(r)},children:[S.includes("CREATE")?(0,s.jsx)(e9(),(0,l._)({value:"create",icon:(0,s.jsx)(eP.G,{icon:eT.TzT}),pressedIcon:(0,s.jsx)(eP.G,{icon:eT.TzT}),name:"draw",digitizeLayer:h,tooltip:(0,e2.t)("EditFeatureGeometryToolbar.draw"),drawType:a.geometry.type,onDrawEnd:e=>{if(!a.geometry.type.toLocaleLowerCase().startsWith("multi")){var r=null==h?void 0:h.getSource(),t=null==r?void 0:r.getFeatures()[0];t&&(null==r||r.once("addfeature",e=>r.removeFeature(e.feature)),t.setGeometry(e.feature.getGeometry()))}C()}},E)):(0,s.jsx)(s.Fragment,{}),S.includes("UPDATE")?(0,s.jsx)(re.ModifyButton,(0,l._)({value:"update",icon:(0,s.jsx)(eP.G,{icon:eT.ubJ}),pressedIcon:(0,s.jsx)(eP.G,{icon:eT.ubJ}),name:"edit",digitizeLayer:h,tooltip:(0,e2.t)("EditFeatureGeometryToolbar.edit"),onModifyStart:C,onModifyEnd:C,onTranslateEnd:C},E)):(0,s.jsx)(s.Fragment,{}),S.includes("DELETE")?(0,s.jsx)(e8.DeleteButton,(0,l._)({value:"delete",icon:(0,s.jsx)(eP.G,{icon:eT.$aW}),pressedIcon:(0,s.jsx)(eP.G,{icon:eT.$aW}),name:"delete",digitizeLayer:h,tooltip:(0,e2.t)("EditFeatureGeometryToolbar.delete"),onFeatureRemove:C},E)):(0,s.jsx)(s.Fragment,{})]}),(0,s.jsx)(P(),(0,l._)({icon:(0,s.jsx)(eP.G,{icon:eT.X7o}),tooltip:(0,e2.t)("EditFeatureGeometryToolbar.undo"),onClick:()=>{var e=null==h?void 0:h.getSource(),r=null==e?void 0:e.getFeatures();if(r){var t=w.writeFeaturesObject(r),a=c.current.past[c.current.past.length-1];e4()(a)||(null==e||e.clear(),null==e||e.addFeatures(w.readFeatures(a)),c.current={past:c.current.past.slice(0,-1),future:[...c.current.future,t].slice(-u)},y(e=>e+1))}},disabled:(null==(r=c.current.past)?void 0:r.length)===0},E)),(0,s.jsx)(P(),(0,l._)({icon:(0,s.jsx)(eP.G,{icon:eT.X7o,flip:"horizontal"}),tooltip:(0,e2.t)("EditFeatureGeometryToolbar.redo"),onClick:()=>{var e=null==h?void 0:h.getSource(),r=null==e?void 0:e.getFeatures();if(r){var t=w.writeFeaturesObject(r),a=c.current.future[c.current.future.length-1];e4()(a)||(null==e||e.clear(),null==e||e.addFeatures(w.readFeatures(a)),c.current={future:c.current.future.slice(0,-1),past:[...c.current.past,t].slice(-u)},y(e=>e+1))}},disabled:(null==(t=c.current.future)?void 0:t.length)===0},E))]}):(0,s.jsx)(s.Fragment,{})},ri=t(33100),rs=e=>{var r=e.tabConfig,t=e.form,a=e.initialValues,n=(0,ef._)(e,["tabConfig","form","initialValues"]),i=null==r?void 0:r.map((e,r)=>({label:e.title,key:`${r}`,forceRender:!0,children:(0,s.jsx)(ez,{name:e.title,form:t,initialValues:a,formConfig:e.children})}));return(0,s.jsx)(ri.Z,(0,l._)({items:i},n))},ro=e=>{var r=e.feature,t=e.layer,a=e.onError,n=void 0===a?()=>{}:a,u=e.onSuccess,p=void 0===u?()=>{}:u,m=(0,ef._)(e,["feature","layer","onError","onSuccess"]),g=(0,d._)((0,o.useState)(!1),2),h=g[0],v=g[1],y=(0,E.useTranslation)().t,x=(0,Z.S)(),b=eq(),j=en();return(0,s.jsx)(e$.Z,{title:y("DeleteButton.confirm"),onConfirm:()=>(0,c._)(function(){var e,a,l,i;return(0,f.Jh)(this,function(s){switch(s.label){case 0:if(!x||!t||!(0,H.us)(t))return[2];s.label=1;case 1:return s.trys.push([1,4,5,6]),v(!0),[4,b({deleteFeatures:Array.isArray(a=new(e6())().readFeature(r))?a:[a],layer:t})];case 2:if(!(l=s.sent()))return[2];return[4,j({layer:t,transaction:l})];case 3:return s.sent(),null==(e=t.getSource())||e.refresh(),p(),[3,6];case 4:return i=s.sent(),N.Z.error(i),n(i),[3,6];case 5:return v(!1),[7];case 6:return[2]}})})(),placement:"bottomRight",children:(0,s.jsx)(eL.ZP,(0,i._)((0,l._)({type:"primary",loading:h,disabled:!r.id,danger:!0,icon:(0,s.jsx)(eP.G,{icon:eT.$aW})},m),{children:y("DeleteButton.title")}))})},ru=e=>{var r=e.feature,t=e.form,a=(0,ef._)(e,["feature","form"]),n=(0,E.useTranslation)().t,o=(0,Z.S)(),u=M();return(0,s.jsx)(eL.ZP,(0,i._)((0,l._)({type:"primary",onClick:()=>{if(t.resetFields(),u((0,e_.uQ)(!1)),o){var e=rt.w.getDigitizeLayer(o);if(e){null==(a=e.getSource())||a.clear();var a,n,l=new(e6())().readFeature(r);if(Array.isArray(l))return;null==(n=e.getSource())||n.addFeature(l)}}},icon:(0,s.jsx)(eP.G,{icon:eT.XnX})},a),{children:n("ResetButton.title")}))},rc=e=>{var r=e.loadComplete,t=void 0!==r&&r;return(0,s.jsx)("div",{className:t?"feedback-icon":"feedback-icon hidden",children:(0,s.jsx)("div",{className:t?"checkmark":"checkmark-hidden"})})},rd=e=>{var r=e.form,t=e.layer,a=e.onError,n=void 0===a?()=>{}:a,u=e.onSuccess,p=void 0===u?()=>{}:u,m=(0,ef._)(e,["form","layer","onError","onSuccess"]),g=(0,d._)((0,o.useState)(!1),2),h=g[0],v=g[1],y=(0,d._)((0,o.useState)(!1),2),x=y[0],b=y[1],j=(0,Z.S)(),w=eq(),S=en(),_=M(),C=A(e=>e.editFeature.formDirty),L=(0,E.useTranslation)().t;return(0,s.jsxs)(eL.ZP,(0,i._)((0,l._)({className:"save-button",type:"primary",onClick:()=>(0,c._)(function(){var e,a,l,i,s,o,u,c;return(0,f.Jh)(this,function(d){switch(d.label){case 0:if(!j||!t||!(0,H.us)(t))return[2];if(!(a=rt.w.getDigitizeLayer(j)))return N.Z.error("Cannot find the digitize layer"),n(),[2];if(!(l=null==(e=a.getSource())?void 0:e.getFeatures())||0===l.length)return N.Z.error("Cannot save feature without geometry"),n(L("SaveButton.errorNoGeometry")),[2];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,r.validateFields()];case 2:return d.sent(),[3,4];case 3:return n(i=d.sent()),N.Z.warn("Validation has failed: ",i),[2];case 4:return d.trys.push([4,7,8,9]),v(!0),[4,w({upsertFeatures:l,form:r,layer:t})];case 5:if(!(o=d.sent()))return[2];return[4,S({layer:t,transaction:o})];case 6:return u=d.sent(),null==(s=t.getSource())||s.refresh(),b(!0),setTimeout(()=>{b(!1)},3e3),_((0,e_.uQ)(!1)),p(u),[3,9];case 7:return c=d.sent(),N.Z.error(c),n(c),[3,9];case 8:return v(!1),[7];case 9:return[2]}})})(),loading:h,disabled:!C,icon:(0,s.jsx)(eP.G,{icon:eT.EdJ})},m),{children:[L("SaveButton.title"),(0,s.jsx)(rc,{loadComplete:x})]}))},rf=e=>{var r=e.feature,t=e.layer,a=e.form,n=e.onSaveSuccess,l=e.onSaveError,i=e.onDeleteSuccess,o=e.onDeleteError,u=A(e=>e.editFeature.userEditMode);return(0,s.jsxs)("div",{className:"edit-feature-toolbar",children:[u.includes("CREATE")||u.includes("UPDATE")?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ru,{feature:r,form:a}),(0,s.jsx)(rd,{form:a,layer:t,onSuccess:void 0===n?()=>{}:n,onError:void 0===l?()=>{}:l})]}):(0,s.jsx)(s.Fragment,{}),u.includes("DELETE")&&(0,s.jsx)(ro,{feature:r,layer:t,onSuccess:void 0===i?()=>{}:i,onError:void 0===o?()=>{}:o})]})},rp=e=>{var r=e.feature,t=e.layer,a=(0,E.useTranslation)().t,n=e1(),p=eD(),m=(0,d._)((0,o.useState)(),2),g=m[0],h=m[1],v=(0,d._)((0,o.useState)(),2),y=v[0],x=v[1],b=(0,d._)((0,o.useState)(),2),j=b[0],w=b[1],S=(0,d._)((0,eA.useForm)(),1)[0],_=(0,Z.S)(),C=M(),L=(0,ea.Z)(),k=(0,o.useCallback)(e=>(0,c._)(function(){var r,a,l,i;return(0,f.Jh)(this,function(s){switch(s.label){case 0:if(!t||!(0,H.us)(t))return[2];return a=(r=document.implementation.createDocument(null,"root")).createElement("Filter"),(l=r.createElement("ResourceId")).setAttribute("rid",e),a.appendChild(l),r.documentElement.appendChild(a),[4,n({layer:t,filter:a},"2.0.0")];case 1:return(null==(i=s.sent())?void 0:i.features[0])&&C((0,e_.hr)(null==i?void 0:i.features[0])),[2]}})})(),[C,n,t]),F=(0,o.useCallback)(()=>(0,c._)(function(){var e,a;return(0,f.Jh)(this,function(n){switch(n.label){case 0:if(!_||!L)return[2];if((null==(e=t.get("editFormConfig"))?void 0:e.length)===0)return N.Z.warn(`Layer ${t.get("name")} has no 'editFormConfig' set`),[2];return[4,Promise.all(Object.entries(a=structuredClone(null==r?void 0:r.properties)||{}).map(r=>{var t=(0,d._)(r,2),n=t[0],s=t[1];return(0,c._)(function(){var r,t,o,u,d,m,g,h;return(0,f.Jh)(this,function(v){switch(v.label){case 0:if((null==(r=null==e?void 0:e.filter(e=>{var r;return null==(r=e.children)?void 0:r.find(e=>e.propertyName===n)}))?void 0:r.length)>1&&N.Z.warn(`Property ${n} is configured in multiple tabs. Is this intended?`),!(r&&r[0]))return[3,7];if((null==(t=r[0].children)?void 0:t.some(e=>e.propertyName===n&&"DATE"===e.component))&&((d=ei()(s)).isValid()?a[n]=d:(N.Z.warn("Could not parse date"),a[n]=null)),!(null==(o=r[0].children)?void 0:o.some(e=>e.propertyName===n&&"UPLOAD"===e.component)))return[3,6];if(!s)return[3,5];v.label=1;case 1:if(v.trys.push([1,3,,4]),!eJ((m=JSON.parse(s))[0]))throw Error("File config is no valid SHOGun file.");return g=m,a[n]=g,[4,Promise.all(g.map(e=>(0,c._)(function(){var r,t,a,n,s,o;return(0,f.Jh)(this,function(u){switch(u.label){case 0:if(!(n=null==(t=g[0].response)||null==(r=t.fileType)?void 0:r.startsWith("image/")))return[3,2];return[4,p(`${L.getBasePath()}imagefiles/${null==e||null==(a=e.response)?void 0:a.fileUuid}/thumbnail`)];case 1:return o=u.sent(),[3,3];case 2:o=void 0,u.label=3;case 3:return s=o,[2,(0,i._)((0,l._)({},e),{thumbUrl:s,url:n?void 0:e.url})]}})})()))];case 2:return a[n]=v.sent(),[3,4];case 3:return h=v.sent(),N.Z.error("Could not parse file list from JSON config: ",h),a[n]=[],[3,4];case 4:return[3,6];case 5:a[n]=[],v.label=6;case 6:if(null==(u=r[0].children)?void 0:u.some(e=>e.propertyName===n&&"REFERENCE_TABLE"===e.component))try{a[n]=JSON.parse(a[n])}catch(e){N.Z.warn("Could not parse the input for the REFERENCE_TABLE",e)}v.label=7;case 7:return[2]}})})()}))];case 1:return n.sent(),x(a),S.resetFields(),S.setFieldsValue(a),h(e),[2]}})})(),[_,L,t,null==r?void 0:r.properties,S,p]);(0,o.useEffect)(()=>{F()},[F]);var T=e=>{var r=[];return(e.errorFields||[]).forEach(e=>{Array.isArray(e.errors)&&r.push(...e.errors)}),r.map((e,t)=>(0,s.jsxs)(u().Fragment,{children:[e,t!==r.length-1&&(0,s.jsx)("br",{})]},t))};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(rl,{feature:r}),j&&(0,s.jsx)(z.Z,{className:"error-alert",message:j,type:"error",showIcon:!0}),(0,s.jsx)(rf,{feature:r,layer:t,form:S,onSaveSuccess:e=>{if(e){w(void 0);var t,a=null==(t=new DOMParser().parseFromString(e,"text/xml").getElementsByTagName("ogc:FeatureId").item(0))?void 0:t.getAttribute("fid");if("none"===a){var n=r.id;if(!n)return;k(n)}else a&&k(a)}},onSaveError:e=>{"object"==typeof e&&null!==e&&"errorFields"in e?w(T(e)):"string"==typeof e?w(e):w(a("EditFeatureFullForm.saveErrorMsg"))},onDeleteSuccess:()=>{w(void 0),C((0,e_.hr)(null))},onDeleteError:()=>{w(a("EditFeatureFullForm.deleteErrorMsg"))}}),(0,s.jsx)(rs,{tabConfig:g,initialValues:y,form:S})]})},rm=()=>{var e=(0,ea.Z)(),r=e=>{var r,t,a=e.feature.id,n=e.feature.properties;if(!a||!n)return void N.Z.warn("Either the id of the feature or its properties (or even both) aren't available");t="number"==typeof a?a:parseInt(a.split(".")[1],10);var l=Object.entries(n).find(e=>{var r=(0,d._)(e,2)[1];return r===t||r===t.toString()});if(!l)return void N.Z.warn("Count not detect the id property");var i=l[0],s=null==(r=e.layer.getSource())?void 0:r.getParams().LAYERS,o=document.createElementNS("https://www.opengis.net/wfs/2.0","LockFeature");o.setAttribute("service","WFS"),o.setAttribute("version","2.0.0"),o.setAttribute("expiry","300"),o.setAttribute("lockAction","SOME");var u=document.createElementNS("https://www.opengis.net/wfs/2.0","Query");u.setAttribute("typeNames",s);var c=document.createElementNS("https://www.opengis.net/fes/2.0","Filter"),f=document.createElementNS("https://www.opengis.net/fes/2.0","PropertyIsEqualTo"),p=document.createElementNS("https://www.opengis.net/fes/2.0","ValueReference"),m=document.createTextNode(i);p.appendChild(m);var g=document.createElementNS("https://www.opengis.net/fes/2.0","Literal"),h=document.createTextNode(t.toString());return g.appendChild(h),f.appendChild(p),f.appendChild(g),c.appendChild(f),u.appendChild(c),o.appendChild(u),o};return(0,o.useCallback)(t=>(0,c._)(function(){var a,n,i,s,o,u,c,d;return(0,f.Jh)(this,function(f){switch(f.label){case 0:if((i=t.layer.getSource())instanceof Q()&&(n=i.getUrl()),i instanceof er()&&(n=(s=i.getUrls())?s[0]:void 0),!n||(n.endsWith("?")&&(n=n.slice(0,-1)),!(o=r({layer:t.layer,feature:t.feature}))))return[2];return u={"Content-Type":"application/xml"},[4,fetch(n,{method:"POST",headers:(null==(a=t.layer)?void 0:a.get("useBearerToken"))?(0,l._)({},u,(0,et.a)(null==e?void 0:e.getKeycloak())):u,body:new XMLSerializer().serializeToString(o)})];case 1:if(!(c=f.sent()).ok)throw Error("No successful response while executing a WFS-LockFeature");return[4,c.text()];case 2:if(d=f.sent(),new DOMParser().parseFromString(d,"text/xml").getElementsByTagName("wfs:FeaturesNotLocked").length>0)throw Error(`Error while locking a feature: ${d}`);return[2,d]}})})(),[e])},rg=(e,r,t)=>{var a=(0,Z.S)(),n=(0,ea.Z)(),i=(0,o.useCallback)(i=>(0,c._)(function(){var s,o,u,c,d,p,m,g;return(0,f.Jh)(this,function(f){switch(f.label){case 0:if(!a||!e||(s=i.coordinate,!(o=a.getView().getResolution()))||(c=null==(u=e.getSource())?void 0:u.getFeatureInfoUrl(s,o,a.getView().getProjection(),{INFO_FORMAT:"application/json",BUFFER:10}),d={"Content-Type":"application/json"},!c))return[2];f.label=1;case 1:return f.trys.push([1,4,5,6]),a.getTargetElement().style.cursor="wait",[4,fetch(c,{method:"GET",headers:e.get("useBearerToken")?(0,l._)({},d,(0,et.a)(null==n?void 0:n.getKeycloak())):d})];case 2:if(!(p=f.sent()).ok)throw Error("No successful response");return[4,p.json()];case 3:return m=f.sent(),r&&r(m),[3,6];case 4:return g=f.sent(),N.Z.error("Error: ",g),t&&t(),[3,6];case 5:return a.getTargetElement().style.cursor="",[7];case 6:return[2]}})})(),[n,e,a,r,t]),s=(0,o.useCallback)(r=>{if(a&&e&&!r.dragging){var t=e.getData(r.pixel);if(t instanceof Uint8ClampedArray){var n=t&&t[3]>0;a.getTargetElement().style.cursor=n?"pointer":""}}},[e,a]);(0,o.useEffect)(()=>{if(a)return a.on("pointermove",s),a.on("singleclick",i),()=>{a.un("pointermove",s),a.un("singleclick",i)}},[a,s,i])},rh=e=>{var r=e.layer,t=e.onLockSuccess,a=void 0===t?()=>{}:t,n=e.onLockError,l=void 0===n?()=>{}:n,i=e.onCreate,u=void 0===i?()=>{}:i,p=(0,d._)((0,o.useState)(!1),2),m=p[0],g=p[1],h=eK(),v=rm(),y=M(),x=(0,Z.S)(),b=(0,E.useTranslation)().t,j=A(e=>e.editFeature.userEditMode);rg(r,e=>(0,c._)(function(){var t,n;return(0,f.Jh)(this,function(i){switch(i.label){case 0:if(!(e.features.length&&(j.includes("UPDATE")||j.includes("DELETE"))))return[3,6];if(t=e.features[0],!r||!t)return[2];if(!K().wfsLockFeatureEnabled)return[3,5];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,v({layer:r,feature:t})];case 2:if(!(n=i.sent()))return[2];return y((0,e_.hr)(t)),a(n),[3,4];case 3:return l(i.sent()),[3,4];case 4:return[3,6];case 5:y((0,e_.hr)(t)),i.label=6;case 6:return[2]}})})());var w=()=>(0,c._)(function(){var e,t,a,n,l;return(0,f.Jh)(this,function(i){switch(i.label){case 0:if(!x||!r)return[2];i.label=1;case 1:return i.trys.push([1,3,4,5]),g(!0),[4,h(r)];case 2:if(!(a=i.sent()))return[2];switch(null==(n=null==(t=a.featureTypes[0])||null==(e=t.properties)?void 0:e.find(e=>eW(e.type)))?void 0:n.type){case"gml:MultiPoint":return[2,"MultiPoint"];case"gml:Point":return[2,"Point"];case"gml:MultiLineString":return[2,"MultiLineString"];case"gml:LineString":return[2,"LineString"];case"gml:MultiPolygon":return[2,"MultiPolygon"];case"gml:Polygon":return[2,"Polygon"];case"xsd:boolean":case"xsd:date":case"xsd:int":case"xsd:number":case"xsd:string":case void 0:return[2]}return[3,5];case 3:return l=i.sent(),N.Z.error(l),[3,5];case 4:return g(!1),[7];case 5:return[2]}})})();return(0,s.jsxs)("div",{className:"edit-feature-switch",children:[j.includes("CREATE")&&(0,s.jsxs)(s.Fragment,{children:[j.includes("UPDATE")&&(0,s.jsx)("div",{children:b("EditFeatureSwitch.usageHint")}),(0,s.jsx)(eL.ZP,{loading:m,onClick:()=>(0,c._)(function(){var e;return(0,f.Jh)(this,function(r){switch(r.label){case 0:return[4,w()];case 1:if(!(e=r.sent()))return[2];return y((0,e_.hr)({type:"Feature",properties:{},geometry:{type:e,coordinates:[]}})),u(),[2]}})})(),children:b("EditFeatureSwitch.createFeature")})]}),!j.includes("CREATE")&&(j.includes("UPDATE")||j.includes("DELETE"))&&(0,s.jsx)("div",{children:b("EditFeatureSwitch.limitedUsageHint")})]})},rv=e=>{var r=(0,a._)({},(0,n._)(e)),t=(0,E.useTranslation)().t,u=(0,d._)((0,o.useState)(),2),p=u[0],g=u[1],h=(0,d._)((0,o.useState)(!1),2),v=h[0],y=h[1],x=(0,d._)((0,o.useState)(t("EditFeatureDrawer.featureEditor")),2),b=x[0],j=x[1],w=A(e=>e.editFeatureDrawerOpen),S=A(e=>e.editFeature.layerId),_=A(e=>e.editFeature.feature),C=A(e=>e.editFeature.formDirty),L=(0,Z.S)(),k=M(),T=eq(),P=en();(0,o.useEffect)(()=>{if(L&&S){var e=F.C.getLayerByOlUid(L,S);if(!e||!(0,H.us)(e))return void N.Z.warn(`Could not find layer with id ${S}`);j(`${t("EditFeatureDrawer.featureEditor")} - ${e.get("name")}`),g(e)}},[L,S,t]);var D=()=>(0,c._)(function(){var e,r,t;return(0,f.Jh)(this,function(a){switch(a.label){case 0:if(!p||!_||!_.id||!K().wfsLockFeatureEnabled)return[2];a.label=1;case 1:return a.trys.push([1,4,,5]),(e=new(Y())).setId(_.id),[4,T({layer:p,deleteFeatures:[],upsertFeatures:[e]})];case 2:if(!(r=a.sent()))return[2];return[4,P({layer:p,transaction:r})];case 3:return a.sent(),[3,5];case 4:return t=a.sent(),N.Z.error("Error while releasing the lock on the feature: ",t),[3,5];case 5:return[2]}})})(),O=()=>(0,c._)(function(){return(0,f.Jh)(this,function(e){switch(e.label){case 0:return[4,D()];case 1:return e.sent(),k((0,eY.Cp)()),k((0,e_.uQ)(!1)),k((0,e_.mc)()),y(!1),[2]}})})();return(0,s.jsxs)(eX,(0,i._)((0,l._)({className:"map-drawer edit-feature-drawer",onClose:()=>{p&&_&&C?m.Z.confirm({maskClosable:!1,title:t("EditFeatureDrawer.closeDrawerWarnTitle"),content:t("EditFeatureDrawer.closeDrawerWarnContent"),okType:"danger",onOk:O}):O()},open:w,title:b},r),{children:[!p&&(0,s.jsx)(z.Z,{message:t("EditFeatureDrawer.noLayerFoundError"),type:"error",showIcon:!0}),v&&(0,s.jsx)(z.Z,{message:t("EditFeatureDrawer.isFeatureLockedErrorMsg"),type:"error",showIcon:!0}),p&&S&&!_&&(0,s.jsx)(rh,{layer:p,onLockSuccess:()=>{y(!1)},onLockError:()=>{y(!0)},onCreate:()=>{y(!1)}}),p&&_&&(0,s.jsx)(rp,{feature:_,layer:p})]}))},ry=t(11843),rx=t(40440),rb=t(33327),rj=t.n(rb),rw=t(44290),rS=t.n(rw),r_=t(89747),rC=t(10269),rE=t.n(rC),rN=t(86849),rL=()=>"10.0.0",rk=e=>{var r,t=e.opener,a=(0,ef._)(e,["opener"]),n=(0,E.useTranslation)().t,c=A(e=>e.appInfo),f=A(e=>e.logoPath),p=A(e=>e.description),g=(0,d._)((0,o.useState)(!1),2),h=g[0],v=g[1],y=()=>{v(!h)};return r=t?u().cloneElement(t,{onClick:y}):(0,s.jsx)("button",{onClick:y,children:"Open"}),(0,s.jsxs)(s.Fragment,{children:[r,(0,s.jsxs)(m.Z,(0,i._)((0,l._)({className:"application-info",title:n("ApplicationInfo.title"),centered:!0,open:h,onOk:y,onCancel:y,footer:null},a),{children:[(0,s.jsx)("img",{className:"logo",src:f,alt:"Logo"}),(0,s.jsx)("div",{className:"description",children:p}),(0,s.jsx)(rN.Z,{title:n("ApplicationInfo.clientVersionTitle"),value:rL()}),c.version&&c.buildTime&&(0,s.jsx)(rN.Z,{title:n("ApplicationInfo.backendVersionTitle"),value:`${c.version} (${c.buildTime})`})]}))]})},rF=e=>{var r,t,u=(0,a._)({},(0,n._)(e)),c=G(),d=(0,E.useTranslation)().t,f=A(e=>e.legal),p=(0,Z.S)(),m=(e,r)=>{c.forEach(t=>{if((n=t.integration)&&"footer"===n.placement&&(null==(a=t.integration)?void 0:a.placementOrientation)===e){var a,n,l,i,o=t.key,u=t.wrappedComponent;r.splice(null!=(i=null==(l=t.integration)?void 0:l.insertionIndex)?i:0,0,(0,s.jsx)(u,{},o))}})};return((0,o.useEffect)(()=>{p&&(p.getControls().getArray().find(e=>e instanceof rS())||p.addControl(new(rS())({target:"scale-line-container"})))},[p]),(0,o.useEffect)(()=>{p&&(p.getControls().getArray().find(e=>e instanceof rj())||p.addControl(new(rj())({coordinateFormat:(0,r_.createStringXY)(2),projection:p.getView().getProjection(),target:"mouse-position"})))},[p]),p)?(0,s.jsxs)("div",(0,i._)((0,l._)({className:"footer"},u),{children:[(0,s.jsx)("div",{className:"item-container left-items",children:(m("left",r=[(0,s.jsx)("div",{id:"scale-line-container","aria-label":"scale-line"},"scale-line-container"),(0,s.jsx)(ry.Z,{type:"vertical"},"scale-line-divider"),(0,s.jsxs)("div",{className:"scale-combo","aria-label":"scale-combo",children:[d("Footer.scale"),":\xa0",(0,s.jsx)(rE(),{"aria-label":"scalecombo-dropdown"}),(0,s.jsx)(ry.Z,{type:"vertical"})]},"scale-combo-container"),(0,s.jsxs)("div",{className:"reference-system","aria-label":"reference-system",children:[d("Footer.refSystem"),": ",p.getView().getProjection().getCode(),(0,s.jsx)(ry.Z,{type:"vertical"})]},"reference-system-container"),(0,s.jsxs)("div",{className:"mouse-position-wrapper",children:[d("Footer.mousePosition"),":\xa0",(0,s.jsx)("div",{id:"mouse-position",className:"mouse-position","aria-label":"mouse-position"})]},"mouse-position-container")]),r)}),(0,s.jsx)("div",{className:"item-container right-items",children:(t=[(0,s.jsx)(eL.ZP,{onClick:()=>{window.open(f.contact,"_blank")},type:"link",children:d("Footer.contact")},"open-contact"),(0,s.jsx)(eL.ZP,{onClick:()=>{window.open(f.imprint,"_blank")},type:"link",children:d("Footer.imprint")},"open-imprint"),(0,s.jsx)(eL.ZP,{onClick:()=>{window.open(f.privacy,"_blank")},type:"link",children:d("Footer.privacypolicy")},"open-privacy"),(0,s.jsx)(rk,{opener:(0,s.jsx)(rx.Z,{title:d("Footer.aboutTooltip"),children:(0,s.jsx)(eL.ZP,{type:"link","aria-label":"info-opener",children:d("Footer.about")})})},"application-info")],c.length>0&&m("right",t),t)})]})):(0,s.jsx)(s.Fragment,{})},rT="documentationbutton",rP=e=>{var r=e.className,t=(0,E.useTranslation)().t,a=r?`${rT} ${r}`:rT;return(0,s.jsx)(rx.Z,{title:t("DocumentationButton.tooltip"),children:(0,s.jsx)(eL.ZP,{type:"link","aria-label":"documentation-button",onClick:()=>window.open("/gis-docs","_blank"),className:a,icon:(0,s.jsx)(eP.G,{icon:eT.FDd})})})},rZ=t(1695),rD=()=>{var e=(0,Z.S)(),r=(0,E.useTranslation)().t;return(0,o.useCallback)((t,a)=>(0,c._)(function(){var n,l,i,s,o;return(0,f.Jh)(this,function(u){switch(u.label){case 0:if(!e)return[2];return[4,(0,rZ.AH)({bounded:a?1:void 0,viewBox:a?null==a?void 0:a.toString():void 0,countryCodes:"",nominatimBaseUrl:null!=(l=null==(n=K().search)?void 0:n.nominatimUrl)?l:"https://nominatim.openstreetmap.org/search?"})(t)];case 1:return i=u.sent(),s=new(e6()),o=null==i?void 0:i.features.filter(e=>!ej()(null==e?void 0:e.properties.geojson)).map(r=>{var t=s.readFeature(r.geometry,{dataProjection:"EPSG:4326",featureProjection:e.getView().getProjection()});if(!Array.isArray(t))return t.setProperties(r.properties),t.set("title",r.properties.display_name),t}).filter(e=>void 0!==e),[2,[{title:r("useNominatimSearchEngine.title"),features:null!=o?o:[]}]]}})})(),[e,r])},rM=t(7739),rA=t.n(rM),rO=t(36426),rU=t.n(rO),rI=e=>e.map(e=>`(${e.trim()}^4 OR *${e.trim()}*^2 OR ${e.trim()}~1)`).join(" AND "),r$=e=>{var r=e.searchValue,t=e.map,a=r.trim().replaceAll(/[()\\\-_.//]/g," ").split(" ").map(e=>e.trim()).filter(e=>""!==e),n=[],l=t.getAllLayers().filter(e=>e.get("searchable"));return Object.entries(rA()(l,e=>{var r;return null==(r=e.get("searchConfig"))?void 0:r.attributes})).forEach(e=>{var r=(0,d._)(e,2),t=r[0],l=r[1].filter(e=>(0,H.us)(e)).map(e=>{var r,t;return null==(t=e.getSource())||null==(r=t.getParams())?void 0:r.LAYERS}).map(e=>`featureType:"${e}"`).join(" OR "),i=`(${l}) AND (${rI(a)})`;n.push({query:i,fieldList:"undefined"!==t?t.split(",").join(" "):void 0})}),n},rR=()=>{var e=(0,ea.Z)();return(0,o.useCallback)(r=>(0,c._)(function(){var t,a,n,i,s,o,u,c,d;return(0,f.Jh)(this,function(f){switch(f.label){case 0:return n={q:r.query,rows:null!=(t=r.rowsPerQuery)?t:100,defType:null!=(a=r.queryParser)?a:"edismax"},r.fieldList?n.qf=r.fieldList:n.qf=null!=(i=r.coreName)?i:"search",r.viewBox&&(n.fq=`geometry:[${r.viewBox[1]},${r.viewBox[0]} TO ${r.viewBox[3]},${r.viewBox[2]}]`),r.useSolrHighlighting&&(n.hl=!0,n["hl.fl"]="*",n["hl.tag.pre"]=null!=(s=r.tagPre)?s:"<b>",n["hl.tag.post"]=null!=(o=r.tagPost)?o:"</b>",n["hl.requireFieldMatch"]=null==(u=r.requireFieldMatch)||u),c={"Content-Type":"application/json"},[4,fetch(r.searchUrl,{method:"POST",headers:(0,l._)({},c,(0,et.a)(null==e?void 0:e.getKeycloak())),body:JSON.stringify(n)})];case 1:if(!(d=f.sent()).ok)throw Error("Failed to execute Solr query");return[4,d.json()];case 2:return[2,f.sent()]}})})(),[e])},rG=e=>"fulfilled"===e.status,rV=e=>"rejected"===e.status,rB=()=>{var e=(0,Z.S)(),r=rR(),t=(0,o.useCallback)((e,r)=>e.replace(/{\s*(\w+?)\s*}/g,(e,t)=>{var a;return(null==(a=r[t])?void 0:a.toString())||""}),[]),a=(0,o.useCallback)((r,a,n)=>{if(!e)return"";var l=F.C.getLayerByNameParam(e,a.featureType[0]),i=null==l?void 0:l.get("searchConfig"),s=["geometry"],o="";if(null==i?void 0:i.displayTemplate)return t(i.displayTemplate,a);if(n){var u=Object.keys(n).filter(e=>!s.includes(e));if(u.length>0){var c=n[u[0]];return`${c} [${u[0]}]`}}return Object.keys(a).filter(e=>!s.includes(e)).forEach(e=>{var t,n=null==(t=a[e])?void 0:t.toString();!o&&n.toLowerCase().indexOf(r.toLowerCase())>-1&&(o=`${n} [${e}]`)}),o||(o=a.id),o},[e,t]),n=(0,o.useCallback)((e,r)=>{var t=["category","id","featureType","geometry","search","_version_"];Object.keys(r).filter(e=>!t.includes(e)).forEach(t=>{var a=r[t];void 0!==a&&e.set(t,a)})},[]);return(0,o.useCallback)((t,i)=>(0,c._)(function(){var s,o,u,c,d,p,m,g,h,v,y,x,b,j,w,S,_,C,E,L,k,T,P,Z,D,M,A,O,U,I,$,R,G;return(0,f.Jh)(this,function(f){switch(f.label){case 0:if(!e)return[2];c=null!=(u=null==(s=K().search)?void 0:s.solrBasePath)?u:"/search/query",d=r$({searchValue:t,map:e}),p=[],m=!0,g=!1,h=void 0;try{for(v=d[Symbol.iterator]();!(m=(y=v.next()).done);m=!0)x=y.value,p.push(r({searchUrl:c,query:x.query,fieldList:x.fieldList,rowsPerQuery:null==(j=K().search)||null==(b=j.solrQueryConfig)?void 0:b.rowsPerQuery,queryParser:null==(S=K().search)||null==(w=S.solrQueryConfig)?void 0:w.queryParser,coreName:null==(_=K().search)?void 0:_.coreName,useSolrHighlighting:null==(C=K().search)?void 0:C.useSolrHighlighting,tagPre:null==(L=K().search)||null==(E=L.solrQueryConfig)?void 0:E.tagPre,tagPost:null==(T=K().search)||null==(k=T.solrQueryConfig)?void 0:k.tagPost,requireFieldMatch:null==(Z=K().search)||null==(P=Z.solrQueryConfig)?void 0:P.requireFieldMatch,viewBox:i}))}catch(e){g=!0,h=e}finally{try{m||null==v.return||v.return()}finally{if(g)throw h}}return[4,Promise.allSettled(p)];case 1:return M=(D=f.sent().map(e=>({value:rG(e)?e.value:void 0,reason:rV(e)?e.reason:void 0,status:e.status}))).filter(e=>"fulfilled"===e.status),D.filter(e=>"rejected"===e.status).forEach(e=>{N.Z.error("Error while fetching the solr results for layer ",e.reason)}),A=M.flatMap(e=>{var r,t;return null==(t=e.value)||null==(r=t.response)?void 0:r.docs}).filter(e=>e),O=Object.assign({},...M.map(e=>{var r;return null==(r=e.value)?void 0:r.highlighting})),U=new(rU()),I=[],(null==(o=K().search)?void 0:o.groupByCategory)?$=rA()(A,e=>{var r;return null==e||null==(r=e.category)?void 0:r[0]}):(R=e.getAllLayers().filter(e=>e.get("searchable")),G=A.map(e=>{var r,t=null==(r=R.filter(e=>(0,H.us)(e)).find(r=>{var t,a,n;return(null==(a=r.getSource())||null==(t=a.getParams())?void 0:t.LAYERS)===(null==e||null==(n=e.featureType)?void 0:n[0])}))?void 0:r.get("name");return(0,l._)({layerTitle:t},e)}),$=rA()(G,e=>null==e?void 0:e.layerTitle)),Object.keys($).forEach(r=>{var l=$[r].map(r=>{if(null==r||null==(o=r.geometry)?void 0:o[0]){var l=r.id,i=U.readGeometry(r.geometry[0],{dataProjection:"EPSG:4326",featureProjection:e.getView().getProjection()}),s=new(Y())({geometry:i});if(n(s,r),s.set("title",a(t,r,null==O?void 0:O[l])),null==(u=r.featureType)?void 0:u[0]){var o,u,c,d,f=F.C.getLayerByNameParam(e,null==(d=r.featureType)?void 0:d[0]);f&&(s.set("layer",f),c=f.get("name"))}else c=l.substring(0,l.lastIndexOf("_"));return s.set("ftName",c),s}}).filter(e=>e);I.push({title:r,features:l})}),[2,I]}})})(),[n,r,a,e])},rJ=t(27547),rz=t(98122),rW=e=>"fulfilled"===e.status,rK=e=>"rejected"===e.status,rq=()=>{var e=(0,Z.S)(),r=e1(),t=eK(),a=(0,o.useCallback)((e,r)=>e.replace(/{\s*(\w+?)\s*}/g,(e,t)=>r.getProperties()[t]||""),[]),n=(0,o.useCallback)((e,r,t)=>{var n=null==t?void 0:t.get("searchConfig");if(null==n?void 0:n.displayTemplate)return a(n.displayTemplate,r);var l=!0,i=!1,s=void 0;try{for(var o,u=Object.entries(r.getProperties())[Symbol.iterator]();!(l=(o=u.next()).done);l=!0){var c=(0,d._)(o.value,2),f=c[0],p=c[1],m=null==p?void 0:p.toString();if(m.toLowerCase().indexOf(null==e?void 0:e.toLowerCase())>-1)return`${m} [${f}]`}}catch(e){i=!0,s=e}finally{try{l||null==u.return||u.return()}finally{if(i)throw s}}return r.getId()},[a]);return(0,o.useCallback)((a,l)=>(0,c._)(function(){var i,s,o,u,c,d,p,m,g,h,v,y,x,b,j,w,S,_,C,E;return(0,f.Jh)(this,function(L){switch(L.label){case 0:if(!e)return[2];if(0===(i=e.getAllLayers().filter(e=>e.get("searchable"))).length)return N.Z.warn("No queryable layer found."),[2];s=[],o=[],u=!0,c=!1,d=void 0,L.label=1;case 1:L.trys.push([1,6,7,8]),p=function(){var n,i,u,c,d,p,m,h,v,y,x,b,j;return(0,f.Jh)(this,function(f){switch(f.label){case 0:if(n=g.value,!(0,H.us)(n))return N.Z.warn("Layer type not supported in search: ",n),[2,"continue"];if(!((d=null==n?void 0:n.get("searchConfig"))&&d.attributes))return N.Z.warn("No search configuration given for layer: ",n),[2,"continue"];return[4,t(n)];case 1:if(!(p=f.sent()))return N.Z.warn("No successful DescribeFeatureType for layer: ",n),[2,"continue"];if(!(m=null==(u=n.getSource())||null==(i=u.getParams())?void 0:i.LAYERS))return N.Z.warn("No layer name available for layer: ",n),[2,"continue"];if(!(h=p.featureTypes.find(e=>{var r;return e.typeName===m||e.typeName===(null==(r=m.split(":"))?void 0:r[1])})))return N.Z.warn("No corresponding feature type for layer: ",n),[2,"continue"];if(0===(v=d.attributes.map(e=>{var r=h.properties.find(r=>r.name===e);if(!r)return N.Z.warn(`Attribute "${e}" not found in feature type "${h.typeName}" for layer "${n.get("name")}".`),null;if("string"===r.localType)return(0,rJ.like)(e,`*${a}*`,"*",".","!",!1);if("number"!==r.localType&&"int"!==r.localType)return N.Z.warn(`Attribute "${e}" with type "${r.localType}" not supported for search in layer "${n.get("name")}".`),null;var t=Number(a);return isNaN(t)?null:(0,rJ.equalTo)(e,t)}).filter(e=>null!==e)).length)return N.Z.warn("No valid filter available for layer: ",n),[2,"continue"];return y=[],d.displayTemplate&&(x=/{\s*(\w+?)\s*}/g,y.push(...Array.from(d.displayTemplate.matchAll(x),e=>e[1]))),(null==(c=K().search)?void 0:c.showSearchResultDrawer)&&y.push(...(null==(j=d.resultDrawerConfig)||null==(b=j.children)?void 0:b.map(e=>e.propertyName))||[]),s.push(r({layer:n,filter:1===v.length?v[0]:(0,rJ.or)(...v),bbox:l?(0,rz.transformExtent)(l,"EPSG:4326",e.getView().getProjection()):void 0,maxFeatures:10,propertyNames:Array.from(new Set(y))})),o.push(n),[2]}})},m=i[Symbol.iterator](),L.label=2;case 2:if(u=(g=m.next()).done)return[3,5];return[5,(0,f.XA)(p())];case 3:L.sent(),L.label=4;case 4:return u=!0,[3,2];case 5:return[3,8];case 6:return h=L.sent(),c=!0,d=h,[3,8];case 7:try{u||null==m.return||m.return()}finally{if(c)throw d}return[7];case 8:return[4,Promise.allSettled(s)];case 9:y=(v=L.sent().map((e,r)=>({value:rW(e)?e.value:void 0,reason:rK(e)?e.reason:void 0,status:e.status,layer:o[r]}))).filter(e=>"fulfilled"===e.status),v.filter(e=>"rejected"===e.status).forEach(e=>{N.Z.error(`Error while fetching the layer search results for layer "${e.layer.get("name")}": `,e.reason)}),x=new(e6()),b=[],j=!0,w=!1,S=void 0;try{for(_=function(){var r=E.value,t=x.readFeatures(r.value,{featureProjection:e.getView().getProjection()});t.forEach(e=>{e.set("title",n(a,e,r.layer)),e.set("layer",r.layer)}),b.push({title:r.layer.get("name"),features:t})},C=y[Symbol.iterator]();!(j=(E=C.next()).done);j=!0)_()}catch(e){w=!0,S=e}finally{try{j||null==C.return||C.return()}finally{if(w)throw S}}return[2,b]}})})(),[r,t,n,e])},rY=t(91754),rH=t(45540),rX=t(71136),rQ=t(81316),r0=t(87044),r1=t(14622),r2=t(99956),r3=t.n(r2),r4=t(76823),r5=t.n(r4),r6=t(23173),r8=t.n(r6),r7=t(50268),r9=t.n(r7),te=t(42212),tr=t(63646),tt=t.n(tr),ta=t(8942),tn=e=>{var r,t,a=e.geocoderSearchEngine,n=e.dataSearchEngine,l=(0,Z.S)(),i=(0,E.useTranslation)().t,u=M(),p=(0,o.useRef)(null),m=(0,o.useMemo)(()=>new(e6()),[]),h=(0,d._)((0,o.useState)(!!a),2),v=h[0],y=h[1],b=(0,d._)((0,o.useState)(!!n),2),j=b[0],w=b[1],S=(0,d._)((0,o.useState)(null==(t=null==(r=K().search)?void 0:r.defaultUseViewBox)||t),2),_=S[0],C=S[1],L=(0,d._)((0,o.useState)(""),2),k=L[0],F=L[1],T=(0,d._)((0,o.useState)(!1),2),P=T[0],D=T[1],A=(0,d._)((0,o.useState)(!1),2),O=A[0],U=A[1],I=(0,d._)((0,o.useState)(!1),2),$=I[0],R=I[1],G=(0,d._)((0,o.useState)([]),2),V=G[0],B=G[1],J=ra();(0,o.useEffect)(()=>(window.addEventListener("mousedown",z),()=>{window.removeEventListener("mousedown",z)}),[]);var z=e=>{for(var r=e.target;r;)r=r.parentNode;p.current&&p.current.contains(e.target)||U(!1)},W=(0,o.useMemo)(()=>{var e={items:[{label:(0,s.jsx)(em.Z,{checked:_,onChange:e=>C(e.target.checked),children:i("MultiSearch.searchInViewBox")}),key:"viewbox"}]};return a&&e.items.push({label:(0,s.jsx)(em.Z,{checked:v,onChange:e=>y(e.target.checked),children:i("MultiSearch.searchGeocoder")}),key:"geocoder"}),n&&e.items.push({label:(0,s.jsx)(em.Z,{checked:j,onChange:e=>w(e.target.checked),children:i("MultiSearch.searchData")}),key:"data"}),e},[_,i,a,n,v,j]),q=(0,o.useCallback)(()=>(0,c._)(function(){var e,r,t,i,s,o,u,c,d,p,m,g;return(0,f.Jh)(this,function(f){switch(f.label){case 0:if(!l||!v&&!j)return[2];if(t=null!=(r=null==(e=K().search)?void 0:e.minChars)?r:3,k.length<t)return Y(),[2];if(D(!0),_&&(o=null==l?void 0:l.getView().getProjection(),(u=null==l||null==(s=l.getView())?void 0:s.calculateExtent())&&(i=(0,rz.transformExtent)(u,o,"EPSG:4326"))),c=[],!(j&&n))return[3,5];f.label=1;case 1:return f.trys.push([1,3,4,5]),[4,n(k,i)];case 2:if(!(d=f.sent()))throw Error("No response from data search engine.");return c.push(...d),[3,5];case 3:return p=f.sent(),N.Z.error("Error while data search: \n",p),[3,5];case 4:return v||D(!1),[7];case 5:if(!(v&&a))return[3,10];f.label=6;case 6:return f.trys.push([6,8,9,10]),[4,a(k,i)];case 7:if(!(m=f.sent()))throw Error("No response from geocoder search engine.");return c.push(...m),[3,10];case 8:return g=f.sent(),N.Z.error("Error while geocoder search: \n",g),[3,10];case 9:return D(!1),[7];case 10:return B(c.every(e=>0===e.features.length)?[]:c),U(!0),[2]}})})(),[l,v,j,k,_,n,a]);(0,o.useEffect)(()=>{var e,r,t=setTimeout(()=>{q()},null!=(r=null==(e=K().search)?void 0:e.delay)?r:1e3);return()=>clearTimeout(t)},[q]);var Y=()=>{B([])},H=e=>{var r=e.feature.get("layer");if(null==r?void 0:r.get("editable"))return[(0,s.jsx)(s.Fragment,{})]},X=(0,o.useMemo)(()=>new(r9())({stroke:new(r8())({color:"rgb(255,0,0)",width:2}),fill:new(r5())({color:"rgba(255,255,255, 0.5)"}),image:new(r3())({radius:10,fill:new(r5())({color:"rgba(255,255,255, 0.5)"}),stroke:new(r8())({color:"rgb(255,0,0)",width:3})})}),[]);return(0,s.jsxs)("div",{className:"multi-search",ref:p,children:[(0,s.jsxs)(r0.Z.Compact,{children:[(0,s.jsx)(g.Z,{value:k,disabled:!v&&!j,onChange:e=>{D(""!==e.target.value),F(e.target.value)},allowClear:!0,onFocus:()=>U(!0),placeholder:v&&j?i("MultiSearch.searchPlaceholder"):!v&&j?i("MultiSearch.searchPlaceholderDataOnly"):v&&!j?i("MultiSearch.searchPlaceholderGeocoderOnly"):void 0,prefix:(0,s.jsx)(rY.Z,{}),suffix:P?(0,s.jsx)(rH.Z,{}):null}),(0,s.jsx)(r1.Z,{menu:W,trigger:["click"],onOpenChange:R,open:$,children:(0,s.jsx)(rx.Z,{title:i("MultiSearch.settingsTooltip"),placement:"right",children:(0,s.jsx)(eL.ZP,{icon:(0,s.jsx)(rX.Z,{})})})})]}),(()=>{if(k.length<2||!O||P||!V)return null;var e=V.length;if(0===e)return(0,s.jsx)("div",{className:"no-search-result-div",children:(0,s.jsx)(rQ.Z,{image:rQ.Z.PRESENTED_IMAGE_SIMPLE})});var r=e=>{var r,t=null==e||null==(r=e.feature)?void 0:r.get("layer");t&&l&&!t.getVisible()&&(t.setVisible(!0),te.kn.setParentsVisible(l,l.getLayerGroup().getLayers(),(0,x.getUid)(t)))},t=e=>{var r,t,a=null==(r=e.feature.getGeometry())?void 0:r.getExtent();a&&(null==l||l.getView().fit(a,{size:l.getSize(),padding:J(null==(t=K().search)?void 0:t.showSearchResultDrawer)}))};return(0,s.jsx)(tt(),{searchResults:V,numTotal:e,accordion:!0,searchTerms:k.split(" "),actionsCreator:H,layerStyle:X,onClick:e=>{var a,n;if(U(!1),t(e),(null==(a=K().search)?void 0:a.activateLayerOnClick)&&r(e),null==(n=K().search)?void 0:n.showSearchResultDrawer){var l,i=m.writeFeatureObject(e.feature);null==(l=i.properties)||delete l.layer,u((0,ta.ef)({geoJSONFeature:i,layerId:(0,x.getUid)(e.feature.get("layer")),drawerVisibility:!0})),F("")}}})})()]})},tl=e=>{var r=(0,a._)({},(0,n._)(e)),t=A(e=>e.searchEngines.includes("nominatim")),i=A(e=>e.searchEngines.includes("solr")),o=A(e=>e.searchEngines.includes("wfs")),u=rq(),c=rB(),d=rD();return t||i||o?(0,s.jsx)("div",{className:"search","aria-label":"search-field",children:(0,s.jsx)(tn,(0,l._)({"aria-label":"search",geocoderSearchEngine:(()=>{if(t)return d})(),dataSearchEngine:i&&o?void N.Z.warn("Both solr and wfs search are configured. Only one of them can be used at the same time."):i?c:o?u:void 0},r))}):(N.Z.warn("Neither nominatim, solr nor wfs search is configured."),(0,s.jsx)(s.Fragment,{}))},ti=t(88495),ts=e=>{var r=e.email,t=e.size,a=e.rating,n=e.defaultImage,l=e.force,i=(void 0===r?"":r).toLowerCase(),s=(0,ti.md5)(i),o=`https://www.gravatar.com/avatar/${s}?s=${void 0===t?80:t}&r=${void 0===a?"g":a}&d=${void 0===n?"identicon":n}`;return void 0!==l&&l&&(o=`${o}&f=y`),o},to=t(39111),tu=e=>{var r=e.className,t=e.imageSrc,a=e.userMenu,n=e.userName,o=e.style,u=(0,ef._)(e,["className","imageSrc","userMenu","userName","style"]),c="userchip",d=()=>eE()(n)?n.split(" ").map(e=>{var r;return null!=(r=e[0])?r:""}).join("").toUpperCase():"??",f=()=>{var e=r?`${r} ${c}`:c;return(0,s.jsxs)("div",{className:e,style:o,children:[(0,s.jsx)(to.Z,(0,i._)((0,l._)({src:t,size:"large",className:"userimage"},u),{children:t?"":d()})),(0,s.jsx)("span",{className:"username",children:n})]})};return(null==a?void 0:a.items)?(0,s.jsx)(r1.Z,{menu:a,trigger:["click"],getPopupContainer:()=>document.getElementsByClassName(c)[0],children:f()}):f()},tc=()=>{var e,r,t,a,n,l,i,u,p,m,g,h,v,y,x,b,j=(0,E.useTranslation)().t,w=(0,d._)((0,o.useState)(),2),S=w[0],_=w[1],C=(0,ea.Z)(),N=null==C?void 0:C.getKeycloak(),L=A(e=>e.user);return(0,o.useEffect)(()=>{(0,c._)(function(){return(0,f.Jh)(this,function(e){switch(e.label){case 0:return[4,null==N?void 0:N.createLoginUrl()];case 1:return _(e.sent()),[2]}})})()},[N]),(0,s.jsx)("div",{className:"user-menu",children:e4()(L)?(0,s.jsx)(rx.Z,{title:j("UserMenu.loginTooltip"),children:(0,s.jsx)(eL.ZP,{type:"link",onClick:()=>{N&&N.login()},icon:(0,s.jsx)(eP.G,{icon:eT.Yem}),children:j("UserMenu.loginMenuTitle")})}):(0,s.jsx)(tu,{size:"small",imageSrc:ts({email:null!=(b=null==(x=L.providerDetails)?void 0:x.email)?b:"",size:28}),userName:(0,s.jsx)(eP.G,{icon:eT.gc2}),userMenu:(m={key:"username",label:(0,s.jsxs)("div",{className:"username-menu-item","aria-label":"user-name",children:[(0,s.jsx)("span",{className:"item-username",children:null!=(i=null==(e=L.providerDetails)?void 0:e.username)?i:L.authProviderId}),(0,s.jsx)("br",{}),(0,s.jsx)("span",{className:"item-fullname",children:`${null!=(u=null==(r=L.providerDetails)?void 0:r.firstName)?u:""} ${null!=(p=null==(t=L.providerDetails)?void 0:t.lastName)?p:""}`})]})},g={type:"divider"},h={key:"settings",icon:(0,s.jsx)(eP.G,{icon:eT.gNZ}),label:j("UserMenu.settingsMenuTitle")},v={key:"logout",icon:(0,s.jsx)(eP.G,{icon:eT.HEx}),label:(0,s.jsx)("div",{"aria-label":"logout",children:j("UserMenu.logoutMenuTitle")})},{items:Array.isArray(y=null==N||null==(l=N.tokenParsed)||null==(n=l.resource_access)||null==(a=n.account)?void 0:a.roles)&&y.indexOf("manage-account")>-1?[m,g,h,g,v]:[m,g,v],onClick:e=>{switch(e.key){case"settings":N&&N.accountManagement();break;case"logout":N&&N.logout({redirectUri:S})}}})})})},td=e=>{var r,t,o,u=(0,a._)({},(0,n._)(e)),c=A(e=>e.title),d=A(e=>e.logoPath),f=A(e=>e.userMenu.visible),p=G(),m=(e,r)=>{p.forEach(t=>{if((n=t.integration)&&"header"===n.placement&&(null==(a=t.integration)?void 0:a.placementOrientation)===e){var a,n,l,i,o=t.key,u=t.wrappedComponent;r.splice(null!=(i=null==(l=t.integration)?void 0:l.insertionIndex)?i:0,0,(0,s.jsx)(u,{},o))}})};return(0,s.jsxs)("div",(0,i._)((0,l._)({className:"header"},u),{children:[(0,s.jsx)("div",{className:"item-container left-items",children:(m("left",r=[(0,s.jsx)("img",{className:"logo","aria-label":"logo",src:d},"logo"),(0,s.jsx)("div",{className:"title","aria-label":"title",children:c},"title")]),r)}),(0,s.jsx)("div",{className:"item-container center-items",children:(m("center",t=[(0,s.jsx)(tl,{"aria-label":"search-input",name:"search-input",className:"search-input"},"search")]),t)}),(0,s.jsx)("div",{className:"item-container right-items",children:(m("right",o=[(()=>{if(K().documentationButtonVisible)return(0,s.jsx)(rP,{},"docs-button")})(),(()=>{var e;if(f&&(null==(e=K().keycloak)?void 0:e.enabled))return(0,s.jsx)("div",{"aria-label":"user-menu",children:(0,s.jsx)(tc,{},"user-menu")},"user-menu")})()].filter(e=>void 0!==e)),o)})]}))},tf=t(29097),tp=t(28641),tm=t.n(tp),tg=t(23578),th=t(91885),tv=e=>{var r=e.layer,t=(0,ef._)(e,["layer"]),a=(0,d._)((0,o.useState)(!1),2),n=a[0],u=a[1],p=(0,d._)((0,o.useState)(),2),m=p[0],g=p[1],h=(0,d._)((0,o.useState)(),2),v=h[0],y=h[1],x=(0,ea.Z)(),b=(0,E.useTranslation)().t,j=(0,o.useCallback)(()=>(0,c._)(function(){var e;return(0,f.Jh)(this,function(t){switch(t.label){case 0:if(t.trys.push([0,2,3,4]),u(!0),g(""),!r||!r.get("shogunId"))throw Error("No layer provided or the layer has no shogunId set");return[4,null==x?void 0:x.layer().findOne(r.get("shogunId"))];case 1:return y(t.sent()),[3,4];case 2:return e=t.sent(),N.Z.error(e),g(b("LayerConfiguration.errorMessage")),[3,4];case 3:return u(!1),[7];case 4:return[2]}})})(),[b,x,r]);return((0,o.useEffect)(()=>{j()},[j]),m)?(0,s.jsx)(z.Z,{type:"error",closable:!0,message:m}):(0,s.jsx)(th.Z,{spinning:n,children:(0,s.jsx)("pre",(0,i._)((0,l._)({className:"layer-configuration"},t),{children:(0,s.jsx)("code",{children:JSON.stringify(v,null,"  ")})}))})},ty=e=>{var r=e.layer,t=(0,ef._)(e,["layer"]),a=(0,d._)((0,o.useState)(!1),2),n=a[0],u=a[1],p=(0,d._)((0,o.useState)(),2),m=p[0],g=p[1],h=(0,d._)((0,o.useState)(),2),v=h[0],y=h[1],x=(0,ea.Z)(),b=(0,E.useTranslation)().t,j=(0,o.useCallback)(()=>(0,c._)(function(){var e;return(0,f.Jh)(this,function(t){switch(t.label){case 0:if(!r||!(0,H.us)(r))return[2];t.label=1;case 1:return t.trys.push([1,3,4,5]),u(!0),y(""),g(void 0),[4,k.Z.getWmsCapabilitiesByLayer(r,{headers:(0,l._)({},r.get("useBearerToken")?(0,l._)({},(0,et.a)(null==x?void 0:x.getKeycloak())):void 0)})];case 2:return g(t.sent()),[3,5];case 3:return e=t.sent(),N.Z.error(e),y(b("LayerDetails.errorMessage")),[3,5];case 4:return u(!1),[7];case 5:return[2]}})})(),[b,x,r]);(0,o.useEffect)(()=>{j()},[j]);var w=()=>{var e;if(r&&(0,H.us)(r))return null==(e=r.getSource())?void 0:e.getParams().LAYERS},S=()=>{if(r&&(0,H.us)(r)){if(r.getSource()instanceof Q()&&(e=r.getSource().getUrl()),r.getSource()instanceof er()){var e,t=r.getSource().getUrls();e=t?t[0]:void 0}if(e)return L.V.createValidGetCapabilitiesRequest(e,"WMS","1.3.0")}},_=()=>{var e,r,t=null==m||null==(r=m.Capability)||null==(e=r.Layer)?void 0:e.Layer,a=w();return Array.isArray(t)?null==t?void 0:t.find(e=>(null==e?void 0:e.Name)===a):t},C=()=>{var e=_();if(e&&e.EX_GeographicBoundingBox)return[e.EX_GeographicBoundingBox.westBoundLongitude,e.EX_GeographicBoundingBox.southBoundLatitude,e.EX_GeographicBoundingBox.eastBoundLongitude,e.EX_GeographicBoundingBox.northBoundLatitude].join(", ")},F=()=>{var e=_();if(e)return e.MinScaleDenominator},T=()=>{var e=_();if(e)return e.MaxScaleDenominator},P=()=>{var e=_();if(e)return e.Abstract},Z=()=>{var e;return null==m||null==(e=m.Service)?void 0:e.Abstract},D=()=>{var e,r;return null==m||null==(r=m.Service)||null==(e=r.ContactInformation)?void 0:e.ContactElectronicMailAddress},M=()=>{var e=_();if(e)return e.Title},A=()=>{var e;return null==m||null==(e=m.Service)?void 0:e.AccessConstraints};return v?(0,s.jsx)(z.Z,{type:"error",closable:!0,message:v}):(0,s.jsx)(th.Z,{spinning:n,children:(0,s.jsxs)(ep.Z,(0,i._)((0,l._)({className:"layer-details",layout:"horizontal",size:"small",labelAlign:"left",labelWrap:!0,labelCol:{flex:"150px"}},t),{children:[(0,s.jsx)(ep.Z.Item,{name:"layerName",label:b("LayerDetails.layerNameLabel"),children:(0,s.jsx)("span",{children:w()?w():b("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(ep.Z.Item,{name:"layerTitle",label:b("LayerDetails.layerTitleLabel"),children:(0,s.jsx)("span",{children:M()?M():b("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(ep.Z.Item,{name:"service-abstract",label:b("LayerDetails.serviceAbstractLabel"),children:(0,s.jsx)("span",{children:Z()?Z():b("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(ep.Z.Item,{name:"abstract",label:b("LayerDetails.abstractLabel"),children:(0,s.jsx)("span",{children:P()?P():b("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(ep.Z.Item,{name:"accessConstraints",label:b("LayerDetails.accessConstraintsLabel"),children:(0,s.jsx)("span",{children:A()?A():b("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(ep.Z.Item,{name:"CapabilitiesUrl",label:b("LayerDetails.capabilitiesUrlLabel"),children:(0,s.jsx)("a",{href:S(),children:S()})}),(0,s.jsx)(ep.Z.Item,{name:"contact",label:b("LayerDetails.contactLabel"),children:D()?(0,s.jsx)("a",{href:`mailto:${D()}`,children:D()}):(0,s.jsx)("span",{children:b("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(ep.Z.Item,{name:"minScale",label:b("LayerDetails.minScaleLabel"),children:(0,s.jsx)("span",{children:F()?F():b("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(ep.Z.Item,{name:"maxScale",label:b("LayerDetails.maxScaleLabel"),children:(0,s.jsx)("span",{children:T()?T():b("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(ep.Z.Item,{name:"bbox",label:b("LayerDetails.bboxLabel"),children:(0,s.jsx)("span",{children:C()?C():b("LayerDetails.noDataPlaceholder")})})]}))})},tx=e=>{var r=(0,a._)({},(0,n._)(e)),t=(0,d._)((0,o.useState)(),2),u=t[0],c=t[1],f=(0,d._)((0,o.useState)(!1),2),p=f[0],g=f[1],h=A(e=>e.layerDetailsModal.visible),v=A(e=>e.layerDetailsModal.layerId),y=M(),x=(0,Z.S)(),b=(0,E.useTranslation)().t;return(0,o.useEffect)(()=>{if(x){if(!v)return void c(void 0);var e=F.C.getLayerByOlUid(x,v);e instanceof tm()&&c(e)}},[x,v]),(0,s.jsxs)(m.Z,(0,i._)((0,l._)({className:"layer-details-modal",title:(0,s.jsxs)("div",{className:"title-group",children:[(0,s.jsx)("span",{children:b("LayerDetailsModal.title",{layerName:null==u?void 0:u.get("name")})}),(null==u?void 0:u.get("shogunId"))&&(0,s.jsx)(rx.Z,{title:b(p?"LayerDetailsModal.internalConfigurationButtonTooltipPressed":"LayerDetailsModal.internalConfigurationButtonTooltip"),children:(0,s.jsx)(eL.ZP,{type:"link",className:p?"pressed":"",icon:(0,s.jsx)(tf.Z,{}),onClick:()=>{g(!p)}})})]}),open:h,onCancel:()=>{y((0,tg.Cp)()),y((0,tg.uF)(void 0))},width:800,footer:!1},r),{children:[(0,s.jsx)(ty,{layer:u,hidden:p}),(null==u?void 0:u.get("shogunId"))&&(0,s.jsx)(tv,{layer:u,hidden:!p})]}))},tb=t(26501),tj=t(33405),tw=t.n(tj),tS=()=>{var e=(0,E.useTranslation)().t,r=(0,Z.S)(),t=(0,d._)((0,o.useState)(!1),2),a=t[0],n=t[1],i=A(e=>e.mapToolbarVisible.visible),u=A(e=>e.stylingDrawerVisibility),c=A(e=>e.editFeatureDrawerOpen),f=A(e=>e.searchResult.drawerVisibility),p={tooltipPlacement:"left",tooltipProps:{mouseEnterDelay:.5}};return(0,s.jsx)(s.Fragment,{children:i&&(0,s.jsxs)(rn,{id:"map-toolbar",className:u||c||f?"drawer-open":"",alignment:"vertical",role:"toolbar",children:[r&&(0,s.jsx)(tw(),(0,l._)({"aria-label":"zoom-in",tooltip:e("MapToolbar.zoomInTooltip"),icon:(0,s.jsx)(eP.G,{icon:eT.r8p})},p)),r&&(0,s.jsx)(tw(),(0,l._)({"aria-label":"zoom-out",tooltip:e("MapToolbar.zoomOutTooltip"),delta:-1,icon:(0,s.jsx)(eP.G,{icon:eT.Kl4})},p)),r&&(0,s.jsx)(tb.GeoLocationButton,(0,l._)({"aria-label":"geolocation",showMarker:!0,follow:!0,pressed:a,onChange:()=>n(!a),tooltip:e("MapToolbar.geoLocation"),icon:(0,s.jsx)(eP.G,{icon:eT.iUi}),pressedIcon:(0,s.jsx)(eP.G,{icon:eT.GrN})},p))]})})},t_=t(35586),tC=t.n(t_),tE=t(41357),tN=t.n(tE),tL=t(50876),tk=t.n(tL),tF=t(49968),tT=e=>{let r;var t=e.value,a=e.attributeName,n=e.resultDrawerConfig,l=t;if(Array.isArray(t)&&1===t.length&&"string"==typeof t[0]&&(l=t[0]),"string"==typeof l&&(r=l,/^(?:\w+:)?\/\/([^\s.]+\.\S{2}|localhost[:?\d]*)\S*$/.test(r))&&n){var i,o,u=null==(i=n.children)?void 0:i.find(e=>e.displayName===a),c=(null==u||null==(o=u.fieldProps)?void 0:o.urlDisplayValue)||l;return(0,s.jsx)("a",{href:l,target:"_blank",rel:"noopener noreferrer",children:c})}return(0,s.jsx)(s.Fragment,{children:null==l||"object"==typeof l?"":l})},tP=e=>{var r,t,u=(0,a._)({},(0,n._)(e)),c=M(),d=(0,Z.S)(),f=A(e=>e.searchResult.drawerVisibility),p=A(e=>e.searchResult.geoJSONFeature),m=A(e=>e.searchResult.layerId),g=(0,o.useMemo)(()=>p?new(e6())().readFeature(p):null,[p]),h=(0,o.useMemo)(()=>m&&d?F.C.getLayerByOlUid(d,m):null,[m,d]),v=(0,tF.n)(()=>new(tC())({source:new(tN()),style:new(r9())({stroke:new(r8())({color:"rgb(255,0,0)",width:2}),fill:new(r5())({color:"rgba(255,255,255, 0.5)"}),image:new(r3())({radius:10,fill:new(r5())({color:"rgba(255,255,255, 0.5)"}),stroke:new(r8())({color:"rgb(255,0,0)",width:3})})})}),[]),y=(0,o.useCallback)(e=>{v&&v.getSource()&&e&&(v.getSource().clear(),v.getSource().addFeature(e))},[v]);(0,o.useEffect)(()=>{g&&d&&y(g)},[g,d,y]);var x=(0,E.useTranslation)().t,b=(e,r)=>{r.forEach(r=>{var t=e.get(r);Array.isArray(t)&&1===t.length&&"string"==typeof t[0]&&e.set(r,t[0])})},j=null!=(t=null==h||null==(r=h.get("searchConfig"))?void 0:r.resultDrawerConfig)?t:null;(0,o.useEffect)(()=>{g&&(null==j?void 0:j.children)&&b(g,j.children.map(e=>e.propertyName))},[g,null==j?void 0:j.children]);var w=(0,o.useMemo)(()=>(null==j?void 0:j.children)?j.children.map(e=>e.propertyName):void 0,[j]),S=(0,o.useMemo)(()=>(null==j?void 0:j.children)?Object.fromEntries(j.children.map(e=>{var r;return[e.propertyName,null!=(r=e.displayName)?r:""]})):void 0,[j]),_=[{title:x("FeaturePropertyGrid.key"),dataIndex:"attributeName",key:"attributeName",width:"50%",ellipsis:!0,defaultSortOrder:"ascend",sorter:(e,r)=>e.key.localeCompare(r.key)},{title:x("FeaturePropertyGrid.value"),dataIndex:"attributeValue",key:"attributeValue",width:"50%",ellipsis:!0,render:(e,r)=>(0,s.jsx)(tT,{value:e,attributeName:r.attributeName,resultDrawerConfig:j})}];return(0,s.jsx)(eX,(0,i._)((0,l._)({title:x("SearchResultDrawer.title"),placement:"right",onClose:()=>{c((0,ta.ef)({drawerVisibility:!1,layerId:null,geoJSONFeature:null})),null==v||v.getSource().clear()},open:f,maskClosable:!1,mask:!1},u),{children:(0,s.jsxs)("div",{children:[g&&(0,s.jsx)("h3",{children:((e,r)=>{if(!e)return"";if(!r){var t;return null!=(t=e.get("title"))?t:""}var a=r.match(/^{(.+)}$/);if(a){var n,l=a[1];return null!=(n=e.get(l))?n:""}return r})(g,null==j?void 0:j.title)}),g&&Object.keys(g.getProperties()).length>1&&(0,s.jsx)(tk(),{className:"property-grid",feature:g,attributeFilter:w,size:"small",sticky:!0,attributeNames:S,columns:_,scroll:{scrollToFirstRowOnChange:!0,y:"calc(100% - 90px)"}})]})}))},tZ=t(63161),tD=t(56700),tM=t(51803),tA=e=>{var r=(0,a._)({},(0,n._)(e)),t={name:"Default Style",rules:[{name:"Area",symbolizers:[{kind:"Fill",color:"#00b72b",outlineOpacity:.8,opacity:.5,fillOpacity:.8,outlineWidth:2,outlineColor:"#00b72b"}]},{name:"Line",symbolizers:[{kind:"Line",color:"#00b72b",width:2,opacity:.8}]},{name:"Point",symbolizers:[{kind:"Mark",wellKnownName:"circle",color:"#00b72b",strokeColor:"#00b72b",strokeOpacity:.8,opacity:.5,radius:7}],filter:["==","label","undefined"]},{name:"Text",symbolizers:[{kind:"Text",label:"{{label}}",size:12,font:["sans-serif"],opacity:.8,color:"#00b72b",offset:[5,5],haloColor:"#00b72b",haloWidth:1}],filter:["!=","label","undefined"]}]},i=(0,d._)((0,o.useState)(t),2),u=i[0],p=i[1],m=(0,Z.S)();return(0,o.useEffect)(()=>{if(u&&m){var e=new tM.Z,r=F.C.getLayerByName(m,"react-geo_digitize");(0,c._)(function(){var t,a,n,l,i,s,o,c,d,p,m,g,h,v;return(0,f.Jh)(this,function(f){switch(f.label){case 0:i=!0,s=!1,o=void 0,f.label=1;case 1:f.trys.push([1,6,7,8]),c=u.rules[Symbol.iterator](),f.label=2;case 2:if(i=(d=c.next()).done)return[3,5];return m={name:"",rules:[p=d.value]},[4,e.writeStyle(m)];case 3:if(!(g=f.sent()).output)return[2];"Fill"===p.symbolizers[0].kind&&(t=g.output),"Text"===p.symbolizers[0].kind&&(l=g.output),"Line"===p.symbolizers[0].kind&&(a=g.output),"Mark"===p.symbolizers[0].kind&&(n=g.output),f.label=4;case 4:return i=!0,[3,2];case 5:return[3,8];case 6:return h=f.sent(),s=!0,o=h,[3,8];case 7:try{i||null==c.return||c.return()}finally{if(s)throw o}return[7];case 8:return v=(e,r)=>{var i,s=null==(i=e.getGeometry())?void 0:i.getType();if(s){if(["MultiPolygon","Polygon","Circle"].includes(s))return"function"==typeof t?t(e,r):t;if(["MultiLineString","LineString"].includes(s))return"function"==typeof a?a(e,r):a;if(["MultiPoint","Point"].includes(s))return e.get("label")?"function"==typeof l?l(e,r):l:"function"==typeof n?n(e,r):n}},r.setStyle(v),[2]}})})()}},[u,m]),(0,s.jsx)(tD.U,(0,l._)({style:u,onStyleChange:p},r))},tO=e=>{var r=(0,a._)({},(0,n._)(e)),t=M(),o=A(e=>e.stylingDrawerVisibility),u=(0,E.useTranslation)().t;return(0,s.jsx)(eX,(0,i._)((0,l._)({title:u("StylingDrawer.title"),placement:"right",onClose:()=>{t((0,tZ.ah)(!1))},open:o,maskClosable:!1,mask:!1},r),{children:(0,s.jsx)(tA,{})}))},tU=t(98930),tI=t(1581),t$=t.n(tI),tR=t(37669),tG=t(12416),tV=t(41354),tB=t(2803),tJ=t(50755),tz=h.Z.Option,tW=()=>{var e=Object.keys(tJ.Z.services.resourceStore.data);return(0,s.jsx)("div",{className:"language-select","aria-label":"language-selector",children:(0,s.jsx)(h.Z,{defaultValue:tJ.Z.language||"en",onChange:e=>{tJ.Z.changeLanguage(e)},children:e.map(e=>(0,s.jsx)(tz,{value:e,children:e.toUpperCase()},e))})})},tK=t(68428),tq=t(97691),tY=t(32446),tH=t(33411),tX=t(20640),tQ=t.n(tX),t0=t(42893),t1=t(35674),t2=()=>{var e=(0,Z.S)(),r=(0,o.useMemo)(()=>["layerConfig","isExternalLayer","isUploadedLayer","groupName"],[]),t=(0,E.useTranslation)().t,a=e?t1.k.getLink(e,";",e=>e.get("name"),e=>(e instanceof C()||e instanceof S())&&e.getVisible(),r):"",n=(0,d._)((0,o.useState)(a),2),l=n[0],i=n[1],u=`Hey,\r
check out the layer-composition I created:\r
\r
${l}`;return(0,o.useEffect)(()=>{if(e){var t=[],a=e=>e.get("name"),n=e=>(e instanceof C()||e instanceof S())&&e.getVisible(),l=()=>{i(t1.k.getLink(e,";",a,n,r))},s=()=>{e.getAllLayers().filter(e=>e.get("isExternalLayer")||e.get("isUploadedLayer")).forEach(e=>{var r=e.get("layerConfig");r&&(r.clientConfig?r.clientConfig.opacity=e.getOpacity():r.clientConfig={opacity:e.getOpacity()},e.set("layerConfig",r))}),l()},o=e=>{var r=e.getLayers().getArray(),a=!0,n=!1,i=void 0;try{for(var u,c=r[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var d=u.value;if(d instanceof j())o(d);else{var f=d.on("change:visible",l),p=d.on("change:opacity",s);t.push(f,p)}}}catch(e){n=!0,i=e}finally{try{a||null==c.return||c.return()}finally{if(n)throw i}}},u=e.getView().on("change:center",l),c=e.getView().on("change:resolution",l);return o(e.getLayerGroup()),s(),()=>{(0,t0.unByKey)(u),(0,t0.unByKey)(c),(0,t0.unByKey)(t)}}},[r,e,t]),(0,s.jsxs)("div",{className:"permalink-wrapper",children:[(0,s.jsxs)("div",{className:"icons",children:[(0,s.jsx)(rx.Z,{title:t("Permalink.whatsAppTooltip"),children:(0,s.jsx)(tK.Z,{onClick:function(){var e=new URL("https://wa.me");e.searchParams.set("text",u),window.open(e)}})}),(0,s.jsx)(rx.Z,{title:t("Permalink.mailTooltip"),children:(0,s.jsx)(tq.Z,{onClick:function(){var e=new URL("mailto:");e.searchParams.set("subject","SHOGun Web-GIS"),e.searchParams.set("body",u),window.open(e.toString().replace(/\+/g,"%20"),"_self")}})})]}),(0,s.jsxs)("div",{className:"link","aria-label":"permalink-url",children:[(0,s.jsx)(g.Z,{value:l,readOnly:!0}),(0,s.jsx)(rx.Z,{title:t("Permalink.copyTooltip"),children:(0,s.jsx)(tY.Z,{onClick:function(){tQ()(l)?tH.ZP.info(t("Permalink.copiedToClipboard")):tH.ZP.info(t("Permalink.copyToClipboardFailed"))}})})]})]})},t3=t(59418),t4=t(57795),t5=t(55002),t6=t(99865),t8=t(19867),t7=t(16827),t9=t(86954),ae=t(50122),ar=t(97955),at=t(11032);class aa extends at.N{serialize(e,r){var t=super.serialize(e,r);return t.baseURL.startsWith("/geoserver/ows")&&(t.baseURL=`http://shogun-geoserver:8080${t.baseURL}`),t.baseURL.startsWith("/geoserver/SHOGUN")&&(t.baseURL=`http://shogun-geoserver:8080${t.baseURL}`),t}}var an=aa,al=class extends an{serialize(e,r){var t=(0,l._)({tileSize:[512,512]},r),a=e.getSource();if(a&&this.validateSource(a))return(0,l._)({},super.serialize(e,t),{type:ar.n.TYPE_WMS},r)}},ai=e=>{var r=e.value,t=e.id,a=e.placeholder,n=e.maxLength,i=(0,ef._)(e,["value","id","placeholder","maxLength"]),u=M();return(0,o.useEffect)(()=>{ej()(t)||u((0,ae.eV)({[t]:r}))},[r,t,u]),(0,s.jsx)(g.Z,(0,l._)({id:t,value:r,placeholder:a,maxLength:n,showCount:!!(n&&n>1)},i))},as=e=>{var r=e.printManager,t=e.onValueChange,a=e.placeholder,n=e.value,u=(0,ef._)(e,["printManager","onValueChange","placeholder","value"]),c=(0,d._)((0,o.useState)(n),2),f=c[0],p=c[1],m=(0,o.useRef)(f);return(0,o.useEffect)(()=>{m.current=n},[n]),(0,o.useEffect)(()=>{r&&(r.setLayout(f),m.current!==f&&t())},[r,f,t,n]),(0,o.useEffect)(()=>{p(n)},[n]),(0,s.jsx)(h.Z,(0,i._)((0,l._)({placeholder:void 0===a?"Bitte w\xe4hlen Sie eine Vorlage aus":a,value:f,onChange:p},u),{children:null==r?void 0:r.getLayouts().map(e=>(0,s.jsx)(h.Z.Option,{value:e.name,children:e.name},e.name))}))},ao=e=>{var r=e.printManager,t=e.placeholder,a=e.value,n=e.outputFormats,u=(0,ef._)(e,["printManager","placeholder","value","outputFormats"]),c=(0,d._)((0,o.useState)(a),2),f=c[0],p=c[1];return(0,o.useEffect)(()=>{r&&r.setOutputFormat(f)},[r,f]),(0,o.useEffect)(()=>{p(a)},[a]),(0,s.jsx)(h.Z,(0,i._)((0,l._)({placeholder:t,value:f,onChange:p},u),{children:n.map(e=>(0,s.jsx)(h.Z.Option,{value:e,children:e.toLocaleUpperCase()},e))}))},au=e=>{var r=e.printManager,t=e.placeholder,a=e.value,n=(0,ef._)(e,["printManager","placeholder","value"]),u=(0,d._)((0,o.useState)(a),2),c=u[0],f=u[1];return(0,o.useEffect)(()=>{r&&r.setDpi(c)},[r,c]),(0,o.useEffect)(()=>{f(a)},[a]),(0,s.jsx)(h.Z,(0,i._)((0,l._)({placeholder:t,value:c,onChange:f},n),{children:null==r?void 0:r.getDpis().map(e=>(0,s.jsx)(h.Z.Option,{value:e,children:`${e} DPI`},e))}))},ac=t(25764),ad=e=>{var r=e.printManager,t=e.placeholder,a=e.value,n=(0,ef._)(e,["printManager","placeholder","value"]),u=(0,Z.S)(),c=(0,d._)((0,o.useState)(0),2),f=c[0],p=c[1];return(0,o.useEffect)(()=>{r&&f&&r.setScale(f)},[r,f]),(0,o.useEffect)(()=>{var e=()=>{var e=r.getScale();e&&p(e)},t=null==u?void 0:u.getInteractions().getArray().find(e=>e.get("name")===ac.C.TRANSFORM_INTERACTION_NAME);if(r&&t)return t.on("scaling",e),()=>{t.on("scaling",e)}},[r,u]),(0,o.useEffect)(()=>{a&&p(a)},[a]),(0,s.jsx)(h.Z,(0,i._)((0,l._)({placeholder:t,value:f,onChange:p},n),{children:null==r?void 0:r.getScales().map(e=>(0,s.jsx)(h.Z.Option,{value:e,children:`1 : ${e.toLocaleString()}`},e))}))};t(26398).j.getLegendGraphicUrl=e=>{if(e.get("legendUrl"))return e.get("legendUrl");if(e.getSource()instanceof er()||e.getSource()instanceof Q()){var r=e.get("customPrintLegendParams"),t=e.getSource(),a=t.getParams(),n=a.LAYERS,i=a.VERSION,s=a.FORMAT,o=t instanceof Q()?t.getUrl():t.getUrls()[0];o.startsWith("/geoserver/ows")&&(o=`http://shogun-geoserver:8080${o}`);var u=(0,l._)({LAYER:n.split(",")[0],VERSION:i||"1.3.0",SERVICE:"WMS",REQUEST:"GetLegendGraphic",FORMAT:s||"image/png"},r),c=Object.keys(u).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(u[e])}`).join("&");return o.startsWith("/geoserver/SHOGUN")?(o=`http://shogun-geoserver:8080${o}/service?`,`${o}${c}`):o.endsWith("?")?`${o}${c}`:`${o}?${c}`}return""};var af=e=>{var r,t=e.active,a=e.customPrintScales,n=void 0===a?[]:a,u=e.layerBlackList,p=void 0===u?[]:u,m=e.outputFormats,g=(0,ef._)(e,["active","customPrintScales","layerBlackList","outputFormats"]),h=(0,d._)(ep.Z.useForm(),1)[0],v=(0,E.useTranslation)(),y=v.t,x=v.i18n,b=(0,Z.S)(),w=M(),S=x.language,_=(0,ea.Z)(),C=A(e=>e.print.customMapParams),L=A(e=>e.print.customParams),k=A(e=>e.print.printApp),T=(0,d._)((0,o.useState)(null),2),P=T[0],D=T[1],O=(0,d._)((0,o.useState)(!1),2),U=O[0],I=O[1],$=(0,d._)((0,o.useState)(null),2),R=$[0],G=$[1],V=(0,o.useCallback)(e=>{if(b){var r=e.get("name");return r&&!p.includes(r)&&e.getVisible()&&!(e instanceof j())&&F.C.layerInResolutionRange(e,b)}},[b,p]),B=(0,o.useCallback)(e=>{if(ej()(b))return!1;var r=e.get("name"),t=!p.includes(r),a=!e.get("hideLegendInPrint"),n=e.getVisible()&&F.C.layerInResolutionRange(e,b),l=!(e instanceof j());if(t&&a&&n&&l){var i=null==b?void 0:b.getView().getResolution();return i&&e.set("customPrintLegendParams",{SCALE:F.C.getScaleForResolution(i,"m")}),!0}return!1},[b,p]),J=(0,o.useCallback)(e=>b?F.C.getAllLayers(b).filter(r=>{var t=r.get("name");return t&&!t.includes("react-geo")&&r.getVisible()&&!(r instanceof j())&&r!==e}):[],[b]),W=(0,o.useCallback)(e=>{var r=e.getExtentLayer();if(!r)return"";var t=J(r),a=[];return t.filter(e=>{var r,t;return e.getSource&&(null==(r=e.getSource())?void 0:r.getAttributions)&&(null==(t=e.getSource())?void 0:t.getAttributions())}).forEach(e=>{var r=t9.Z.getLayerAttributionsText(e,",",!0);a.includes(r)||a.push(r)}),a.join(", ").trim()},[J]),q=(0,o.useCallback)(()=>(0,c._)(function(){var e,r,t,a,i,s,o,u,c,d;return(0,f.Jh)(this,function(f){switch(f.label){case 0:if(ej()(b))return[2];s={url:null!=(i=null==(e=K().print)?void 0:e.url)?i:"/print",map:b,customPrintScales:null==b||null==(a=b.getView())||null==(t=a.getResolutions())||null==(r=t.map(e=>{var r,t,a=null==b||null==(t=b.getView())||null==(r=t.getProjection())?void 0:r.getUnits();if(void 0!==e){var n=F.C.getScaleForResolution(e,a);if(void 0!==n)return F.C.roundScale(n)}}).filter(e=>void 0!==e))?void 0:r.reverse(),timeout:6e4,layerFilter:V,headers:(0,l._)({},(0,et.a)(null==_?void 0:_.getKeycloak())),transformOpts:{rotate:!1},serializers:[new t6.o,new t4.o,new t5.S,new t8.g,new t7.N,new an,new al],legendFilter:B},n.length>0&&(s=(0,l._)({},s,{customPrintScales:n.toReversed()})),o=new t3.C(s),f.label=1;case 1:return f.trys.push([1,8,,9]),[4,o.init()];case 2:if(f.sent(),c=o.getPrintApps(),k)return[3,5];if(!(c&&S&&c.includes(S)))return[3,4];return[4,o.setPrintApp(S)];case 3:f.sent(),f.label=4;case 4:return[3,7];case 5:return[4,o.setPrintApp(k)];case 6:f.sent(),f.label=7;case 7:return o.setOutputFormat(o.getOutputFormats()[0]),o.setDpi(o.getDpis()[0]),o.setLayout(null==(u=o.getLayouts()[0])?void 0:u.name),[2,o];case 8:return d=f.sent(),G(()=>y("PrintForm.managerErrorMessage")),N.Z.error("Could not initialize print manager: ",d),[3,9];case 9:return[2]}})})(),[b,V,_,B,n,k,S,y]);return(0,o.useEffect)(()=>{P&&w((0,ae.eV)({attributions:W(P)}))},[w,W,P]),(0,eZ.b)(()=>(0,c._)(function(){var e;return(0,f.Jh)(this,function(r){switch(r.label){case 0:if(!t)return[3,3];if(P)return[3,2];return h.resetFields(),[4,q()];case 1:(e=r.sent())&&D(e),r.label=2;case 2:return[3,4];case 3:null==P||P.shutdownManager(),D(null),r.label=4;case 4:return[2]}})})(),[P,t,q,h]),(0,o.useEffect)(()=>{P&&(L&&P.setCustomParams(L),C&&P.setCustomMapParams(C))},[P,L,C]),(0,s.jsxs)("div",{className:"print","aria-label":"print-form",children:[R&&(0,s.jsx)(z.Z,{className:"print-alert",message:R,type:"error",closable:!0,showIcon:!0,onClose:()=>{G(null)}}),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ep.Z,(0,i._)((0,l._)({form:h,className:"print-form",labelAlign:"left",labelCol:{flex:"90px"}},g),{children:(null==P?void 0:P.isInitiated())&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ep.Z.Item,{"aria-label":"print-title",name:"title",label:y("PrintForm.title"),initialValue:y("PrintForm.initialTitle"),children:(0,s.jsx)(ai,{"aria-label":"print-title-input",maxLength:50,placeholder:y("PrintForm.titlePlaceholder")})}),(0,s.jsx)(ep.Z.Item,{"aria-label":"print-comment",name:"comment",label:y("PrintForm.comment"),children:(0,s.jsx)(ai,{"aria-label":"print-comment-input",maxLength:200,placeholder:y("PrintForm.commentPlaceholder")})}),(0,s.jsx)(ep.Z.Item,{"aria-label":"print-layout",name:"layout",label:y("PrintForm.layout"),initialValue:null==P||null==(r=P.getLayouts()[0])?void 0:r.name,children:(0,s.jsx)(as,{"aria-label":"print-layout-input",printManager:P,onValueChange:()=>{h.setFieldValue("dpi",null==P?void 0:P.getDpis()[0])}})}),(0,s.jsx)(ep.Z.Item,{"aria-label":"print-scale",name:"scale",label:y("PrintForm.scale"),initialValue:null==P?void 0:P.getClosestScaleToFitMap(),children:(0,s.jsx)(ad,{"aria-label":"print-scale-input",printManager:P})}),(0,s.jsx)(ep.Z.Item,{"aria-label":"print-dpi",name:"dpi",label:y("PrintForm.dpi"),initialValue:P.getDpis()[0],children:(0,s.jsx)(au,{"aria-label":"print-dpi-input",printManager:P,placeholder:y("PrintForm.resolutionPlaceholder")})}),(0,s.jsx)(ep.Z.Item,{"aria-label":"print-format",name:"format",label:y("PrintForm.format"),initialValue:"pdf",children:(0,s.jsx)(ao,{"aria-label":"print-format-input",printManager:P,outputFormats:void 0===m?["pdf","png"]:m,placeholder:y("PrintForm.outputFormatPlaceholder")})})]})})),(0,s.jsx)(eL.ZP,{"aria-label":"create-print",className:"print-button tool-menu-button",disabled:!(null==P?void 0:P.isInitiated()),icon:(0,s.jsx)(eP.G,{icon:eT.q7m}),loading:U,onClick:()=>(0,c._)(function(){var e,r;return(0,f.Jh)(this,function(t){switch(t.label){case 0:if(t.trys.push([0,2,3,4]),G(null),I(!0),!P)return[2];return[4,P.print(!1)];case 1:if(!(e=t.sent()))throw Error("No download URL available, the job has failed.");return window.open(e),[3,4];case 2:return r=t.sent(),G(y("PrintForm.printJobErrorMsg")||null),N.Z.error(r),[3,4];case 3:return I(!1),[7];case 4:return[2]}})})(),children:y("PrintForm.downloadBtnText")})]})]})},ap=t(5737),am=t(71230),ag=t(16121),ah=t.n(ag),av=t(34571),ay=e=>{var r=e.keyName,t=e.onChange,a=void 0===t?()=>{}:t,n=e.options,l=(0,E.useTranslation)().t;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ep.Z.Item,{name:[r,"name"],rules:[{required:!0,message:l("AttributionRow.missingKey")},e=>{var r=e.getFieldsValue;return{validator(e,t){var a=r(!0);return a.fields&&Object.entries(a.fields).filter(e=>{var r=(0,d._)(e,2)[1];return(null==r?void 0:r.name)===t}).length>1?Promise.reject(Error(l("AttributionRow.keyInUse"))):Promise.resolve()}}}],children:(0,s.jsx)(av.Z,{placeholder:l("AttributionRow.keyPlaceholder"),onChange:e=>{a(e)},options:null==n?void 0:n.map(e=>({value:e}))})}),(0,s.jsx)(ep.Z.Item,{name:[r,"value"],rules:[{required:!0,message:l("AttributionRow.missingValue")}],children:(0,s.jsx)(g.Z,{placeholder:l("AttributionRow.valuePlaceholder"),onChange:e=>{a(e.target.value)}})})]})},ax=e=>{var r=e.selectedFeature,t=(0,ef._)(e,["selectedFeature"]),a=(0,d._)((0,o.useState)(!0),2),n=a[0],u=a[1],m=(0,d._)((0,o.useState)([]),2),g=m[0],h=m[1],v=(0,d._)((0,o.useState)([]),2),y=v[0],x=v[1],b=(0,d._)(p.ZP.useNotification(),2)[1],j=(0,d._)(ep.Z.useForm(),1)[0],w=(0,Z.S)(),S=void 0!==r,_=(0,E.useTranslation)().t,C=(0,o.useCallback)(e=>{var r,t=null==(r=e.fields)?void 0:r.map(e=>{var r;return null==e||null==(r=e.name)?void 0:r.toLowerCase()}).filter(e=>void 0!==e);x(g.filter(e=>!(null==t?void 0:t.includes(e.toLowerCase()))))},[g]);(0,o.useEffect)(()=>{if(w){var e,t=null==r?void 0:r.getProperties();if(j.setFieldValue("fields",[]),t){var a=Object.entries(Object.fromEntries(Object.entries(t).filter(e=>!((0,d._)(e,2)[1]instanceof ah())).map(e=>{var r=(0,d._)(e,2);return[r[0],r[1]]}))).map(e=>{var r=(0,d._)(e,2);return{name:r[0],value:r[1]}});j.setFieldValue("fields",a)}var n=null==(e=rt.w.getDigitizeLayer(w).getSource())?void 0:e.getFeatures(),l=new Set;null==n||n.forEach(e=>{Object.keys(e.getProperties()).forEach(r=>{e.get(r)instanceof ah()||l.add(r)})}),h(Array.from(l))}},[r,j,w]);var L=(e,r)=>{e(r)},k=()=>(0,c._)(function(){var e;return(0,f.Jh)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,j.validateFields()];case 1:return r.sent(),u(!0),[3,3];case 2:return e=r.sent(),u(!1),N.Z.error(e),[3,3];case 3:return[2]}})})(),F=(e,r)=>e.map(e=>(0,s.jsxs)("div",{className:"attribute-row",children:[(0,s.jsx)(ay,{keyName:e.name,onChange:k,options:y},e.key),(0,s.jsxs)(e$.Z,{title:_("AttributionPopConfirm.title"),okText:_("AttributionPopConfirm.okText"),cancelText:_("AttributionPopConfirm.cancelText"),placement:"topRight",onConfirm:()=>{p.ZP.destroy(),p.ZP.info({message:_("notificationDeleteText.title"),description:_("notificationDeleteText.info"),placement:"top",duration:6}),L(r,e.name)},children:[b,(0,s.jsx)(eL.ZP,{className:"remove-attribute-button",type:"primary",danger:!0,icon:(0,s.jsx)(eP.G,{icon:ap.El_})})]})]},e.key));return(0,s.jsxs)(eH.Z,(0,i._)((0,l._)({title:_("Attribution.title"),className:"attribution-drawer",placement:"right",mask:!1,maskClosable:!1,closable:!1,open:S},t),{children:[!r&&(0,s.jsx)(s.Fragment,{children:_("Attribution.select")}),(0,s.jsx)(am.Z,{children:(0,s.jsxs)(ep.Z,{onFinish:e=>{if(r){for(var t in p.ZP.destroy(),p.ZP.success({message:_("notificationApplyText.title"),placement:"top",duration:3.5}),r.getProperties())r.get(t)instanceof ah()||r.unset(t);e.fields&&Object.values(e.fields).forEach(e=>{(null==e?void 0:e.name)&&r.set(e.name,e.value)})}},autoComplete:"off",form:j,onValuesChange:(e,r)=>{C(r)},children:[(0,s.jsx)(ep.Z.List,{name:"fields",children:(e,t)=>{var a=t.add,n=t.remove;return(0,s.jsxs)(s.Fragment,{children:[F(e,n),(0,s.jsx)(ep.Z.Item,{children:r?(0,s.jsx)(eL.ZP,{type:"dashed",onClick:()=>{a()},className:"add-attribute-button",icon:(0,s.jsx)(eP.G,{icon:eT.r8p}),children:_("Attribution.add")}):(0,s.jsx)(s.Fragment,{})})]})}}),(0,s.jsx)(ep.Z.Item,{children:(0,s.jsx)(eL.ZP,{className:"submit-attributes-button",type:"primary",htmlType:"submit",disabled:!n,hidden:!r,children:_("Attribution.submit")})})]})})]}))},ab=t(92848),aj=m.Z.confirm,aw="deleteallbutton",aS=e=>{var r=e.className,t=e.digitizeLayer,a=(0,ef._)(e,["className","digitizeLayer"]),n=(0,d._)((0,o.useState)(null),2),i=n[0],u=n[1],c=(0,Z.S)(),f=(0,E.useTranslation)().t;if((0,o.useEffect)(()=>{c&&(t?u([t]):u([rt.w.getDigitizeLayer(c)]))},[c,t]),!i)return null;var p=r?`${aw} ${r}`:aw;return(0,s.jsx)(P(),(0,l._)({onClick:()=>{aj({title:f("DeleteAllButton.deleteAll"),content:f("DeleteAllButton.confirmMessage"),icon:(0,s.jsx)(ab.Z,{}),onOk(){var e;null==(e=i[0].getSource())||e.clear()}})},className:p},a))},a_=eN.Z.Dragger,aC=e=>{var r=e.className,t=e.footer,a=e.width,n=e.onCancel,u=e.onSuccess,c=e.onFailure,f=(0,ef._)(e,["className","footer","width","onCancel","onSuccess","onFailure"]),p=(0,d._)((0,o.useState)(!1),2),g=p[0],h=p[1],v=(0,d._)((0,o.useState)(""),2),y=v[0],x=v[1],b=(0,Z.S)(),j=(0,E.useTranslation)().t,w=["json","geojson"],S=["application/json","application/geo+json","application/geojson"];return(0,s.jsxs)(m.Z,(0,i._)((0,l._)({title:j("ImportDataModal.title"),onCancel:e=>{x(""),h(!1),null==n||n(e)},className:void 0===r?"import-data-modal":r,width:void 0===a?600:a,footer:void 0!==t&&t},f),{children:[y&&(0,s.jsx)(z.Z,{message:y,closable:!0,type:"error"}),(0,s.jsx)(th.Z,{spinning:g,children:(0,s.jsxs)(a_,{customRequest:e=>{var r=e.file,t=e.onSuccess,a=e.onError;if(r instanceof File&&b){var n=new FileReader;n.onload=()=>{try{var e=new(e6())().readFeatures(n.result,{featureProjection:b.getView().getProjection()});null==t||t(e)}catch(e){null==a||a(e),N.Z.error("Error while reading the file: ",e)}},n.readAsText(r)}},accept:[...w.map(e=>`.${e}`),S].join(","),maxCount:1,showUploadList:!1,beforeUpload:e=>{var r=e.type,t=e.name.split(".").pop();return x(""),!!S.includes(r)&&(!t||!!w.includes(t))||(x(j("ImportDataModal.error.supportedFormats",{supportedFormats:S.join(", ")})),!1)},onChange:e=>{var r=e.file.status,t=e.file.response;if(b)if("uploading"===r)h(!0);else if("done"===r){var a=rt.w.getDigitizeLayer(b).getSource();null==a||a.addFeatures(t||[]),h(!1),tH.ZP.success(j("ImportDataModal.success")),null==u||u(t||[])}else"error"===r&&(h(!1),x(j("ImportDataModal.error.parsing")),null==c||c(e.file.error))},children:[(0,s.jsx)("p",{className:"ant-upload-drag-icon",children:(0,s.jsx)(eP.G,{icon:eT.cf$})}),(0,s.jsx)("p",{className:"ant-upload-text",children:j("ImportDataModal.description")}),(0,s.jsx)("p",{className:"ant-upload-hint",children:j("ImportDataModal.hint")})]})})]}))},aE=()=>{var e=M(),r=(0,E.useTranslation)().t,t=A(e=>e.stylingDrawerVisibility);return(0,s.jsx)(eL.ZP,{type:"link",onClick:()=>{e((0,tZ.ah)(!t))},icon:(0,s.jsx)(eP.G,{icon:eT.XsY}),children:r(t?"StylingDrawer.closeColorPalette":"StylingDrawer.openColorPalette")})},aN=e=>{var r=e.showDrawPoint,t=e.showDrawLine,a=e.showDrawPolygon,n=e.showDrawCircle,l=e.showDrawRectangle,i=e.showDrawAnnotation,u=e.showModifyFeatures,c=e.showUploadFeatures,f=e.showDeleteFeatures,p=(0,d._)((0,o.useState)(),2),m=p[0],g=p[1],h=(0,d._)((0,o.useState)(),2),v=h[0],y=h[1],x=(0,d._)((0,o.useState)(!1),2),b=x[0],j=x[1],w=(0,E.useTranslation)().t,S=(0,Z.S)(),_=(0,o.useCallback)((e,r)=>{y(r),"draw-modify"!==r&&g(void 0)},[]),C=(0,o.useCallback)(e=>{e.selected.length>0?g(e.selected[0]):g(void 0)},[]),N=()=>{j(!1)};return S?(0,s.jsxs)("div",{className:"draw-tools",children:[(0,s.jsxs)(rr.ToggleGroup,{selected:v,onChange:_,children:[r?(0,s.jsxs)(e9(),{value:"draw-point",drawType:"Point",type:"link",pressed:!1,children:[(0,s.jsx)(eP.G,{icon:eT.diR}),(0,s.jsx)("span",{className:"draw-point",children:w("Draw.point")})]},"draw-point"):(0,s.jsx)(s.Fragment,{}),t?(0,s.jsxs)(e9(),{value:"draw-line",drawType:"LineString",type:"link",children:[(0,s.jsx)(eP.G,{icon:eT.hx$}),(0,s.jsx)("span",{className:"draw-line",children:w("Draw.line")})]},"draw-line"):(0,s.jsx)(s.Fragment,{}),a?(0,s.jsxs)(e9(),{value:"draw-polygon",drawType:"Polygon",type:"link",children:[(0,s.jsx)(eP.G,{icon:eT.Kak}),(0,s.jsx)("span",{className:"draw-polygon",children:w("Draw.polygon")})]},"draw-polygon"):(0,s.jsx)(s.Fragment,{}),n?(0,s.jsxs)(e9(),{value:"draw-circle",drawType:"Circle",type:"link",children:[(0,s.jsx)(eP.G,{icon:eT.IJ7}),(0,s.jsx)("span",{className:"draw-circle",children:w("Draw.circle")})]},"draw-circle"):(0,s.jsx)(s.Fragment,{}),l?(0,s.jsxs)(e9(),{value:"draw-rectangle",drawType:"Rectangle",type:"link",children:[(0,s.jsx)(eP.G,{icon:eT.pL1}),(0,s.jsx)("span",{className:"draw-rectangle",children:w("Draw.rectangle")})]},"draw-rectangle"):(0,s.jsx)(s.Fragment,{}),i?(0,s.jsxs)(e9(),{value:"draw-text",drawType:"Text",type:"link",children:[(0,s.jsx)(eP.G,{icon:eT.yGG}),(0,s.jsx)("span",{className:"draw-text",children:w("Draw.text")})]},"draw-text"):(0,s.jsx)(s.Fragment,{}),(0,s.jsx)(aE,{},"styling"),u?(0,s.jsxs)(re.ModifyButton,{value:"draw-modify",type:"link",onFeatureSelect:C,children:[(0,s.jsx)(eP.G,{icon:eT.Yai}),(0,s.jsx)("span",{className:"draw-modify",children:w("Draw.modify")})]},"draw-modify"):(0,s.jsx)(s.Fragment,{}),f?(0,s.jsxs)(e8.DeleteButton,{value:"draw-delete",type:"link",children:[(0,s.jsx)(eP.G,{icon:eT.xf2}),(0,s.jsx)("span",{className:"draw-delete",children:w("Draw.delete")})]},"draw-delete"):(0,s.jsx)(s.Fragment,{})]}),f?(0,s.jsxs)(aS,{value:"draw-delete-all",type:"link",children:[(0,s.jsx)(eP.G,{icon:eT.$aW}),(0,s.jsx)("span",{className:"draw-delete-all",children:w("DeleteAllButton.deleteAll")})]}):(0,s.jsx)(s.Fragment,{}),c?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eL.ZP,{onClick:()=>{j(!0)},"aria-label":"draw-upload",type:"link",icon:(0,s.jsx)(eP.G,{icon:eT.cf$}),children:(0,s.jsx)("span",{className:"draw-upload",children:w("Draw.upload")})}),(0,s.jsx)(aC,{open:b,onCancel:N,onSuccess:N})]}):(0,s.jsx)(s.Fragment,{}),c?(0,s.jsxs)(P(),{value:"draw-export",onClick:()=>{var e=[];if(S){var r,t=S.getView().getProjection().getCode(),a=null==(r=rt.w.getDigitizeLayer(S).getSource())?void 0:r.getFeatures();if(a&&a.length>0){a.forEach(r=>{var a,n=r.clone();null==(a=n.getGeometry())||a.transform(t,"EPSG:4326"),e.push(n)});var n=new Blob([new(e6())().writeFeatures(e)],{type:"application/geo+json"}),l=window.URL.createObjectURL(n),i=document.createElement("a");i.href=l,i.setAttribute("download","exportedFeatures.geojson"),document.body.appendChild(i),i.click(),document.body.removeChild(i)}}},type:"link",children:[(0,s.jsx)(eP.G,{icon:eT.q7m}),(0,s.jsx)("span",{className:"draw-export",children:w("Draw.export")})]}):(0,s.jsx)(s.Fragment,{}),(0,s.jsx)(ax,{selectedFeature:m})]}):(0,s.jsx)(s.Fragment,{})},aL=t(96486),ak=t(20413),aF=t(60878),aT=e=>{var r=(0,Z.S)(),t=(0,o.useCallback)(()=>(0,c._)(function(){var t,a,n,l,i;return(0,f.Jh)(this,function(s){return!r||F.C.getLayerByName(r,e.layerName)||(t=new(tN()),a=new(r5())({color:"rgba(255, 255, 255, 0.15)"}),n=new(r8())({color:"rgba(209, 70, 47, 1)",width:2}),l=new(r9())({fill:a,stroke:n,image:new(r3())({radius:5,fill:a,stroke:n})}),(i=new(tC())({source:t,style:l})).set("name",e.layerName),r.addLayer(i)),[2]})})(),[r,e.layerName]),a=(0,o.useCallback)(()=>{if(r){var t=F.C.getLayerByName(r,e.layerName);t&&r.removeLayer(t)}},[r,e.layerName]);(0,o.useEffect)(()=>(t(),()=>a()),[a,t])},aP=t(1445),aZ=t(66678),aD=t.n(aZ),aM=e=>{var r=e.exportFilter,t=e.features,a=e.layer,n=e.selectedFeature,i=(0,ef._)(e,["exportFilter","features","layer","selectedFeature"]),o=(0,E.useTranslation)().t,u=M(),c=(0,Z.S)(),f=ra(),p=A(e=>e.featureInfo.activeCopyTools),m=A(e=>e.editFeature.userEditMode),g=m.includes("CREATE")||m.includes("DELETE")||m.includes("UPDATE"),h=null==a?void 0:a.get("editable");return(0,s.jsxs)("div",{className:"pagination-toolbar",children:[(0,s.jsx)(aP.Z,(0,l._)({simple:!0,total:t.length,size:"small",pageSize:1},i)),(0,s.jsxs)("div",{className:"copy-buttons",children:[g&&(0,s.jsx)(rx.Z,{title:o(h?"PaginationToolbar.editFeature":"PaginationToolbar.editDisabled"),children:(0,s.jsx)(eL.ZP,{type:"text",size:"small",onClick:()=>{if(a&&c){var e=new(e6())().writeFeature(n);try{var r=JSON.parse(e),t=rt.w.getDigitizeLayer(c);if(!t)return;var l=t.getSource();if(!l||(l.clear(),l.addFeature(n),(0,eu.isEmpty)(l.getExtent())))return;c.getView().fit(l.getExtent(),{padding:f()}),u((0,e_.vN)((0,x.getUid)(a))),u((0,e_.hr)(r)),u((0,eY.$Z)())}catch(e){N.Z.error("Could not parse GeoJSON: ",e)}}},icon:(0,s.jsx)(eP.G,{icon:eT.Xcf}),disabled:!h})},"edit"),(null==p?void 0:p.includes(tR.r1.COPY_AS_GEOJSON))&&(0,s.jsx)(rx.Z,{title:o("PaginationToolbar.copyAsGeoJson"),children:(0,s.jsx)(eL.ZP,{type:"text",size:"small",onClick:()=>{if(n){var e=n.clone();if(r){var t=Object.entries(e.getProperties()),a=t.filter(e=>{var t=(0,d._)(e,2);return r(t[0],t[1])}),l=!0,i=!1,s=void 0;try{for(var o,u=t[Symbol.iterator]();!(l=(o=u.next()).done);l=!0){var c=(0,d._)(o.value,2),f=c[0];c[1]instanceof ah()||e.unset(f)}}catch(e){i=!0,s=e}finally{try{l||null==u.return||u.return()}finally{if(i)throw s}}e.setProperties(Object.fromEntries(a))}tQ()(new(e6())().writeFeature(e))}},icon:(0,s.jsx)(eP.G,{icon:eT.E9T})})}),(null==p?void 0:p.includes(tR.r1.COPY_AS_OBJECT))&&(0,s.jsx)(rx.Z,{title:o("PaginationToolbar.copyAsObject"),children:(0,s.jsx)(eL.ZP,{type:"text",size:"small",onClick:()=>{if(n){var e=Object.entries(aD()(n.getProperties())).filter(e=>!((0,d._)(e,2)[1]instanceof ah()));r&&(e=e.filter(e=>{var t=(0,d._)(e,2);return r(t[0],t[1])})),tQ()(JSON.stringify(Object.fromEntries(e)))}},icon:(0,s.jsx)(eP.G,{icon:eT.OGB})})})]})]})},aA=e=>{var r=e.features,t=e.layerName,a=e.layer,n=e.tabConfig,i=(0,ef._)(e,["features","layerName","layer","tabConfig"]),u=(0,d._)((0,o.useState)(1),2),c=u[0],f=u[1],p=(0,d._)((0,o.useState)(),2),m=p[0],g=p[1],h=(0,d._)((0,o.useState)("0"),2),v=h[0],y=h[1],x=(0,Z.S)(),b=`selection-layer-${t}`;if(aT({layerName:b}),(0,o.useEffect)(()=>{if(x){var e,t=F.C.getLayerByName(x,b);t&&(null==(e=t.getSource())||e.clear(),f(1),r.length>0&&(y("0"),g(r[0])))}},[r,x,b]),(0,o.useEffect)(()=>{if(m&&x){var e,r,t=F.C.getLayerByName(x,b);t&&(null==(e=t.getSource())||e.clear(),null==(r=t.getSource())||r.addFeature(m))}},[m,x,b]),!n||!m)return(0,s.jsx)(s.Fragment,{});var j=n.filter(e=>!ej()(e)).map((e,r)=>({label:e.title,key:`${r}`,forceRender:!0,children:(0,s.jsx)(eO,{name:e.title,feature:m,formConfig:e.children})}));return(0,s.jsxs)("div",{className:"feature-info-tabs",children:[(0,s.jsx)(aM,{current:c,exportFilter:e=>{var r=!1,t=!0,a=!1,l=void 0;try{for(var i,s=n[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var o=i.value;if(o.children){var u=!0,c=!1,d=void 0;try{for(var f,p=o.children[Symbol.iterator]();!(u=(f=p.next()).done);u=!0)if(f.value.propertyName===e){r=!0;break}}catch(e){c=!0,d=e}finally{try{u||null==p.return||p.return()}finally{if(c)throw d}}}}}catch(e){a=!0,l=e}finally{try{t||null==s.return||s.return()}finally{if(a)throw l}}return r},features:r,layer:a,onChange:e=>{e<1||(f(e),g(r[e-1]))},selectedFeature:m}),(0,s.jsx)(ri.Z,(0,l._)({items:j,activeKey:v,defaultActiveKey:"0",onTabClick:e=>{y(e)}},i))]})},aO=e=>{var r=e.features,t=e.layerName,a=e.layer,n=(0,ef._)(e,["features","layerName","layer"]),i=(0,d._)((0,o.useState)(),2),u=i[0],c=i[1],f=(0,d._)((0,o.useState)(),2),p=f[0],m=f[1],g=(0,d._)((0,o.useState)([]),2),h=g[0],v=g[1],y=(0,Z.S)(),x=(0,E.useTranslation)().t,b=`selection-layer-${t}`;aT({layerName:b}),(0,o.useEffect)(()=>{if(y){var e,t=F.C.getLayerByName(y,b);t&&(null==(e=t.getSource())||e.clear(),c(1),r.length>0&&m(r[0]))}},[r,y,b]),(0,o.useEffect)(()=>{if(p&&y){var e,r,t=F.C.getLayerByName(y,b);t&&(v(Object.entries(p.getProperties()).filter(e=>(0,d._)(e,2)[1]instanceof ah()).map(e=>(0,d._)(e,1)[0])),null==(e=t.getSource())||e.clear(),null==(r=t.getSource())||r.addFeature(p))}},[p,y,b]);var j=e=>{c(e),m(r[e-1])};if(!p)return(0,s.jsx)(s.Fragment,{});var w=p.getKeys().filter(e=>!h.includes(e.toLocaleLowerCase()));return(0,s.jsx)(tk(),(0,l._)({className:"property-grid",feature:p,attributeFilter:w,size:"small",sticky:!0,title:()=>(0,s.jsx)(aM,{features:r,selectedFeature:p,current:u,layer:a,onChange:j}),columns:[{title:x("FeaturePropertyGrid.key"),dataIndex:"attributeName",key:"attributeName",width:"50%",ellipsis:!0,defaultSortOrder:"ascend",sorter:(e,r)=>e.key.localeCompare(r.key)},{title:x("FeaturePropertyGrid.value"),dataIndex:"attributeValue",key:"attributeValue",width:"50%",ellipsis:!0}],scroll:{scrollToFirstRowOnChange:!0,y:"calc(100% - 90px)"}},n))},aU=e=>{var r=(0,a._)({},(0,n._)(e)),t=(0,E.useTranslation)().t,i=(0,Z.S)(),u=(0,ea.Z)(),c=G(),f=M(),p=(0,d._)((0,o.useState)(void 0),2),m=p[0],g=p[1],h=A(e=>e.featureInfo.enabled),v=e=>{g(e)},y=e=>{if(!ej()(i))return i.getAllLayers().findIndex(r=>{if((0,H.us)(r)){var t=r.getSource(),a=x(null==t?void 0:t.getParams().LAYERS);return x(e)===a}return!1})},x=e=>e.split(":").length>1?e.split(":")[1]:e.split(":")[0];return i&&h?(0,s.jsx)("div",{className:"feature-info-panel",children:(0,s.jsx)(ak.CoordinateInfo,(0,l._)({active:h,drillDown:!0,featureCount:10,fetchOpts:e=>({headers:(0,l._)({},e.get("useBearerToken")?(0,l._)({},(0,et.a)(null==u?void 0:u.getKeycloak())):void 0)}),layerFilter:e=>!!e.getVisible()&&!!e.get("hoverable")&&(!!(e instanceof S()&&e.getSource()instanceof Q())||e instanceof C()&&e.getSource()instanceof er()),onSuccess:e=>{var r=e.features,t=(0,aL.groupBy)(r,"featureType"),a=(0,aL.mapValues)(t,e=>e.map(e=>e.feature)),n={},l=!0,i=!1,s=void 0;try{for(var o,u=Object.entries(a)[Symbol.iterator]();!(l=(o=u.next()).done);l=!0){var c=(0,d._)(o.value,2),p=c[0],m=c[1];n[p]=new(e6())().writeFeatures(m)}}catch(e){i=!0,s=e}finally{try{l||null==u.return||u.return()}finally{if(i)throw s}}var h=r.map(e=>({layerName:e.featureType,index:y(e.featureType)})).sort((e,r)=>ej()(e.index)||ej()(r.index)?0:r.index-e.index);h.length>0&&g(h[0].layerName),f((0,aF.wl)(n))},resultRenderer:e=>{if(ej()(i))return(0,s.jsx)(s.Fragment,{});var r=e.features,a=e.loading;if(0===r.length)return(0,s.jsx)("span",{className:"usage-hint",children:t("FeatureInfo.usageHint")});var n=[];return Object.entries((0,aL.groupBy)(r,"featureType")).forEach(e=>{var r=(0,d._)(e,2),t=r[0],a=r[1],l=!1,o=a.map(e=>e.feature),u=i.getAllLayers(),f=y(t);if(!ej()(f)){var p=u[f];c.forEach(e=>{var r;if((r=e.integration)&&"feature-info"===r.placement&&(Array.isArray(e.integration.layers)&&e.integration.layers.includes(t)||!e.integration.layers)){var a=e.key,i=e.wrappedComponent;n.push({label:t,index:f,key:t,children:(0,s.jsx)(i,{},a)}),l=!0}}),l||n.push({label:(null==p?void 0:p.get("name"))||t,index:f,key:t,children:(0,s.jsx)("div",{children:(null==p?void 0:p.get("featureInfoFormConfig"))?(0,s.jsx)(aA,{tabConfig:null==p?void 0:p.get("featureInfoFormConfig"),features:o,layerName:t,layer:p}):(0,s.jsx)(aO,{features:o,layerName:t,layer:p})},t)})}}),n.sort((e,r)=>r.index-e.index),(0,s.jsx)(th.Z,{spinning:a,children:(0,s.jsx)(ri.Z,{destroyInactiveTabPane:!0,items:n,activeKey:m,defaultActiveKey:n[0].key,onTabClick:v})})}},r))}):(0,s.jsx)(s.Fragment,{})},aI=t(10255),a$=t(46502),aR=t.n(a$),aG=t(43356),aV=t(85958),aB=t.n(aV),aJ=t(92766),az=t.n(aJ),aW="YYYY-MM-DD",aK=e=>{var r=e.layer,t=(0,ef._)(e,["layer"]),a=(0,d._)((0,o.useState)(),2),n=a[0],i=a[1],u=(0,d._)((0,o.useState)(),2),c=u[0],f=u[1],p=(0,d._)((0,o.useState)(),2),m=p[0],g=p[1],h=(0,o.useMemo)(()=>{if(ej()(c)||ej()(m))return[];var e=c.clone().add(m.diff(c)/2);return[{timestamp:c,markConfig:{label:c.format(aW)}},{timestamp:e,markConfig:{label:e.format(aW)}},{timestamp:m,markConfig:{label:m.format(aW),style:{left:"unset",right:0,transform:"translate(50%)"}}}]},[m,c]),v=(0,E.useTranslation)().t;return(0,o.useEffect)(()=>{var e,t=r.get("dimension");if(t&&(t.values&&(e=t.values.split(",")),e&&0!==e.length)){f(ei()(e[0])),g(ei()(e[e.length-1])),i(ei()(e[e.length-1]));var a={};if(e.forEach(e=>{a[e]=ei()(e).format("YYYY-MM-DD")}),"current"===e.default){var n=[NaN,""];Object.values(a).forEach(e=>{var r=ei()().diff(ei()(e));r<n[0]&&(n=[r,e])}),i(ei()(n[1]))}}},[r]),(0,s.jsxs)("div",{className:"wms-time-slider",children:[(0,s.jsxs)(ry.Z,{children:[(0,s.jsx)(eP.G,{icon:eT.SZw}),v("WmsTimeSlider.title")]}),h&&c&&m?(0,s.jsx)(az(),(0,l._)({defaultValue:ei()(),formatString:aW,marks:h,max:m,min:c,onChange:e=>{var t;i(e),null==(t=r.getSource())||t.updateParams({TIME:Array.isArray(e)?e[0].format(aW):e.format(aW)})},value:n},t)):(0,s.jsx)("span",{children:v("WmsTimeSlider.default")})]})},aq=e=>{var r,t=e.layer,a=e.visibleLegendsIds,n=e.setVisibleLegendsIds,u=(0,ef._)(e,["layer","visibleLegendsIds","setVisibleLegendsIds"]),m=(0,d._)((0,o.useState)(!1),2),g=m[0],h=m[1],v=(0,d._)((0,o.useState)(!1),2),y=v[0],b=v[1],w=M(),S=(0,ea.Z)(),_=(0,Z.S)(),C=ra(),L=(0,E.useTranslation)().t,k=null!=(r=t.get("downloadConfig"))?r:null,T=A(e=>e.editFeature.userEditMode),P=A(e=>e.layerTree.metadataVisible),D=()=>(0,c._)(function(){var e,r;return(0,f.Jh)(this,function(a){switch(a.label){case 0:if(!_)return[2];b(!0),a.label=1;case 1:return a.trys.push([1,3,4,5]),[4,t9.Z.getExtentForLayer(t,{headers:t.get("useBearerToken")?(0,l._)({},(0,et.a)(null==S?void 0:S.getKeycloak())):{}})];case 2:return e=a.sent(),e=(0,rz.transformExtent)(e,"EPSG:4326",_.getView().getProjection()),_.getView().fit(e,{padding:C()}),[3,5];case 3:return r=a.sent(),N.Z.error(r),p.ZP.error({message:L("LayerTreeContextMenu.extentError")}),[3,5];case 4:return b(!1),[7];case 5:return[2]}})})(),O=e=>_?U(_.getLayerGroup()).filter(r=>r.getLayers().getArray().includes(e)):[],U=e=>{var r=[e],t=!0,a=!1,n=void 0;try{for(var l,i=e.getLayers().getArray()[Symbol.iterator]();!(t=(l=i.next()).done);t=!0){var s=l.value;s instanceof j()&&r.push(...U(s))}}catch(e){a=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(a)throw n}}return r},I=e=>{O(e).forEach(r=>r.getLayers().remove(e))},$=()=>{if(_){I(t);var e=F.C.getLayerByName(_,L("AddLayerModal.externalWmsFolder")),r=F.C.getLayerByName(_,L("UploadDataModal.uploadedDataFolder"));e&&0===e.getLayers().getLength()&&I(e),r&&0===r.getLayers().getLength()&&I(r)}},R=e=>(0,c._)(function(){var r,a;return(0,f.Jh)(this,function(n){switch(n.label){case 0:if(!t)return[2];return[4,fetch(e,{method:"GET",headers:(0,l._)({},t.get("useBearerToken")?(0,l._)({},(0,et.a)(null==S?void 0:S.getKeycloak())):void 0)})];case 1:return[4,n.sent().blob()];case 2:return r=n.sent(),(a=document.createElement("a")).href=URL.createObjectURL(r),a.setAttribute("download",t.get("name")),a.click(),[2]}})})(),G=[];if((0,H.us)(t)&&G.push({label:(0,s.jsx)(th.Z,{spinning:y,children:L("LayerTreeContextMenu.layerZoomToExtent")}),key:"zoomToExtent"}),(0,H.us)(t)&&t.getVisible()){var V=a.includes((0,x.getUid)(t));G.push({label:V?L("LayerTreeContextMenu.hideLegend"):L("LayerTreeContextMenu.showLegend"),key:"toggleLegend"})}if((t.get("isExternalLayer")||t.get("isUploadedLayer"))&&G.push({label:L("LayerTreeContextMenu.removeLayer"),key:"removeExternal"}),k){var B=k.map(e=>{var r;return{label:L("LayerTreeContextMenu.downloadLayer",{formatName:null!=(r=e.formatName)?r:"XML"}),key:`downloadLayer|${encodeURI(e.downloadUrl)}`}});G.push(...B)}return t.get("editable")&&(T.includes("CREATE")||T.includes("UPDATE")||T.includes("DELETE"))&&G.push({label:L("LayerTreeContextMenu.editLayer"),key:"editLayer"}),P&&G.push({label:L("LayerTreeContextMenu.layerDetails"),key:"layerDetails"}),(0,s.jsx)("div",{"aria-label":"layer-context",children:(0,s.jsx)(r1.Z,(0,i._)((0,l._)({menu:{items:G,onClick:e=>{switch((null==e?void 0:e.key.startsWith("downloadLayer"))&&R(decodeURI(e.key.split("|")[1])),null==e?void 0:e.key){case"zoomToExtent":D();break;case"removeExternal":$();break;case"toggleLegend":var r=(0,x.getUid)(t),l=[...a];l.includes(r)?l.splice(l.indexOf(r),1):l.push(r),n(l);break;case"editLayer":w((0,e_.hr)(null)),w((0,e_.vN)((0,x.getUid)(t))),w((0,eY.$Z)());break;case"layerDetails":w((0,tg.uF)((0,x.getUid)(t))),w((0,tg.$Z)())}h(!1)}},placement:"bottomLeft",onOpenChange:h,open:g,trigger:["click"]},u),{children:(0,s.jsx)(eP.G,{icon:eT.iV1})}))})},aY=()=>(0,s.jsxs)("div",{className:"layer-node-title-loading-animation",children:[(0,s.jsx)("span",{className:"dot-one",children:"."}),(0,s.jsx)("span",{className:"dot-two",children:"."}),(0,s.jsx)("span",{className:"dot-three",children:"."})]}),aH=e=>{var r,t,i=(0,a._)({},(0,n._)(e)),u=(0,Z.S)(),c=(0,ea.Z)(),f=(0,E.useTranslation)().t,p=null==u?void 0:u.getAllLayers().map(e=>(0,x.getUid)(e)),m=null!=(r=A(e=>e.layerTree.showLegends))&&r,g=null!=(t=A(e=>e.layerTree.layerIconsVisible))&&t,h=(0,d._)((0,o.useState)(m&&null!=p?p:[]),2),v=h[0],y=h[1],b=(0,d._)((0,o.useState)({}),2),w=b[0],_=b[1],N=(0,d._)((0,o.useState)(),2),L=N[0],k=N[1],T=(0,o.useCallback)(()=>{u&&F.C.getAllLayers(u).forEach(e=>{if(e instanceof tm()){var r=e.getSource();r instanceof er()&&(r.hasListener("tileloadstart")||r.on("tileloadstart",U),r.hasListener("tileloadend")||r.hasListener("tileloaderror")||r.on(["tileloadend","tileloaderror"],I)),r instanceof Q()&&(r.hasListener("imageloadstart")||r.on("imageloadstart",U),r.hasListener("imageloadend")||r.hasListener("imageloaderror")||r.on(["imageloadend","imageloaderror"],I))}})},[u]),P=(0,o.useCallback)(()=>{var e=null==u?void 0:u.getAllLayers().map(e=>(0,x.getUid)(e));(null==e?void 0:e.length)!==(null==p?void 0:p.length)&&T()},[u,p,T]),D=(0,o.useMemo)(()=>({SCALE:L,LEGEND_OPTIONS:"fontAntiAliasing:true;forceLabels:on",TRANSPARENT:!0}),[L]),M=(0,o.useMemo)(()=>(0,l._)({},(0,et.a)(null==c?void 0:c.getKeycloak())),[c]),O=(0,o.useCallback)(e=>{var r=e.map.getView(),t=r.getProjection().getUnits()||"m",a=r.getResolution();k(a?F.C.getScaleForResolution(a,t):void 0)},[]);(0,o.useEffect)(()=>{if(u)return O(new aI.Z("moveend",u)),u.on("moveend",O),()=>{u.un("moveend",O)}},[u,O]),(0,o.useEffect)(()=>{if(u)return T(),u.getLayers().on("change",P),()=>{F.C.getAllLayers(u).forEach(e=>{if(e instanceof tm()){var r=e.getSource();r.hasListener("tileloadstart")&&r.un("tileloadstart",U),r.hasListener("tileloadend")&&r.un("tileloadend",I),r.hasListener("tileloaderror")&&r.un("tileloaderror",I)}}),u.getLayers().un("change",P)}},[u,T,P]);var U=e=>{_(r=>{var t=(0,x.getUid)(e.target),a=structuredClone(r);return a[t]&&a[t].loaded>=a[t].loading?(a[t].loading=1,a[t].loaded=0,a[t].percent=0):(a[t]||(a[t]={loading:0,loaded:0,percent:0}),a[t].loading=Number.isInteger(a[t].loading)?a[t].loading+1:1),a})},I=e=>{_(r=>{var t=(0,x.getUid)(e.target),a=structuredClone(r);a[t]||(a[t]={loading:0,loaded:0,percent:0}),a[t].loaded=Number.isInteger(a[t].loaded)?a[t].loaded+1:1;var n=Math.round(a[t].loaded/a[t].loading*100);return n>a[t].percent&&(a[t].percent=n),a})};return u?(0,s.jsx)(aR(),(0,l._)({"aria-label":"layertree",className:"layertree",nodeTitleRenderer:e=>{if(u){var r,t=e instanceof tm()&&(0,x.getUid)(e.getSource())?null==(r=w[(0,x.getUid)(e.getSource())])?void 0:r.percent:100;return e instanceof j()?(0,s.jsx)("div",{"aria-label":"layer-group",children:e.get("name")}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"tree-node-header","aria-label":"tree-node-header",children:[(0,s.jsxs)("span",{"aria-label":"layer-name",className:"layer-name",children:[e.get("name"),(0,s.jsx)("span",{className:"loading-dots",children:t<100&&(0,s.jsx)(aY,{})}),(0,s.jsxs)("span",{className:"layer-icons-group",children:[e.get("searchable")&&g&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(rx.Z,{title:f("ToolMenu.searchable"),children:(0,s.jsx)(eP.G,{icon:eT.Y$T,className:"layer-icon"})})}),e.get("hoverable")&&e.get("visible")&&g&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(rx.Z,{title:f("ToolMenu.queryable"),children:(0,s.jsx)(eP.G,{icon:eT.DBf,className:"layer-icon"})})}),e.get("editable")&&g&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(rx.Z,{title:f("ToolMenu.editable"),children:(0,s.jsx)(eP.G,{icon:eT.IwR,className:"layer-icon"})})})]})]}),(e instanceof C()||e instanceof S())&&(0,s.jsx)("div",{"aria-label":"layer-context-menu",children:(0,s.jsx)(aq,{layer:e,visibleLegendsIds:v,setVisibleLegendsIds:y})})]}),e.get("visible")&&(0,s.jsx)("div",{className:"layer-transparency",role:"button","aria-label":"transparency-slider",tabIndex:0,onClick:e=>e.stopPropagation(),onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),e.stopPropagation())},onDragStart:e=>{e.stopPropagation(),e.preventDefault()},draggable:!0,children:(0,s.jsx)(aB(),{tooltip:{formatter:e=>`${f("LayerTree.transparency")}: ${e}%`},layer:e})}),e.get("visible")&&"WMSTIME"===e.get("type")&&(0,s.jsx)("div",{className:"layer-time-slider",children:(0,s.jsx)(aK,{layer:e})}),e.get("visible")&&(0,H.us)(e)&&v.includes((0,x.getUid)(e))&&(0,s.jsx)(aG.Legend,{layer:e,errorMsg:f("LayerTree.noLegendAvailable"),extraParams:D,headers:e.get("useBearerToken")?M:void 0})]})}},filterFunction:e=>e instanceof j()||!(e instanceof tC())||!ej()(e.get("shogunId")),draggable:!0},i)):(0,s.jsx)(s.Fragment,{})},aX=t(27361),aQ=t.n(aX),a0=t(44126),a1=t.n(a0),a2=t(52746),a3=e=>{var r=e.showMeasureDistance,t=e.showMeasureArea,a=(0,E.useTranslation)().t,n=(0,Z.S)(),l=(0,o.useMemo)(()=>{if(ej()(n))return!0;var e=a1().Proj(n.getView().getProjection().getCode()),r=aQ()(e,"projName");return e4()(r)||"longlat"===r||"geocent"===r},[n]),i=(0,d._)((0,o.useState)(),2),u=i[0],c=i[1];return n?(0,s.jsxs)(rr.ToggleGroup,{className:"measure-tools",selected:u,onChange:(e,r)=>{c(r)},children:[r?(0,s.jsxs)(a2.MeasureButton,{geodesic:l,value:"line",measureType:"line",type:"link",continueLineMsg:a("Measure.clicktodrawline"),children:[(0,s.jsx)(eP.G,{icon:eT.SoD}),(0,s.jsx)("span",{className:"measure-text",children:a("Measure.line")})]}):(0,s.jsx)(s.Fragment,{}),t?(0,s.jsxs)(a2.MeasureButton,{geodesic:l,value:"poly",measureType:"polygon",type:"link",continuePolygonMsg:a("Measure.clicktodrawarea"),children:[(0,s.jsx)(eP.G,{icon:eT.ubJ}),(0,s.jsx)("span",{className:"measure-text",children:a("Measure.area")})]}):(0,s.jsx)(s.Fragment,{})]}):(0,s.jsx)(s.Fragment,{})},a4=e=>{var r,t=e.collapseWidth,a=void 0===t?40:t,n=e.minWidth,u=void 0===n?240:n,c=e.maxWidth,f=void 0===c?600:c,p=(0,ef._)(e,["collapseWidth","minWidth","maxWidth"]),m=(0,E.useTranslation)().t,g=(0,Z.S)(),h=G(),v=M(),y=A(e=>e.toolMenu.availableTools),x=A(e=>e.toolMenu.activeKeys),b=A(e=>e.toolMenu.maxHeight),j=(0,ea.Z)(),w=null==j?void 0:j.getKeycloak(),S=(0,d._)((0,o.useState)(!1),2),_=S[0],C=S[1],N=(0,d._)((0,o.useState)([]),2),L=N[0],k=N[1],F=(0,d._)((0,o.useState)(!1),2),T=F[0],P=F[1],D=(0,d._)((0,o.useState)(320),2),U=D[0],I=D[1],$=(0,d._)((0,o.useState)(U),2),R=$[0],V=$[1];(0,o.useEffect)(()=>{var e=window.matchMedia("only screen and (max-width: 450px) and (orientation: portrait),only screen and (max-width: 750px) and (orientation: landscape), only screen and (max-width: 580px)"),r=RegExp("/Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile|Kindle|NetFront|Silk-Accelerated|(hpw|web)OS|Fennec|Minimo|Opera M(obi|ini)|Blazer|Dolfin|Dolphin|Skyfire|Zune/");(e.matches||r.test(window.navigator.userAgent))&&(C(!0),I(a))},[a]),(0,o.useEffect)(()=>{L.length<1&&(y.includes("default")?k(["measure_tools","draw_tools","feature_info","print","tree","permalink","language_selector"]):k(y))},[L,y]),(0,o.useEffect)(()=>{var e=["print","measure_tools","draw_tools","feature_info","tree"];if(e.filter(e=>x.includes(e)).length>1){var r=x.slice(0,x.length-1).reverse().find(r=>e.includes(r));r&&v((0,tV.wG)(x.filter(e=>e!==r)))}v((0,tR.$f)(x.includes("feature_info"))),v((0,tG.cm)(x.includes("tree")))},[x,v]);var B=A(e=>e.layerTree.activeUploadTools),J=e=>{switch(e){case"measure_tools":return{icon:eT.KxN,title:m("ToolMenu.measure"),wrappedComponent:(0,s.jsx)(a3,{showMeasureDistance:y.includes("default")||y.includes("measure_tools_distance"),showMeasureArea:y.includes("default")||y.includes("measure_tools_area")})};case"draw_tools":return{icon:eT.q2v,title:m("ToolMenu.draw"),wrappedComponent:(0,s.jsx)(aN,{showDrawPoint:y.includes("default")||y.includes("draw_tools_point"),showDrawLine:y.includes("default")||y.includes("draw_tools_line"),showDrawPolygon:y.includes("default")||y.includes("draw_tools_polygon"),showDrawCircle:y.includes("default")||y.includes("draw_tools_circle"),showDrawRectangle:y.includes("default")||y.includes("draw_tools_rectangle"),showDrawAnnotation:y.includes("default")||y.includes("draw_tools_annotation"),showModifyFeatures:y.includes("default")||y.includes("draw_tools_modify"),showUploadFeatures:y.includes("default")||y.includes("draw_tools_upload"),showDownloadFeatures:y.includes("default")||y.includes("draw_tools_download"),showDeleteFeatures:y.includes("default")||y.includes("draw_tools_delete"),showStyleFeatures:y.includes("default")||y.includes("draw_tools_style")})};case"feature_info":return{icon:eT.DBf,title:m("ToolMenu.featureInfo"),wrappedComponent:(0,s.jsx)(aU,{})};case"print":return{icon:eT.kwI,title:m("ToolMenu.print"),wrappedComponent:g?(0,s.jsx)(af,{active:x.includes("print"),layerBlackList:["react-geo_measure","hoverVectorLayer"]}):(0,s.jsx)(s.Fragment,{})};case"tree":var r,t,a;return{icon:eT.aC2,title:m("ToolMenu.layertree"),wrappedComponent:(0,s.jsxs)("div",{className:"tree-wrapper",children:[(0,s.jsx)(aH,{}),(null==B?void 0:B.includes(tG.Sv.addWMS))&&(0,s.jsx)(eL.ZP,{className:"add-wms-button tool-menu-button",icon:(0,s.jsx)(eP.G,{icon:eT.r8p}),onClick:()=>v((0,O.$Z)()),children:m("ToolMenu.addWms")}),w&&(null==(a=K().geoserver)||null==(t=a.upload)||null==(r=t.authorizedRoles)?void 0:r.some(e=>w.hasResourceRole(e,w.clientId)))&&(null==B?void 0:B.includes(tG.Sv.dataUpload))&&(0,s.jsx)(eL.ZP,{className:"upload-data-button tool-menu-button",icon:(0,s.jsx)(eP.G,{icon:eT.cf$}),onClick:()=>v((0,tB.$Z)()),children:m("ToolMenu.uploadData")})]})};case"permalink":return{icon:eT.M6U,title:m("Permalink.title"),wrappedComponent:(0,s.jsx)(t2,{})};case"language_selector":return{icon:eT.BCn,title:m("ToolMenu.languageSelect"),wrappedComponent:(0,s.jsx)(tW,{})}}},z=(0,o.useCallback)(()=>{P(!0)},[]),W=(0,o.useCallback)(()=>{P(!1)},[]),q=(0,o.useCallback)(e=>{if(T&&!_){var r=e.clientX-document.body.offsetLeft;r>u&&r<f&&(I(r),V(r))}},[T,_,u,f]);return(0,o.useEffect)(()=>(document.addEventListener("mousemove",q),document.addEventListener("mouseup",W),()=>{document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",W)}),[q,W]),(0,s.jsxs)("div",{"aria-label":"tool-menu",className:`tool-menu ${_?"collapsed":""}`,style:{width:U,maxHeight:null!=b?b:"100%"},children:[(0,s.jsx)(tU.Z,(0,l._)({expandIconPosition:"end",activeKey:x,destroyOnHidden:!0,onChange:e=>{C(!1),v((0,tV.wG)(t$()(e))),_&&I(R)},items:(r=[],L.forEach(e=>{var t=J(e);if(t){var a=t.icon,n=t.title,l=t.wrappedComponent;r.push({key:e,label:(0,s.jsxs)(s.Fragment,{children:[a?(0,s.jsx)(eP.G,{icon:a}):void 0,(0,s.jsx)("span",{children:n})]}),children:l})}}),h&&h.forEach(e=>{var t;if((t=e.integration)&&"tool-menu"===t.placement){var a=e.key,n=e.wrappedComponent,o=e.integration,u=o.label,c=o.insertionIndex,d=o.icon,f=(0,ef._)(e.integration,["label","insertionIndex","icon"]),p=(0,i._)((0,l._)({key:a,label:(0,s.jsxs)(s.Fragment,{children:[d?(0,s.jsx)(eP.G,{icon:d}):void 0,(0,s.jsx)("span",{children:m(void 0===u?"Plugin":u)})]})},f),{children:(0,s.jsx)(n,{})});r.splice(null!=c?c:0,0,p)}}),r)},p)),(0,s.jsx)(rx.Z,{placement:"right",title:_?m("ToolMenu.expand"):m("ToolMenu.collapse"),children:(0,s.jsx)(eL.ZP,{className:"collapse-btn","aria-label":"collapse-button",icon:_?(0,s.jsx)(eP.G,{icon:eT._tD}):(0,s.jsx)(eP.G,{icon:eT.A35}),onClick:()=>{v((0,tV.wG)([])),C(!_),_?I(R):I(a)}})}),_?(0,s.jsx)(s.Fragment,{}):(0,s.jsx)("div",{className:"dynamicWidth",role:"button",tabIndex:0,onMouseDown:z,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),z())}})]})},a5=t(28837),a6=t(47613),a8=eN.Z.Dragger,a7=e=>{var r=(0,a._)({},(0,n._)(e)),t=(0,d._)((0,o.useState)(""),2),u=t[0],p=t[1],g=(0,d._)((0,o.useState)(""),2),h=g[0],v=g[1],y=(0,d._)((0,o.useState)(!1),2),x=y[0],b=y[1],w=A(e=>e.uploadDataModal.visible),S=A(e=>e.user),_=M(),C=(0,Z.S)(),L=(0,ea.Z)(),k=(0,E.useTranslation)().t,T=e=>{if(C){var r=k("UploadDataModal.uploadedDataFolder"),t=F.C.getLayerByName(C,r);if(!t){t=new(j())({layers:[],properties:{name:r}});var a=C.getLayerGroup().getLayers();a.insertAt((null==a?void 0:a.getLength())||0,t)}t.getLayers().getArray().includes(e)||t.getLayers().push(e)}},P=e=>(0,c._)(function(){var r,t,a,n,s,o;return(0,f.Jh)(this,function(u){switch(u.label){case 0:return t=e.baseUrl,a=e.workspace,n=e.storeName,s=e.layerName,o=e.file,[4,fetch(`${t}/rest/workspaces/${a}/coveragestores/${n}/file.geotiff?configure=none`,{method:"PUT",headers:(0,i._)((0,l._)({},(0,et.a)(null==L?void 0:L.getKeycloak())),{"Content-Type":"image/tiff"}),body:o})];case 1:if(!u.sent().ok)throw Error(k("UploadDataModal.error.general",{fileName:o.name}));return[4,fetch(`${t}/rest/workspaces/${a}/coveragestores/${n}/coverages`,{method:"POST",headers:(0,i._)((0,l._)({},(0,et.a)(null==L?void 0:L.getKeycloak())),{"Content-Type":"application/json"}),body:JSON.stringify({coverage:{enabled:!0,name:s,nativeName:s,title:s,keywords:{string:["User upload",`Uploaded by ${null==(r=S.providerDetails)?void 0:r.username}`]}}})})];case 2:if(!u.sent().ok)throw Error(k("UploadDataModal.error.general",{fileName:o.name}));return[2]}})})(),D=e=>(0,c._)(function(){var r,t,a,n,s,o,u,c,p;return(0,f.Jh)(this,function(f){switch(f.label){case 0:return t=e.baseUrl,a=e.workspace,n=e.storeName,s=e.layerName,o=e.file,[4,a5.Shapefile.load(o)];case 1:if(u=f.sent(),c="",p={attribute:[]},1!==Object.entries(u).length)throw Error(k("UploadDataModal.error.zipContent"));return Object.entries(u).forEach(e=>{var r=(0,d._)(e,2),t=r[0],a=r[1];c=t;var n=a.parse("dbf",{properties:!1});p.attribute=n.fields.map(e=>({name:e.name,minOccurs:0,maxOccurs:1,nillable:!0,binding:U(e.type),length:e.length}));var l=a.parse("shx");p.attribute.push({name:"the_geom",minOccurs:0,maxOccurs:1,nillable:!0,binding:O(l.header.type)})}),[4,fetch(`${t}/rest/workspaces/${a}/datastores/${n}/file.shp?configure=none`,{method:"PUT",headers:(0,i._)((0,l._)({},(0,et.a)(null==L?void 0:L.getKeycloak())),{"Content-Type":"application/zip"}),body:o})];case 2:if(!f.sent().ok)throw Error(k("UploadDataModal.error.general",{fileName:o.name}));return[4,fetch(`${t}/rest/workspaces/${a}/datastores/${n}/featuretypes`,{method:"POST",headers:(0,i._)((0,l._)({},(0,et.a)(null==L?void 0:L.getKeycloak())),{"Content-Type":"application/json"}),body:JSON.stringify({featureType:{enabled:!0,name:s,nativeName:c,title:s,attributes:p,keywords:{string:["User upload",`Uploaded by ${null==(r=S.providerDetails)?void 0:r.username}`]}}})})];case 3:if(!f.sent().ok)throw Error(k("UploadDataModal.error.general",{fileName:o.name}));return[2]}})})(),O=e=>({0:null,1:"org.locationtech.jts.geom.Point",3:"org.locationtech.jts.geom.LineString",5:"org.locationtech.jts.geom.Polygon",8:"org.locationtech.jts.geom.MultiPoint",11:"org.locationtech.jts.geom.Point",13:"org.locationtech.jts.geom.LineString",15:"org.locationtech.jts.geom.Polygon",18:"org.locationtech.jts.geom.MultiPoint",21:"org.locationtech.jts.geom.Point",23:"org.locationtech.jts.geom.LineString",25:"org.locationtech.jts.geom.Polygon",28:"org.locationtech.jts.geom.MultiPoint",31:null})[e],U=e=>{switch(e){case"C":return"java.lang.String";case"D":return"java.util.Date";case"N":return"java.lang.Long";case"F":return"java.lang.Double";case"L":return"java.lang.Boolean";default:return null}};return(0,s.jsxs)(m.Z,(0,i._)((0,l._)({className:"upload-data-modal",title:k("UploadDataModal.title"),open:w,onCancel:()=>{p(""),v(""),_((0,tB.Cp)())},width:600,footer:!1},r),{children:[h&&(0,s.jsx)(z.Z,{message:h,closable:!0,type:"success"}),u&&(0,s.jsx)(z.Z,{message:u,closable:!0,type:"error"}),(0,s.jsx)(th.Z,{spinning:x,children:(0,s.jsxs)(a8,{customRequest:e=>(0,c._)(function(){var r,t,a,n,l,i,s,o,u,c,d,p,m,g,h;return(0,f.Jh)(this,function(f){switch(f.label){case 0:n=e.onError,l=e.onSuccess,s=(i=e.file).name.split("."),o=i.type,c=null!=(u=null==(r=K().geoserver)?void 0:r.base)?u:"/geoserver",p=null!=(d=null==(a=K().geoserver)||null==(t=a.upload)?void 0:t.workspace)?d:"SHOGUN",m=`${s[0]}_${Date.now()}`.toUpperCase(),g={file:i,baseUrl:c,workspace:p,storeName:m,layerName:m},f.label=1;case 1:if(f.trys.push([1,6,,7]),"image/tiff"!==o)return[3,3];return[4,P(g)];case 2:f.sent(),f.label=3;case 3:if("application/zip"!==o)return[3,5];return[4,D(g)];case 4:f.sent(),f.label=5;case 5:return l&&l({baseUrl:c,workspace:p,layerName:m}),[3,7];case 6:return h=f.sent(),n&&n({name:"UploadError",message:h instanceof Error?h.message:k("UploadDataModal.error.general",{fileName:i.name})}),[3,7];case 7:return[2]}})})(),accept:"image/tiff,application/zip",maxCount:1,showUploadList:!1,beforeUpload:e=>{var r,t,a,n=null!=(a=null==(t=K().geoserver)||null==(r=t.upload)?void 0:r.limit)?a:2e8,l=e.type,i=e.size;if(p(""),v(""),i>n)return p(k("UploadDataModal.error.maxSize",{maxSize:n/1e6})),!1;var s=["application/zip","image/tiff"];return!!s.includes(l)||(p(k("UploadDataModal.error.supportedFormats",{supportedFormats:s.join(", ")})),!1)},onChange:e=>(0,c._)(function(){var r,t,a;return(0,f.Jh)(this,function(n){if("uploading"===(r=e.file).status&&b(!0),"done"===r.status){if(!L||!r.response)return[2];t={name:r.response.layerName,type:"TILEWMS",clientConfig:{hoverable:!0},sourceConfig:{url:`${r.response.baseUrl}/ows?`,layerNames:`${r.response.workspace}:${r.response.layerName}`,useBearerToken:!0}},(a=new a6.Z({client:L}).parseTileLayer(t)).set("layerConfig",t),a.set("isUploadedLayer",!0),a.set("groupName",k("UploadDataModal.uploadedDataFolder")),T(a),v(k("UploadDataModal.success",{fileName:r.name,layerName:r.response.layerName})),b(!1)}else"error"===r.status&&(b(!1),N.Z.error(r.error),r.error&&r.error.message?p(r.error.message):p(k("UploadDataModal.error.general",{fileName:r.name})));return[2]})})(),children:[(0,s.jsx)("p",{className:"ant-upload-drag-icon",children:(0,s.jsx)(eP.G,{icon:eT.cf$})}),(0,s.jsx)("p",{className:"ant-upload-text",children:k("UploadDataModal.description")}),(0,s.jsx)("p",{className:"ant-upload-hint",children:k("UploadDataModal.hint")})]})})]}))},a9=()=>(0,c._)(function(){var e,r,t,a,n,l,i,s,o,c,d,p,m,g,h,v,y,x,b;return(0,f.Jh)(this,function(w){switch(w.label){case 0:var _;if(e=(0,Z.S)(),r=(0,ea.Z)(),_=window.location.search,t=u().useMemo(()=>new URLSearchParams(_),[_]),a=(0,E.useTranslation)().t,n=t.get("layers"),!e||(l=e=>e.get("name"),i=e=>e instanceof C()||e instanceof S(),!(s=t1.k.applyLink(e,";",l,i))))return[2];o=r=>{var t=new(j())({layers:[]});t.set("name",r);var a=e.getLayerGroup().getLayers();return a.insertAt((null==a?void 0:a.getLength())||0,t),t},w.label=1;case 1:if(w.trys.push([1,10,,11]),c=JSON.parse(s),!r)throw Error("Client is not available");d=new a6.Z({client:r}),p=!0,m=!1,g=void 0,w.label=2;case 2:w.trys.push([2,7,8,9]),h=function(){var r,t,l,i,s;return(0,f.Jh)(this,function(u){switch(u.label){case 0:if(r=y.value,e4()(null==r?void 0:r.layerConfig))return[3,2];return t=r.layerConfig,[4,d.parseLayer(t)];case 1:if(!(l=u.sent())||(r.isExternalLayer&&l.set("isExternalLayer",r.isExternalLayer),r.isUploadedLayer&&l.set("isUploadedLayer",r.isUploadedLayer),l.set("groupName",r.groupName),l.set("layerConfig",r.layerConfig),l.setVisible(!!(null==n?void 0:n.split(";").some(e=>e===t.name))),!(l.get("isExternalLayer")||l.get("isUploadedLayer"))))return[2,"continue"];i=void 0,l.get("groupName")?(i=F.C.getLayerByName(e,l.get("groupName")))||(i=o(l.get("groupName"))):(i=null==(s=F.C.getLayersByProperty(e,"isExternalLayerGroup",!0))?void 0:s[0])||(i=o(a("AddLayerModal.externalWmsFolder"))).set("isExternalLayerGroup",!0),F.C.getLayerByName(e,l.get("name"))||i.getLayers().push(l),u.label=2;case 2:return[2]}})},v=c[Symbol.iterator](),w.label=3;case 3:if(p=(y=v.next()).done)return[3,6];return[5,(0,f.XA)(h())];case 4:w.sent(),w.label=5;case 5:return p=!0,[3,3];case 6:return[3,9];case 7:return x=w.sent(),m=!0,g=x,[3,9];case 8:try{p||null==v.return||v.return()}finally{if(m)throw g}return[7];case 9:return[3,11];case 10:return b=w.sent(),N.Z.error(b),[3,11];case 11:return[2]}})})(),ne=e=>{var r=(0,a._)({},(0,n._)(e));return a9(),(0,o.useEffect)(()=>{var e=document.querySelectorAll(".loadmask")[0];e&&e.classList.add("loadmask-hidden")},[]),(0,s.jsxs)("div",(0,i._)((0,l._)({className:"App"},r),{children:[(0,s.jsx)(td,{}),(0,s.jsx)(V,{}),(0,s.jsx)(a4,{}),(0,s.jsx)(tS,{}),(0,s.jsx)(rF,{}),(0,s.jsx)(J,{}),(0,s.jsx)(U,{}),(0,s.jsx)(a7,{}),(0,s.jsx)(rv,{}),(0,s.jsx)(tx,{}),(0,s.jsx)(tO,{}),(0,s.jsx)(tP,{})]}))},nr=ne},10562:function(){},96281:function(){}}]);
//# sourceMappingURL=4445.0c8d80b3e4b1343b.js.map