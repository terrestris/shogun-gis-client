{"version":3,"file":"8065.d94ca5c03906cfee.js","sources":["webpack://@terrestris/shogun-gis-client/./node_modules/ol/proj/proj4.js"],"sourcesContent":["/**\n * @module ol/proj/proj4\n */\nimport {\n  addCoordinateTransforms,\n  addEquivalentProjections,\n  addProjection,\n  createSafeCoordinateTransform,\n} from '../proj.js';\nimport Projection from './Projection.js';\nimport {get as getCachedProjection} from './projections.js';\nimport {get as getTransform} from './transforms.js';\n\n/**\n * @type {import(\"proj4\")|null}\n */\nlet registered = null;\n\n/**\n * @return {boolean} Proj4 has been registered.\n */\nexport function isRegistered() {\n  return !!registered;\n}\n\n/**\n * Unsets the shared proj4 previously set with register.\n */\nexport function unregister() {\n  registered = null;\n}\n\n/**\n * Make projections defined in proj4 (with `proj4.defs()`) available in\n * OpenLayers. Requires proj4 >= 2.8.0.\n *\n * This function should be called whenever changes are made to the proj4\n * registry, e.g. after calling `proj4.defs()`. Existing transforms will not be\n * modified by this function.\n *\n * @param {import(\"proj4\")} proj4 Proj4.\n * @api\n */\nexport function register(proj4) {\n  registered = proj4;\n\n  const projCodes = Object.keys(proj4.defs);\n  const len = projCodes.length;\n  let i, j;\n  for (i = 0; i < len; ++i) {\n    const code = projCodes[i];\n    if (!getCachedProjection(code)) {\n      const def = proj4.defs(code);\n      let units = /** @type {import(\"./Units.js\").Units} */ (def.units);\n      if (!units && def.projName === 'longlat') {\n        units = 'degrees';\n      }\n      addProjection(\n        new Projection({\n          code: code,\n          axisOrientation: def.axis,\n          metersPerUnit: def.to_meter,\n          units,\n        }),\n      );\n    }\n  }\n  for (i = 0; i < len; ++i) {\n    const code1 = projCodes[i];\n    const proj1 = getCachedProjection(code1);\n    for (j = 0; j < len; ++j) {\n      const code2 = projCodes[j];\n      const proj2 = getCachedProjection(code2);\n      if (!getTransform(code1, code2)) {\n        if (proj4.defs[code1] === proj4.defs[code2]) {\n          addEquivalentProjections([proj1, proj2]);\n        } else {\n          const transform = proj4(code1, code2);\n          addCoordinateTransforms(\n            proj1,\n            proj2,\n            createSafeCoordinateTransform(proj1, proj2, transform.forward),\n            createSafeCoordinateTransform(proj2, proj1, transform.inverse),\n          );\n        }\n      }\n    }\n  }\n}\n\n/**\n * @param {number} code The EPSG code.\n * @return {Promise<string>} The proj4 definition.\n */\nlet epsgLookup = async function (code) {\n  const response = await fetch(`https://epsg.io/${code}.proj4`);\n  if (!response.ok) {\n    throw new Error(`Unexpected response from epsg.io: ${response.status}`);\n  }\n  return response.text();\n};\n\n/**\n * Set the lookup function for getting proj4 definitions given an EPSG code.\n * By default, the {@link module:ol/proj/proj4.fromEPSGCode} function uses the\n * epsg.io website for proj4 definitions.  This can be changed by providing a\n * different lookup function.\n *\n * @param {function(number):Promise<string>} func The lookup function.\n * @api\n */\nexport function setEPSGLookup(func) {\n  epsgLookup = func;\n}\n\n/**\n * Get the current EPSG lookup function.\n *\n * @return {function(number):Promise<string>} The EPSG lookup function.\n */\nexport function getEPSGLookup() {\n  return epsgLookup;\n}\n\n/**\n * Get a projection from an EPSG code.  This function fetches the projection\n * definition from the epsg.io website, registers this definition for use with\n * proj4, and returns a configured projection.  You must call import proj4 and\n * call {@link module:ol/proj/proj4.register} before using this function.\n *\n * If the projection definition is already registered with proj4, it will not\n * be fetched again (so it is ok to call this function multiple times with the\n * same code).\n *\n * @param {number|string} code The EPSG code (e.g. 4326 or 'EPSG:4326').\n * @return {Promise<Projection>} The projection.\n * @api\n */\nexport async function fromEPSGCode(code) {\n  if (typeof code === 'string') {\n    code = parseInt(code.split(':').pop(), 10);\n  }\n\n  const proj4 = registered;\n  if (!proj4) {\n    throw new Error('Proj4 must be registered first with register(proj4)');\n  }\n\n  const epsgCode = 'EPSG:' + code;\n  if (proj4.defs(epsgCode)) {\n    return getCachedProjection(epsgCode);\n  }\n\n  proj4.defs(epsgCode, await epsgLookup(code));\n  register(proj4);\n\n  return getCachedProjection(epsgCode);\n}\n\n/**\n * Generate an EPSG lookup function which uses the MapTiler Coordinates API to find projection\n * definitions which do not require proj4 to be configured to handle `+nadgrids` parameters.\n * Call {@link module:ol/proj/proj4.setEPSGLookup} use the function for lookups\n * `setEPSGLookup(epsgLookupMapTiler('{YOUR_MAPTILER_API_KEY_HERE}'))`.\n *\n * @param {string} key MapTiler API key.  Get your own API key at https://www.maptiler.com/cloud/.\n * @return {function(number):Promise<string>} The EPSG lookup function.\n * @api\n */\nexport function epsgLookupMapTiler(key) {\n  return async function (code) {\n    const response = await fetch(\n      `https://api.maptiler.com/coordinates/search/code:${code}.json?transformations=true&exports=true&key=${key}`,\n    );\n    if (!response.ok) {\n      throw new Error(\n        `Unexpected response from maptiler.com: ${response.status}`,\n      );\n    }\n    return response.json().then((json) => {\n      const results = json['results'];\n      if (results?.length > 0) {\n        const result = results.filter(\n          (r) =>\n            r['id']?.['authority'] === 'EPSG' && r['id']?.['code'] === code,\n        )[0];\n        if (result) {\n          const transforms = result['transformations'];\n          if (transforms?.length > 0) {\n            // use default transform if it does not require grids\n            const defaultTransform = result['default_transformation'];\n            if (\n              transforms.filter(\n                (t) =>\n                  t['id']?.['authority'] === defaultTransform?.['authority'] &&\n                  t['id']?.['code'] === defaultTransform?.['code'] &&\n                  t['grids']?.length === 0,\n              ).length > 0\n            ) {\n              return result['exports']?.['proj4'];\n            }\n            // otherwise use most accurate alternative without grids\n            const transform = transforms\n              .filter(\n                (t) =>\n                  t['grids']?.length === 0 &&\n                  t['target_crs']?.['authority'] === 'EPSG' &&\n                  t['target_crs']?.['code'] === 4326 &&\n                  t['deprecated'] === false &&\n                  t['usable'] === true,\n              )\n              .sort((t1, t2) => t1['accuracy'] - t2['accuracy'])[0]?.[\n              'exports'\n            ]?.['proj4'];\n            if (transform) {\n              return transform;\n            }\n          }\n          // fallback to default\n          return result['exports']?.['proj4'];\n        }\n      }\n    });\n  };\n}\n"],"names":["registered","isRegistered","unregister","register","proj4","i","j","projCodes","Object","len","code","def","units","code1","proj1","code2","proj2","transform","epsgLookup","response","fetch","Error","setEPSGLookup","func","getEPSGLookup","fromEPSGCode","parseInt","epsgCode","epsgLookupMapTiler","key","json","results","result","r","transforms","defaultTransform","t","t1","t2"],"mappings":"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"}