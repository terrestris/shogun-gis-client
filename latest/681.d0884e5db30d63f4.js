(self.webpackChunk_terrestris_shogun_gis_client=self.webpackChunk_terrestris_shogun_gis_client||[]).push([["681"],{10562:function(){},26058:function(e,r,t){var a={"./af":"42786","./af.js":"42786","./ar":"30867","./ar-dz":"14130","./ar-dz.js":"14130","./ar-kw":"96135","./ar-kw.js":"96135","./ar-ly":"56440","./ar-ly.js":"56440","./ar-ma":"47702","./ar-ma.js":"47702","./ar-ps":"20315","./ar-ps.js":"20315","./ar-sa":"16040","./ar-sa.js":"16040","./ar-tn":"37100","./ar-tn.js":"37100","./ar.js":"30867","./az":"31083","./az.js":"31083","./be":"9808","./be.js":"9808","./bg":"68338","./bg.js":"68338","./bm":"67438","./bm.js":"67438","./bn":"8905","./bn-bd":"76225","./bn-bd.js":"76225","./bn.js":"8905","./bo":"11560","./bo.js":"11560","./br":"1278","./br.js":"1278","./bs":"80622","./bs.js":"80622","./ca":"2468","./ca.js":"2468","./cs":"5822","./cs.js":"5822","./cv":"50877","./cv.js":"50877","./cy":"47373","./cy.js":"47373","./da":"24780","./da.js":"24780","./de":"59740","./de-at":"60217","./de-at.js":"60217","./de-ch":"60894","./de-ch.js":"60894","./de.js":"59740","./dv":"5300","./dv.js":"5300","./el":"50837","./el.js":"50837","./en-au":"78348","./en-au.js":"78348","./en-ca":"77925","./en-ca.js":"77925","./en-gb":"22243","./en-gb.js":"22243","./en-ie":"46436","./en-ie.js":"46436","./en-il":"47207","./en-il.js":"47207","./en-in":"44175","./en-in.js":"44175","./en-nz":"76319","./en-nz.js":"76319","./en-sg":"31662","./en-sg.js":"31662","./eo":"92915","./eo.js":"92915","./es":"55655","./es-do":"55251","./es-do.js":"55251","./es-mx":"96112","./es-mx.js":"96112","./es-us":"71146","./es-us.js":"71146","./es.js":"55655","./et":"5603","./et.js":"5603","./eu":"77763","./eu.js":"77763","./fa":"76959","./fa.js":"76959","./fi":"11897","./fi.js":"11897","./fil":"42549","./fil.js":"42549","./fo":"94694","./fo.js":"94694","./fr":"94470","./fr-ca":"63049","./fr-ca.js":"63049","./fr-ch":"52330","./fr-ch.js":"52330","./fr.js":"94470","./fy":"5044","./fy.js":"5044","./ga":"29295","./ga.js":"29295","./gd":"2101","./gd.js":"2101","./gl":"38794","./gl.js":"38794","./gom-deva":"27884","./gom-deva.js":"27884","./gom-latn":"23168","./gom-latn.js":"23168","./gu":"95349","./gu.js":"95349","./he":"24206","./he.js":"24206","./hi":"30094","./hi.js":"30094","./hr":"30316","./hr.js":"30316","./hu":"22138","./hu.js":"22138","./hy-am":"11423","./hy-am.js":"11423","./id":"29218","./id.js":"29218","./is":"90135","./is.js":"90135","./it":"90626","./it-ch":"10150","./it-ch.js":"10150","./it.js":"90626","./ja":"39183","./ja.js":"39183","./jv":"24286","./jv.js":"24286","./ka":"12105","./ka.js":"12105","./kk":"47772","./kk.js":"47772","./km":"18758","./km.js":"18758","./kn":"79282","./kn.js":"79282","./ko":"33730","./ko.js":"33730","./ku":"1408","./ku-kmr":"90563","./ku-kmr.js":"90563","./ku.js":"1408","./ky":"33291","./ky.js":"33291","./lb":"36841","./lb.js":"36841","./lo":"75780","./lo.js":"75780","./lt":"57010","./lt.js":"57010","./lv":"37595","./lv.js":"37595","./me":"39861","./me.js":"39861","./mi":"35493","./mi.js":"35493","./mk":"95966","./mk.js":"95966","./ml":"87341","./ml.js":"87341","./mn":"5115","./mn.js":"5115","./mr":"10370","./mr.js":"10370","./ms":"9847","./ms-my":"41237","./ms-my.js":"41237","./ms.js":"9847","./mt":"72126","./mt.js":"72126","./my":"56165","./my.js":"56165","./nb":"64924","./nb.js":"64924","./ne":"16744","./ne.js":"16744","./nl":"93901","./nl-be":"59814","./nl-be.js":"59814","./nl.js":"93901","./nn":"83877","./nn.js":"83877","./oc-lnc":"92135","./oc-lnc.js":"92135","./pa-in":"15858","./pa-in.js":"15858","./pl":"64495","./pl.js":"64495","./pt":"89520","./pt-br":"57971","./pt-br.js":"57971","./pt.js":"89520","./ro":"96459","./ro.js":"96459","./ru":"21793","./ru.js":"21793","./sd":"40950","./sd.js":"40950","./se":"10490","./se.js":"10490","./si":"90124","./si.js":"90124","./sk":"64249","./sk.js":"64249","./sl":"14985","./sl.js":"14985","./sq":"51104","./sq.js":"51104","./sr":"49131","./sr-cyrl":"79915","./sr-cyrl.js":"79915","./sr.js":"49131","./ss":"95606","./ss.js":"95606","./sv":"98760","./sv.js":"98760","./sw":"91172","./sw.js":"91172","./ta":"27333","./ta.js":"27333","./te":"23110","./te.js":"23110","./tet":"52095","./tet.js":"52095","./tg":"27321","./tg.js":"27321","./th":"9041","./th.js":"9041","./tk":"19005","./tk.js":"19005","./tl-ph":"75768","./tl-ph.js":"75768","./tlh":"89444","./tlh.js":"89444","./tr":"72397","./tr.js":"72397","./tzl":"28254","./tzl.js":"28254","./tzm":"51106","./tzm-latn":"30699","./tzm-latn.js":"30699","./tzm.js":"51106","./ug-cn":"9288","./ug-cn.js":"9288","./uk":"67691","./uk.js":"67691","./ur":"13795","./ur.js":"13795","./uz":"6791","./uz-latn":"60588","./uz-latn.js":"60588","./uz.js":"6791","./vi":"65666","./vi.js":"65666","./x-pseudo":"14378","./x-pseudo.js":"14378","./yo":"75805","./yo.js":"75805","./zh-cn":"83839","./zh-cn.js":"83839","./zh-hk":"55726","./zh-hk.js":"55726","./zh-mo":"99807","./zh-mo.js":"99807","./zh-tw":"74152","./zh-tw.js":"74152"};function n(e){return t(l(e))}function l(e){if(!t.o(a,e)){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}return a[e]}n.keys=function(){return Object.keys(a)},n.resolve=l,e.exports=n,n.id=26058},89006:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return aH},App:function(){return aX}});var a=t(58106),n=t(32206),l=t(91439),i=t(46439),s=t(85893),o=t(9948),u=t.n(o),c=t(92485),d=t(87719),m=t(65353),f=t(79718),p=t(58155),g=t(64614),h=t(45037),v=t(88983),y=t(62530),j=t(49179),x=t(21730),b=t.n(x),w=t(36472),S=t.n(w),_=t(9026),C=t.n(_),E=t(29435),k=t(12038),L=t(92212),N=t(50971),F=t(54388),T=t(20164),P=t.n(T),Z=t(39660),M=t(4649),D=()=>(0,M.useDispatch)(),A=M.useSelector,O=t(56511),U=e=>{var r=(0,a._)({},(0,n._)(e)),t=(0,d._)((0,o.useState)(!1),2),u=t[0],x=t[1],w=(0,d._)((0,o.useState)([]),2),_=w[0],T=w[1],M=(0,d._)((0,o.useState)([]),2),U=M[0],I=M[1],G=(0,d._)((0,o.useState)(""),2),$=G[0],R=G[1],B=(0,d._)((0,o.useState)("https://sgx.geodatenzentrum.de/wms_topplus_open"),2),V=B[0],z=B[1],J=(0,d._)((0,o.useState)(),2),W=J[0],K=J[1],q=(0,d._)((0,o.useState)("1.3.0"),2),Y=q[0],X=q[1],H=A(e=>e.addLayerModal.visible),Q=D(),ee=(0,Z.S)(),er=(0,E.useTranslation)().t;(0,o.useEffect)(()=>{H&&K(L.V.createValidGetCapabilitiesRequest(V,"WMS",Y))},[Y,H,V]);var et=()=>{I([]),T([]),Q((0,O.Cp)())},ea=e=>{if(ee){var r=er("AddLayerModal.externalWmsFolder"),t=F.C.getLayerByName(ee,r),a=!!t;if(t||(t=new(b())({layers:[]})).set("name",r),e.forEach(e=>{if(!t.getLayers().getArray().includes(e)){if(e.set("isExternalLayer",!0),e instanceof S()&&(a=null==(n=e.getSource())?void 0:n.getUrl()),e instanceof C()){var r,a,n,l,i=null==(l=e.getSource())?void 0:l.getUrls();a=(null==i?void 0:i.length)===1?i[0]:void 0}var s={name:e.get("name"),type:e instanceof C()?"TILEWMS":"WMS",opacity:e.getOpacity(),sourceConfig:{layerNames:null==(r=e.getSource())?void 0:r.getParams().LAYERS,url:a,useBearerToken:!1}};e.set("layerConfig",s),t.getLayers().push(e)}}),!a){var n=ee.getLayerGroup().getLayers();n.insertAt((null==n?void 0:n.getLength())||0,t)}et()}};return(0,s.jsxs)(p.Z,(0,i._)((0,l._)({className:"add-layer-modal",title:er("AddLayerModal.title"),open:H,onCancel:et,width:600,footer:[(0,s.jsx)(P(),{"aria-label":"add-all",disabled:(null==_?void 0:_.length)<1,onClick:()=>{ea(_)},children:er("AddLayerModal.addAllLayers")},"add-all"),(0,s.jsx)(P(),{"aria-label":"add-selected",disabled:(null==U?void 0:U.length)<1,onClick:()=>{ea(_.filter(e=>U.includes((0,j.getUid)(e))))},children:er("AddLayerModal.addSelectedLayers")},"add-selected")]},r),{children:[(0,s.jsx)("span",{children:er("AddLayerModal.requestWmsGetCapabilitiesInstruction")}),(0,s.jsx)(g.Z.Search,{"aria-label":"input-search",className:"url-input",placeholder:er("AddLayerModal.inputPlaceholder"),value:V,onChange:e=>{var r=e.target.value;R(L.V.isValid(r.trim())?"":"error"),z(e.target.value)},onSearch:()=>(0,c._)(function(){var e,r;return(0,m.Jh)(this,function(t){switch(t.label){case 0:if(!W)return[2];t.label=1;case 1:return t.trys.push([1,3,4,5]),x(!0),[4,N.Z.getWmsCapabilities(W)];case 2:return e=t.sent(),T(N.Z.getLayersFromWmsCapabilities(e,"Title")),[3,5];case 3:return r=t.sent(),f.ZP.error({message:er("AddLayerModal.errorMessage"),description:er("AddLayerModal.errorDescription")}),k.Z.error(r),[3,5];case 4:return x(!1),[7];case 5:return[2]}})})(),status:$,enterButton:!0,addonBefore:(0,s.jsx)(h.Z,{"aria-label":"select-version",defaultValue:"1.3.0",onChange:X,options:[{value:"1.3.0",label:`${er("AddLayerModal.version")} 1.3.0`},{value:"1.1.1",label:`${er("AddLayerModal.version")} 1.1.1`}]})}),""!==$&&(0,s.jsx)(v.Z,{className:"error",children:er("AddLayerModal.invalidUrlErrorMsg")}),(0,s.jsx)(y.Z,{"aria-label":"wms-table",loading:u,columns:[{title:er("AddLayerModal.columnTitle"),render:(e,r)=>r.get("title")}],scroll:{y:250},rowKey:e=>(0,j.getUid)(e),rowSelection:{selectedRowKeys:U,onChange:I},pagination:!1,dataSource:_})]}))},I=t(7925),G=t(70413),$=t(17126),R=()=>(0,o.useContext)($.ZP),B=e=>{var r=(0,a._)({},(0,n._)(e)),t=(0,Z.S)(),u=R(),c=(0,E.useTranslation)(),d=c.t,m=c.i18n;(0,o.useEffect)(()=>{if(t){var e=F.C.getLayersByProperty(t,"isExternalLayerGroup",!0);if((null==e?void 0:e.length)===1){var r=e[0],a=e[0].get("name");r.set("name",d("AddLayerModal.externalWmsFolder"));var n=new I.ObjectEvent("change:layers","name",a);r.dispatchEvent(n)}}},[m.language,t,d]);var f=[];return(u&&u.forEach(e=>{var r;if((r=e.integration)&&"map"===r.placement){var t=e.key,a=e.wrappedComponent;f.push((0,s.jsx)(a,{},t))}}),t)?(0,s.jsx)(G.MapComponent,(0,i._)((0,l._)({map:t},r),{children:f})):(0,s.jsx)(s.Fragment,{})},V=t(30143),z=()=>{var e=R(),r=(0,E.useTranslation)().t,t=()=>{var r=null;return e.forEach(e=>{var t;if((t=e.integration)&&"cookie-banner"===t.placement){var a=e.key,n=e.wrappedComponent;r=(0,s.jsx)(n,{},a)}}),r};return(0,s.jsx)(V.Gk,{disableStyles:!0,location:"bottom",buttonText:r("CookieBanner.button"),cookieName:"SHOGun-Session-Cookie",buttonClasses:"cookie-button",containerClasses:"cookie-container",contentClasses:"cookie-content",expires:150,children:t()?t():r("CookieBanner.info")},"default-cookie-consent")},J=t(33357),W=t(87617),K=t.n(W),q=t(42151),Y=t.n(q),X=t(68191),H=t(67549),Q=t.n(H),ee=t(24194),er=t.n(ee),et=t(78459),ea=t(71797),en=()=>{var e=(0,ea.Z)(),r=e=>["wfs:FAILED","ows:ExceptionReport"].some(r=>e.getElementsByTagName(r).length>0);return(0,o.useCallback)(t=>(0,c._)(function(){var a,n,i,s,o,u,c;return(0,m.Jh)(this,function(d){switch(d.label){case 0:if((i=t.layer.getSource())instanceof Q()&&(n=i.getUrl()),i instanceof er()&&(n=(s=i.getUrls())?s[0]:void 0),!n)return[2];return n.endsWith("?")&&(n=n.slice(0,-1)),o={"Content-Type":"application/xml"},[4,fetch(n,{method:"POST",headers:(null==(a=t.layer)?void 0:a.get("useBearerToken"))?(0,l._)({},o,(0,et.a)(null==e?void 0:e.getKeycloak())):o,body:new XMLSerializer().serializeToString(t.transaction)})];case 1:if(!(u=d.sent()).ok)throw Error("No successful response while executing a WFS-Transaction");return[4,u.text()];case 2:if(c=d.sent(),r(new DOMParser().parseFromString(c,"text/xml")))throw Error(`Something failed: ${c}`);return[2,c]}})})(),[e])},el=t(50361),ei=t.n(el),es=t(30381),eo=t.n(es),eu=t(33905),ec=t(26257),ed=t.n(ec),em=t(91007),ef=t(70033),ep=t(19478),eg=t(96935),eh=t(36192),ev=t(96973),ey=t(23279),ej=t.n(ey),ex=t(14293),eb=t.n(ex),ew=t(13218),eS=t.n(ew),e_=t(63364),eC=t(47037),eE=t.n(eC),ek=t(24512),eL=t(76534),eN=t(58548),eF=e=>{var r=e.readOnly,t=e.fieldConfig,a=(0,em._)(e,["readOnly","fieldConfig"]),n=(0,ea.Z)(),o=(0,E.useTranslation)().t;return n?(0,s.jsx)(ek.Z,(0,i._)((0,l._)({multiple:!0,name:"file",action:"/files/uploadToFileSystem",withCredentials:!0,headers:(0,l._)({},(0,eN.y)(),(0,et.a)(n.getKeycloak())),onRemove:e=>(0,c._)(function(){var r,t;return(0,m.Jh)(this,function(a){switch(a.label){case 0:if(!(t=null==e||null==(r=e.response)?void 0:r.fileUuid))return[3,2];return[4,fetch(`${null==n?void 0:n.getBasePath()}files/${t}`,{method:"DELETE",credentials:"same-origin",headers:(0,l._)({},(0,eN.y)(),(0,et.a)(null==n?void 0:n.getKeycloak()))})];case 1:return[2,a.sent()];case 2:return[2]}})})(),onPreview:e=>(0,c._)(function(){var r,t,a,i,s,o;return(0,m.Jh)(this,function(u){switch(u.label){case 0:if(!n||(t=null==(r=e.response)?void 0:r.fileName,a=`/files/${null==r?void 0:r.fileUuid}`,eb()(t)||eb()(null==r?void 0:r.fileUuid)))return[2];return i=document.createElement("a"),document.body.appendChild(i),[4,fetch(a,{headers:(0,l._)({},(0,et.a)(n.getKeycloak()))})];case 1:return[4,u.sent().blob()];case 2:return s=u.sent(),o=window.URL.createObjectURL(s),i.href=o,i.download=t,i.click(),window.URL.revokeObjectURL(o),[2]}})})()},null==t?void 0:t.fieldProps,a),{children:!(void 0!==r&&r)&&(0,s.jsx)(eL.ZP,{children:o("FileUpload.upload")})})):(0,s.jsx)(s.Fragment,{})},eT=t(84131),eP=t(62163),eZ=t(76383),eM=()=>{var e=(0,ea.Z)();return(0,o.useCallback)(r=>(0,c._)(function(){var t;return(0,m.Jh)(this,function(a){switch(a.label){case 0:if(eb()(r))return[2,Promise.reject(Error(`Passed url '${r}' is null or undefined`))];return[4,fetch(r,{credentials:"include",headers:(0,l._)({},(0,et.a)(null==e?void 0:e.getKeycloak()))})];case 1:return[4,a.sent().blob()];case 2:return t=a.sent(),[2,new Promise((e,r)=>{try{var a=new FileReader;a.onload=function(){e(this.result)},a.readAsDataURL(t)}catch(e){r(e)}})]}})})(),[e])},eD=e=>{var r=e.fieldConfig,t=e.readOnly,a=void 0!==t&&t,n=e.initialFileList,u=(0,em._)(e,["fieldConfig","readOnly","initialFileList"]),f=(0,d._)((0,o.useState)(!1),2),g=f[0],h=f[1],v=(0,d._)((0,o.useState)(""),2),y=v[0],j=v[1],x=(0,d._)((0,o.useState)(),2),b=x[0],w=x[1],S=(0,ea.Z)(),_=eM(),C=(0,E.useTranslation)().t;return((0,eZ.b)(()=>(0,c._)(function(){return(0,m.Jh)(this,function(e){switch(e.label){case 0:let r;if(!n||0===n.length)return[2];return[4,(r=n,(0,c._)(function(){return(0,m.Jh)(this,function(e){switch(e.label){case 0:return[4,Promise.all(r.map(e=>(0,c._)(function(){var r,t,a;return(0,m.Jh)(this,function(n){switch(n.label){case 0:return t=[(0,l._)({},e)],a={},[4,_(`${null==S?void 0:S.getBasePath()}imagefiles/${null==e||null==(r=e.response)?void 0:r.fileUuid}/thumbnail`)];case 1:return[2,i._.apply(void 0,t.concat([(a.thumbUrl=n.sent(),a.url=void 0,a)]))]}})})()))];case 1:return[2,e.sent()]}})})())];case 1:return w(e.sent()),[2]}})})(),[null==n?void 0:n.length]),S)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ek.Z,(0,i._)((0,l._)({accept:"image/*",multiple:!0,name:"file",action:`${S.getBasePath()}imagefiles/uploadToFileSystem`,withCredentials:!0,listType:"picture-card",headers:(0,l._)({},(0,eN.y)(),(0,et.a)(S.getKeycloak())),onRemove:e=>(0,c._)(function(){var r,t;return(0,m.Jh)(this,function(a){switch(a.label){case 0:if(!(t=null==e||null==(r=e.response)?void 0:r.fileUuid))return[3,2];return[4,fetch(`${null==S?void 0:S.getBasePath()}imagefiles/${t}`,{method:"DELETE",credentials:"same-origin",headers:(0,l._)({},(0,eN.y)(),(0,et.a)(null==S?void 0:S.getKeycloak()))})];case 1:return[2,a.sent()];case 2:return[2]}})})(),onPreview:e=>(0,c._)(function(){var r;return(0,m.Jh)(this,function(t){switch(t.label){case 0:if(r=e.response,eb()(r)||eb()(null==r?void 0:r.fileUuid))return[2];return[4,_(`${null==S?void 0:S.getBasePath()}imagefiles/${r.fileUuid}`)];case 1:return j(t.sent()),h(!0),[2]}})})(),fileList:a?b:void 0},null==r?void 0:r.fieldProps,u),{children:!a&&(0,s.jsxs)("div",{children:[(0,s.jsx)(eP.G,{icon:eT.r8p}),(0,s.jsx)("div",{style:{marginTop:8},children:C("ImageUpload.upload")})]})})),(0,s.jsx)(p.Z,{open:g,footer:null,onCancel:()=>h(!1),children:(0,s.jsx)("img",{alt:"example",style:{width:"100%"},src:y})})]}):(0,s.jsx)(s.Fragment,{})},eA=t(50963),eO=e=>{var r=e.feature,t=e.formConfig,a=(0,em._)(e,["feature","formConfig"]),n=(0,d._)((0,eA.useForm)(),1)[0];return(0,o.useEffect)(()=>{n.resetFields(),n.setFieldsValue(r.getProperties())},[r,n]),(0,s.jsx)(ef.Z,(0,i._)((0,l._)({className:"feature-info-form",form:n,labelCol:{span:8},labelAlign:"left",labelWrap:!0},a),{children:null==t?void 0:t.map(e=>{var r,t;return(0,s.jsx)(ef.Z.Item,{name:e.propertyName,label:null!=(r=e.displayName)?r:e.propertyName,children:(0,s.jsx)(eI,(0,l._)({label:null!=(t=e.displayName)?t:e.propertyName},e.fieldProps))},e.propertyName)})}))},eU=e=>{var r=e.value,t=e.referenceConfig,a=(0,em._)(e,["value","referenceConfig"]),n=(0,d._)((0,o.useState)(!1),2),i=n[0],u=n[1],f=(0,d._)((0,o.useState)(),2),g=f[0],h=f[1],v=(0,E.useTranslation)().t,j=e=>{if(null==t?void 0:t.tablePropertyName){var r=/{{(.*?)}}/g;if(null==t?void 0:t.tablePropertyName.match(r)){for(var a,n=null==t?void 0:t.tablePropertyName;a=r.exec(null==t?void 0:t.tablePropertyName);)n=n.replace(a[0],e[a[1]]);return n}return e[null==t?void 0:t.tablePropertyName]}if(e.id)return e.id},x=[{width:"100%",render:(e,r)=>j(r)?j(r):v("ReferenceTable.defaultRowPlaceholder")},{render:(e,r)=>(0,s.jsx)(eL.ZP,{onClick:()=>b(e,r),icon:(0,s.jsx)(eP.G,{icon:eT.IA$})})}],b=(e,r)=>{var t=new(Y());t.setProperties(r),h(t),u(!0)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(y.Z,(0,l._)({size:"small",showHeader:!1,pagination:!1,columns:x,rowKey:"id",dataSource:(()=>{if(!r)return[];try{var e=JSON.parse(r);if(Array.isArray(e))return e;if(null==e||"number"==typeof e||"boolean"==typeof e||"string"==typeof e)return k.Z.warn("Unsupported value given"),[];if("object"==typeof e)return[e]}catch(e){return k.Z.warn("Error while parsing the table data ",e),[]}})()},a)),(0,s.jsx)(p.Z,{className:"reference-table-modal",open:i,maskClosable:!1,footer:null,width:600,destroyOnClose:!0,title:(()=>{if(!g)return v("ReferenceTable.defaultModalTitle");var e=j(g.getProperties());return e?`${v("ReferenceTable.modalTitle",{referenceValue:e})}`:v("ReferenceTable.defaultModalTitle")})(),onCancel:()=>(0,c._)(function(){return(0,m.Jh)(this,function(e){return u(!1),h(void 0),[2]})})(),children:g&&(0,s.jsx)(eO,{feature:g,formConfig:null==t?void 0:t.featureInfoFormConfig})})]})},eI=e=>{var r,t,a,n=e.dataType,o=void 0===n?"auto":n,u=e.valueMap,c=e.format,d=e.suffix,m=e.value,f=e.referenceConfig,p=e.urlDisplayValue,g=(0,em._)(e,["dataType","valueMap","format","suffix","value","referenceConfig","urlDisplayValue"]),h=(0,E.useTranslation)().i18n,y="";if(m&&"string"==typeof m&&(null==u?void 0:u.hasOwnProperty(m))&&(m=u[m]),("string"===o||"auto"===o&&"string"==typeof m)&&m&&(y=null==m?void 0:m.toString()),"boolean"===o||"auto"===o&&"boolean"==typeof m||"false"===m||"true"===m)return(0,s.jsx)(ep.Z,{checked:"false"!==m&&!1!==m,disabled:!0});("number"===o||"auto"===o&&Number.isFinite(m))&&m&&(y=new Intl.NumberFormat(h.language,{useGrouping:!1}).format(Number(m))),("date"===o||"auto"===o&&(0,es.isMoment)(m))&&m&&(y=eo()(m).format(void 0===c?"DD.MM.YYYY":c)),"auto"===o&&Array.isArray(m)&&(y=m.join(", ")),("url"===o||"auto"===o&&eE()(m)&&(r=m.toLowerCase(),["http://","https://","ftp://","mailto:"].some(e=>r.startsWith(e))))&&m&&(y=(0,s.jsx)("a",{href:null==m?void 0:m.toString(),target:"_blank",rel:"noreferrer",children:p||(null==m?void 0:m.toString())}));var j=m&&(e=>{if(!m)return null;var r="string"!=typeof e?JSON.stringify(e):e;try{r=JSON.parse(r)}catch(e){return k.Z.trace(e),null}return"object"==typeof r&&null!==r&&eB(r[0])?r:null})(m);return"auto"===o&&j?(null==(a=j[0].response)||null==(t=a.fileType)?void 0:t.startsWith("image/"))?(0,s.jsx)(eD,{initialFileList:j,disabled:!0,readOnly:!0}):(0,s.jsx)(eF,{defaultFileList:j,disabled:!0,readOnly:!0}):"json"===o||"auto"===o&&m&&(e=>{var r="string"!=typeof e?JSON.stringify(e):e;try{r=JSON.parse(r)}catch(e){return k.Z.trace(e),!1}return"object"==typeof r&&null!==r})(m)?(0,s.jsx)(eU,{value:"string"==typeof m?m:JSON.stringify(m),referenceConfig:f}):(d&&(y=(0,s.jsxs)(s.Fragment,{children:[y," ",d]})),(0,s.jsx)(v.Z.Text,(0,i._)((0,l._)({className:"displayfield"},g),{children:y})))},eG=t(21689),e$=t(94945),eR=e=>{var r=e.parentForm,t=e.propertyName,a=e.value,n=e.tablePropertyName,u=e.formConfig,f=e.onChange,g=void 0===f?()=>{}:f,h=(0,em._)(e,["parentForm","propertyName","value","tablePropertyName","formConfig","onChange"]),v=(0,d._)((0,o.useState)(!1),2),j=v[0],x=v[1],b=(0,d._)((0,o.useState)(),2),w=b[0],S=b[1],_=(0,d._)((0,eA.useForm)(),1)[0],C=(0,E.useTranslation)().t,L=eM(),N=(0,ea.Z)(),F=e=>{if(!n)return null!=(r=e.id)?r:"";var r,t,a=/{{(.*?)}}/g;if(!n.match(a))return e[n];for(var l=n;t=a.exec(n);)l=l.replace(t[0],e[t[1]]);return l},T=[{width:"100%",defaultSortOrder:"ascend",sorter:(e,r)=>{var t=F(e),a=F(r);return Number.isFinite(t)&&Number.isFinite(a)?t-a:"string"==typeof t&&"string"==typeof a?t.localeCompare(a):0},render:(e,r)=>F(r)},{render:(e,r)=>(0,s.jsx)(eL.ZP,{onClick:()=>Z(r),icon:(0,s.jsx)(eP.G,{icon:eT.Xcf})})},{render:(e,r)=>(0,s.jsx)(eG.Z,{title:C("EditReferenceTable.confirmDeleteTitle"),onConfirm:()=>P(r),placement:"bottomRight",children:(0,s.jsx)(eL.ZP,{danger:!0,icon:(0,s.jsx)(eP.G,{icon:eT.$aW})})})}],P=e=>{var a=r.getFieldsValue();if(!a[t])return void k.Z.warn(`Could not find the property ${t} in the form values`);var n=ei()(a[t]);if(!Array.isArray(n))return void k.Z.warn("The delete candidate is not of required type array");var l=n.findIndex(r=>!!Number.isFinite(r.id)&&r.id===e.id||!!r.internalId&&r.internalId===e.internalId);if(-1===l)return void k.Z.warn(`Could not find the index (${e.id}) to delete`);n.splice(l,1),g(n)},Z=e=>{var r=new(Y());r.setProperties(e),_.setFieldsValue(r.getProperties()),S(r),x(!0)},M=()=>{var e=ei()(_.getFieldsValue(!0)),a=[];Array.isArray(r.getFieldValue(t))&&(a=ei()(r.getFieldValue(t)));var n=a.findIndex(r=>!!Number.isFinite(r.id)&&r.id===e.id||!!r.internalId&&r.internalId===e.internalId);n>-1?a[n]=e:a.push(e),_.isFieldsTouched()&&g(a)},D=()=>{_.resetFields(),x(!1),S(void 0)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eL.ZP,{className:"add-reference-button",onClick:()=>{var e=new(Y());e.set("internalId",(0,e$.getUid)(e)),_.setFieldsValue(e.getProperties()),S(e),x(!0)},icon:(0,s.jsx)(eP.G,{icon:eT.r8p})}),(0,s.jsx)(y.Z,(0,l._)({size:"small",showHeader:!1,pagination:!1,columns:T,rowKey:"id",dataSource:(()=>{if(a){if(!Array.isArray(a))return void k.Z.warn("Reference value must be of of type array.");var e=ei()(a);return e.forEach(e=>{Object.entries(e).forEach(r=>{var t=(0,d._)(r,2),n=t[0],s=t[1];return(0,c._)(function(){var r,t;return(0,m.Jh)(this,function(o){switch(o.label){case 0:if((null==u?void 0:u.some(e=>e.propertyName===n&&"DATE"===e.component))&&s&&(eo()(a).isValid()?e[n]=eo()(s):(k.Z.warn("Could not parse date"),e[n]=null)),!(null==u?void 0:u.some(e=>e.propertyName===n&&"UPLOAD"===e.component)))return[3,3];if(!Array.isArray(e[n]))return[3,2];return[4,Promise.all(null==(r=e[n])?void 0:r.map(e=>(0,c._)(function(){var r,t,a,n;return(0,m.Jh)(this,function(s){switch(s.label){case 0:if(t=[(0,l._)({},e)],a={},!e.type.startsWith("image"))return[3,2];return[4,L(`${null==N?void 0:N.getBasePath()}imagefiles/${null==e||null==(r=e.response)?void 0:r.fileUuid}/thumbnail`)];case 1:return n=s.sent(),[3,3];case 2:n=void 0,s.label=3;case 3:return[2,i._.apply(void 0,t.concat([(a.thumbUrl=n,a.url=e.type.startsWith("image")?void 0:e.url,a)]))]}})})()))];case 1:return t=o.sent(),e[n]=t,[3,3];case 2:e[n]=[],o.label=3;case 3:return[2]}})})()})}),e.every(e=>!!Number.isFinite(e.id)||"string"==typeof e.id&&!!(e.id.length>0))||k.Z.warn("Not all elements in the referenced array contain an id value. This might result in unexpected behaviour"),e}})()},h)),(0,s.jsx)(p.Z,{className:"edit-reference-table-modal",open:j,maskClosable:!1,width:600,destroyOnClose:!0,title:`${C("EditReferenceTable.modalTitle",{referenceValue:w?F(w.getProperties()):void 0})}`,onCancel:()=>{D()},onOk:()=>(0,c._)(function(){var e;return(0,m.Jh)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,_.validateFields()];case 1:return r.sent(),[3,3];case 2:return e=r.sent(),k.Z.warn("Form validation failed: ",e),[2];case 3:return M(),D(),[2]}})})(),children:w&&(0,s.jsx)(eV,{form:_,formConfig:u,applyFormDirty:!1})})]})};function eB(e){return!eb()(e)&&e.uid&&!eb()(e.name)&&!eb()(e.type)&&!eb()(e.uid)&&eS()(e.response)&&!eb()(e.response.id)&&!eb()(e.response.fileUuid)&&!eb()(e.response.fileName)&&!eb()(e.response.fileType)}var eV=e=>{var r=e.form,t=e.formConfig,a=e.applyFormDirty,n=void 0===a||a,o=(0,em._)(e,["form","formConfig","applyFormDirty"]),u=(0,ea.Z)(),d=D(),f=A(e=>e.editFeature.formDirty),p=e=>(0,s.jsx)(eI,(0,l._)({},e.fieldProps)),v=e=>{if(u)switch(e.component){case"CHECKBOX":return(0,s.jsx)(ep.Z,(0,l._)({},null==e?void 0:e.fieldProps));case"DATE":return(0,s.jsx)(eg.Z,(0,l._)({},null==e?void 0:e.fieldProps));case"DISPLAY":return(0,s.jsx)("span",(0,l._)({},null==e?void 0:e.fieldProps));case"INPUT":return(0,s.jsx)(g.Z,(0,l._)({},null==e?void 0:e.fieldProps));case"NUMBER":return(0,s.jsx)(eh.Z,(0,l._)({},null==e?void 0:e.fieldProps));case"SELECT":return(0,s.jsx)(h.Z,(0,l._)({allowClear:!0},null==e?void 0:e.fieldProps));case"SWITCH":return(0,s.jsx)(ev.Z,(0,l._)({},null==e?void 0:e.fieldProps));case"TEXTAREA":return(0,s.jsx)(g.Z.TextArea,(0,l._)({},null==e?void 0:e.fieldProps));case"UPLOAD":var t;if((null==e||null==(t=e.fieldProps)?void 0:t.type)==="IMAGE")return(0,s.jsx)(eD,(0,l._)({},null==e?void 0:e.fieldProps));return(0,s.jsx)(eF,(0,l._)({},null==e?void 0:e.fieldProps));case"REFERENCE_TABLE":return(0,s.jsx)(eR,(0,l._)({tablePropertyName:e.tablePropertyName,propertyName:e.propertyName,formConfig:e.editFormConfig,parentForm:r},e.fieldProps),e.propertyName);default:return k.Z.error(`Component type "${null==e?void 0:e.component}" is not supported`),(0,s.jsx)(s.Fragment,{})}};return(0,s.jsx)(ef.Z,(0,i._)((0,l._)({className:"edit-feature-form",form:r,labelCol:{span:8},labelAlign:"left",labelWrap:!0,onValuesChange:ej()(e=>(0,c._)(function(){return(0,m.Jh)(this,function(r){return n&&e&&!f&&d((0,e_.uQ)(!0)),[2]})})(),250)},o),{children:null==t?void 0:t.map(e=>{e.readOnly?r=p(e):e.component?r=v(e):(k.Z.warn("FieldConfig is missing `readOnly`, `component` or `dataType` property."),r=(0,s.jsx)(g.Z,{placeholder:""},e.propertyName));var r,t,a={rules:[]};return a.rules=[{required:e.required}],"SWITCH"!==e.component&&"CHECKBOX"!==e.component||e.readOnly||(a.valuePropName="checked"),"UPLOAD"!==e.component||e.readOnly||(a.valuePropName="fileList",a.getValueFromEvent=e=>Array.isArray(e)?e:null==e?void 0:e.fileList),(0,s.jsx)(ef.Z.Item,(0,i._)((0,l._)({name:e.propertyName,label:null!=(t=e.displayName)?t:e.propertyName},a),{children:r}),e.propertyName)})}))},ez=e=>["gml:MultiPoint","gml:Point","gml:MultiLineString","gml:LineString","gml:MultiPolygon","gml:Polygon"].includes(e),eJ=()=>{var e=(0,ea.Z)(),r="describeFeatureTypeCache";return(0,o.useCallback)(t=>(0,c._)(function(){var a,n,i,s,o,u,c,d,f,p,g;return(0,m.Jh)(this,function(m){switch(m.label){case 0:if((i=t.getSource())instanceof Q()&&(n=i.getUrl()),i instanceof er()&&(n=(s=i.getUrls())?s[0]:void 0),!n||(n.endsWith("?")&&(n=n.slice(0,-1)),!(o=null==(a=t.getSource())?void 0:a.getParams().LAYERS)))return[2];if(c=(u=JSON.parse(sessionStorage.getItem(r)||"{}"))[o])return[2,c];return d={SERVICE:"WFS",REQUEST:"DescribeFeatureType",VERSION:"2.0.0",OUTPUTFORMAT:"application/json",TYPENAMES:o},f={"Content-Type":"application/json"},[4,fetch(`${n}?${L.V.objectToRequestString(d)}`,{method:"GET",headers:t.get("useBearerToken")?(0,l._)({},f,(0,et.a)(null==e?void 0:e.getKeycloak())):f})];case 1:if(!(p=m.sent()).ok)throw Error("No successful response while executing a WFS-DescribeFeature");return[4,p.json()];case 2:return g=m.sent(),u[o]=g,sessionStorage.setItem(r,JSON.stringify(u)),[2,g]}})})(),[e])},eW=()=>{var e=(0,Z.S)(),r=eJ(),t=(0,ea.Z)(),a=A(e=>e.editFeature.userEditMode),n=(0,o.useCallback)((e,r,a)=>{var l=!0,i=!1,s=void 0;try{for(var o,u=Object.entries(e)[Symbol.iterator]();!(l=(o=u.next()).done);l=!0)!function(){var l=(0,d._)(o.value,2),i=l[0],s=l[1];if(Array.isArray(s)){var u=s.map(e=>n(e,r));e[i]=a?JSON.stringify(u):u}if(void 0===s&&(e[i]=null),r.some(e=>{var r;return null==(r=e.children)?void 0:r.some(e=>e.propertyName===i&&e.readOnly)})&&delete e[i],(0,es.isMoment)(s)&&(e[i]=s.toISOString()),Array.isArray(s)&&s.length>0&&eB(s[0])){var c,m,f=(null==(m=s[0].response)||null==(c=m.fileType)?void 0:c.startsWith("image/"))?"imagefiles/":"files/",p=s.map(e=>{var r,a,n,l,i;return{uid:e.uid,lastModified:e.lastModified,name:e.name,type:e.type,url:`${null==t?void 0:t.getBasePath()}${f}${e.response.fileUuid}`,response:{id:null==(r=e.response)?void 0:r.id,created:null==(a=e.response)?void 0:a.created,fileName:null==(n=e.response)?void 0:n.fileName,fileType:null==(l=e.response)?void 0:l.fileType,fileUuid:null==(i=e.response)?void 0:i.fileUuid}}});e[i]=JSON.stringify(p)}}()}catch(e){i=!0,s=e}finally{try{l||null==u.return||u.return()}finally{if(i)throw s}}return e},[t]);return(0,o.useCallback)(t=>(0,c._)(function(){var l,i,s,o,u,c,d,f,p,g,h,v,y,j,x,b,w,S,_,C,E,k,L,N,F,T,P,Z;return(0,m.Jh)(this,function(m){switch(m.label){case 0:if(!e)return[2];return o=[],u=[],c=[],[4,r(t.layer)];case 1:if(!(d=m.sent()))return[2];if(f=t.layer.get("editFormConfig"),p=null==(i=d.featureTypes[0])||null==(l=i.properties)?void 0:l.find(e=>ez(e.type)),g=!1,t.upsertFeatures){h=!0,v=!1,y=void 0;try{for(j=t.upsertFeatures[Symbol.iterator]();!(h=(x=j.next()).done);h=!0)b=x.value,S=new(Y()),(_=null==(w=b.getGeometry())?void 0:w.clone())&&!(0,eu.isEmpty)(_.getExtent())&&(null==a?void 0:a.includes("EDIT_GEOMETRY"))&&(E=null!=(C=null==p?void 0:p.name)?C:"geom",S.set(E,_),S.setGeometryName(E)),t.form&&S.setProperties(n(ei()(null==(k=t.form)?void 0:k.getFieldsValue()),f,!0)),(L=!!b.getId())&&!g&&(g=!0),L&&S.setId(b.getId()),L?u.push(S):o.push(S)}catch(e){v=!0,y=e}finally{try{h||null==j.return||j.return()}finally{if(v)throw y}}}return t.deleteFeatures&&c.push(...t.deleteFeatures),N={featureNS:d.targetNamespace,featurePrefix:d.targetPrefix,featureType:null==(s=t.layer.getSource())?void 0:s.getParams().LAYERS,srsName:e.getView().getProjection().getCode(),version:"1.1.0",nativeElements:[]},F=new(ed())().writeTransaction(o,u,c,N),g&&K().wfsLockFeatureEnabled&&(T=F.getRootNode(),P=document.createElementNS("http://www.opengis.net/wfs","LockId"),Z=document.createTextNode("GeoServer"),P.appendChild(Z),T.appendChild(P)),[2,F]}})})(),[e,a,r,n])},eK=t(67187),eq=t(12477),eY=e=>{var r=e.open,t=e.children,a=(0,em._)(e,["open","children"]),n=(0,Z.S)();return(0,o.useEffect)(()=>{var e;null==(e=document.querySelectorAll("#map")[0])||e.classList.toggle("bisected",!!r)},[r]),(0,s.jsx)(eq.Z,(0,i._)((0,l._)({rootClassName:"map-drawer",mask:!1,open:r,placement:"right",width:getComputedStyle(document.documentElement).getPropertyValue("--drawerWidth"),afterOpenChange:()=>{null==n||n.updateSize()}},a),{children:t}))},eX=t(53501),eH=t.n(eX),eQ=()=>{var e=(0,ea.Z)(),r=(0,Z.S)(),t=eJ();return(0,o.useCallback)(function(a){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"1.1.0";return(0,c._)(function(){var i,s,o,u,c,d,f,p,g,h,v;return(0,m.Jh)(this,function(m){switch(m.label){case 0:if(!r)return[2];return[4,t(a.layer)];case 1:if(!(u=m.sent())||((d=a.layer.getSource())instanceof Q()&&(c=d.getUrl()),d instanceof er()&&(c=(f=d.getUrls())?f[0]:void 0),!c))return[2];return c.endsWith("?")&&(c=c.slice(0,-1)),p=null==(s=u.featureTypes[0])||null==(i=s.properties)?void 0:i.find(e=>ez(e.type)),(g=new(ed())({version:n}).writeGetFeature({srsName:r.getView().getProjection().getCode(),featureNS:u.targetNamespace,featurePrefix:u.targetPrefix,featureTypes:[null==d?void 0:d.getParams().LAYERS],outputFormat:"application/json",maxFeatures:a.maxFeatures,propertyNames:a.propertyNames&&(null==p?void 0:p.name)?[...a.propertyNames,null==p?void 0:p.name]:void 0,bbox:a.bbox,filter:a.filter instanceof eH()?a.filter:void 0,geometryName:null==p?void 0:p.name}))instanceof Element&&a.filter instanceof Element&&g.getElementsByTagName("Query")[0].appendChild(a.filter),h={"Content-Type":"application/json"},[4,fetch(c,{method:"POST",headers:(null==(o=a.layer)?void 0:o.get("useBearerToken"))?(0,l._)({},h,(0,et.a)(null==e?void 0:e.getKeycloak())):h,body:new XMLSerializer().serializeToString(g)})];case 2:if(!(v=m.sent()).ok)throw Error("No successful response while executing a WFS-GetFeature");return[4,v.json()];case 3:return[2,m.sent()]}})})()},[e,t,r])},e0=t(78001),e1=t(41609),e2=t.n(e1),e3=t(48472),e4=t.n(e3),e5=t(10771),e7=t(72858),e6=t.n(e7),e9=t(60297),e8=t(91967),re=t(14292),rr=e=>{var r=e.alignment,t=e.className,a=void 0===t?"":t,n=e.children,o=(0,em._)(e,["alignment","className","children"]),u="toolbar",c=a?`${a} ${u}`:u;return(0,s.jsx)("div",(0,i._)((0,l._)({className:`${c} ${void 0===r?"horizontal":r}-toolbar`,role:"toolbar"},o),{children:n}))},rt=e=>{var r,t,a=e.feature,n=e.historyLength,u=void 0===n?10:n,c=(0,o.useRef)({past:[],future:[]}),m=(0,Z.S)(),f=D(),p=(0,d._)((0,o.useState)(),2),g=p[0],h=p[1],v=(0,d._)((0,o.useState)(0),2)[1],y=(0,d._)((0,o.useState)(void 0),2),j=y[0],x=y[1],b=(0,o.useMemo)(()=>new(e4()),[]),w=A(e=>e.editFeature.userEditMode),S=A(e=>e.editFeature.formDirty);(0,o.useEffect)(()=>{if(m)return g||h(re.w.getDigitizeLayer(m)),()=>{g&&(null==m||m.removeLayer(g))}},[g,m]),(0,o.useEffect)(()=>{c.current.past.length>0&&!S&&f((0,e_.uQ)(!0))},[f,c.current.past]),(0,o.useEffect)(()=>{if(g&&(null==a?void 0:a.id)){null==(e=g.getSource())||e.clear();var e,r=b.readFeature(a);if(!Array.isArray(r)){var t=g.getSource();t.addFeature(r),v(e=>e+1),(0,eu.isEmpty)(t.getExtent())||null==m||m.getView().fit(t.getExtent(),{padding:[50,50,50,50]})}}},[a,g,b,m]);var _=()=>{var e,r=null==g||null==(e=g.getSource())?void 0:e.getFeatures();if(r){var t=b.writeFeaturesObject(r);c.current=(0,i._)((0,l._)({},c.current),{past:[...c.current.past,t].slice(-10)}),v(e=>e+1)}},C={tooltipPlacement:"left",tooltipProps:{mouseEnterDelay:.5}};return g&&w.includes("EDIT_GEOMETRY")?(0,s.jsxs)(rr,{className:"geometry-edit-tb",alignment:"vertical",children:[(0,s.jsxs)(e8.ToggleGroup,{selected:j,onChange:(e,r)=>{x(r)},children:[w.includes("CREATE")?(0,s.jsx)(e6(),(0,l._)({value:"create",icon:(0,s.jsx)(eP.G,{icon:eT.TzT}),pressedIcon:(0,s.jsx)(eP.G,{icon:eT.TzT}),name:"draw",digitizeLayer:g,tooltip:(0,e0.t)("EditFeatureGeometryToolbar.draw"),drawType:a.geometry.type,onDrawEnd:e=>{if(!a.geometry.type.toLocaleLowerCase().startsWith("multi")){var r=null==g?void 0:g.getSource(),t=null==r?void 0:r.getFeatures()[0];t&&(null==r||r.once("addfeature",e=>r.removeFeature(e.feature)),t.setGeometry(e.feature.getGeometry()))}_()}},C)):(0,s.jsx)(s.Fragment,{}),w.includes("UPDATE")?(0,s.jsx)(e9.ModifyButton,(0,l._)({value:"update",icon:(0,s.jsx)(eP.G,{icon:eT.ubJ}),pressedIcon:(0,s.jsx)(eP.G,{icon:eT.ubJ}),name:"edit",digitizeLayer:g,tooltip:(0,e0.t)("EditFeatureGeometryToolbar.edit"),onModifyStart:_,onModifyEnd:_,onTranslateEnd:_},C)):(0,s.jsx)(s.Fragment,{}),w.includes("DELETE")?(0,s.jsx)(e5.DeleteButton,(0,l._)({value:"delete",icon:(0,s.jsx)(eP.G,{icon:eT.$aW}),pressedIcon:(0,s.jsx)(eP.G,{icon:eT.$aW}),name:"delete",digitizeLayer:g,tooltip:(0,e0.t)("EditFeatureGeometryToolbar.delete"),onFeatureRemove:_},C)):(0,s.jsx)(s.Fragment,{})]}),(0,s.jsx)(P(),(0,l._)({icon:(0,s.jsx)(eP.G,{icon:eT.X7o}),tooltip:(0,e0.t)("EditFeatureGeometryToolbar.undo"),onClick:()=>{var e=null==g?void 0:g.getSource(),r=null==e?void 0:e.getFeatures();if(r){var t=b.writeFeaturesObject(r),a=c.current.past[c.current.past.length-1];e2()(a)||(null==e||e.clear(),null==e||e.addFeatures(b.readFeatures(a)),c.current={past:c.current.past.slice(0,-1),future:[...c.current.future,t].slice(-u)},v(e=>e+1))}},disabled:(null==(r=c.current.past)?void 0:r.length)===0},C)),(0,s.jsx)(P(),(0,l._)({icon:(0,s.jsx)(eP.G,{icon:eT.X7o,flip:"horizontal"}),tooltip:(0,e0.t)("EditFeatureGeometryToolbar.redo"),onClick:()=>{var e=null==g?void 0:g.getSource(),r=null==e?void 0:e.getFeatures();if(r){var t=b.writeFeaturesObject(r),a=c.current.future[c.current.future.length-1];e2()(a)||(null==e||e.clear(),null==e||e.addFeatures(b.readFeatures(a)),c.current={future:c.current.future.slice(0,-1),past:[...c.current.past,t].slice(-u)},v(e=>e+1))}},disabled:(null==(t=c.current.future)?void 0:t.length)===0},C))]}):(0,s.jsx)(s.Fragment,{})},ra=t(33100),rn=e=>{var r=e.tabConfig,t=e.form,a=e.initialValues,n=(0,em._)(e,["tabConfig","form","initialValues"]),i=null==r?void 0:r.map((e,r)=>({label:e.title,key:`${r}`,forceRender:!0,children:(0,s.jsx)(eV,{name:e.title,form:t,initialValues:a,formConfig:e.children})}));return(0,s.jsx)(ra.Z,(0,l._)({items:i},n))},rl=e=>{var r=e.feature,t=e.layer,a=e.onError,n=void 0===a?()=>{}:a,u=e.onSuccess,f=void 0===u?()=>{}:u,p=(0,em._)(e,["feature","layer","onError","onSuccess"]),g=(0,d._)((0,o.useState)(!1),2),h=g[0],v=g[1],y=(0,E.useTranslation)().t,j=(0,Z.S)(),x=eW(),b=en();return(0,s.jsx)(eG.Z,{title:y("DeleteButton.confirm"),onConfirm:()=>(0,c._)(function(){var e,a,l,i;return(0,m.Jh)(this,function(s){switch(s.label){case 0:if(!j||!t||!(0,X.us)(t))return[2];s.label=1;case 1:return s.trys.push([1,4,5,6]),v(!0),[4,x({deleteFeatures:Array.isArray(a=new(e4())().readFeature(r))?a:[a],layer:t})];case 2:if(!(l=s.sent()))return[2];return[4,b({layer:t,transaction:l})];case 3:return s.sent(),null==(e=t.getSource())||e.refresh(),f(),[3,6];case 4:return i=s.sent(),k.Z.error(i),n(i),[3,6];case 5:return v(!1),[7];case 6:return[2]}})})(),placement:"bottomRight",children:(0,s.jsx)(eL.ZP,(0,i._)((0,l._)({type:"primary",loading:h,disabled:!r.id,danger:!0,icon:(0,s.jsx)(eP.G,{icon:eT.$aW})},p),{children:y("DeleteButton.title")}))})},ri=e=>{var r=e.feature,t=e.form,a=(0,em._)(e,["feature","form"]),n=(0,E.useTranslation)().t,o=(0,Z.S)(),u=D();return(0,s.jsx)(eL.ZP,(0,i._)((0,l._)({type:"primary",onClick:()=>{if(t.resetFields(),u((0,e_.uQ)(!1)),o){var e=re.w.getDigitizeLayer(o);if(e){null==(a=e.getSource())||a.clear();var a,n,l=new(e4())().readFeature(r);if(Array.isArray(l))return;null==(n=e.getSource())||n.addFeature(l)}}},icon:(0,s.jsx)(eP.G,{icon:eT.XnX})},a),{children:n("ResetButton.title")}))},rs=e=>{var r=e.loadComplete,t=void 0!==r&&r;return(0,s.jsx)("div",{className:t?"feedback-icon":"feedback-icon hidden",children:(0,s.jsx)("div",{className:t?"checkmark":"checkmark-hidden"})})},ro=e=>{var r=e.form,t=e.layer,a=e.onError,n=void 0===a?()=>{}:a,u=e.onSuccess,f=void 0===u?()=>{}:u,p=(0,em._)(e,["form","layer","onError","onSuccess"]),g=(0,d._)((0,o.useState)(!1),2),h=g[0],v=g[1],y=(0,d._)((0,o.useState)(!1),2),j=y[0],x=y[1],b=(0,Z.S)(),w=eW(),S=en(),_=D(),C=A(e=>e.editFeature.formDirty),L=(0,E.useTranslation)().t;return(0,s.jsxs)(eL.ZP,(0,i._)((0,l._)({className:"save-button",type:"primary",onClick:()=>(0,c._)(function(){var e,a,l,i,s,o,u,c;return(0,m.Jh)(this,function(d){switch(d.label){case 0:if(!b||!t||!(0,X.us)(t))return[2];if(!(a=re.w.getDigitizeLayer(b)))return k.Z.error("Cannot find the digitize layer"),n(),[2];if(!(l=null==(e=a.getSource())?void 0:e.getFeatures())||0===l.length)return k.Z.error("Cannot save feature without geometry"),n(L("SaveButton.errorNoGeometry")),[2];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,r.validateFields()];case 2:return d.sent(),[3,4];case 3:return n(i=d.sent()),k.Z.warn("Validation has failed: ",i),[2];case 4:return d.trys.push([4,7,8,9]),v(!0),[4,w({upsertFeatures:l,form:r,layer:t})];case 5:if(!(o=d.sent()))return[2];return[4,S({layer:t,transaction:o})];case 6:return u=d.sent(),null==(s=t.getSource())||s.refresh(),x(!0),setTimeout(()=>{x(!1)},3e3),_((0,e_.uQ)(!1)),f(u),[3,9];case 7:return c=d.sent(),k.Z.error(c),n(c),[3,9];case 8:return v(!1),[7];case 9:return[2]}})})(),loading:h,disabled:!C,icon:(0,s.jsx)(eP.G,{icon:eT.EdJ})},p),{children:[L("SaveButton.title"),(0,s.jsx)(rs,{loadComplete:j})]}))},ru=e=>{var r=e.feature,t=e.layer,a=e.form,n=e.onSaveSuccess,l=e.onSaveError,i=e.onDeleteSuccess,o=e.onDeleteError,u=A(e=>e.editFeature.userEditMode);return(0,s.jsxs)("div",{className:"edit-feature-toolbar",children:[u.includes("CREATE")||u.includes("UPDATE")?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ri,{feature:r,form:a}),(0,s.jsx)(ro,{form:a,layer:t,onSuccess:void 0===n?()=>{}:n,onError:void 0===l?()=>{}:l})]}):(0,s.jsx)(s.Fragment,{}),u.includes("DELETE")&&(0,s.jsx)(rl,{feature:r,layer:t,onSuccess:void 0===i?()=>{}:i,onError:void 0===o?()=>{}:o})]})},rc=e=>{var r=e.feature,t=e.layer,a=(0,E.useTranslation)().t,n=eQ(),f=eM(),p=(0,d._)((0,o.useState)(),2),g=p[0],h=p[1],v=(0,d._)((0,o.useState)(),2),y=v[0],j=v[1],x=(0,d._)((0,o.useState)(),2),b=x[0],w=x[1],S=(0,d._)((0,eA.useForm)(),1)[0],_=(0,Z.S)(),C=D(),L=(0,ea.Z)(),N=(0,o.useCallback)(e=>(0,c._)(function(){var r,a,l,i;return(0,m.Jh)(this,function(s){switch(s.label){case 0:if(!t||!(0,X.us)(t))return[2];return a=(r=document.implementation.createDocument(null,"root")).createElement("Filter"),(l=r.createElement("ResourceId")).setAttribute("rid",e),a.appendChild(l),r.documentElement.appendChild(a),[4,n({layer:t,filter:a},"2.0.0")];case 1:return(null==(i=s.sent())?void 0:i.features[0])&&C((0,e_.hr)(null==i?void 0:i.features[0])),[2]}})})(),[C,n,t]),F=(0,o.useCallback)(()=>(0,c._)(function(){var e,a;return(0,m.Jh)(this,function(n){switch(n.label){case 0:if(!_||!L)return[2];if((null==(e=t.get("editFormConfig"))?void 0:e.length)===0)return k.Z.warn(`Layer ${t.get("name")} has no 'editFormConfig' set`),[2];return[4,Promise.all(Object.entries(a=structuredClone(null==r?void 0:r.properties)||{}).map(r=>{var t=(0,d._)(r,2),n=t[0],s=t[1];return(0,c._)(function(){var r,t,o,u,d,p,g,h,v;return(0,m.Jh)(this,function(y){switch(y.label){case 0:if((null==(r=null==e?void 0:e.filter(e=>{var r;return null==(r=e.children)?void 0:r.find(e=>e.propertyName===n)}))?void 0:r.length)>1&&k.Z.warn(`Property ${n} is configured in multiple tabs. Is this intended?`),!(r&&r[0]))return[3,7];if((null==(t=r[0].children)?void 0:t.some(e=>e.propertyName===n&&"DATE"===e.component))&&((d=eo()(s)).isValid()?a[n]=d:(k.Z.warn("Could not parse date"),a[n]=null)),!(null==(o=r[0].children)?void 0:o.some(e=>e.propertyName===n&&"UPLOAD"===e.component)))return[3,6];if(!s)return[3,5];y.label=1;case 1:if(y.trys.push([1,3,,4]),!eB((p=JSON.parse(s))[0]))throw Error("File config is no valid SHOGun file.");return g=p,a[n]=g,[4,Promise.all(g.map(e=>(0,c._)(function(){var r,t,a,n,s,o;return(0,m.Jh)(this,function(u){switch(u.label){case 0:if(!(n=null==(t=g[0].response)||null==(r=t.fileType)?void 0:r.startsWith("image/")))return[3,2];return[4,f(`${L.getBasePath()}imagefiles/${null==e||null==(a=e.response)?void 0:a.fileUuid}/thumbnail`)];case 1:return o=u.sent(),[3,3];case 2:o=void 0,u.label=3;case 3:return s=o,[2,(0,i._)((0,l._)({},e),{thumbUrl:s,url:n?void 0:e.url})]}})})()))];case 2:return h=y.sent(),a[n]=h,[3,4];case 3:return v=y.sent(),k.Z.error("Could not parse file list from JSON config: ",v),a[n]=[],[3,4];case 4:return[3,6];case 5:a[n]=[],y.label=6;case 6:if(null==(u=r[0].children)?void 0:u.some(e=>e.propertyName===n&&"REFERENCE_TABLE"===e.component))try{a[n]=JSON.parse(a[n])}catch(e){k.Z.warn("Could not parse the input for the REFERENCE_TABLE",e)}y.label=7;case 7:return[2]}})})()}))];case 1:return n.sent(),j(a),S.resetFields(),S.setFieldsValue(a),h(e),[2]}})})(),[_,L,t,null==r?void 0:r.properties,S,f]);(0,o.useEffect)(()=>{F()},[F]);var T=e=>{var r=[];return(e.errorFields||[]).forEach(e=>{Array.isArray(e.errors)&&r.push(...e.errors)}),r.map((e,t)=>(0,s.jsxs)(u().Fragment,{children:[e,t!==r.length-1&&(0,s.jsx)("br",{})]},t))};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(rt,{feature:r}),b&&(0,s.jsx)(J.Z,{className:"error-alert",message:b,type:"error",showIcon:!0}),(0,s.jsx)(ru,{feature:r,layer:t,form:S,onSaveSuccess:e=>{if(e){w(void 0);var t,a=null==(t=new DOMParser().parseFromString(e,"text/xml").getElementsByTagName("ogc:FeatureId").item(0))?void 0:t.getAttribute("fid");if("none"===a){var n=r.id;if(!n)return;N(n)}else a&&N(a)}},onSaveError:e=>{"object"==typeof e&&null!==e&&"errorFields"in e?w(T(e)):"string"==typeof e?w(e):w(a("EditFeatureFullForm.saveErrorMsg"))},onDeleteSuccess:()=>{w(void 0),C((0,e_.hr)(null))},onDeleteError:()=>{w(a("EditFeatureFullForm.deleteErrorMsg"))}}),(0,s.jsx)(rn,{tabConfig:g,initialValues:y,form:S})]})},rd=()=>{var e=(0,ea.Z)(),r=e=>{var r,t,a=e.feature.id,n=e.feature.properties;if(!a||!n)return void k.Z.warn("Either the id of the feature or its properties (or even both) aren't available");t="number"==typeof a?a:parseInt(a.split(".")[1],10);var l=Object.entries(n).find(e=>{var r=(0,d._)(e,2)[1];return r===t||r===t.toString()});if(!l)return void k.Z.warn("Count not detect the id property");var i=l[0],s=null==(r=e.layer.getSource())?void 0:r.getParams().LAYERS,o=document.createElementNS("http://www.opengis.net/wfs/2.0","LockFeature");o.setAttribute("service","WFS"),o.setAttribute("version","2.0.0"),o.setAttribute("expiry","300"),o.setAttribute("lockAction","SOME");var u=document.createElementNS("http://www.opengis.net/wfs/2.0","Query");u.setAttribute("typeNames",s);var c=document.createElementNS("http://www.opengis.net/fes/2.0","Filter"),m=document.createElementNS("http://www.opengis.net/fes/2.0","PropertyIsEqualTo"),f=document.createElementNS("http://www.opengis.net/fes/2.0","ValueReference"),p=document.createTextNode(i);f.appendChild(p);var g=document.createElementNS("http://www.opengis.net/fes/2.0","Literal"),h=document.createTextNode(t.toString());return g.appendChild(h),m.appendChild(f),m.appendChild(g),c.appendChild(m),u.appendChild(c),o.appendChild(u),o};return(0,o.useCallback)(t=>(0,c._)(function(){var a,n,i,s,o,u,c,d;return(0,m.Jh)(this,function(m){switch(m.label){case 0:if((i=t.layer.getSource())instanceof Q()&&(n=i.getUrl()),i instanceof er()&&(n=(s=i.getUrls())?s[0]:void 0),!n||(n.endsWith("?")&&(n=n.slice(0,-1)),!(o=r({layer:t.layer,feature:t.feature}))))return[2];return u={"Content-Type":"application/xml"},[4,fetch(n,{method:"POST",headers:(null==(a=t.layer)?void 0:a.get("useBearerToken"))?(0,l._)({},u,(0,et.a)(null==e?void 0:e.getKeycloak())):u,body:new XMLSerializer().serializeToString(o)})];case 1:if(!(c=m.sent()).ok)throw Error("No successful response while executing a WFS-LockFeature");return[4,c.text()];case 2:if(d=m.sent(),new DOMParser().parseFromString(d,"text/xml").getElementsByTagName("wfs:FeaturesNotLocked").length>0)throw Error(`Error while locking a feature: ${d}`);return[2,d]}})})(),[e])},rm=(e,r,t)=>{var a=(0,Z.S)(),n=(0,ea.Z)(),i=(0,o.useCallback)(i=>(0,c._)(function(){var s,o,u,c,d,f,p,g;return(0,m.Jh)(this,function(m){switch(m.label){case 0:if(!a||!e||(s=i.coordinate,!(o=a.getView().getResolution()))||(c=null==(u=e.getSource())?void 0:u.getFeatureInfoUrl(s,o,a.getView().getProjection(),{INFO_FORMAT:"application/json",BUFFER:10}),d={"Content-Type":"application/json"},!c))return[2];m.label=1;case 1:return m.trys.push([1,4,5,6]),a.getTargetElement().style.cursor="wait",[4,fetch(c,{method:"GET",headers:e.get("useBearerToken")?(0,l._)({},d,(0,et.a)(null==n?void 0:n.getKeycloak())):d})];case 2:if(!(f=m.sent()).ok)throw Error("No successful response");return[4,f.json()];case 3:return p=m.sent(),r&&r(p),[3,6];case 4:return g=m.sent(),k.Z.error("Error: ",g),t&&t(),[3,6];case 5:return a.getTargetElement().style.cursor="",[7];case 6:return[2]}})})(),[n,e,a,r,t]),s=(0,o.useCallback)(r=>{if(a&&e&&!r.dragging){var t=e.getData(r.pixel);if(t instanceof Uint8ClampedArray){var n=t&&t[3]>0;a.getTargetElement().style.cursor=n?"pointer":""}}},[e,a]);(0,o.useEffect)(()=>{if(a)return a.on("pointermove",s),a.on("singleclick",i),()=>{a.un("pointermove",s),a.un("singleclick",i)}},[a,s,i])},rf=e=>{var r=e.layer,t=e.onLockSuccess,a=void 0===t?()=>{}:t,n=e.onLockError,l=void 0===n?()=>{}:n,i=e.onCreate,u=void 0===i?()=>{}:i,f=(0,d._)((0,o.useState)(!1),2),p=f[0],g=f[1],h=eJ(),v=rd(),y=D(),j=(0,Z.S)(),x=(0,E.useTranslation)().t,b=A(e=>e.editFeature.userEditMode);rm(r,e=>(0,c._)(function(){var t,n;return(0,m.Jh)(this,function(i){switch(i.label){case 0:if(!(e.features.length&&(b.includes("UPDATE")||b.includes("DELETE"))))return[3,6];if(t=e.features[0],!r||!t)return[2];if(!K().wfsLockFeatureEnabled)return[3,5];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,v({layer:r,feature:t})];case 2:if(!(n=i.sent()))return[2];return y((0,e_.hr)(t)),a(n),[3,4];case 3:return l(i.sent()),[3,4];case 4:return[3,6];case 5:y((0,e_.hr)(t)),i.label=6;case 6:return[2]}})})());var w=()=>(0,c._)(function(){var e,t,a,n,l;return(0,m.Jh)(this,function(i){switch(i.label){case 0:if(!j||!r)return[2];i.label=1;case 1:return i.trys.push([1,3,4,5]),g(!0),[4,h(r)];case 2:if(!(a=i.sent()))return[2];switch(null==(n=null==(t=a.featureTypes[0])||null==(e=t.properties)?void 0:e.find(e=>ez(e.type)))?void 0:n.type){case"gml:MultiPoint":return[2,"MultiPoint"];case"gml:Point":return[2,"Point"];case"gml:MultiLineString":return[2,"MultiLineString"];case"gml:LineString":return[2,"LineString"];case"gml:MultiPolygon":return[2,"MultiPolygon"];case"gml:Polygon":return[2,"Polygon"];case"xsd:boolean":case"xsd:date":case"xsd:int":case"xsd:number":case"xsd:string":case void 0:return[2]}return[3,5];case 3:return l=i.sent(),k.Z.error(l),[3,5];case 4:return g(!1),[7];case 5:return[2]}})})();return(0,s.jsxs)("div",{className:"edit-feature-switch",children:[b.includes("CREATE")&&(0,s.jsxs)(s.Fragment,{children:[b.includes("UPDATE")&&(0,s.jsx)("div",{children:x("EditFeatureSwitch.usageHint")}),(0,s.jsx)(eL.ZP,{loading:p,onClick:()=>(0,c._)(function(){var e;return(0,m.Jh)(this,function(r){switch(r.label){case 0:return[4,w()];case 1:if(!(e=r.sent()))return[2];return y((0,e_.hr)({type:"Feature",properties:{},geometry:{type:e,coordinates:[]}})),u(),[2]}})})(),children:x("EditFeatureSwitch.createFeature")})]}),!b.includes("CREATE")&&(b.includes("UPDATE")||b.includes("DELETE"))&&(0,s.jsx)("div",{children:x("EditFeatureSwitch.limitedUsageHint")})]})},rp=e=>{var r=(0,a._)({},(0,n._)(e)),t=(0,E.useTranslation)().t,u=(0,d._)((0,o.useState)(),2),f=u[0],g=u[1],h=(0,d._)((0,o.useState)(!1),2),v=h[0],y=h[1],j=(0,d._)((0,o.useState)(t("EditFeatureDrawer.featureEditor")),2),x=j[0],b=j[1],w=A(e=>e.editFeatureDrawerOpen),S=A(e=>e.editFeature.layerId),_=A(e=>e.editFeature.feature),C=A(e=>e.editFeature.formDirty),L=(0,Z.S)(),N=D(),T=eW(),P=en();(0,o.useEffect)(()=>{if(L&&S){var e=F.C.getLayerByOlUid(L,S);if(!e||!(0,X.us)(e))return void k.Z.warn(`Could not find layer with id ${S}`);b(`${t("EditFeatureDrawer.featureEditor")} - ${e.get("name")}`),g(e)}},[L,S,t]);var M=()=>(0,c._)(function(){var e,r,t;return(0,m.Jh)(this,function(a){switch(a.label){case 0:if(!f||!_||!_.id||!K().wfsLockFeatureEnabled)return[2];a.label=1;case 1:return a.trys.push([1,4,,5]),(e=new(Y())).setId(_.id),[4,T({layer:f,deleteFeatures:[],upsertFeatures:[e]})];case 2:if(!(r=a.sent()))return[2];return[4,P({layer:f,transaction:r})];case 3:return a.sent(),[3,5];case 4:return t=a.sent(),k.Z.error("Error while releasing the lock on the feature: ",t),[3,5];case 5:return[2]}})})(),O=()=>(0,c._)(function(){return(0,m.Jh)(this,function(e){switch(e.label){case 0:return[4,M()];case 1:return e.sent(),N((0,eK.Cp)()),N((0,e_.uQ)(!1)),N((0,e_.mc)()),y(!1),[2]}})})();return(0,s.jsxs)(eY,(0,i._)((0,l._)({className:"map-drawer edit-feature-drawer",onClose:()=>{f&&_&&C?p.Z.confirm({maskClosable:!1,title:t("EditFeatureDrawer.closeDrawerWarnTitle"),content:t("EditFeatureDrawer.closeDrawerWarnContent"),okType:"danger",onOk:O}):O()},open:w,title:x},r),{children:[!f&&(0,s.jsx)(J.Z,{message:t("EditFeatureDrawer.noLayerFoundError"),type:"error",showIcon:!0}),v&&(0,s.jsx)(J.Z,{message:t("EditFeatureDrawer.isFeatureLockedErrorMsg"),type:"error",showIcon:!0}),f&&S&&!_&&(0,s.jsx)(rf,{layer:f,onLockSuccess:()=>{y(!1)},onLockError:()=>{y(!0)},onCreate:()=>{y(!1)}}),f&&_&&(0,s.jsx)(rc,{feature:_,layer:f})]}))},rg=t(11843),rh=t(40440),rv=t(51614),ry=t.n(rv),rj=t(39988),rx=t.n(rj),rb=t(21473),rw=t(79670),rS=t.n(rw),r_=t(51108),rC=()=>"9.0.0",rE=e=>{var r,t=e.opener,a=(0,em._)(e,["opener"]),n=(0,E.useTranslation)().t,c=A(e=>e.appInfo),m=A(e=>e.logoPath),f=A(e=>e.description),g=(0,d._)((0,o.useState)(!1),2),h=g[0],v=g[1],y=()=>{v(!h)};return r=t?u().cloneElement(t,{onClick:y}):(0,s.jsx)("button",{onClick:y,children:"Open"}),(0,s.jsxs)(s.Fragment,{children:[r,(0,s.jsxs)(p.Z,(0,i._)((0,l._)({className:"application-info",title:n("ApplicationInfo.title"),centered:!0,open:h,onOk:y,onCancel:y,footer:null},a),{children:[(0,s.jsx)("img",{className:"logo",src:m}),(0,s.jsx)("div",{className:"description",children:f}),(0,s.jsx)(r_.Z,{title:n("ApplicationInfo.clientVersionTitle"),value:rC()}),c.version&&c.buildTime&&(0,s.jsx)(r_.Z,{title:n("ApplicationInfo.backendVersionTitle"),value:`${c.version} (${c.buildTime})`})]}))]})},rk=e=>{var r,t,u=(0,a._)({},(0,n._)(e)),c=R(),d=(0,E.useTranslation)().t,m=A(e=>e.legal),f=(0,Z.S)(),p=(e,r)=>{c.forEach(t=>{if((n=t.integration)&&"footer"===n.placement&&(null==(a=t.integration)?void 0:a.placementOrientation)===e){var a,n,l,i,o=t.key,u=t.wrappedComponent;r.splice(null!=(i=null==(l=t.integration)?void 0:l.insertionIndex)?i:0,0,(0,s.jsx)(u,{},o))}})};return((0,o.useEffect)(()=>{f&&(f.getControls().getArray().find(e=>e instanceof rx())||f.addControl(new(rx())({target:"scale-line-container"})))},[f]),(0,o.useEffect)(()=>{f&&(f.getControls().getArray().find(e=>e instanceof ry())||f.addControl(new(ry())({coordinateFormat:(0,rb.createStringXY)(2),projection:f.getView().getProjection(),target:"mouse-position"})))},[f]),f)?(0,s.jsxs)("div",(0,i._)((0,l._)({className:"footer"},u),{children:[(0,s.jsx)("div",{className:"item-container left-items",children:(p("left",r=[(0,s.jsx)("div",{id:"scale-line-container","aria-label":"scale-line"},"scale-line-container"),(0,s.jsx)(rg.Z,{type:"vertical"},"scale-line-divider"),(0,s.jsxs)("div",{className:"scale-combo","aria-label":"scale-combo",children:[d("Footer.scale"),":\xa0",(0,s.jsx)(rS(),{"aria-label":"scalecombo-dropdown"}),(0,s.jsx)(rg.Z,{type:"vertical"})]},"scale-combo-container"),(0,s.jsxs)("div",{className:"reference-system","aria-label":"reference-system",children:[d("Footer.refSystem"),": ",f.getView().getProjection().getCode(),(0,s.jsx)(rg.Z,{type:"vertical"})]},"reference-system-container"),(0,s.jsxs)("div",{className:"mouse-position-wrapper",children:[d("Footer.mousePosition"),":\xa0",(0,s.jsx)("div",{id:"mouse-position",className:"mouse-position","aria-label":"mouse-position"})]},"mouse-position-container")]),r)}),(0,s.jsx)("div",{className:"item-container right-items",children:(t=[(0,s.jsx)(eL.ZP,{onClick:()=>{window.open(m.contact,"_blank")},type:"link",children:d("Footer.contact")},"open-contact"),(0,s.jsx)(eL.ZP,{onClick:()=>{window.open(m.imprint,"_blank")},type:"link",children:d("Footer.imprint")},"open-imprint"),(0,s.jsx)(eL.ZP,{onClick:()=>{window.open(m.privacy,"_blank")},type:"link",children:d("Footer.privacypolicy")},"open-privacy"),(0,s.jsx)(rE,{opener:(0,s.jsx)(rh.Z,{title:d("Footer.aboutTooltip"),children:(0,s.jsx)(eL.ZP,{type:"link","aria-label":"info-opener",children:d("Footer.about")})})},"application-info")],c.length>0&&p("right",t),t)})]})):(0,s.jsx)(s.Fragment,{})},rL="documentationbutton",rN=e=>{var r=e.className,t=(0,E.useTranslation)().t,a=r?`${rL} ${r}`:rL;return(0,s.jsx)(rh.Z,{title:t("DocumentationButton.tooltip"),children:(0,s.jsx)(eL.ZP,{type:"link","aria-label":"documentation-button",onClick:()=>window.open("/gis-docs","_blank"),className:a,icon:(0,s.jsx)(eP.G,{icon:eT.FDd})})})},rF=t(1695),rT=()=>{var e=(0,Z.S)(),r=(0,E.useTranslation)().t;return(0,o.useCallback)((t,a)=>(0,c._)(function(){var n,l,i,s,o;return(0,m.Jh)(this,function(u){switch(u.label){case 0:if(!e)return[2];return[4,(0,rF.AH)({bounded:a?1:void 0,viewBox:a?null==a?void 0:a.toString():void 0,countryCodes:"",nominatimBaseUrl:null!=(l=null==(n=K().search)?void 0:n.nominatimUrl)?l:"https://nominatim.openstreetmap.org/search?"})(t)];case 1:return i=u.sent(),s=new(e4()),o=null==i?void 0:i.features.filter(e=>!eb()(null==e?void 0:e.properties.geojson)).map(r=>{var t=s.readFeature(r.properties.geojson,{dataProjection:"EPSG:4326",featureProjection:e.getView().getProjection()});if(!Array.isArray(t))return t.set("title",r.properties.display_name),t}).filter(e=>void 0!==e),[2,[{title:r("useNominatimSearchEngine.title"),features:null!=o?o:[]}]]}})})(),[e,r])},rP=t(7739),rZ=t.n(rP),rM=t(60319),rD=t.n(rM),rA=e=>e.map(e=>`(${e.trim()}^4 OR *${e.trim()}*^2 OR ${e.trim()}~1)`).join(" AND "),rO=e=>{var r=e.searchValue,t=e.map,a=r.trim().replaceAll(/[()\\\-_.//]/g," ").split(" ").map(e=>e.trim()).filter(e=>""!==e),n=[],l=t.getAllLayers().filter(e=>e.get("searchable"));return Object.entries(rZ()(l,e=>{var r;return null==(r=e.get("searchConfig"))?void 0:r.attributes})).forEach(e=>{var r=(0,d._)(e,2),t=r[0],l=r[1].filter(e=>(0,X.us)(e)).map(e=>{var r,t;return null==(t=e.getSource())||null==(r=t.getParams())?void 0:r.LAYERS}).map(e=>`featureType:"${e}"`).join(" OR "),i=`(${l}) AND (${rA(a)})`;n.push({query:i,fieldList:"undefined"!==t?t.split(",").join(" "):void 0})}),n},rU=()=>{var e=(0,ea.Z)();return(0,o.useCallback)(r=>(0,c._)(function(){var t,a,n,i,s,o,u,c,d;return(0,m.Jh)(this,function(m){switch(m.label){case 0:return n={q:r.query,rows:null!=(t=r.rowsPerQuery)?t:100,defType:null!=(a=r.queryParser)?a:"edismax"},r.fieldList?n.qf=r.fieldList:n.qf=null!=(i=r.coreName)?i:"search",r.viewBox&&(n.fq=`geometry:[${r.viewBox[1]},${r.viewBox[0]} TO ${r.viewBox[3]},${r.viewBox[2]}]`),r.useSolrHighlighting&&(n.hl=!0,n["hl.fl"]="*",n["hl.tag.pre"]=null!=(s=r.tagPre)?s:"<b>",n["hl.tag.post"]=null!=(o=r.tagPost)?o:"</b>",n["hl.requireFieldMatch"]=null==(u=r.requireFieldMatch)||u),c={"Content-Type":"application/json"},[4,fetch(r.searchUrl,{method:"POST",headers:(0,l._)({},c,(0,et.a)(null==e?void 0:e.getKeycloak())),body:JSON.stringify(n)})];case 1:if(!(d=m.sent()).ok)throw Error("Failed to execute Solr query");return[4,d.json()];case 2:return[2,m.sent()]}})})(),[e])},rI=e=>"fulfilled"===e.status,rG=e=>"rejected"===e.status,r$=()=>{var e=(0,Z.S)(),r=rU(),t=(0,o.useCallback)((e,r)=>e.replace(/{\s*(\w+?)\s*}/g,(e,t)=>{var a;return(null==(a=r[t])?void 0:a.toString())||""}),[]),a=(0,o.useCallback)((r,a,n)=>{if(!e)return"";var l=F.C.getLayerByNameParam(e,a.featureType[0]),i=null==l?void 0:l.get("searchConfig"),s=["category","id","featureType","geometry","search"],o="";if(null==i?void 0:i.displayTemplate)return t(i.displayTemplate,a);if(n){var u=Object.keys(n).filter(e=>!s.includes(e));if(u.length>0){var c=n[u[0]];return`${c} [${u[0]}]`}}return Object.keys(a).filter(e=>!s.includes(e)).forEach(e=>{var t,n=null==(t=a[e])?void 0:t.toString();!o&&n.toLowerCase().indexOf(r.toLowerCase())>-1&&(o=`${n} [${e}]`)}),o||(o=a.id),o},[e,t]);return(0,o.useCallback)((t,n)=>(0,c._)(function(){var i,s,o,u,c,d,f,p,g,h,v,y,j,x,b,w,S,_,C,E,L,N,T,P,Z,M,D,A,O,U,I,G,$;return(0,m.Jh)(this,function(m){switch(m.label){case 0:if(!e)return[2];u=null!=(o=null==(i=K().search)?void 0:i.solrBasePath)?o:"/search/query",c=rO({searchValue:t,map:e}),d=[],f=!0,p=!1,g=void 0;try{for(h=c[Symbol.iterator]();!(f=(v=h.next()).done);f=!0)y=v.value,d.push(r({searchUrl:u,query:y.query,fieldList:y.fieldList,rowsPerQuery:null==(x=K().search)||null==(j=x.solrQueryConfig)?void 0:j.rowsPerQuery,queryParser:null==(w=K().search)||null==(b=w.solrQueryConfig)?void 0:b.queryParser,coreName:null==(S=K().search)?void 0:S.coreName,useSolrHighlighting:null==(_=K().search)?void 0:_.useSolrHighlighting,tagPre:null==(E=K().search)||null==(C=E.solrQueryConfig)?void 0:C.tagPre,tagPost:null==(N=K().search)||null==(L=N.solrQueryConfig)?void 0:L.tagPost,requireFieldMatch:null==(P=K().search)||null==(T=P.solrQueryConfig)?void 0:T.requireFieldMatch,viewBox:n}))}catch(e){p=!0,g=e}finally{try{f||null==h.return||h.return()}finally{if(p)throw g}}return[4,Promise.allSettled(d)];case 1:return M=(Z=m.sent().map(e=>({value:rI(e)?e.value:void 0,reason:rG(e)?e.reason:void 0,status:e.status}))).filter(e=>"fulfilled"===e.status),Z.filter(e=>"rejected"===e.status).map(e=>{k.Z.error("Error while fetching the solr results for layer ",e.reason)}),D=M.flatMap(e=>{var r,t;return null==(t=e.value)||null==(r=t.response)?void 0:r.docs}).filter(e=>e),A=Object.assign({},...M.map(e=>{var r;return null==(r=e.value)?void 0:r.highlighting})),O=new(rD()),U=[],(null==(s=K().search)?void 0:s.groupByCategory)?I=rZ()(D,e=>{var r;return null==e||null==(r=e.category)?void 0:r[0]}):(G=e.getAllLayers().filter(e=>e.get("searchable")),$=D.map(e=>{var r,t=null==(r=G.filter(e=>(0,X.us)(e)).find(r=>{var t,a,n;return(null==(a=r.getSource())||null==(t=a.getParams())?void 0:t.LAYERS)===(null==e||null==(n=e.featureType)?void 0:n[0])}))?void 0:r.get("name");return(0,l._)({layerTitle:t},e)}),I=rZ()($,e=>null==e?void 0:e.layerTitle)),Object.keys(I).forEach(r=>{var n=I[r].map(r=>{if(null==r||null==(s=r.geometry)?void 0:s[0]){var n=r.id,l=O.readGeometry(r.geometry[0],{dataProjection:"EPSG:4326",featureProjection:e.getView().getProjection()}),i=new(Y())({geometry:l});if(i.set("title",a(t,r,null==A?void 0:A[n])),null==(o=r.featureType)?void 0:o[0]){var s,o,u,c,d=F.C.getLayerByNameParam(e,null==(c=r.featureType)?void 0:c[0]);d&&(i.set("layer",d),u=d.get("name"))}else u=n.substring(0,n.lastIndexOf("_"));return i.set("ftName",u),i}}).filter(e=>e);U.push({title:r,features:n})}),[2,U]}})})(),[r,a,e])},rR=t(76849),rB=t(62481),rV=e=>"fulfilled"===e.status,rz=e=>"rejected"===e.status,rJ=()=>{var e=(0,Z.S)(),r=eQ(),t=(0,o.useCallback)((e,r)=>e.replace(/{\s*(\w+?)\s*}/g,(e,t)=>r.getProperties()[t]||""),[]),a=(0,o.useCallback)((e,r,a)=>{var n=null==a?void 0:a.get("searchConfig");if(null==n?void 0:n.displayTemplate)return t(n.displayTemplate,r);var l=["category","id","featureType","geometry","search"],i=!0,s=!1,o=void 0;try{for(var u,c=Object.entries(r.getProperties())[Symbol.iterator]();!(i=(u=c.next()).done);i=!0){var m=(0,d._)(u.value,2),f=m[0],p=m[1];if(!l.includes(f)){var g=null==p?void 0:p.toString();if(g.toLowerCase().indexOf(null==e?void 0:e.toLowerCase())>-1)return`${g} [${f}]`}}}catch(e){s=!0,o=e}finally{try{i||null==c.return||c.return()}finally{if(s)throw o}}return r.getId()},[t]);return(0,o.useCallback)((t,n)=>(0,c._)(function(){var l,i,s,o,u,c,d,f,p,g,h,v,y,j,x,b,w,S,_,C,E;return(0,m.Jh)(this,function(m){switch(m.label){case 0:if(!e)return[2];if(0===(l=e.getAllLayers().filter(e=>e.get("searchable"))).length)return k.Z.warn("No queryable layer found."),[2];i=[],s=[],o=!0,u=!1,c=void 0;try{for(d=l[Symbol.iterator]();!(o=(f=d.next()).done);o=!0){if(p=f.value,!(0,X.us)(p)){k.Z.warn("Layer type not supported in search: ",p);continue}if(!((g=null==p?void 0:p.get("searchConfig"))&&g.attributes)){k.Z.warn("No search configuration given for layer: ",p);continue}h=g.attributes.map(e=>(0,rR.like)(e,`*${t}*`,"*",".","!",!1)),i.push(r({layer:p,filter:1===h.length?h[0]:(0,rR.or)(...h),bbox:n?(0,rB.transformExtent)(n,"EPSG:4326",e.getView().getProjection()):void 0,maxFeatures:10,propertyNames:g.attributes})),s.push(p)}}catch(e){u=!0,c=e}finally{try{o||null==d.return||d.return()}finally{if(u)throw c}}return[4,Promise.allSettled(i)];case 1:y=(v=m.sent().map((e,r)=>({value:rV(e)?e.value:void 0,reason:rz(e)?e.reason:void 0,status:e.status,layer:s[r]}))).filter(e=>"fulfilled"===e.status),v.filter(e=>"rejected"===e.status).map(e=>{k.Z.error(`Error while fetching the layer search results for layer "${e.layer.get("name")}": `,e.reason)}),j=new(e4()),x=[],b=!0,w=!1,S=void 0;try{for(_=function(){var r=E.value,n=j.readFeatures(r.value,{featureProjection:e.getView().getProjection()});n.forEach(e=>{e.set("title",a(t,e,r.layer)),e.set("layer",r.layer)}),x.push({title:r.layer.get("name"),features:n})},C=y[Symbol.iterator]();!(b=(E=C.next()).done);b=!0)_()}catch(e){w=!0,S=e}finally{try{b||null==C.return||C.return()}finally{if(w)throw S}}return[2,x]}})})(),[r,a,e])},rW=t(91754),rK=t(45540),rq=t(71136),rY=t(81316),rX=t(87044),rH=t(14622),rQ=t(89686),r0=t.n(rQ),r1=t(22336),r2=t.n(r1),r3=t(28513),r4=t.n(r3),r5=t(83713),r7=t.n(r5),r6=t(35674),r9=t(86955),r8=t.n(r9),te=e=>{var r,t,a=e.geocoderSearchEngine,n=e.dataSearchEngine,l=(0,Z.S)(),i=(0,E.useTranslation)().t,u=(0,o.useRef)(null),f=(0,d._)((0,o.useState)(!!a),2),p=f[0],h=f[1],v=(0,d._)((0,o.useState)(!!n),2),y=v[0],x=v[1],b=(0,d._)((0,o.useState)(null==(t=null==(r=K().search)?void 0:r.defaultUseViewBox)||t),2),w=b[0],S=b[1],_=(0,d._)((0,o.useState)(""),2),C=_[0],L=_[1],N=(0,d._)((0,o.useState)(!1),2),F=N[0],T=N[1],P=(0,d._)((0,o.useState)(!1),2),M=P[0],D=P[1],A=(0,d._)((0,o.useState)(!1),2),O=A[0],U=A[1],I=(0,d._)((0,o.useState)([]),2),G=I[0],$=I[1];(0,o.useEffect)(()=>(window.addEventListener("mousedown",R),()=>{window.removeEventListener("mousedown",R)}),[]);var R=e=>{for(var r=e.target;r;)r=r.parentNode;u.current&&u.current.contains(e.target)||D(!1)},B=(0,o.useMemo)(()=>{var e={items:[{label:(0,s.jsx)(ep.Z,{checked:w,onChange:e=>S(e.target.checked),children:i("MultiSearch.searchInViewBox")}),key:"viewbox"}]};return a&&e.items.push({label:(0,s.jsx)(ep.Z,{checked:p,onChange:e=>h(e.target.checked),children:i("MultiSearch.searchGeocoder")}),key:"geocoder"}),n&&e.items.push({label:(0,s.jsx)(ep.Z,{checked:y,onChange:e=>x(e.target.checked),children:i("MultiSearch.searchData")}),key:"data"}),e},[w,i,a,n,p,y]),V=(0,o.useCallback)(()=>(0,c._)(function(){var e,r,t,i,s,o,u,c,d,f,g,h;return(0,m.Jh)(this,function(m){switch(m.label){case 0:if(!l||!p&&!y)return[2];if(t=null!=(r=null==(e=K().search)?void 0:e.minChars)?r:3,C.length<t)return z(),[2];if(T(!0),w&&(o=null==l?void 0:l.getView().getProjection(),(u=null==l||null==(s=l.getView())?void 0:s.calculateExtent())&&(i=(0,rB.transformExtent)(u,o,"EPSG:4326"))),c=[],!(y&&n))return[3,5];m.label=1;case 1:return m.trys.push([1,3,4,5]),[4,n(C,i)];case 2:if(!(d=m.sent()))throw Error("No response from data search engine.");return c.push(...d),[3,5];case 3:return f=m.sent(),k.Z.error("Error while data search: \n",f),[3,5];case 4:return p||T(!1),[7];case 5:if(!(p&&a))return[3,10];m.label=6;case 6:return m.trys.push([6,8,9,10]),[4,a(C,i)];case 7:if(!(g=m.sent()))throw Error("No response from geocoder search engine.");return c.push(...g),[3,10];case 8:return h=m.sent(),k.Z.error("Error while geocoder search: \n",h),[3,10];case 9:return T(!1),[7];case 10:return $(c.every(e=>0===e.features.length)?[]:c),D(!0),[2]}})})(),[l,p,y,C,w,n,a]);(0,o.useEffect)(()=>{var e,r,t=setTimeout(()=>{V()},null!=(r=null==(e=K().search)?void 0:e.delay)?r:1e3);return()=>clearTimeout(t)},[V]);var z=()=>{$([])},J=e=>{var r=e.feature.get("layer");if(null==r?void 0:r.get("editable"))return[(0,s.jsx)(s.Fragment,{})]},W=(0,o.useMemo)(()=>new(r7())({stroke:new(r4())({color:"rgb(255,0,0)",width:2}),fill:new(r2())({color:"rgba(255,255,255, 0.5)"}),image:new(r0())({radius:10,fill:new(r2())({color:"rgba(255,255,255, 0.5)"}),stroke:new(r4())({color:"rgb(255,0,0)",width:3})})}),[]);return(0,s.jsxs)("div",{className:"multi-search",ref:u,children:[(0,s.jsxs)(rX.Z.Compact,{children:[(0,s.jsx)(g.Z,{value:C,disabled:!p&&!y,onChange:e=>{T(""!==e.target.value),L(e.target.value)},allowClear:!0,onFocus:()=>D(!0),placeholder:p&&y?i("MultiSearch.searchPlaceholder"):!p&&y?i("MultiSearch.searchPlaceholderDataOnly"):p&&!y?i("MultiSearch.searchPlaceholderGeocoderOnly"):void 0,prefix:(0,s.jsx)(rW.Z,{}),suffix:F?(0,s.jsx)(rK.Z,{}):null}),(0,s.jsx)(rH.Z,{menu:B,trigger:["click"],onOpenChange:U,open:O,children:(0,s.jsx)(rh.Z,{title:i("MultiSearch.settingsTooltip"),placement:"right",children:(0,s.jsx)(eL.ZP,{icon:(0,s.jsx)(rq.Z,{})})})})]}),(()=>{if(C.length<2||!M||F||!G)return null;var e=G.length;if(0===e)return(0,s.jsx)("div",{className:"no-search-result-div",children:(0,s.jsx)(rY.Z,{image:rY.Z.PRESENTED_IMAGE_SIMPLE})});var r=e=>{var r,t=null==e||null==(r=e.feature)?void 0:r.get("layer");t&&l&&!t.getVisible()&&(t.setVisible(!0),r6.k.setParentsVisible(l,l.getLayerGroup().getLayers(),(0,j.getUid)(t)))},t=e=>{var r,t,a,n=null==(r=e.feature.getGeometry())?void 0:r.getExtent(),i=null!=(a=null==(t=document.getElementsByClassName("tool-menu")[0])?void 0:t.clientWidth)?a:0;n&&(null==l||l.getView().fit(n,{size:l.getSize(),padding:[0,0,0,i]}))};return(0,s.jsx)(r8(),{searchResults:G,numTotal:e,accordion:!0,searchTerms:C.split(" "),actionsCreator:J,layerStyle:W,onClick:e=>{var a;D(!1),t(e),(null==(a=K().search)?void 0:a.activateLayerOnClick)&&r(e)}})})()]})},tr=e=>{var r=(0,a._)({},(0,n._)(e)),t=A(e=>e.searchEngines.includes("nominatim")),i=A(e=>e.searchEngines.includes("solr")),o=A(e=>e.searchEngines.includes("wfs")),u=rJ(),c=r$(),d=rT();return t||i||o?(0,s.jsx)("div",{className:"search","aria-label":"search-field",children:(0,s.jsx)(te,(0,l._)({"aria-label":"search",geocoderSearchEngine:(()=>{if(t)return d})(),dataSearchEngine:i&&o?void k.Z.warn("Both solr and wfs search are configured. Only one of them can be used at the same time."):i?c:o?u:void 0},r))}):(k.Z.warn("Neither nominatim, solr nor wfs search is configured."),(0,s.jsx)(s.Fragment,{}))},tt=t(88495),ta=e=>{var r=e.email,t=e.size,a=e.rating,n=e.defaultImage,l=e.force,i=(void 0===r?"":r).toLowerCase(),s=(0,tt.md5)(i),o=`https://www.gravatar.com/avatar/${s}?s=${void 0===t?80:t}&r=${void 0===a?"g":a}&d=${void 0===n?"identicon":n}`;return void 0!==l&&l&&(o=`${o}&f=y`),o},tn=t(39111),tl=e=>{var r=e.className,t=e.imageSrc,a=e.userMenu,n=e.userName,o=e.style,u=(0,em._)(e,["className","imageSrc","userMenu","userName","style"]),c="userchip",d=()=>eE()(n)?n.split(" ").map(e=>{var r;return null!=(r=e[0])?r:""}).join("").toUpperCase():"??",m=()=>{var e=r?`${r} ${c}`:c;return(0,s.jsxs)("div",{className:e,style:o,children:[(0,s.jsx)(tn.Z,(0,i._)((0,l._)({src:t,size:"large",className:"userimage"},u),{children:t?"":d()})),(0,s.jsx)("span",{className:"username",children:n})]})};return(null==a?void 0:a.items)?(0,s.jsx)(rH.Z,{menu:a,trigger:["click"],getPopupContainer:()=>document.getElementsByClassName(c)[0],children:m()}):m()},ti=()=>{var e,r,t,a,n,l,i,u,f,p,g,h,v,y,j,x,b=(0,E.useTranslation)().t,w=(0,d._)((0,o.useState)(),2),S=w[0],_=w[1],C=(0,ea.Z)(),k=null==C?void 0:C.getKeycloak(),L=A(e=>e.user);return(0,o.useEffect)(()=>{(0,c._)(function(){return(0,m.Jh)(this,function(e){switch(e.label){case 0:return[4,null==k?void 0:k.createLoginUrl()];case 1:return _(e.sent()),[2]}})})()},[k]),(0,s.jsx)("div",{className:"user-menu",children:e2()(L)?(0,s.jsx)(rh.Z,{title:b("UserMenu.loginTooltip"),children:(0,s.jsx)(eL.ZP,{type:"link",onClick:()=>{k&&k.login()},icon:(0,s.jsx)(eP.G,{icon:eT.Yem}),children:b("UserMenu.loginMenuTitle")})}):(0,s.jsx)(tl,{size:"small",imageSrc:ta({email:null!=(x=null==(j=L.providerDetails)?void 0:j.email)?x:"",size:28}),userName:(0,s.jsx)(eP.G,{icon:eT.gc2}),userMenu:(p={key:"username",label:(0,s.jsxs)("div",{className:"username-menu-item","aria-label":"user-name",children:[(0,s.jsx)("span",{className:"item-username",children:null!=(i=null==(e=L.providerDetails)?void 0:e.username)?i:L.authProviderId}),(0,s.jsx)("br",{}),(0,s.jsx)("span",{className:"item-fullname",children:`${null!=(u=null==(r=L.providerDetails)?void 0:r.firstName)?u:""} ${null!=(f=null==(t=L.providerDetails)?void 0:t.lastName)?f:""}`})]})},g={type:"divider"},h={key:"settings",icon:(0,s.jsx)(eP.G,{icon:eT.gNZ}),label:b("UserMenu.settingsMenuTitle")},v={key:"logout",icon:(0,s.jsx)(eP.G,{icon:eT.HEx}),label:(0,s.jsx)("div",{"aria-label":"logout",children:b("UserMenu.logoutMenuTitle")})},{items:Array.isArray(y=null==k||null==(l=k.tokenParsed)||null==(n=l.resource_access)||null==(a=n.account)?void 0:a.roles)&&y.indexOf("manage-account")>-1?[p,g,h,g,v]:[p,g,v],onClick:e=>{switch(e.key){case"settings":k&&k.accountManagement();break;case"logout":k&&k.logout({redirectUri:S})}}})})})},ts=e=>{var r,t,o,u=(0,a._)({},(0,n._)(e)),c=A(e=>e.title),d=A(e=>e.logoPath),m=A(e=>e.userMenu.visible),f=R(),p=(e,r)=>{f.forEach(t=>{if((n=t.integration)&&"header"===n.placement&&(null==(a=t.integration)?void 0:a.placementOrientation)===e){var a,n,l,i,o=t.key,u=t.wrappedComponent;r.splice(null!=(i=null==(l=t.integration)?void 0:l.insertionIndex)?i:0,0,(0,s.jsx)(u,{},o))}})};return(0,s.jsxs)("div",(0,i._)((0,l._)({className:"header"},u),{children:[(0,s.jsx)("div",{className:"item-container left-items",children:(p("left",r=[(0,s.jsx)("img",{className:"logo","aria-label":"logo",src:d},"logo"),(0,s.jsx)("div",{className:"title","aria-label":"title",children:c},"title")]),r)}),(0,s.jsx)("div",{className:"item-container center-items",children:(p("center",t=[(0,s.jsx)(tr,{"aria-label":"search-input",name:"search-input",className:"search-input"},"search")]),t)}),(0,s.jsx)("div",{className:"item-container right-items",children:(p("right",o=[(()=>{if(K().documentationButtonVisible)return(0,s.jsx)(rN,{},"docs-button")})(),(()=>{var e;if(m&&(null==(e=K().keycloak)?void 0:e.enabled))return(0,s.jsx)("div",{"aria-label":"user-menu",children:(0,s.jsx)(ti,{},"user-menu")},"user-menu")})()].filter(e=>void 0!==e)),o)})]}))},to=t(29097),tu=t(32757),tc=t.n(tu),td=t(23578),tm=t(91885),tf=e=>{var r=e.layer,t=(0,em._)(e,["layer"]),a=(0,d._)((0,o.useState)(!1),2),n=a[0],u=a[1],f=(0,d._)((0,o.useState)(),2),p=f[0],g=f[1],h=(0,d._)((0,o.useState)(),2),v=h[0],y=h[1],j=(0,ea.Z)(),x=(0,E.useTranslation)().t,b=(0,o.useCallback)(()=>(0,c._)(function(){var e;return(0,m.Jh)(this,function(t){switch(t.label){case 0:if(t.trys.push([0,2,3,4]),u(!0),g(""),!r||!r.get("shogunId"))throw Error("No layer provided or the layer has no shogunId set");return[4,null==j?void 0:j.layer().findOne(r.get("shogunId"))];case 1:return y(t.sent()),[3,4];case 2:return e=t.sent(),k.Z.error(e),g(x("LayerConfiguration.errorMessage")),[3,4];case 3:return u(!1),[7];case 4:return[2]}})})(),[x,j,r]);return((0,o.useEffect)(()=>{b()},[b]),p)?(0,s.jsx)(J.Z,{type:"error",closable:!0,message:p}):(0,s.jsx)(tm.Z,{spinning:n,children:(0,s.jsx)("pre",(0,i._)((0,l._)({className:"layer-configuration"},t),{children:(0,s.jsx)("code",{children:JSON.stringify(v,null,"  ")})}))})},tp=e=>{var r=e.layer,t=(0,em._)(e,["layer"]),a=(0,d._)((0,o.useState)(!1),2),n=a[0],u=a[1],f=(0,d._)((0,o.useState)(),2),p=f[0],g=f[1],h=(0,d._)((0,o.useState)(),2),v=h[0],y=h[1],j=(0,ea.Z)(),x=(0,E.useTranslation)().t,b=(0,o.useCallback)(()=>(0,c._)(function(){var e;return(0,m.Jh)(this,function(t){switch(t.label){case 0:if(!r||!(0,X.us)(r))return[2];t.label=1;case 1:return t.trys.push([1,3,4,5]),u(!0),y(""),g(void 0),[4,N.Z.getWmsCapabilitiesByLayer(r,{headers:(0,l._)({},r.get("useBearerToken")?(0,l._)({},(0,et.a)(null==j?void 0:j.getKeycloak())):void 0)})];case 2:return g(t.sent()),[3,5];case 3:return e=t.sent(),k.Z.error(e),y(x("LayerDetails.errorMessage")),[3,5];case 4:return u(!1),[7];case 5:return[2]}})})(),[x,j,r]);(0,o.useEffect)(()=>{b()},[b]);var w=()=>{var e;if(r&&(0,X.us)(r))return null==(e=r.getSource())?void 0:e.getParams().LAYERS},S=()=>{if(r&&(0,X.us)(r)){if(r.getSource()instanceof Q()&&(e=r.getSource().getUrl()),r.getSource()instanceof er()){var e,t=r.getSource().getUrls();e=t?t[0]:void 0}if(e)return L.V.createValidGetCapabilitiesRequest(e,"WMS","1.3.0")}},_=()=>{var e,r,t=null==p||null==(r=p.Capability)||null==(e=r.Layer)?void 0:e.Layer,a=w();return Array.isArray(t)?null==t?void 0:t.find(e=>(null==e?void 0:e.Name)===a):t},C=()=>{var e=_();if(e&&e.EX_GeographicBoundingBox)return[e.EX_GeographicBoundingBox.westBoundLongitude,e.EX_GeographicBoundingBox.southBoundLatitude,e.EX_GeographicBoundingBox.eastBoundLongitude,e.EX_GeographicBoundingBox.northBoundLatitude].join(", ")},F=()=>{var e=_();if(e)return e.MinScaleDenominator},T=()=>{var e=_();if(e)return e.MaxScaleDenominator},P=()=>{var e=_();if(e)return e.Abstract},Z=()=>{var e;return null==p||null==(e=p.Service)?void 0:e.Abstract},M=()=>{var e,r;return null==p||null==(r=p.Service)||null==(e=r.ContactInformation)?void 0:e.ContactElectronicMailAddress},D=()=>{var e=_();if(e)return e.Title},A=()=>{var e;return null==p||null==(e=p.Service)?void 0:e.AccessConstraints};return v?(0,s.jsx)(J.Z,{type:"error",closable:!0,message:v}):(0,s.jsx)(tm.Z,{spinning:n,children:(0,s.jsxs)(ef.Z,(0,i._)((0,l._)({className:"layer-details",layout:"horizontal",size:"small",labelAlign:"left",labelWrap:!0,labelCol:{flex:"150px"}},t),{children:[(0,s.jsx)(ef.Z.Item,{name:"layerName",label:x("LayerDetails.layerNameLabel"),children:(0,s.jsx)("span",{children:w()?w():x("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(ef.Z.Item,{name:"layerTitle",label:x("LayerDetails.layerTitleLabel"),children:(0,s.jsx)("span",{children:D()?D():x("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(ef.Z.Item,{name:"service-abstract",label:x("LayerDetails.serviceAbstractLabel"),children:(0,s.jsx)("span",{children:Z()?Z():x("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(ef.Z.Item,{name:"abstract",label:x("LayerDetails.abstractLabel"),children:(0,s.jsx)("span",{children:P()?P():x("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(ef.Z.Item,{name:"accessConstraints",label:x("LayerDetails.accessConstraintsLabel"),children:(0,s.jsx)("span",{children:A()?A():x("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(ef.Z.Item,{name:"CapabilitiesUrl",label:x("LayerDetails.capabilitiesUrlLabel"),children:(0,s.jsx)("a",{href:S(),children:S()})}),(0,s.jsx)(ef.Z.Item,{name:"contact",label:x("LayerDetails.contactLabel"),children:M()?(0,s.jsx)("a",{href:`mailto:${M()}`,children:M()}):(0,s.jsx)("span",{children:x("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(ef.Z.Item,{name:"minScale",label:x("LayerDetails.minScaleLabel"),children:(0,s.jsx)("span",{children:F()?F():x("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(ef.Z.Item,{name:"maxScale",label:x("LayerDetails.maxScaleLabel"),children:(0,s.jsx)("span",{children:T()?T():x("LayerDetails.noDataPlaceholder")})}),(0,s.jsx)(ef.Z.Item,{name:"bbox",label:x("LayerDetails.bboxLabel"),children:(0,s.jsx)("span",{children:C()?C():x("LayerDetails.noDataPlaceholder")})})]}))})},tg=e=>{var r=(0,a._)({},(0,n._)(e)),t=(0,d._)((0,o.useState)(),2),u=t[0],c=t[1],m=(0,d._)((0,o.useState)(!1),2),f=m[0],g=m[1],h=A(e=>e.layerDetailsModal.visible),v=A(e=>e.layerDetailsModal.layerId),y=D(),j=(0,Z.S)(),x=(0,E.useTranslation)().t;return(0,o.useEffect)(()=>{if(j){if(!v)return void c(void 0);var e=F.C.getLayerByOlUid(j,v);e instanceof tc()&&c(e)}},[j,v]),(0,s.jsxs)(p.Z,(0,i._)((0,l._)({className:"layer-details-modal",title:(0,s.jsxs)("div",{className:"title-group",children:[(0,s.jsx)("span",{children:x("LayerDetailsModal.title",{layerName:null==u?void 0:u.get("name")})}),(null==u?void 0:u.get("shogunId"))&&(0,s.jsx)(rh.Z,{title:x(f?"LayerDetailsModal.internalConfigurationButtonTooltipPressed":"LayerDetailsModal.internalConfigurationButtonTooltip"),children:(0,s.jsx)(eL.ZP,{type:"link",className:f?"pressed":"",icon:(0,s.jsx)(to.Z,{}),onClick:()=>{g(!f)}})})]}),open:h,onCancel:()=>{y((0,td.Cp)()),y((0,td.uF)(void 0))},width:800,footer:!1},r),{children:[(0,s.jsx)(tp,{layer:u,hidden:f}),(null==u?void 0:u.get("shogunId"))&&(0,s.jsx)(tf,{layer:u,hidden:!f})]}))},th=t(8321),tv=t(34353),ty=t.n(tv),tj=()=>{var e=(0,E.useTranslation)().t,r=(0,Z.S)(),t=(0,d._)((0,o.useState)(!1),2),a=t[0],n=t[1],i=A(e=>e.mapToolbarVisible.visible),u=A(e=>e.stylingDrawerVisibility),c=A(e=>e.editFeatureDrawerOpen),m={tooltipPlacement:"left",tooltipProps:{mouseEnterDelay:.5}};return(0,s.jsx)(s.Fragment,{children:i&&(0,s.jsxs)(rr,{id:"map-toolbar",className:u||c?"drawer-open":"",alignment:"vertical",role:"toolbar",children:[r&&(0,s.jsx)(ty(),(0,l._)({"aria-label":"zoom-in",tooltip:e("MapToolbar.zoomInTooltip"),icon:(0,s.jsx)(eP.G,{icon:eT.r8p})},m)),r&&(0,s.jsx)(ty(),(0,l._)({"aria-label":"zoom-out",tooltip:e("MapToolbar.zoomOutTooltip"),delta:-1,icon:(0,s.jsx)(eP.G,{icon:eT.Kl4})},m)),r&&(0,s.jsx)(th.GeoLocationButton,(0,l._)({"aria-label":"geolocation",showMarker:!0,follow:!0,pressed:a,onChange:()=>n(!a),tooltip:e("MapToolbar.geoLocation"),icon:(0,s.jsx)(eP.G,{icon:eT.iUi}),pressedIcon:(0,s.jsx)(eP.G,{icon:eT.GrN})},m))]})})},tx=t(63161),tb=t(87095),tw=t(86477),tS=e=>{var r=(0,a._)({},(0,n._)(e)),t={name:"Default Style",rules:[{name:"Area",symbolizers:[{kind:"Fill",color:"#00b72b",outlineOpacity:.8,opacity:.5,fillOpacity:.8,outlineWidth:2,outlineColor:"#00b72b"}]},{name:"Line",symbolizers:[{kind:"Line",color:"#00b72b",width:2,opacity:.8}]},{name:"Point",symbolizers:[{kind:"Mark",wellKnownName:"circle",color:"#00b72b",strokeColor:"#00b72b",strokeOpacity:.8,opacity:.5,radius:7}],filter:["==","label","undefined"]},{name:"Text",symbolizers:[{kind:"Text",label:"{{label}}",size:12,font:["sans-serif"],opacity:.8,color:"#00b72b",offset:[5,5],haloColor:"#00b72b",haloWidth:1}],filter:["!=","label","undefined"]}]},i=(0,d._)((0,o.useState)(t),2),u=i[0],f=i[1],p=(0,Z.S)();return(0,o.useEffect)(()=>{if(u&&p){var e=new tw.Z,r=F.C.getLayerByName(p,"react-geo_digitize");(0,c._)(function(){var t,a,n,l,i,s,o,c,d,f,p,g,h,v;return(0,m.Jh)(this,function(m){switch(m.label){case 0:i=!0,s=!1,o=void 0,m.label=1;case 1:m.trys.push([1,6,7,8]),c=u.rules[Symbol.iterator](),m.label=2;case 2:if(i=(d=c.next()).done)return[3,5];return p={name:"",rules:[f=d.value]},[4,e.writeStyle(p)];case 3:if(!(g=m.sent()).output)return[2];"Fill"===f.symbolizers[0].kind&&(t=g.output),"Text"===f.symbolizers[0].kind&&(l=g.output),"Line"===f.symbolizers[0].kind&&(a=g.output),"Mark"===f.symbolizers[0].kind&&(n=g.output),m.label=4;case 4:return i=!0,[3,2];case 5:return[3,8];case 6:return h=m.sent(),s=!0,o=h,[3,8];case 7:try{i||null==c.return||c.return()}finally{if(s)throw o}return[7];case 8:return v=(e,r)=>{var i,s=null==(i=e.getGeometry())?void 0:i.getType();if(s){if(["MultiPolygon","Polygon","Circle"].includes(s))return"function"==typeof t?t(e,r):t;if(["MultiLineString","LineString"].includes(s))return"function"==typeof a?a(e,r):a;if(["MultiPoint","Point"].includes(s))return e.get("label")?"function"==typeof l?l(e,r):l:"function"==typeof n?n(e,r):n}},r.setStyle(v),[2]}})})()}},[u,p]),(0,s.jsx)(tb.U,(0,l._)({style:u,onStyleChange:f},r))},t_=e=>{var r=(0,a._)({},(0,n._)(e)),t=D(),o=A(e=>e.stylingDrawerVisibility),u=(0,E.useTranslation)().t;return(0,s.jsx)(eY,(0,i._)((0,l._)({title:u("StylingDrawer.title"),placement:"right",onClose:()=>{t((0,tx.ah)(!1))},open:o,rootClassName:"color-pick-drawer",maskClosable:!1,mask:!1},r),{children:(0,s.jsx)(tS,{})}))},tC=t(98930),tE=t(1581),tk=t.n(tE),tL=t(37669),tN=t(12416),tF=t(41354),tT=t(2803),tP=t(50755),tZ=h.Z.Option,tM=()=>{var e=Object.keys(tP.Z.services.resourceStore.data);return(0,s.jsx)("div",{className:"language-select","aria-label":"language-selector",children:(0,s.jsx)(h.Z,{defaultValue:tP.Z.language||"en",onChange:e=>{tP.Z.changeLanguage(e)},children:e.map(e=>(0,s.jsx)(tZ,{value:e,children:e.toUpperCase()},e))})})},tD=t(68428),tA=t(97691),tO=t(32446),tU=t(33411),tI=t(20640),tG=t.n(tI),t$=t(86977),tR=()=>{var e=(0,Z.S)(),r=(0,o.useMemo)(()=>["layerConfig","isExternalLayer","isUploadedLayer","groupName"],[]),t=(0,E.useTranslation)().t,a=e?r6.k.getLink(e,";",e=>e.get("name"),e=>(e instanceof C()||e instanceof S())&&e.getVisible(),r):"",n=(0,d._)((0,o.useState)(a),2),l=n[0],i=n[1],u=`Hey,\r
check out the layer-composition I created:\r
\r
${l}`;return(0,o.useEffect)(()=>{if(e){var t=[],a=e=>e.get("name"),n=e=>(e instanceof C()||e instanceof S())&&e.getVisible(),l=()=>{i(r6.k.getLink(e,";",a,n,r))},s=()=>{e.getAllLayers().filter(e=>e.get("isExternalLayer")||e.get("isUploadedLayer")).forEach(e=>{var r=e.get("layerConfig");r&&(r.clientConfig?r.clientConfig.opacity=e.getOpacity():r.clientConfig={opacity:e.getOpacity()},e.set("layerConfig",r))}),l()},o=e=>{var r=e.getLayers().getArray(),a=!0,n=!1,i=void 0;try{for(var u,c=r[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var d=u.value;if(d instanceof b())o(d);else{var m=d.on("change:visible",l),f=d.on("change:opacity",s);t.push(m,f)}}}catch(e){n=!0,i=e}finally{try{a||null==c.return||c.return()}finally{if(n)throw i}}},u=e.getView().on("change:center",l),c=e.getView().on("change:resolution",l);return o(e.getLayerGroup()),s(),()=>{(0,t$.unByKey)(u),(0,t$.unByKey)(c),(0,t$.unByKey)(t)}}},[r,e,t]),(0,s.jsxs)("div",{className:"permalink-wrapper",children:[(0,s.jsxs)("div",{className:"icons",children:[(0,s.jsx)(rh.Z,{title:t("Permalink.whatsAppTooltip"),children:(0,s.jsx)(tD.Z,{onClick:function(){var e=new URL("https://wa.me");e.searchParams.set("text",u),window.open(e)}})}),(0,s.jsx)(rh.Z,{title:t("Permalink.mailTooltip"),children:(0,s.jsx)(tA.Z,{onClick:function(){var e=new URL("mailto:");e.searchParams.set("subject","SHOGun Web-GIS"),e.searchParams.set("body",u),window.open(e.toString().replace(/\+/g,"%20"),"_self")}})})]}),(0,s.jsxs)("div",{className:"link","aria-label":"permalink-url",children:[(0,s.jsx)(g.Z,{value:l,readOnly:!0}),(0,s.jsx)(rh.Z,{title:t("Permalink.copyTooltip"),children:(0,s.jsx)(tO.Z,{onClick:function(){tG()(l)?tU.ZP.info(t("Permalink.copiedToClipboard")):tU.ZP.info(t("Permalink.copyToClipboardFailed"))}})})]})]})},tB=t(59418),tV=t(57795),tz=t(55002),tJ=t(99865),tW=t(19867),tK=t(16827),tq=t(86954),tY=t(50122),tX=t(97955),tH=t(11032);class tQ extends tH.N{serialize(e,r){var t=super.serialize(e,r);return t.baseURL.startsWith("/geoserver/ows")&&(t.baseURL=`http://shogun-geoserver:8080${t.baseURL}`),t.baseURL.startsWith("/geoserver/SHOGUN")&&(t.baseURL=`http://shogun-geoserver:8080${t.baseURL}`),t}}var t0=tQ,t1=class extends t0{serialize(e,r){var t=(0,l._)({tileSize:[512,512]},r),a=e.getSource();if(a&&this.validateSource(a))return(0,l._)({},super.serialize(e,t),{type:tX.n.TYPE_WMS},r)}},t2=e=>{var r=e.value,t=e.id,a=e.placeholder,n=e.maxLength,i=(0,em._)(e,["value","id","placeholder","maxLength"]),u=D();return(0,o.useEffect)(()=>{eb()(t)||u((0,tY.eV)({[t]:r}))},[r,t,u]),(0,s.jsx)(g.Z,(0,l._)({id:t,value:r,placeholder:a,maxLength:n,showCount:!!(n&&n>1)},i))},t3=e=>{var r=e.printManager,t=e.onValueChange,a=e.placeholder,n=e.value,u=(0,em._)(e,["printManager","onValueChange","placeholder","value"]),c=(0,d._)((0,o.useState)(n),2),m=c[0],f=c[1],p=(0,o.useRef)(m);return(0,o.useEffect)(()=>{p.current=n},[n]),(0,o.useEffect)(()=>{r&&(r.setLayout(m),p.current!==m&&t())},[r,m,t,n]),(0,o.useEffect)(()=>{f(n)},[n]),(0,s.jsx)(h.Z,(0,i._)((0,l._)({placeholder:void 0===a?"Bitte w\xe4hlen Sie eine Vorlage aus":a,value:m,onChange:f},u),{children:null==r?void 0:r.getLayouts().map(e=>(0,s.jsx)(h.Z.Option,{value:e.name,children:e.name},e.name))}))},t4=e=>{var r=e.printManager,t=e.placeholder,a=e.value,n=e.outputFormats,u=(0,em._)(e,["printManager","placeholder","value","outputFormats"]),c=(0,d._)((0,o.useState)(a),2),m=c[0],f=c[1];return(0,o.useEffect)(()=>{r&&r.setOutputFormat(m)},[r,m]),(0,o.useEffect)(()=>{f(a)},[a]),(0,s.jsx)(h.Z,(0,i._)((0,l._)({placeholder:t,value:m,onChange:f},u),{children:n.map(e=>(0,s.jsx)(h.Z.Option,{value:e,children:e.toLocaleUpperCase()},e))}))},t5=e=>{var r=e.printManager,t=e.placeholder,a=e.value,n=(0,em._)(e,["printManager","placeholder","value"]),u=(0,d._)((0,o.useState)(a),2),c=u[0],m=u[1];return(0,o.useEffect)(()=>{r&&r.setDpi(c)},[r,c]),(0,o.useEffect)(()=>{m(a)},[a]),(0,s.jsx)(h.Z,(0,i._)((0,l._)({placeholder:t,value:c,onChange:m},n),{children:null==r?void 0:r.getDpis().map(e=>(0,s.jsx)(h.Z.Option,{value:e,children:`${e} DPI`},e))}))},t7=t(25764),t6=e=>{var r=e.printManager,t=e.placeholder,a=e.value,n=(0,em._)(e,["printManager","placeholder","value"]),u=(0,Z.S)(),c=(0,d._)((0,o.useState)(0),2),m=c[0],f=c[1];return(0,o.useEffect)(()=>{r&&m&&r.setScale(m)},[r,m]),(0,o.useEffect)(()=>{var e=()=>{var e=r.getScale();e&&f(e)},t=null==u?void 0:u.getInteractions().getArray().find(e=>e.get("name")===t7.C.TRANSFORM_INTERACTION_NAME);if(r&&t)return t.on("scaling",e),()=>{t.on("scaling",e)}},[r,u]),(0,o.useEffect)(()=>{a&&f(a)},[a]),(0,s.jsx)(h.Z,(0,i._)((0,l._)({placeholder:t,value:m,onChange:f},n),{children:null==r?void 0:r.getScales().map(e=>(0,s.jsx)(h.Z.Option,{value:e,children:`1 : ${e.toLocaleString()}`},e))}))};t(26398).j.getLegendGraphicUrl=e=>{if(e.get("legendUrl"))return e.get("legendUrl");if(e.getSource()instanceof er()||e.getSource()instanceof Q()){var r=e.get("customPrintLegendParams"),t=e.getSource(),a=t.getParams(),n=a.LAYERS,i=a.VERSION,s=a.FORMAT,o=t instanceof Q()?t.getUrl():t.getUrls()[0];o.startsWith("/geoserver/ows")&&(o=`http://shogun-geoserver:8080${o}`);var u=(0,l._)({LAYER:n.split(",")[0],VERSION:i||"1.3.0",SERVICE:"WMS",REQUEST:"GetLegendGraphic",FORMAT:s||"image/png"},r),c=Object.keys(u).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(u[e])}`).join("&");return o.startsWith("/geoserver/SHOGUN")?(o=`http://shogun-geoserver:8080${o}/service?`,`${o}${c}`):o.endsWith("?")?`${o}${c}`:`${o}?${c}`}return""};var t9=e=>{var r,t=e.active,a=e.customPrintScales,n=void 0===a?[]:a,u=e.layerBlackList,f=void 0===u?[]:u,p=e.outputFormats,g=(0,em._)(e,["active","customPrintScales","layerBlackList","outputFormats"]),h=(0,d._)(ef.Z.useForm(),1)[0],v=(0,E.useTranslation)(),y=v.t,j=v.i18n,x=(0,Z.S)(),w=D(),S=j.language,_=(0,ea.Z)(),C=A(e=>e.print.customMapParams),L=A(e=>e.print.customParams),N=A(e=>e.print.printApp),T=(0,d._)((0,o.useState)(null),2),P=T[0],M=T[1],O=(0,d._)((0,o.useState)(!1),2),U=O[0],I=O[1],G=(0,d._)((0,o.useState)(null),2),$=G[0],R=G[1],B=(0,o.useCallback)(e=>{if(x){var r=e.get("name");return r&&!f.includes(r)&&e.getVisible()&&!(e instanceof b())&&F.C.layerInResolutionRange(e,x)}},[x,f]),V=(0,o.useCallback)(e=>{if(eb()(x))return!1;var r=e.get("name"),t=!f.includes(r),a=!e.get("hideLegendInPrint"),n=e.getVisible()&&F.C.layerInResolutionRange(e,x),l=!(e instanceof b());if(t&&a&&n&&l){var i=null==x?void 0:x.getView().getResolution();return i&&e.set("customPrintLegendParams",{SCALE:F.C.getScaleForResolution(i,"m")}),!0}return!1},[x,f]),z=(0,o.useCallback)(e=>x?F.C.getAllLayers(x).filter(r=>{var t=r.get("name");return t&&!t.includes("react-geo")&&r.getVisible()&&!(r instanceof b())&&r!==e}):[],[x]),W=(0,o.useCallback)(e=>{var r=e.getExtentLayer();if(!r)return"";var t=z(r),a=[];return t.filter(e=>{var r,t;return e.getSource&&(null==(r=e.getSource())?void 0:r.getAttributions)&&(null==(t=e.getSource())?void 0:t.getAttributions())}).forEach(e=>{var r=tq.Z.getLayerAttributionsText(e,",",!0);a.includes(r)||a.push(r)}),a.join(", ").trim()},[z]),q=(0,o.useCallback)(()=>(0,c._)(function(){var e,r,t,a,i,s,o,u,c,d;return(0,m.Jh)(this,function(m){switch(m.label){case 0:if(eb()(x))return[2];s={url:null!=(i=null==(e=K().print)?void 0:e.url)?i:"/print",map:x,customPrintScales:null==x||null==(a=x.getView())||null==(t=a.getResolutions())||null==(r=t.map(e=>{var r,t,a=null==x||null==(t=x.getView())||null==(r=t.getProjection())?void 0:r.getUnits();if(void 0!==e){var n=F.C.getScaleForResolution(e,a);if(void 0!==n)return F.C.roundScale(n)}}).filter(e=>void 0!==e))?void 0:r.reverse(),timeout:6e4,layerFilter:B,headers:(0,l._)({},(0,et.a)(null==_?void 0:_.getKeycloak())),transformOpts:{rotate:!1},serializers:[new tJ.o,new tV.o,new tz.S,new tW.g,new tK.N,new t0,new t1],legendFilter:V},n.length>0&&(s=(0,l._)({},s,{customPrintScales:n.toReversed()})),o=new tB.C(s),m.label=1;case 1:return m.trys.push([1,8,,9]),[4,o.init()];case 2:if(m.sent(),c=o.getPrintApps(),N)return[3,5];if(!(c&&S&&c.includes(S)))return[3,4];return[4,o.setPrintApp(S)];case 3:m.sent(),m.label=4;case 4:return[3,7];case 5:return[4,o.setPrintApp(N)];case 6:m.sent(),m.label=7;case 7:return o.setOutputFormat(o.getOutputFormats()[0]),o.setDpi(o.getDpis()[0]),o.setLayout(null==(u=o.getLayouts()[0])?void 0:u.name),[2,o];case 8:return d=m.sent(),R(()=>y("PrintForm.managerErrorMessage")),k.Z.error("Could not initialize print manager: ",d),[3,9];case 9:return[2]}})})(),[x,B,_,V,n,N,S,y]);return(0,o.useEffect)(()=>{P&&w((0,tY.eV)({attributions:W(P)}))},[w,W,P]),(0,eZ.b)(()=>(0,c._)(function(){var e;return(0,m.Jh)(this,function(r){switch(r.label){case 0:if(!t)return[3,3];if(P)return[3,2];return h.resetFields(),[4,q()];case 1:(e=r.sent())&&M(e),r.label=2;case 2:return[3,4];case 3:null==P||P.shutdownManager(),M(null),r.label=4;case 4:return[2]}})})(),[P,t,q,h]),(0,o.useEffect)(()=>{P&&(L&&P.setCustomParams(L),C&&P.setCustomMapParams(C))},[P,L,C]),(0,s.jsxs)("div",{className:"print","aria-label":"print-form",children:[$&&(0,s.jsx)(J.Z,{className:"print-alert",message:$,type:"error",closable:!0,showIcon:!0,onClose:()=>{R(null)}}),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ef.Z,(0,i._)((0,l._)({form:h,className:"print-form",labelAlign:"left",labelCol:{flex:"90px"}},g),{children:(null==P?void 0:P.isInitiated())&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ef.Z.Item,{"aria-label":"print-title",name:"title",label:y("PrintForm.title"),initialValue:y("PrintForm.initialTitle"),children:(0,s.jsx)(t2,{"aria-label":"print-title-input",maxLength:50,placeholder:y("PrintForm.titlePlaceholder")})}),(0,s.jsx)(ef.Z.Item,{"aria-label":"print-comment",name:"comment",label:y("PrintForm.comment"),children:(0,s.jsx)(t2,{"aria-label":"print-comment-input",maxLength:200,placeholder:y("PrintForm.commentPlaceholder")})}),(0,s.jsx)(ef.Z.Item,{"aria-label":"print-layout",name:"layout",label:y("PrintForm.layout"),initialValue:null==P||null==(r=P.getLayouts()[0])?void 0:r.name,children:(0,s.jsx)(t3,{"aria-label":"print-layout-input",printManager:P,onValueChange:()=>{h.setFieldValue("dpi",null==P?void 0:P.getDpis()[0])}})}),(0,s.jsx)(ef.Z.Item,{"aria-label":"print-scale",name:"scale",label:y("PrintForm.scale"),initialValue:null==P?void 0:P.getClosestScaleToFitMap(),children:(0,s.jsx)(t6,{"aria-label":"print-scale-input",printManager:P})}),(0,s.jsx)(ef.Z.Item,{"aria-label":"print-dpi",name:"dpi",label:y("PrintForm.dpi"),initialValue:P.getDpis()[0],children:(0,s.jsx)(t5,{"aria-label":"print-dpi-input",printManager:P,placeholder:y("PrintForm.resolutionPlaceholder")})}),(0,s.jsx)(ef.Z.Item,{"aria-label":"print-format",name:"format",label:y("PrintForm.format"),initialValue:"pdf",children:(0,s.jsx)(t4,{"aria-label":"print-format-input",printManager:P,outputFormats:void 0===p?["pdf","png"]:p,placeholder:y("PrintForm.outputFormatPlaceholder")})})]})})),(0,s.jsx)(eL.ZP,{"aria-label":"create-print",className:"print-button tool-menu-button",disabled:!(null==P?void 0:P.isInitiated()),icon:(0,s.jsx)(eP.G,{icon:eT.q7m}),loading:U,onClick:()=>(0,c._)(function(){var e,r;return(0,m.Jh)(this,function(t){switch(t.label){case 0:if(t.trys.push([0,2,3,4]),R(null),I(!0),!P)return[2];return[4,P.print(!1)];case 1:if(!(e=t.sent()))throw Error("No download URL available, the job has failed.");return window.open(e),[3,4];case 2:return r=t.sent(),R(y("PrintForm.printJobErrorMsg")||null),k.Z.error(r),[3,4];case 3:return I(!1),[7];case 4:return[2]}})})(),children:y("PrintForm.downloadBtnText")})]})]})},t8=t(5737),ae=t(71230),ar=t(49840),at=t.n(ar),aa=t(34571),an=e=>{var r=e.keyName,t=e.onChange,a=void 0===t?()=>{}:t,n=e.options,l=(0,E.useTranslation)().t;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ef.Z.Item,{name:[r,"name"],rules:[{required:!0,message:l("AttributionRow.missingKey")},e=>{var r=e.getFieldsValue;return{validator(e,t){var a=r(!0);return a.fields&&Object.entries(a.fields).filter(e=>{var r=(0,d._)(e,2)[1];return(null==r?void 0:r.name)===t}).length>1?Promise.reject(Error(l("AttributionRow.keyInUse"))):Promise.resolve()}}}],children:(0,s.jsx)(aa.Z,{placeholder:l("AttributionRow.keyPlaceholder"),onChange:e=>{a(e)},options:null==n?void 0:n.map(e=>({value:e}))})}),(0,s.jsx)(ef.Z.Item,{name:[r,"value"],rules:[{required:!0,message:l("AttributionRow.missingValue")}],children:(0,s.jsx)(g.Z,{placeholder:l("AttributionRow.valuePlaceholder"),onChange:e=>{a(e.target.value)}})})]})},al=e=>{var r=e.selectedFeature,t=(0,em._)(e,["selectedFeature"]),a=(0,d._)((0,o.useState)(!0),2),n=a[0],u=a[1],p=(0,d._)((0,o.useState)([]),2),g=p[0],h=p[1],v=(0,d._)((0,o.useState)([]),2),y=v[0],j=v[1],x=(0,d._)(f.ZP.useNotification(),2)[1],b=(0,d._)(ef.Z.useForm(),1)[0],w=(0,Z.S)(),S=void 0!==r,_=(0,E.useTranslation)().t,C=(0,o.useCallback)(e=>{var r,t=null==(r=e.fields)?void 0:r.map(e=>{var r;return null==e||null==(r=e.name)?void 0:r.toLowerCase()}).filter(e=>void 0!==e);j(g.filter(e=>!(null==t?void 0:t.includes(e.toLowerCase()))))},[g]);(0,o.useEffect)(()=>{if(w){var e,t=null==r?void 0:r.getProperties();if(b.setFieldValue("fields",[]),t){var a=Object.entries(Object.fromEntries(Object.entries(t).filter(e=>!((0,d._)(e,2)[1]instanceof at())).map(e=>{var r=(0,d._)(e,2);return[r[0],r[1]]}))).map(e=>{var r=(0,d._)(e,2);return{name:r[0],value:r[1]}});b.setFieldValue("fields",a)}var n=null==(e=re.w.getDigitizeLayer(w).getSource())?void 0:e.getFeatures(),l=new Set;null==n||n.forEach(e=>{Object.keys(e.getProperties()).forEach(r=>{e.get(r)instanceof at()||l.add(r)})}),h(Array.from(l))}},[r,b,w]);var L=(e,r)=>{e(r)},N=()=>(0,c._)(function(){var e;return(0,m.Jh)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,b.validateFields()];case 1:return r.sent(),u(!0),[3,3];case 2:return e=r.sent(),u(!1),k.Z.error(e),[3,3];case 3:return[2]}})})(),F=(e,r)=>e.map(e=>(0,s.jsxs)("div",{className:"attribute-row",children:[(0,s.jsx)(an,{keyName:e.name,onChange:N,options:y},e.key),(0,s.jsxs)(eG.Z,{title:_("AttributionPopConfirm.title"),okText:_("AttributionPopConfirm.okText"),cancelText:_("AttributionPopConfirm.cancelText"),placement:"topRight",onConfirm:()=>{f.ZP.destroy(),f.ZP.info({message:_("notificationDeleteText.title"),description:_("notificationDeleteText.info"),placement:"top",duration:6}),L(r,e.name)},children:[x,(0,s.jsx)(eL.ZP,{className:"remove-attribute-button",type:"primary",danger:!0,icon:(0,s.jsx)(eP.G,{icon:t8.El_})})]})]},e.key));return(0,s.jsxs)(eq.Z,(0,i._)((0,l._)({title:_("Attribution.title"),className:"attribution-drawer",placement:"right",mask:!1,maskClosable:!1,closable:!1,open:S},t),{children:[!r&&(0,s.jsx)(s.Fragment,{children:_("Attribution.select")}),(0,s.jsx)(ae.Z,{children:(0,s.jsxs)(ef.Z,{onFinish:e=>{if(r){for(var t in f.ZP.destroy(),f.ZP.success({message:_("notificationApplyText.title"),placement:"top",duration:3.5}),r.getProperties())r.get(t)instanceof at()||r.unset(t);e.fields&&Object.values(e.fields).forEach(e=>{(null==e?void 0:e.name)&&r.set(e.name,e.value)})}},autoComplete:"off",form:b,onValuesChange:(e,r)=>{C(r)},children:[(0,s.jsx)(ef.Z.List,{name:"fields",children:(e,t)=>{var a=t.add,n=t.remove;return(0,s.jsxs)(s.Fragment,{children:[F(e,n),(0,s.jsx)(ef.Z.Item,{children:r?(0,s.jsx)(eL.ZP,{type:"dashed",onClick:()=>{a()},className:"add-attribute-button",icon:(0,s.jsx)(eP.G,{icon:eT.r8p}),children:_("Attribution.add")}):(0,s.jsx)(s.Fragment,{})})]})}}),(0,s.jsx)(ef.Z.Item,{children:(0,s.jsx)(eL.ZP,{className:"submit-attributes-button",type:"primary",htmlType:"submit",disabled:!n,hidden:!r,children:_("Attribution.submit")})})]})})]}))},ai=t(92848),as=p.Z.confirm,ao="deleteallbutton",au=e=>{var r=e.className,t=e.digitizeLayer,a=(0,em._)(e,["className","digitizeLayer"]),n=(0,d._)((0,o.useState)(null),2),i=n[0],u=n[1],c=(0,Z.S)(),m=(0,E.useTranslation)().t;if((0,o.useEffect)(()=>{c&&(t?u([t]):u([re.w.getDigitizeLayer(c)]))},[c,t]),!i)return null;var f=r?`${ao} ${r}`:ao;return(0,s.jsx)(P(),(0,l._)({onClick:()=>{as({title:m("DeleteAllButton.deleteAll"),content:m("DeleteAllButton.confirmMessage"),icon:(0,s.jsx)(ai.Z,{}),onOk(){var e;null==(e=i[0].getSource())||e.clear()}})},className:f},a))},ac=ek.Z.Dragger,ad=e=>{var r=e.className,t=e.footer,a=e.width,n=e.onCancel,u=e.onSuccess,c=e.onFailure,m=(0,em._)(e,["className","footer","width","onCancel","onSuccess","onFailure"]),f=(0,d._)((0,o.useState)(!1),2),g=f[0],h=f[1],v=(0,d._)((0,o.useState)(""),2),y=v[0],j=v[1],x=(0,Z.S)(),b=(0,E.useTranslation)().t,w=["json","geojson"],S=["application/json","application/geo+json","application/geojson"];return(0,s.jsxs)(p.Z,(0,i._)((0,l._)({title:b("ImportDataModal.title"),onCancel:e=>{j(""),h(!1),null==n||n(e)},className:void 0===r?"import-data-modal":r,width:void 0===a?600:a,footer:void 0!==t&&t},m),{children:[y&&(0,s.jsx)(J.Z,{message:y,closable:!0,type:"error"}),(0,s.jsx)(tm.Z,{spinning:g,children:(0,s.jsxs)(ac,{customRequest:e=>{var r=e.file,t=e.onSuccess,a=e.onError;if(r instanceof File&&x){var n=new FileReader;n.onload=()=>{try{var e=new(e4())().readFeatures(n.result,{featureProjection:x.getView().getProjection()});null==t||t(e)}catch(e){null==a||a(e),k.Z.error("Error while reading the file: ",e)}},n.readAsText(r)}},accept:[...w.map(e=>`.${e}`),S].join(","),maxCount:1,showUploadList:!1,beforeUpload:e=>{var r=e.type,t=e.name.split(".").pop();return j(""),!!S.includes(r)&&(!t||!!w.includes(t))||(j(b("ImportDataModal.error.supportedFormats",{supportedFormats:S.join(", ")})),!1)},onChange:e=>{var r=e.file.status,t=e.file.response;if(x)if("uploading"===r)h(!0);else if("done"===r){var a=re.w.getDigitizeLayer(x).getSource();null==a||a.addFeatures(t||[]),h(!1),tU.ZP.success(b("ImportDataModal.success")),null==u||u(t||[])}else"error"===r&&(h(!1),j(b("ImportDataModal.error.parsing")),null==c||c(e.file.error))},children:[(0,s.jsx)("p",{className:"ant-upload-drag-icon",children:(0,s.jsx)(eP.G,{icon:eT.cf$})}),(0,s.jsx)("p",{className:"ant-upload-text",children:b("ImportDataModal.description")}),(0,s.jsx)("p",{className:"ant-upload-hint",children:b("ImportDataModal.hint")})]})})]}))},am=()=>{var e=D(),r=(0,E.useTranslation)().t,t=A(e=>e.stylingDrawerVisibility);return(0,s.jsx)(eL.ZP,{type:"link",onClick:()=>{e((0,tx.ah)(!t))},icon:(0,s.jsx)(eP.G,{icon:eT.XsY}),children:r(t?"StylingDrawer.closeColorPalette":"StylingDrawer.openColorPalette")})},af=e=>{var r=e.showDrawPoint,t=e.showDrawLine,a=e.showDrawPolygon,n=e.showDrawCircle,l=e.showDrawRectangle,i=e.showDrawAnnotation,u=e.showModifyFeatures,c=e.showUploadFeatures,m=e.showDeleteFeatures,f=(0,d._)((0,o.useState)(),2),p=f[0],g=f[1],h=(0,d._)((0,o.useState)(),2),v=h[0],y=h[1],j=(0,d._)((0,o.useState)(!1),2),x=j[0],b=j[1],w=(0,E.useTranslation)().t,S=(0,Z.S)(),_=(0,o.useCallback)((e,r)=>{y(r),"draw-modify"!==r&&g(void 0)},[]),C=(0,o.useCallback)(e=>{e.selected.length>0?g(e.selected[0]):g(void 0)},[]),k=()=>{b(!1)};return S?(0,s.jsxs)("div",{className:"draw-tools",children:[(0,s.jsxs)(e8.ToggleGroup,{selected:v,onChange:_,children:[r?(0,s.jsxs)(e6(),{value:"draw-point",drawType:"Point",type:"link",pressed:!1,children:[(0,s.jsx)(eP.G,{icon:eT.diR}),(0,s.jsx)("span",{className:"draw-point",children:w("Draw.point")})]},"draw-point"):(0,s.jsx)(s.Fragment,{}),t?(0,s.jsxs)(e6(),{value:"draw-line",drawType:"LineString",type:"link",children:[(0,s.jsx)(eP.G,{icon:eT.hx$}),(0,s.jsx)("span",{className:"draw-line",children:w("Draw.line")})]},"draw-line"):(0,s.jsx)(s.Fragment,{}),a?(0,s.jsxs)(e6(),{value:"draw-polygon",drawType:"Polygon",type:"link",children:[(0,s.jsx)(eP.G,{icon:eT.Kak}),(0,s.jsx)("span",{className:"draw-polygon",children:w("Draw.polygon")})]},"draw-polygon"):(0,s.jsx)(s.Fragment,{}),n?(0,s.jsxs)(e6(),{value:"draw-circle",drawType:"Circle",type:"link",children:[(0,s.jsx)(eP.G,{icon:eT.IJ7}),(0,s.jsx)("span",{className:"draw-circle",children:w("Draw.circle")})]},"draw-circle"):(0,s.jsx)(s.Fragment,{}),l?(0,s.jsxs)(e6(),{value:"draw-rectangle",drawType:"Rectangle",type:"link",children:[(0,s.jsx)(eP.G,{icon:eT.pL1}),(0,s.jsx)("span",{className:"draw-rectangle",children:w("Draw.rectangle")})]},"draw-rectangle"):(0,s.jsx)(s.Fragment,{}),i?(0,s.jsxs)(e6(),{value:"draw-text",drawType:"Text",type:"link",children:[(0,s.jsx)(eP.G,{icon:eT.yGG}),(0,s.jsx)("span",{className:"draw-text",children:w("Draw.text")})]},"draw-text"):(0,s.jsx)(s.Fragment,{}),(0,s.jsx)(am,{},"styling"),u?(0,s.jsxs)(e9.ModifyButton,{value:"draw-modify",type:"link",onFeatureSelect:C,children:[(0,s.jsx)(eP.G,{icon:eT.Yai}),(0,s.jsx)("span",{className:"draw-modify",children:w("Draw.modify")})]},"draw-modify"):(0,s.jsx)(s.Fragment,{}),m?(0,s.jsxs)(e5.DeleteButton,{value:"draw-delete",type:"link",children:[(0,s.jsx)(eP.G,{icon:eT.xf2}),(0,s.jsx)("span",{className:"draw-delete",children:w("Draw.delete")})]},"draw-delete"):(0,s.jsx)(s.Fragment,{})]}),m?(0,s.jsxs)(au,{value:"draw-delete-all",type:"link",children:[(0,s.jsx)(eP.G,{icon:eT.$aW}),(0,s.jsx)("span",{className:"draw-delete-all",children:w("DeleteAllButton.deleteAll")})]}):(0,s.jsx)(s.Fragment,{}),c?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eL.ZP,{onClick:()=>{b(!0)},"aria-label":"draw-upload",type:"link",icon:(0,s.jsx)(eP.G,{icon:eT.cf$}),children:(0,s.jsx)("span",{className:"draw-upload",children:w("Draw.upload")})}),(0,s.jsx)(ad,{open:x,onCancel:k,onSuccess:k})]}):(0,s.jsx)(s.Fragment,{}),c?(0,s.jsxs)(P(),{value:"draw-export",onClick:()=>{var e=[];if(S){var r,t=S.getView().getProjection().getCode(),a=null==(r=re.w.getDigitizeLayer(S).getSource())?void 0:r.getFeatures();if(a&&a.length>0){a.forEach(r=>{var a,n=r.clone();null==(a=n.getGeometry())||a.transform(t,"EPSG:4326"),e.push(n)});var n=new Blob([new(e4())().writeFeatures(e)],{type:"application/geo+json"}),l=window.URL.createObjectURL(n),i=document.createElement("a");i.href=l,i.setAttribute("download","exportedFeatures.geojson"),document.body.appendChild(i),i.click(),document.body.removeChild(i)}}},type:"link",children:[(0,s.jsx)(eP.G,{icon:eT.q7m}),(0,s.jsx)("span",{className:"draw-export",children:w("Draw.export")})]}):(0,s.jsx)(s.Fragment,{}),(0,s.jsx)(al,{selectedFeature:p})]}):(0,s.jsx)(s.Fragment,{})},ap=t(96486),ag=t(71764),ah=t(60878),av=t(80982),ay=t.n(av),aj=t(93349),ax=t.n(aj),ab=e=>{var r=(0,Z.S)(),t=(0,o.useCallback)(()=>(0,c._)(function(){var t,a,n,l,i;return(0,m.Jh)(this,function(s){return!r||F.C.getLayerByName(r,e.layerName)||(t=new(ax()),a=new(r2())({color:"rgba(255, 255, 255, 0.15)"}),n=new(r4())({color:"rgba(209, 70, 47, 1)",width:2}),l=new(r7())({fill:a,stroke:n,image:new(r0())({radius:5,fill:a,stroke:n})}),(i=new(ay())({source:t,style:l})).set("name",e.layerName),r.addLayer(i)),[2]})})(),[r,e.layerName]),a=(0,o.useCallback)(()=>{if(r){var t=F.C.getLayerByName(r,e.layerName);t&&r.removeLayer(t)}},[r,e.layerName]);(0,o.useEffect)(()=>(t(),()=>a()),[a,t])},aw=t(1445),aS=t(66678),a_=t.n(aS),aC=e=>{var r=e.exportFilter,t=e.features,a=e.layer,n=e.selectedFeature,i=(0,em._)(e,["exportFilter","features","layer","selectedFeature"]),o=(0,E.useTranslation)().t,u=D(),c=(0,Z.S)(),m=A(e=>e.featureInfo.activeCopyTools),f=A(e=>e.editFeature.userEditMode),p=f.includes("CREATE")||f.includes("DELETE")||f.includes("UPDATE"),g=null==a?void 0:a.get("editable");return(0,s.jsxs)("div",{className:"pagination-toolbar",children:[(0,s.jsx)(aw.Z,(0,l._)({simple:!0,total:t.length,size:"small",pageSize:1},i)),(0,s.jsxs)("div",{className:"copy-buttons",children:[p&&(0,s.jsx)(rh.Z,{title:o(g?"PaginationToolbar.editFeature":"PaginationToolbar.editDisabled"),children:(0,s.jsx)(eL.ZP,{type:"text",size:"small",onClick:()=>{if(a&&c){var e=new(e4())().writeFeature(n);try{var r=JSON.parse(e),t=re.w.getDigitizeLayer(c);if(!t)return;var l=t.getSource();if(!l||(l.clear(),l.addFeature(n),(0,eu.isEmpty)(l.getExtent())))return;c.getView().fit(l.getExtent(),{padding:[150,150,150,150]}),u((0,e_.vN)((0,j.getUid)(a))),u((0,e_.hr)(r)),u((0,eK.$Z)())}catch(e){k.Z.error("Could not parse GeoJSON: ",e)}}},icon:(0,s.jsx)(eP.G,{icon:eT.Xcf}),disabled:!g})},"edit"),(null==m?void 0:m.includes(tL.r1.COPY_AS_GEOJSON))&&(0,s.jsx)(rh.Z,{title:o("PaginationToolbar.copyAsGeoJson"),children:(0,s.jsx)(eL.ZP,{type:"text",size:"small",onClick:()=>{if(n){var e=n.clone();if(r){var t=Object.entries(e.getProperties()),a=t.filter(e=>{var t=(0,d._)(e,2);return r(t[0],t[1])}),l=!0,i=!1,s=void 0;try{for(var o,u=t[Symbol.iterator]();!(l=(o=u.next()).done);l=!0){var c=(0,d._)(o.value,2),m=c[0];c[1]instanceof at()||e.unset(m)}}catch(e){i=!0,s=e}finally{try{l||null==u.return||u.return()}finally{if(i)throw s}}e.setProperties(Object.fromEntries(a))}tG()(new(e4())().writeFeature(e))}},icon:(0,s.jsx)(eP.G,{icon:eT.E9T})})}),(null==m?void 0:m.includes(tL.r1.COPY_AS_OBJECT))&&(0,s.jsx)(rh.Z,{title:o("PaginationToolbar.copyAsObject"),children:(0,s.jsx)(eL.ZP,{type:"text",size:"small",onClick:()=>{if(n){var e=Object.entries(a_()(n.getProperties())).filter(e=>!((0,d._)(e,2)[1]instanceof at()));r&&(e=e.filter(e=>{var t=(0,d._)(e,2);return r(t[0],t[1])})),tG()(JSON.stringify(Object.fromEntries(e)))}},icon:(0,s.jsx)(eP.G,{icon:eT.OGB})})})]})]})},aE=e=>{var r=e.features,t=e.layerName,a=e.layer,n=e.tabConfig,i=(0,em._)(e,["features","layerName","layer","tabConfig"]),u=(0,d._)((0,o.useState)(1),2),c=u[0],m=u[1],f=(0,d._)((0,o.useState)(),2),p=f[0],g=f[1],h=(0,d._)((0,o.useState)("0"),2),v=h[0],y=h[1],j=(0,Z.S)(),x=`selection-layer-${t}`;if(ab({layerName:x}),(0,o.useEffect)(()=>{if(j){var e,t=F.C.getLayerByName(j,x);t&&(null==(e=t.getSource())||e.clear(),m(1),r.length>0&&(y("0"),g(r[0])))}},[r,j,x]),(0,o.useEffect)(()=>{if(p&&j){var e,r,t=F.C.getLayerByName(j,x);t&&(null==(e=t.getSource())||e.clear(),null==(r=t.getSource())||r.addFeature(p))}},[p,j,x]),!n||!p)return(0,s.jsx)(s.Fragment,{});var b=n.filter(e=>!eb()(e)).map((e,r)=>({label:e.title,key:`${r}`,forceRender:!0,children:(0,s.jsx)(eO,{name:e.title,feature:p,formConfig:e.children})}));return(0,s.jsxs)("div",{className:"feature-info-tabs",children:[(0,s.jsx)(aC,{current:c,exportFilter:e=>{var r=!1,t=!0,a=!1,l=void 0;try{for(var i,s=n[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var o=i.value;if(o.children){var u=!0,c=!1,d=void 0;try{for(var m,f=o.children[Symbol.iterator]();!(u=(m=f.next()).done);u=!0)if(m.value.propertyName===e){r=!0;break}}catch(e){c=!0,d=e}finally{try{u||null==f.return||f.return()}finally{if(c)throw d}}}}}catch(e){a=!0,l=e}finally{try{t||null==s.return||s.return()}finally{if(a)throw l}}return r},features:r,layer:a,onChange:e=>{e<1||(m(e),g(r[e-1]))},selectedFeature:p}),(0,s.jsx)(ra.Z,(0,l._)({items:b,activeKey:v,defaultActiveKey:"0",onTabClick:e=>{y(e)}},i))]})},ak=t(88666),aL=t.n(ak),aN=e=>{var r=e.features,t=e.layerName,a=e.layer,n=(0,em._)(e,["features","layerName","layer"]),i=(0,d._)((0,o.useState)(),2),u=i[0],c=i[1],m=(0,d._)((0,o.useState)(),2),f=m[0],p=m[1],g=(0,d._)((0,o.useState)([]),2),h=g[0],v=g[1],y=(0,Z.S)(),j=(0,E.useTranslation)().t,x=`selection-layer-${t}`;ab({layerName:x}),(0,o.useEffect)(()=>{if(y){var e,t=F.C.getLayerByName(y,x);t&&(null==(e=t.getSource())||e.clear(),c(1),r.length>0&&p(r[0]))}},[r,y,x]),(0,o.useEffect)(()=>{if(f&&y){var e,r,t=F.C.getLayerByName(y,x);t&&(v(Object.entries(f.getProperties()).filter(e=>(0,d._)(e,2)[1]instanceof at()).map(e=>(0,d._)(e,1)[0])),null==(e=t.getSource())||e.clear(),null==(r=t.getSource())||r.addFeature(f))}},[f,y,x]);var b=e=>{c(e),p(r[e-1])};if(!f)return(0,s.jsx)(s.Fragment,{});var w=f.getKeys().filter(e=>!h.includes(e.toLocaleLowerCase()));return(0,s.jsx)(aL(),(0,l._)({className:"property-grid",feature:f,attributeFilter:w,size:"small",sticky:!0,title:()=>(0,s.jsx)(aC,{features:r,selectedFeature:f,current:u,layer:a,onChange:b}),columns:[{title:j("FeaturePropertyGrid.key"),dataIndex:"attributeName",key:"attributeName",width:"50%",ellipsis:!0,defaultSortOrder:"ascend",sorter:(e,r)=>e.key.localeCompare(r.key)},{title:j("FeaturePropertyGrid.value"),dataIndex:"attributeValue",key:"attributeValue",width:"50%",ellipsis:!0}],scroll:{scrollToFirstRowOnChange:!0,y:"calc(100% - 90px)"}},n))},aF=e=>{var r=(0,a._)({},(0,n._)(e)),t=(0,E.useTranslation)().t,i=(0,Z.S)(),u=(0,ea.Z)(),c=R(),m=D(),f=(0,d._)((0,o.useState)([]),2),p=f[0],g=f[1],h=(0,d._)((0,o.useState)(void 0),2),v=h[0],y=h[1],j=A(e=>e.featureInfo.enabled),x=e=>!!e.get("hoverable")&&(!!(e instanceof S()&&e.getSource()instanceof Q())||e instanceof C()&&e.getSource()instanceof er()),b=(0,o.useCallback)(()=>{i&&g(F.C.getAllLayers(i,x).filter(e=>e.getVisible()))},[i]);if((0,o.useEffect)(()=>{if(i){b();var e=F.C.getAllLayers(i,x);return e.forEach(e=>e.on("change:visible",b)),()=>{e.forEach(e=>e.un("change:visible",b))}}},[i,b]),!i)return(0,s.jsx)(s.Fragment,{});var w=e=>{y(e)},_=e=>i.getAllLayers().findIndex(r=>{if((0,X.us)(r)){var t=r.getSource(),a=k(null==t?void 0:t.getParams().LAYERS);return k(e)===a}return!1}),k=e=>e.split(":").length>1?e.split(":")[1]:e.split(":")[0];return j?(0,s.jsx)("div",{className:"feature-info-panel",children:(0,s.jsx)(ag.CoordinateInfo,(0,l._)({featureCount:10,queryLayers:p,resultRenderer:e=>{var r=e.features,a=e.loading;if(0===r.length)return(0,s.jsx)("span",{className:"usage-hint",children:t("FeatureInfo.usageHint")});var n=[];return Object.entries((0,ap.groupBy)(r,"featureType")).forEach(e=>{var r=(0,d._)(e,2),t=r[0],a=r[1],l=!1,o=a.map(e=>e.feature),u=i.getAllLayers(),m=_(t),f=u[m];c.forEach(e=>{var r;if((r=e.integration)&&"feature-info"===r.placement&&(Array.isArray(e.integration.layers)&&e.integration.layers.includes(t)||!e.integration.layers)){var a=e.key,i=e.wrappedComponent;n.push({label:t,index:m,key:t,children:(0,s.jsx)(i,{},a)}),l=!0}}),l||n.push({label:(null==f?void 0:f.get("name"))||t,index:m,key:t,children:(0,s.jsx)("div",{children:(null==f?void 0:f.get("featureInfoFormConfig"))?(0,s.jsx)(aE,{tabConfig:null==f?void 0:f.get("featureInfoFormConfig"),features:o,layerName:t,layer:f}):(0,s.jsx)(aN,{features:o,layerName:t,layer:f})},t)})}),n.sort((e,r)=>r.index-e.index),(0,s.jsx)(tm.Z,{spinning:a,children:(0,s.jsx)(ra.Z,{destroyInactiveTabPane:!0,items:n,activeKey:v,defaultActiveKey:n[0].key,onTabClick:w})})},fetchOpts:e=>({headers:(0,l._)({},e.get("useBearerToken")?(0,l._)({},(0,et.a)(null==u?void 0:u.getKeycloak())):void 0)}),onSuccess:e=>{var r=e.features,t=(0,ap.groupBy)(r,"featureType"),a=(0,ap.mapValues)(t,e=>e.map(e=>e.feature)),n={},l=!0,i=!1,s=void 0;try{for(var o,u=Object.entries(a)[Symbol.iterator]();!(l=(o=u.next()).done);l=!0){var c=(0,d._)(o.value,2),f=c[0],p=c[1];n[f]=new(e4())().writeFeatures(p)}}catch(e){i=!0,s=e}finally{try{l||null==u.return||u.return()}finally{if(i)throw s}}var g=r.map(e=>({layerName:e.featureType,index:_(e.featureType)})).sort((e,r)=>r.index-e.index);g.length>0&&y(g[0].layerName),m((0,ah.wl)(n))},drillDown:!0},r))}):(0,s.jsx)(s.Fragment,{})},aT=t(10255),aP=t(78493),aZ=t.n(aP),aM=t(51404),aD=t(34066),aA=t.n(aD),aO=t(26944),aU=t.n(aO),aI=e=>{var r,t=e.layer,a=(0,em._)(e,["layer"]),n=(0,d._)((0,o.useState)(null==(r=t.getSource())?void 0:r.getParams().TIME),2),i=n[0],u=n[1],c=(0,d._)((0,o.useState)(),2),m=c[0],f=c[1],p=(0,d._)((0,o.useState)(),2),g=p[0],h=p[1],v=(0,d._)((0,o.useState)(),2),y=v[0],j=v[1],x=(0,E.useTranslation)().t;return(0,o.useEffect)(()=>{var e,r=t.get("dimension");if(r&&(r.values&&(e=r.values.split(",")),e&&0!==e.length)){f(e[0]),h(e[e.length-1]),u(e[e.length-1]);var a={};if(e.forEach(e=>{a[e]=eo()(e).format("YYYY-MM-DD")}),j(a),"current"===e.default){var n=[NaN,""];Object.values(a).forEach(e=>{var r=eo()().diff(eo()(e));r<n[0]&&(n=[r,e])}),u(n[1])}}},[t]),(0,s.jsxs)("div",{className:"wms-time-slider",children:[(0,s.jsxs)(rg.Z,{children:[(0,s.jsx)(eP.G,{icon:eT.SZw}),x("WmsTimeSlider.title")]}),y&&m&&g?(0,s.jsx)(aU(),(0,l._)({formatString:"",defaultValue:"",min:m,max:g,marks:y,value:i,onChange:e=>{var r;u(e),null==(r=t.getSource())||r.updateParams({TIME:e})}},a)):(0,s.jsx)("span",{children:x("WmsTimeSlider.default")})]})},aG=e=>{var r,t=e.layer,a=e.visibleLegendsIds,n=e.setVisibleLegendsIds,u=(0,em._)(e,["layer","visibleLegendsIds","setVisibleLegendsIds"]),p=(0,d._)((0,o.useState)(!1),2),g=p[0],h=p[1],v=(0,d._)((0,o.useState)(!1),2),y=v[0],x=v[1],w=D(),S=(0,ea.Z)(),_=(0,Z.S)(),C=(0,E.useTranslation)().t,L=null!=(r=t.get("downloadConfig"))?r:null,N=A(e=>e.editFeature.userEditMode),T=A(e=>e.layerTree.metadataVisible),P=()=>(0,c._)(function(){var e,r;return(0,m.Jh)(this,function(a){switch(a.label){case 0:if(!_)return[2];x(!0),a.label=1;case 1:return a.trys.push([1,3,4,5]),[4,tq.Z.getExtentForLayer(t,{headers:t.get("useBearerToken")?(0,l._)({},(0,et.a)(null==S?void 0:S.getKeycloak())):{}})];case 2:return e=a.sent(),e=(0,rB.transformExtent)(e,"EPSG:4326",_.getView().getProjection()),_.getView().fit(e),[3,5];case 3:return r=a.sent(),k.Z.error(r),f.ZP.error({message:C("LayerTreeContextMenu.extentError")}),[3,5];case 4:return x(!1),[7];case 5:return[2]}})})(),M=e=>_?O(_.getLayerGroup()).filter(r=>r.getLayers().getArray().includes(e)):[],O=e=>{var r=[e],t=!0,a=!1,n=void 0;try{for(var l,i=e.getLayers().getArray()[Symbol.iterator]();!(t=(l=i.next()).done);t=!0){var s=l.value;s instanceof b()&&r.push(...O(s))}}catch(e){a=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(a)throw n}}return r},U=e=>{M(e).forEach(r=>r.getLayers().remove(e))},I=()=>{if(_){U(t);var e=F.C.getLayerByName(_,C("AddLayerModal.externalWmsFolder")),r=F.C.getLayerByName(_,C("UploadDataModal.uploadedDataFolder"));e&&0===e.getLayers().getLength()&&U(e),r&&0===r.getLayers().getLength()&&U(r)}},G=e=>(0,c._)(function(){var r,a;return(0,m.Jh)(this,function(n){switch(n.label){case 0:if(!t)return[2];return[4,fetch(e,{method:"GET",headers:(0,l._)({},t.get("useBearerToken")?(0,l._)({},(0,et.a)(null==S?void 0:S.getKeycloak())):void 0)})];case 1:return[4,n.sent().blob()];case 2:return r=n.sent(),(a=document.createElement("a")).href=URL.createObjectURL(r),a.setAttribute("download",t.get("name")),a.click(),[2]}})})(),$=[];if((0,X.us)(t)&&$.push({label:(0,s.jsx)(tm.Z,{spinning:y,children:C("LayerTreeContextMenu.layerZoomToExtent")}),key:"zoomToExtent"}),(0,X.us)(t)&&t.getVisible()){var R=a.includes((0,j.getUid)(t));$.push({label:R?C("LayerTreeContextMenu.hideLegend"):C("LayerTreeContextMenu.showLegend"),key:"toggleLegend"})}if((t.get("isExternalLayer")||t.get("isUploadedLayer"))&&$.push({label:C("LayerTreeContextMenu.removeLayer"),key:"removeExternal"}),L){var B=L.map(e=>{var r;return{label:C("LayerTreeContextMenu.downloadLayer",{formatName:null!=(r=e.formatName)?r:"XML"}),key:`downloadLayer|${encodeURI(e.downloadUrl)}`}});$.push(...B)}return t.get("editable")&&(N.includes("CREATE")||N.includes("UPDATE")||N.includes("DELETE"))&&$.push({label:C("LayerTreeContextMenu.editLayer"),key:"editLayer"}),T&&$.push({label:C("LayerTreeContextMenu.layerDetails"),key:"layerDetails"}),(0,s.jsx)("div",{"aria-label":"layer-context",children:(0,s.jsx)(rH.Z,(0,i._)((0,l._)({menu:{items:$,onClick:e=>{switch((null==e?void 0:e.key.startsWith("downloadLayer"))&&G(decodeURI(e.key.split("|")[1])),null==e?void 0:e.key){case"zoomToExtent":P();break;case"removeExternal":I();break;case"toggleLegend":var r=(0,j.getUid)(t),l=[...a];l.includes(r)?l.splice(l.indexOf(r),1):l.push(r),n(l);break;case"editLayer":w((0,e_.hr)(null)),w((0,e_.vN)((0,j.getUid)(t))),w((0,eK.$Z)());break;case"layerDetails":w((0,td.uF)((0,j.getUid)(t))),w((0,td.$Z)())}h(!1)}},placement:"bottomLeft",onOpenChange:h,open:g,trigger:["click"]},u),{children:(0,s.jsx)(eP.G,{icon:eT.iV1})}))})},a$=()=>(0,s.jsxs)("div",{className:"layer-node-title-loading-animation",children:[(0,s.jsx)("span",{className:"dot-one",children:"."}),(0,s.jsx)("span",{className:"dot-two",children:"."}),(0,s.jsx)("span",{className:"dot-three",children:"."})]}),aR=e=>{var r,t,i=(0,a._)({},(0,n._)(e)),u=(0,Z.S)(),c=(0,ea.Z)(),m=(0,E.useTranslation)().t,f=null==u?void 0:u.getAllLayers().map(e=>(0,j.getUid)(e)),p=null!=(r=A(e=>e.layerTree.showLegends))&&r,g=null!=(t=A(e=>e.layerTree.layerIconsVisible))&&t,h=(0,d._)((0,o.useState)(p&&null!=f?f:[]),2),v=h[0],y=h[1],x=(0,d._)((0,o.useState)({}),2),w=x[0],_=x[1],k=(0,d._)((0,o.useState)(),2),L=k[0],N=k[1],T=(0,o.useCallback)(()=>{u&&F.C.getAllLayers(u).forEach(e=>{if(e instanceof tc()){var r=e.getSource();r instanceof er()&&(r.hasListener("tileloadstart")||r.on("tileloadstart",U),r.hasListener("tileloadend")||r.hasListener("tileloaderror")||r.on(["tileloadend","tileloaderror"],I)),r instanceof Q()&&(r.hasListener("imageloadstart")||r.on("imageloadstart",U),r.hasListener("imageloadend")||r.hasListener("imageloaderror")||r.on(["imageloadend","imageloaderror"],I))}})},[u]),P=(0,o.useCallback)(()=>{var e=null==u?void 0:u.getAllLayers().map(e=>(0,j.getUid)(e));(null==e?void 0:e.length)!==(null==f?void 0:f.length)&&T()},[u,f,T]),M=(0,o.useMemo)(()=>({SCALE:L,LEGEND_OPTIONS:"fontAntiAliasing:true;forceLabels:on",TRANSPARENT:!0}),[L]),D=(0,o.useMemo)(()=>(0,l._)({},(0,et.a)(null==c?void 0:c.getKeycloak())),[c]),O=(0,o.useCallback)(e=>{var r=e.map.getView(),t=r.getProjection().getUnits()||"m",a=r.getResolution();N(a?F.C.getScaleForResolution(a,t):void 0)},[]);(0,o.useEffect)(()=>{if(u)return O(new aT.Z("moveend",u)),u.on("moveend",O),()=>{u.un("moveend",O)}},[u,O]),(0,o.useEffect)(()=>{if(u)return T(),u.getLayers().on("change",P),()=>{F.C.getAllLayers(u).forEach(e=>{if(e instanceof tc()){var r=e.getSource();r.hasListener("tileloadstart")&&r.un("tileloadstart",U),r.hasListener("tileloadend")&&r.un("tileloadend",I),r.hasListener("tileloaderror")&&r.un("tileloaderror",I)}}),u.getLayers().un("change",P)}},[u,T,P]);var U=e=>{_(r=>{var t=(0,j.getUid)(e.target),a=structuredClone(r);return a[t]&&a[t].loaded>=a[t].loading?(a[t].loading=1,a[t].loaded=0,a[t].percent=0):(a[t]||(a[t]={loading:0,loaded:0,percent:0}),a[t].loading=Number.isInteger(a[t].loading)?a[t].loading+1:1),a})},I=e=>{_(r=>{var t=(0,j.getUid)(e.target),a=structuredClone(r);a[t]||(a[t]={loading:0,loaded:0,percent:0}),a[t].loaded=Number.isInteger(a[t].loaded)?a[t].loaded+1:1;var n=Math.round(a[t].loaded/a[t].loading*100);return n>a[t].percent&&(a[t].percent=n),a})};return u?(0,s.jsx)(aZ(),(0,l._)({"aria-label":"layertree",className:"layertree",nodeTitleRenderer:e=>{if(u){var r,t=e instanceof tc()&&(0,j.getUid)(e.getSource())?null==(r=w[(0,j.getUid)(e.getSource())])?void 0:r.percent:100;return e instanceof b()?(0,s.jsx)("div",{"aria-label":"layer-group",children:e.get("name")}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"tree-node-header","aria-label":"tree-node-header",children:[(0,s.jsxs)("span",{"aria-label":"layer-name",className:"layer-name",children:[e.get("name"),(0,s.jsx)("span",{className:"loading-dots",children:t<100&&(0,s.jsx)(a$,{})}),(0,s.jsxs)("span",{className:"layer-icons-group",children:[e.get("searchable")&&g&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(rh.Z,{title:m("ToolMenu.searchable"),children:(0,s.jsx)(eP.G,{icon:eT.Y$T,className:"layer-icon"})})}),e.get("hoverable")&&e.get("visible")&&g&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(rh.Z,{title:m("ToolMenu.queryable"),children:(0,s.jsx)(eP.G,{icon:eT.DBf,className:"layer-icon"})})}),e.get("editable")&&g&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(rh.Z,{title:m("ToolMenu.editable"),children:(0,s.jsx)(eP.G,{icon:eT.IwR,className:"layer-icon"})})})]})]}),(e instanceof C()||e instanceof S())&&(0,s.jsx)("div",{"aria-label":"layer-context-menu",children:(0,s.jsx)(aG,{layer:e,visibleLegendsIds:v,setVisibleLegendsIds:y})})]}),e.get("visible")&&(0,s.jsx)("div",{className:"layer-transparency","aria-label":"transparency-slider",onClick:e=>e.stopPropagation(),onDragStart:e=>{e.stopPropagation(),e.preventDefault()},draggable:!0,children:(0,s.jsx)(aA(),{tooltip:{formatter:e=>`${m("LayerTree.transparency")}: ${e}%`},layer:e})}),e.get("visible")&&"WMSTIME"===e.get("type")&&(0,s.jsx)("div",{className:"layer-time-slider",children:(0,s.jsx)(aI,{layer:e})}),e.get("visible")&&(0,X.us)(e)&&v.includes((0,j.getUid)(e))&&(0,s.jsx)(aM.Legend,{layer:e,errorMsg:m("LayerTree.noLegendAvailable"),extraParams:M,headers:e.get("useBearerToken")?D:void 0})]})}},filterFunction:e=>{var r;return e.getLayers?!e.get("hideInLayerTree"):!(e.getSource&&(null==(r=e.getSource())?void 0:r.forEachFeature))},draggable:!0},i)):(0,s.jsx)(s.Fragment,{})},aB=t(55738),aV=e=>{var r=e.showMeasureDistance,t=e.showMeasureArea,a=(0,E.useTranslation)().t,n=(0,Z.S)(),l=(0,d._)((0,o.useState)(),2),i=l[0],u=l[1];return n?(0,s.jsxs)(e8.ToggleGroup,{className:"measure-tools",selected:i,onChange:(e,r)=>{u(r)},children:[r?(0,s.jsxs)(aB.MeasureButton,{geodesic:!0,value:"line",measureType:"line",type:"link",continueLineMsg:a("Measure.clicktodrawline"),children:[(0,s.jsx)(eP.G,{icon:eT.SoD}),(0,s.jsx)("span",{className:"measure-text",children:a("Measure.line")})]}):(0,s.jsx)(s.Fragment,{}),t?(0,s.jsxs)(aB.MeasureButton,{geodesic:!0,value:"poly",measureType:"polygon",type:"link",continuePolygonMsg:a("Measure.clicktodrawarea"),children:[(0,s.jsx)(eP.G,{icon:eT.ubJ}),(0,s.jsx)("span",{className:"measure-text",children:a("Measure.area")})]}):(0,s.jsx)(s.Fragment,{})]}):(0,s.jsx)(s.Fragment,{})},az=e=>{var r,t=e.collapseWidth,a=void 0===t?40:t,n=e.minWidth,u=void 0===n?240:n,c=e.maxWidth,m=void 0===c?600:c,f=(0,em._)(e,["collapseWidth","minWidth","maxWidth"]),p=(0,E.useTranslation)().t,g=(0,Z.S)(),h=R(),v=D(),y=A(e=>e.toolMenu.availableTools),j=A(e=>e.toolMenu.activeKeys),x=(0,ea.Z)(),b=null==x?void 0:x.getKeycloak(),w=(0,d._)((0,o.useState)(!1),2),S=w[0],_=w[1],C=(0,d._)((0,o.useState)([]),2),k=C[0],L=C[1],N=(0,d._)((0,o.useState)(!1),2),F=N[0],T=N[1],P=(0,d._)((0,o.useState)(320),2),M=P[0],U=P[1],I=(0,d._)((0,o.useState)(M),2),G=I[0],$=I[1];(0,o.useEffect)(()=>{var e=window.matchMedia("only screen and (max-width: 450px) and (orientation: portrait),only screen and (max-width: 750px) and (orientation: landscape), only screen and (max-width: 580px)"),r=RegExp("/Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile|Kindle|NetFront|Silk-Accelerated|(hpw|web)OS|Fennec|Minimo|Opera M(obi|ini)|Blazer|Dolfin|Dolphin|Skyfire|Zune/");(e.matches||r.test(window.navigator.userAgent))&&(_(!0),U(a))},[a]),(0,o.useEffect)(()=>{k.length<1&&(y.includes("default")?L(["measure_tools","draw_tools","feature_info","print","tree","permalink","language_selector"]):L(y))},[k,y]),(0,o.useEffect)(()=>{var e=["print","measure_tools","draw_tools","feature_info","tree"];if(e.filter(e=>j.includes(e)).length>1){var r=j.slice(0,j.length-1).reverse().find(r=>e.includes(r));r&&v((0,tF.wG)(j.filter(e=>e!==r)))}v((0,tL.$f)(j.includes("feature_info"))),v((0,tN.cm)(j.includes("tree")))},[j,v]);var B=A(e=>e.layerTree.activeUploadTools),V=e=>{switch(e){case"measure_tools":return{icon:eT.KxN,title:p("ToolMenu.measure"),wrappedComponent:(0,s.jsx)(aV,{showMeasureDistance:y.includes("default")||y.includes("measure_tools_distance"),showMeasureArea:y.includes("default")||y.includes("measure_tools_area")})};case"draw_tools":return{icon:eT.q2v,title:p("ToolMenu.draw"),wrappedComponent:(0,s.jsx)(af,{showDrawPoint:y.includes("default")||y.includes("draw_tools_point"),showDrawLine:y.includes("default")||y.includes("draw_tools_line"),showDrawPolygon:y.includes("default")||y.includes("draw_tools_polygon"),showDrawCircle:y.includes("default")||y.includes("draw_tools_circle"),showDrawRectangle:y.includes("default")||y.includes("draw_tools_rectangle"),showDrawAnnotation:y.includes("default")||y.includes("draw_tools_annotation"),showModifyFeatures:y.includes("default")||y.includes("draw_tools_modify"),showUploadFeatures:y.includes("default")||y.includes("draw_tools_upload"),showDownloadFeatures:y.includes("default")||y.includes("draw_tools_download"),showDeleteFeatures:y.includes("default")||y.includes("draw_tools_delete"),showStyleFeatures:y.includes("default")||y.includes("draw_tools_style")})};case"feature_info":return{icon:eT.DBf,title:p("ToolMenu.featureInfo"),wrappedComponent:(0,s.jsx)(aF,{})};case"print":return{icon:eT.kwI,title:p("ToolMenu.print"),wrappedComponent:g?(0,s.jsx)(t9,{active:j.includes("print"),layerBlackList:["react-geo_measure","hoverVectorLayer"]}):(0,s.jsx)(s.Fragment,{})};case"tree":var r,t,a;return{icon:eT.aC2,title:p("ToolMenu.layertree"),wrappedComponent:(0,s.jsxs)("div",{className:"tree-wrapper",children:[(0,s.jsx)(aR,{}),(null==B?void 0:B.includes(tN.Sv.addWMS))&&(0,s.jsx)(eL.ZP,{className:"add-wms-button tool-menu-button",icon:(0,s.jsx)(eP.G,{icon:eT.r8p}),onClick:()=>v((0,O.$Z)()),children:p("ToolMenu.addWms")}),b&&(null==(a=K().geoserver)||null==(t=a.upload)||null==(r=t.authorizedRoles)?void 0:r.some(e=>b.hasResourceRole(e,b.clientId)))&&(null==B?void 0:B.includes(tN.Sv.dataUpload))&&(0,s.jsx)(eL.ZP,{className:"upload-data-button tool-menu-button",icon:(0,s.jsx)(eP.G,{icon:eT.cf$}),onClick:()=>v((0,tT.$Z)()),children:p("ToolMenu.uploadData")})]})};case"permalink":return{icon:eT.M6U,title:p("Permalink.title"),wrappedComponent:(0,s.jsx)(tR,{})};case"language_selector":return{icon:eT.BCn,title:p("ToolMenu.languageSelect"),wrappedComponent:(0,s.jsx)(tM,{})}}},z=(0,o.useCallback)(()=>{T(!0)},[]),J=(0,o.useCallback)(()=>{T(!1)},[]),W=(0,o.useCallback)(e=>{if(F&&!S){var r=e.clientX-document.body.offsetLeft;r>u&&r<m&&(U(r),$(r))}},[F,S,u,m]);return(0,o.useEffect)(()=>(document.addEventListener("mousemove",W),document.addEventListener("mouseup",J),()=>{document.removeEventListener("mousemove",W),document.removeEventListener("mouseup",J)}),[W,J]),(0,s.jsxs)("div",{"aria-label":"tool-menu",className:`tool-menu ${S?"collapsed":""}`,style:{width:M},children:[(0,s.jsx)(tC.Z,(0,l._)({expandIconPosition:"end",activeKey:j,destroyInactivePanel:!0,onChange:e=>{_(!1),v((0,tF.wG)(tk()(e))),S&&U(G)},items:(r=[],k.forEach(e=>{var t=V(e);if(t){var a=t.icon,n=t.title,l=t.wrappedComponent;r.push({key:e,label:(0,s.jsxs)(s.Fragment,{children:[a?(0,s.jsx)(eP.G,{icon:a}):void 0,(0,s.jsx)("span",{children:n})]}),children:l})}}),h&&h.forEach(e=>{var t;if((t=e.integration)&&"tool-menu"===t.placement){var a=e.key,n=e.wrappedComponent,o=e.integration,u=o.label,c=o.insertionIndex,d=o.icon,m=(0,em._)(e.integration,["label","insertionIndex","icon"]),f=(0,i._)((0,l._)({key:a,label:(0,s.jsxs)(s.Fragment,{children:[d?(0,s.jsx)(eP.G,{icon:d}):void 0,(0,s.jsx)("span",{children:p(void 0===u?"Plugin":u)})]})},m),{children:(0,s.jsx)(n,{})});r.splice(null!=c?c:0,0,f)}}),r)},f)),(0,s.jsx)(rh.Z,{placement:"right",title:S?p("ToolMenu.expand"):p("ToolMenu.collapse"),children:(0,s.jsx)(eL.ZP,{className:"collapse-btn","aria-label":"collapse-button",icon:S?(0,s.jsx)(eP.G,{icon:eT._tD}):(0,s.jsx)(eP.G,{icon:eT.A35}),onClick:()=>{v((0,tF.wG)([])),_(!S),S?U(G):U(a)}})}),S?(0,s.jsx)(s.Fragment,{}):(0,s.jsx)("div",{className:"dynamicWidth",onMouseDown:z,role:"button"})]})},aJ=t(28837),aW=t(48916),aK=ek.Z.Dragger,aq=e=>{var r=(0,a._)({},(0,n._)(e)),t=(0,d._)((0,o.useState)(""),2),u=t[0],f=t[1],g=(0,d._)((0,o.useState)(""),2),h=g[0],v=g[1],y=(0,d._)((0,o.useState)(!1),2),j=y[0],x=y[1],w=A(e=>e.uploadDataModal.visible),S=A(e=>e.user),_=D(),C=(0,Z.S)(),L=(0,ea.Z)(),N=(0,E.useTranslation)().t,T=e=>{if(C){var r=N("UploadDataModal.uploadedDataFolder"),t=F.C.getLayerByName(C,r);if(!t){t=new(b())({layers:[],properties:{name:r}});var a=C.getLayerGroup().getLayers();a.insertAt((null==a?void 0:a.getLength())||0,t)}t.getLayers().getArray().includes(e)||t.getLayers().push(e)}},P=e=>(0,c._)(function(){var r,t,a,n,s,o;return(0,m.Jh)(this,function(u){switch(u.label){case 0:return t=e.baseUrl,a=e.workspace,n=e.storeName,s=e.layerName,o=e.file,[4,fetch(`${t}/rest/workspaces/${a}/coveragestores/${n}/file.geotiff?configure=none`,{method:"PUT",headers:(0,i._)((0,l._)({},(0,et.a)(null==L?void 0:L.getKeycloak())),{"Content-Type":"image/tiff"}),body:o})];case 1:if(!u.sent().ok)throw Error(N("UploadDataModal.error.general",{fileName:o.name}));return[4,fetch(`${t}/rest/workspaces/${a}/coveragestores/${n}/coverages`,{method:"POST",headers:(0,i._)((0,l._)({},(0,et.a)(null==L?void 0:L.getKeycloak())),{"Content-Type":"application/json"}),body:JSON.stringify({coverage:{enabled:!0,name:s,nativeName:s,title:s,keywords:{string:["User upload",`Uploaded by ${null==(r=S.providerDetails)?void 0:r.username}`]}}})})];case 2:if(!u.sent().ok)throw Error(N("UploadDataModal.error.general",{fileName:o.name}));return[2]}})})(),M=e=>(0,c._)(function(){var r,t,a,n,s,o,u,c,f;return(0,m.Jh)(this,function(m){switch(m.label){case 0:return t=e.baseUrl,a=e.workspace,n=e.storeName,s=e.layerName,o=e.file,[4,aJ.Shapefile.load(o)];case 1:if(u=m.sent(),c="",f={attribute:[]},1!==Object.entries(u).length)throw Error(N("UploadDataModal.error.zipContent"));return Object.entries(u).forEach(e=>{var r=(0,d._)(e,2),t=r[0],a=r[1];c=t;var n=a.parse("dbf",{properties:!1});f.attribute=n.fields.map(e=>({name:e.name,minOccurs:0,maxOccurs:1,nillable:!0,binding:U(e.type),length:e.length}));var l=a.parse("shx");f.attribute.push({name:"the_geom",minOccurs:0,maxOccurs:1,nillable:!0,binding:O(l.header.type)})}),[4,fetch(`${t}/rest/workspaces/${a}/datastores/${n}/file.shp?configure=none`,{method:"PUT",headers:(0,i._)((0,l._)({},(0,et.a)(null==L?void 0:L.getKeycloak())),{"Content-Type":"application/zip"}),body:o})];case 2:if(!m.sent().ok)throw Error(N("UploadDataModal.error.general",{fileName:o.name}));return[4,fetch(`${t}/rest/workspaces/${a}/datastores/${n}/featuretypes`,{method:"POST",headers:(0,i._)((0,l._)({},(0,et.a)(null==L?void 0:L.getKeycloak())),{"Content-Type":"application/json"}),body:JSON.stringify({featureType:{enabled:!0,name:s,nativeName:c,title:s,attributes:f,keywords:{string:["User upload",`Uploaded by ${null==(r=S.providerDetails)?void 0:r.username}`]}}})})];case 3:if(!m.sent().ok)throw Error(N("UploadDataModal.error.general",{fileName:o.name}));return[2]}})})(),O=e=>({0:null,1:"org.locationtech.jts.geom.Point",3:"org.locationtech.jts.geom.LineString",5:"org.locationtech.jts.geom.Polygon",8:"org.locationtech.jts.geom.MultiPoint",11:"org.locationtech.jts.geom.Point",13:"org.locationtech.jts.geom.LineString",15:"org.locationtech.jts.geom.Polygon",18:"org.locationtech.jts.geom.MultiPoint",21:"org.locationtech.jts.geom.Point",23:"org.locationtech.jts.geom.LineString",25:"org.locationtech.jts.geom.Polygon",28:"org.locationtech.jts.geom.MultiPoint",31:null})[e],U=e=>{switch(e){case"C":return"java.lang.String";case"D":return"java.util.Date";case"N":return"java.lang.Long";case"F":return"java.lang.Double";case"L":return"java.lang.Boolean";default:return null}};return(0,s.jsxs)(p.Z,(0,i._)((0,l._)({className:"upload-data-modal",title:N("UploadDataModal.title"),open:w,onCancel:()=>{f(""),v(""),_((0,tT.Cp)())},width:600,footer:!1},r),{children:[h&&(0,s.jsx)(J.Z,{message:h,closable:!0,type:"success"}),u&&(0,s.jsx)(J.Z,{message:u,closable:!0,type:"error"}),(0,s.jsx)(tm.Z,{spinning:j,children:(0,s.jsxs)(aK,{customRequest:e=>(0,c._)(function(){var r,t,a,n,l,i,s,o,u,c,d,f,p,g,h;return(0,m.Jh)(this,function(m){switch(m.label){case 0:n=e.onError,l=e.onSuccess,s=(i=e.file).name.split("."),o=i.type,c=null!=(u=null==(r=K().geoserver)?void 0:r.base)?u:"/geoserver",f=null!=(d=null==(a=K().geoserver)||null==(t=a.upload)?void 0:t.workspace)?d:"SHOGUN",p=`${s[0]}_${Date.now()}`.toUpperCase(),g={file:i,baseUrl:c,workspace:f,storeName:p,layerName:p},m.label=1;case 1:if(m.trys.push([1,6,,7]),"image/tiff"!==o)return[3,3];return[4,P(g)];case 2:m.sent(),m.label=3;case 3:if("application/zip"!==o)return[3,5];return[4,M(g)];case 4:m.sent(),m.label=5;case 5:return l&&l({baseUrl:c,workspace:f,layerName:p}),[3,7];case 6:return h=m.sent(),n&&n({name:"UploadError",message:h instanceof Error?h.message:N("UploadDataModal.error.general",{fileName:i.name})}),[3,7];case 7:return[2]}})})(),accept:"image/tiff,application/zip",maxCount:1,showUploadList:!1,beforeUpload:e=>{var r,t,a,n=null!=(a=null==(t=K().geoserver)||null==(r=t.upload)?void 0:r.limit)?a:2e8,l=e.type,i=e.size;if(f(""),v(""),i>n)return f(N("UploadDataModal.error.maxSize",{maxSize:n/1e6})),!1;var s=["application/zip","image/tiff"];return!!s.includes(l)||(f(N("UploadDataModal.error.supportedFormats",{supportedFormats:s.join(", ")})),!1)},onChange:e=>(0,c._)(function(){var r,t,a;return(0,m.Jh)(this,function(n){if("uploading"===(r=e.file).status&&x(!0),"done"===r.status){if(!L||!r.response)return[2];t={name:r.response.layerName,type:"TILEWMS",clientConfig:{hoverable:!0},sourceConfig:{url:`${r.response.baseUrl}/ows?`,layerNames:`${r.response.workspace}:${r.response.layerName}`,useBearerToken:!0}},(a=new aW.Z({client:L}).parseTileLayer(t)).set("layerConfig",t),a.set("isUploadedLayer",!0),a.set("groupName",N("UploadDataModal.uploadedDataFolder")),T(a),v(N("UploadDataModal.success",{fileName:r.name,layerName:r.response.layerName})),x(!1)}else"error"===r.status&&(x(!1),k.Z.error(r.error),r.error&&r.error.message?f(r.error.message):f(N("UploadDataModal.error.general",{fileName:r.name})));return[2]})})(),children:[(0,s.jsx)("p",{className:"ant-upload-drag-icon",children:(0,s.jsx)(eP.G,{icon:eT.cf$})}),(0,s.jsx)("p",{className:"ant-upload-text",children:N("UploadDataModal.description")}),(0,s.jsx)("p",{className:"ant-upload-hint",children:N("UploadDataModal.hint")})]})})]}))},aY=()=>(0,c._)(function(){var e,r,t,a,n,l,i,s,o,c,d,f,p,g,h,v,y,j,x;return(0,m.Jh)(this,function(w){switch(w.label){case 0:var _;if(e=(0,Z.S)(),r=(0,ea.Z)(),_=window.location.search,t=u().useMemo(()=>new URLSearchParams(_),[_]),a=(0,E.useTranslation)().t,n=t.get("layers"),!e||(l=e=>e.get("name"),i=e=>e instanceof C()||e instanceof S(),!(s=r6.k.applyLink(e,";",l,i))))return[2];o=r=>{var t=new(b())({layers:[]});t.set("name",r);var a=e.getLayerGroup().getLayers();return a.insertAt((null==a?void 0:a.getLength())||0,t),t},w.label=1;case 1:if(w.trys.push([1,10,,11]),c=JSON.parse(s),!r)throw Error("Client is not available");d=new aW.Z({client:r}),f=!0,p=!1,g=void 0,w.label=2;case 2:w.trys.push([2,7,8,9]),h=function(){var r,t,l,i,s;return(0,m.Jh)(this,function(u){switch(u.label){case 0:if(r=y.value,e2()(null==r?void 0:r.layerConfig))return[3,2];return t=r.layerConfig,[4,d.parseLayer(t)];case 1:if(!(l=u.sent())||(r.isExternalLayer&&l.set("isExternalLayer",r.isExternalLayer),r.isUploadedLayer&&l.set("isUploadedLayer",r.isUploadedLayer),l.set("groupName",r.groupName),l.set("layerConfig",r.layerConfig),l.setVisible(!!(null==n?void 0:n.split(";").some(e=>e===t.name))),!(l.get("isExternalLayer")||l.get("isUploadedLayer"))))return[2,"continue"];i=void 0,l.get("groupName")?(i=F.C.getLayerByName(e,l.get("groupName")))||(i=o(l.get("groupName"))):(i=null==(s=F.C.getLayersByProperty(e,"isExternalLayerGroup",!0))?void 0:s[0])||(i=o(a("AddLayerModal.externalWmsFolder"))).set("isExternalLayerGroup",!0),F.C.getLayerByName(e,l.get("name"))||i.getLayers().push(l),u.label=2;case 2:return[2]}})},v=c[Symbol.iterator](),w.label=3;case 3:if(f=(y=v.next()).done)return[3,6];return[5,(0,m.XA)(h())];case 4:w.sent(),w.label=5;case 5:return f=!0,[3,3];case 6:return[3,9];case 7:return j=w.sent(),p=!0,g=j,[3,9];case 8:try{f||null==v.return||v.return()}finally{if(p)throw g}return[7];case 9:return[3,11];case 10:return x=w.sent(),k.Z.error(x),[3,11];case 11:return[2]}})})(),aX=e=>{var r=(0,a._)({},(0,n._)(e));return aY(),(0,o.useEffect)(()=>{var e=document.querySelectorAll(".loadmask")[0];e&&e.classList.add("loadmask-hidden")},[]),(0,s.jsxs)("div",(0,i._)((0,l._)({className:"App"},r),{children:[(0,s.jsx)(ts,{}),(0,s.jsx)(B,{}),(0,s.jsx)(az,{}),(0,s.jsx)(tj,{}),(0,s.jsx)(rk,{}),(0,s.jsx)(z,{}),(0,s.jsx)(U,{}),(0,s.jsx)(aq,{}),(0,s.jsx)(rp,{}),(0,s.jsx)(tg,{}),(0,s.jsx)(t_,{})]}))},aH=aX},96281:function(){}}]);
//# sourceMappingURL=681.d0884e5db30d63f4.js.map