"use strict";(self.webpackChunk_terrestris_shogun_gis_client=self.webpackChunk_terrestris_shogun_gis_client||[]).push([["6550"],{78907:function(e,t,i){var s=i(3783),r=i(31644),n=i(74255),l=i(84674);class o extends r.A{constructor(e,t,i,s,r,n){super(e,t,n),this.crossOrigin_=s,this.src_=i,this.key=i,this.image_=new Image,null!==s&&(this.image_.crossOrigin=s),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(e){this.image_=e,this.state=n.default.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=n.default.ERROR,this.unlistenImage_(),this.image_=function(){let e=(0,l.Y)(1,1);return e.fillStyle="rgba(0,0,0,0)",e.fillRect(0,0,1,1),e.canvas}(),this.changed()}handleImageLoad_(){let e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=n.default.LOADED:this.state=n.default.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==n.default.ERROR&&(this.state=n.default.IDLE,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==n.default.IDLE&&(this.state=n.default.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=(0,s.f6)(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}}t.A=o},9359:function(e,t){t.A={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"}},36927:function(e,t,i){i.d(t,{A:function(){return I}});var s=i(31644),r=i(74255);function n(e){return e instanceof Image||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageBitmap?e:null}let l=Error("disposed"),o=[256,256];class a extends s.A{constructor(e){super(e.tileCoord,r.default.IDLE,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null,this.controller_=e.controller||null}getSize(){if(this.size_)return this.size_;let e=n(this.data_);return e?[e.width,e.height]:o}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==r.default.IDLE&&this.state!==r.default.ERROR)return;this.state=r.default.LOADING,this.changed();let e=this;this.loader_().then(function(t){e.data_=t,e.state=r.default.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=r.default.ERROR,e.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(l),this.controller_=null),super.disposeInternal()}}var h=i(78907),d=i(90123),u=i(19487),c=i(85752),g=i(21128),_=i(7689),f=i(5245),p=i(74802),T=i(17229),m=class{constructor(e){this.highWaterMark=void 0!==e?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){let e=this.pop();e instanceof p.A&&e.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){let i=this.entries_[e];return(0,T.v)(void 0!==i,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(e){let t=this.entries_[e];return(0,T.v)(void 0!==t,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){let e,t=Array(this.count_),i=0;for(e=this.newest_;e;e=e.older)t[i++]=e.key_;return t}getValues(){let e,t=Array(this.count_),i=0;for(e=this.newest_;e;e=e.older)t[i++]=e.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){return this.entries_[e]?.value_}pop(){let e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){(0,T.v)(!(e in this.entries_),"Tried to set a value for a key that is used already");let i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}},E=i(93435),x=i(21878),R=i(94092),w=i(16247);function y(e,t,i,s,r){return`${(0,R.getUid)(e)},${t},${(0,E.dp)(i,s,r)}`}function S(e,t,i){if(!(i in e))return e[i]=new Set([t]),!0;let s=e[i],r=s.has(t);return r||s.add(t),!r}function v(e,t){let i=e.layerStatesArray[e.layerIndex];i.extent&&(t=(0,c.getIntersection)(t,(0,g.fromUserExtent)(i.extent,e.viewState.projection)));let s=i.layer.getRenderSource();if(!s.getWrapX()){let i=s.getTileGridForProjection(e.viewState.projection).getExtent();i&&(t=(0,c.getIntersection)(t,i))}return t}class C extends w.A{constructor(e,t){super(e),t=t||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=(0,c.createEmpty)(),this.tempTileRange_=new d.A(0,0,0,0),this.tempTileCoord_=(0,E.N)(0,0,0);let i=void 0!==t.cacheSize?t.cacheSize:512;this.tileCache_=new m(i),this.maxStaleKeys=.5*i}getTileCache(){return this.tileCache_}getOrCreateTile(e,t,i,s){let r,n=this.tileCache_,l=this.getLayer().getSource(),o=y(l,l.getKey(),e,t,i);if(n.containsKey(o))r=n.get(o);else{if(!(r=l.getTile(e,t,i,s.pixelRatio,s.viewState.projection)))return null;n.set(o,r)}return r}getTile(e,t,i,s){let r=this.getOrCreateTile(e,t,i,s);return r||null}getData(e){let t=this.frameState;if(!t)return null;let i=this.getLayer(),s=(0,x.Bb)(t.pixelToCoordinateTransform,e.slice()),l=i.getExtent();if(l&&!(0,c.containsCoordinate)(l,s))return null;let o=t.viewState,d=i.getRenderSource(),u=d.getTileGridForProjection(o.projection),g=d.getTilePixelRatio(t.pixelRatio);for(let e=u.getZForResolution(o.resolution);e>=u.getMinZoom();--e){let i,l=u.getTileCoordForCoordAndZ(s,e),c=this.getTile(e,l[1],l[2],t);if(!c||c.getState()!==r.default.LOADED)continue;let p=u.getOrigin(e),T=(0,f.xq)(u.getTileSize(e)),m=u.getResolution(e);if(c instanceof h.A||c instanceof _.A)i=c.getImage();else if(!(c instanceof a))continue;else if(!(i=n(c.getData())))continue;let E=Math.floor(g*((s[0]-p[0])/m-l[1]*T[0])),x=Math.floor(g*((p[1]-s[1])/m-l[2]*T[1])),R=Math.round(g*d.getGutterForProjection(o.projection));return this.getImageData(i,E+R,x+R)}return null}prepareFrame(e){this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;let t=this.getLayer().getSource();if(!t)return!1;let i=t.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==i&&(this.renderedSourceRevision_=i,this.renderedSourceKey_===t.getKey()&&this.tileCache_.clear()):this.renderedSourceRevision_=i,!0}enqueueTiles(e,t,i,s,n){let l=e.viewState,o=this.getLayer(),a=o.getRenderSource(),h=a.getTileGridForProjection(l.projection),d=(0,R.getUid)(a);d in e.wantedTiles||(e.wantedTiles[d]={});let u=e.wantedTiles[d],g=o.getMapInternal(),_=Math.max(i-n,h.getMinZoom(),h.getZForResolution(Math.min(o.getMaxResolution(),g?g.getView().getResolutionForZoom(Math.max(o.getMinZoom(),0)):h.getResolution(0)),a.zDirection)),f=l.rotation,p=f?(0,c.getRotatedViewport)(l.center,l.resolution,f,e.size):void 0;for(let n=i;n>=_;--n){let i=h.getTileRangeForExtentAndZ(t,n,this.tempTileRange_),l=h.getResolution(n);for(let t=i.minX;t<=i.maxX;++t)for(let o=i.minY;o<=i.maxY;++o){if(f&&!h.tileCoordIntersectsViewport([n,t,o],p))continue;let i=this.getTile(n,t,o,e);if(!i||!S(s,i,n))continue;let a=i.getKey();if(u[a]=!0,i.getState()===r.default.IDLE&&!e.tileQueue.isKeyQueued(a)){let s=(0,E.N)(n,t,o,this.tempTileCoord_);e.tileQueue.enqueue([i,d,h.getTileCoordCenter(s),l])}}}}findStaleTile_(e,t){let i=this.tileCache_,s=e[0],n=e[1],l=e[2],o=this.getStaleKeys();for(let e=0;e<o.length;++e){let a=y(this.getLayer().getSource(),o[e],s,n,l);if(i.containsKey(a)){let e=i.peek(a);if(e.getState()===r.default.LOADED)return e.endTransition((0,R.getUid)(this)),S(t,e,s),!0}}return!1}findAltTiles_(e,t,i,s){let n=e.getTileRangeForTileCoordAndZ(t,i,this.tempTileRange_);if(!n)return!1;let l=!0,o=this.tileCache_,a=this.getLayer().getRenderSource(),h=a.getKey();for(let e=n.minX;e<=n.maxX;++e)for(let t=n.minY;t<=n.maxY;++t){let n=y(a,h,i,e,t),d=!1;if(o.containsKey(n)){let e=o.peek(n);e.getState()===r.default.LOADED&&(S(s,e,i),d=!0)}d||(l=!1)}return l}renderFrame(e,t){let i;this.renderComplete=!0;let s=e.layerStatesArray[e.layerIndex],n=e.viewState,l=n.projection,o=n.resolution,a=n.center,h=e.pixelRatio,d=this.getLayer(),_=d.getSource(),f=_.getTileGridForProjection(l),p=f.getZForResolution(o,_.zDirection),T=f.getResolution(p),m=_.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==m&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=m):this.renderedSourceKey_=m;let E=e.extent,w=_.getTilePixelRatio(h);this.prepareContainer(e,t);let y=this.context.canvas.width,S=this.context.canvas.height,C=s.extent&&(0,g.fromUserExtent)(s.extent,l);C&&(E=(0,c.getIntersection)(E,(0,g.fromUserExtent)(s.extent,l)));let I=T*y/2/w,A=T*S/2/w,L=[a[0]-I,a[1]-A,a[0]+I,a[1]+A],D={};this.renderedTiles.length=0;let O=d.getPreload();if(e.nextExtent){let t=f.getZForResolution(n.nextResolution,_.zDirection),i=v(e,e.nextExtent);this.enqueueTiles(e,i,t,D,O)}let M=v(e,E);if(this.enqueueTiles(e,M,p,D,0),O>0&&setTimeout(()=>{this.enqueueTiles(e,M,p-1,D,O-1)},0),!(p in D))return this.container;let K=(0,R.getUid)(this),k=e.time;for(let t of D[p]){let i=t.getState();if(i===r.default.EMPTY)continue;let s=t.tileCoord;if(i===r.default.LOADED&&1===t.getAlpha(K,k)){t.endTransition(K);continue}if(i!==r.default.ERROR&&(this.renderComplete=!1),this.findStaleTile_(s,D)){!function(e,t,i){let s=e[i];s&&s.delete(t)}(D,t,p),e.animate=!0;continue}if(this.findAltTiles_(f,s,p+1,D))continue;let n=f.getMinZoom();for(let e=p-1;e>=n&&!this.findAltTiles_(f,s,e,D);--e);}let P=T/o*h/w,j=this.getRenderContext(e);(0,x.Zz)(this.tempTransform,y/2,S/2,P,P,0,-y/2,-S/2),s.extent&&this.clipUnrotated(j,e,C),_.getInterpolate()||(j.imageSmoothingEnabled=!1),this.preRender(j,e);let F=Object.keys(D).map(Number);F.sort(u.V_);let G=[],Z=[];for(let t=F.length-1;t>=0;--t){let s=F[t],n=_.getTilePixelSize(s,h,l),o=f.getResolution(s)/T,a=n[0]*o*P,d=n[1]*o*P,u=f.getTileCoordForCoordAndZ((0,c.getTopLeft)(L),s),g=f.getTileCoordExtent(u),p=(0,x.Bb)(this.tempTransform,[w*(g[0]-L[0])/T,w*(L[3]-g[3])/T]),m=w*_.getGutterForProjection(l);for(let t of D[s]){if(t.getState()!==r.default.LOADED)continue;let n=t.tileCoord,l=u[1]-n[1],o=Math.round(p[0]-(l-1)*a),h=u[2]-n[2],g=Math.round(p[1]-(h-1)*d),f=Math.round(p[0]-l*a),T=Math.round(p[1]-h*d),E=o-f,x=g-T,R=1===F.length,w=!1;i=[f,T,f+E,T,f+E,T+x,f,T+x];for(let e=0,t=G.length;e<t;++e)if(!R&&s<Z[e]){let t=G[e];(0,c.intersects)([f,T,f+E,T+x],[t[0],t[3],t[4],t[7]])&&(w||(j.save(),w=!0),j.beginPath(),j.moveTo(i[0],i[1]),j.lineTo(i[2],i[3]),j.lineTo(i[4],i[5]),j.lineTo(i[6],i[7]),j.moveTo(t[6],t[7]),j.lineTo(t[4],t[5]),j.lineTo(t[2],t[3]),j.lineTo(t[0],t[1]),j.clip())}G.push(i),Z.push(s),this.drawTile(t,e,f,T,E,x,m,R),w&&j.restore(),this.renderedTiles.unshift(t),this.updateUsedTiles(e.usedTiles,_,t)}}if(this.renderedResolution=T,this.extentChanged=!this.renderedExtent_||!(0,c.equals)(this.renderedExtent_,L),this.renderedExtent_=L,this.renderedPixelRatio=h,this.postRender(this.context,e),s.extent&&j.restore(),j.imageSmoothingEnabled=!0,this.renderComplete){let t=(e,t)=>{let i=(0,R.getUid)(_),s=t.wantedTiles[i],r=s?Object.keys(s).length:0;this.updateCacheSize(r),this.tileCache_.expireCache()};e.postRenderFunctions.push(t)}return this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,2*e)}drawTile(e,t,i,s,r,l,o,h){let d;if(e instanceof a){if(!(d=n(e.getData())))throw Error("Rendering array data is not yet supported")}else d=this.getTileImage(e);if(!d)return;let u=this.getRenderContext(t),c=(0,R.getUid)(this),g=t.layerStatesArray[t.layerIndex],_=g.opacity*(h?e.getAlpha(c,t.time):1),f=_!==u.globalAlpha;f&&(u.save(),u.globalAlpha=_),u.drawImage(d,o,o,d.width-2*o,d.height-2*o,i,s,r,l),f&&u.restore(),_!==g.opacity?t.animate=!0:h&&e.endTransition(c)}getImage(){let e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,t,i){let s=(0,R.getUid)(t);s in e||(e[s]={}),e[s][i.getKey()]=!0}}var I=C},7689:function(e,t,i){var s=i(31644),r=i(74255),n=i(84674),l=i(55506),o=i(17353),a=i(85752),h=i(94966),d=i(22482),u=i(95826),c=i(20776);class g extends s.A{constructor(e,t,i,s,n,l,o,g,_,f,p,T){super(n,r.default.IDLE,T),this.renderEdges_=void 0!==p&&p,this.pixelRatio_=o,this.gutter_=g,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=s,this.wrappedTileCoord_=l||n,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=e.canWrapX()?e.getExtent():void 0;let m=s.getTileCoordExtent(this.wrappedTileCoord_),E=this.targetTileGrid_.getExtent(),x=this.sourceTileGrid_.getExtent(),R=E?(0,a.getIntersection)(m,E):m;if(0===(0,a.getArea)(R)){this.state=r.default.EMPTY;return}let w=e.getExtent();w&&(x=x?(0,a.getIntersection)(x,w):w);let y=s.getResolution(this.wrappedTileCoord_[0]),S=(0,d.aY)(e,i,R,y);if(!isFinite(S)||S<=0){this.state=r.default.EMPTY;return}let v=void 0!==f?f:c.l;if(this.triangulation_=new u.A(e,i,R,x,S*v,y),0===this.triangulation_.getTriangles().length){this.state=r.default.EMPTY;return}this.sourceZ_=t.getZForResolution(S);let C=this.triangulation_.calculateSourceExtent();if(x&&(e.canWrapX()?(C[1]=(0,h.qE)(C[1],x[1],x[3]),C[3]=(0,h.qE)(C[3],x[1],x[3])):C=(0,a.getIntersection)(C,x)),(0,a.getArea)(C)){let i=0,s=0;e.canWrapX()&&(i=(0,a.getWidth)(w),s=Math.floor((C[0]-w[0])/i)),(0,a.wrapAndSliceX)(C.slice(),e,!0).forEach(e=>{let r=t.getTileRangeForExtentAndZ(e,this.sourceZ_);for(let e=r.minX;e<=r.maxX;e++)for(let t=r.minY;t<=r.maxY;t++){let r=_(this.sourceZ_,e,t,o);if(r){let e=s*i;this.sourceTiles_.push({tile:r,offset:e})}}++s}),0===this.sourceTiles_.length&&(this.state=r.default.EMPTY)}else this.state=r.default.EMPTY}getImage(){return this.canvas_}reproject_(){let e=[];if(this.sourceTiles_.forEach(t=>{let i=t.tile;if(i&&i.getState()==r.default.LOADED){let s=this.sourceTileGrid_.getTileCoordExtent(i.tileCoord);s[0]+=t.offset,s[2]+=t.offset;let r=this.clipExtent_?.slice();r&&(r[0]+=t.offset,r[2]+=t.offset),e.push({extent:s,clipExtent:r,image:i.getImage()})}}),this.sourceTiles_.length=0,0===e.length)this.state=r.default.ERROR;else{let t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),s="number"==typeof i?i:i[0],n="number"==typeof i?i:i[1],l=this.targetTileGrid_.getResolution(t),o=this.sourceTileGrid_.getResolution(this.sourceZ_),a=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=(0,d.XX)(s,n,this.pixelRatio_,o,this.sourceTileGrid_.getExtent(),l,a,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=r.default.LOADED}this.changed()}load(){if(this.state==r.default.IDLE){this.state=r.default.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{let i=t.getState();if(i==r.default.IDLE||i==r.default.LOADING){e++;let i=(0,o.KT)(t,l.default.CHANGE,s=>{let n=t.getState();(n==r.default.LOADED||n==r.default.ERROR||n==r.default.EMPTY)&&((0,o.JH)(i),0==--e&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(i)}}),0===e?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e},t,i){e.getState()==r.default.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(o.JH),this.sourcesListenerKeys_=null}release(){this.canvas_&&((0,n.Yg)(this.canvas_.getContext("2d")),d.BV.push(this.canvas_),this.canvas_=null),super.release()}}t.A=g}}]);
//# sourceMappingURL=6550.76c2fe09c54df98d.js.map