"use strict";(self.webpackChunk_terrestris_shogun_gis_client=self.webpackChunk_terrestris_shogun_gis_client||[]).push([["5210"],{24113:function(e,t,r){r.r(t),r.d(t,{default:function(){return R}});var i=r(67008),n=r(19487),s=r(53094),a=r(84674),h=r(85752),l=r(21128),o=r(31431),d=r(9966),c=r(20337),u=r(67474),g=r(94092),p=r(4441),_=r(16247);class x extends _.A{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=(0,h.createEmpty)(),this.wrappedRenderedExtent_=(0,h.createEmpty)(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(e,t,r){let n=t.extent,s=t.viewState,a=s.center,l=s.resolution,o=s.projection,d=s.rotation,u=o.getExtent(),g=this.getLayer().getSource(),p=this.getLayer().getDeclutter(),_=t.pixelRatio,x=t.viewHints,y=!(x[i.A.ANIMATING]||x[i.A.INTERACTING]),f=this.context,R=Math.round((0,h.getWidth)(n)/l*_),m=Math.round((0,h.getHeight)(n)/l*_),C=g.getWrapX()&&o.canWrapX(),D=C?(0,h.getWidth)(u):null,E=C?Math.ceil((n[2]-u[2])/D)+1:1,I=C?Math.floor((n[0]-u[0])/D):0;do{let i=this.getRenderTransform(a,l,0,_,R,m,I*D);t.declutter&&(i=i.slice(0)),e.execute(f,[f.canvas.width,f.canvas.height],i,d,y,void 0===r?c.y2:r?c.$i:c.x$,r?p&&t.declutter[p]:void 0)}while(++I<E)}setDrawContext_(){1!==this.opacity_&&(this.targetContext_=this.context,this.context=(0,a.Y)(this.context.canvas.width,this.context.canvas.height,_.B))}resetDrawContext_(){if(1!==this.opacity_&&this.targetContext_){let e=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=e,(0,a.Yg)(this.context),_.B.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(e){this.replayGroup_&&this.getLayer().getDeclutter()&&this.renderWorlds(this.replayGroup_,e,!0)}renderDeferredInternal(e){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(e,t){let r=e.layerStatesArray[e.layerIndex];this.opacity_=r.opacity;let i=e.viewState;this.prepareContainer(e,t);let n=this.context,s=this.replayGroup_,a=s&&!s.isEmpty();if(!a&&!(this.getLayer().hasListener(o.A.PRERENDER)||this.getLayer().hasListener(o.A.POSTRENDER)))return this.container;this.setDrawContext_(),this.preRender(n,e);let d=i.projection;if(this.clipped_=!1,a&&r.extent&&this.clipping){let t=(0,l.fromUserExtent)(r.extent,d);a=(0,h.intersects)(t,e.extent),this.clipped_=a&&!(0,h.containsExtent)(t,e.extent),this.clipped_&&this.clipUnrotated(n,e,t)}return a&&this.renderWorlds(s,e,!this.getLayer().getDeclutter()&&void 0),!e.declutter&&this.clipped_&&n.restore(),this.postRender(n,e),this.renderedRotation_!==i.rotation&&(this.renderedRotation_=i.rotation,this.hitDetectionImageData_=null),e.declutter||this.resetDrawContext_(),this.container}getFeatures(e){return new Promise(t=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){let e=this.frameState.size.slice(),t=this.renderedCenter_,r=this.renderedResolution_,i=this.renderedRotation_,n=this.renderedProjection_,s=this.wrappedRenderedExtent_,a=this.getLayer(),o=[],d=e[0]*u.tF,c=e[1]*u.tF;o.push(this.getRenderTransform(t,r,i,u.tF,d,c,0).slice());let g=a.getSource(),_=n.getExtent();if(g.getWrapX()&&n.canWrapX()&&!(0,h.containsExtent)(_,s)){let e,n=s[0],a=(0,h.getWidth)(_),l=0;for(;n<_[0];)e=a*--l,o.push(this.getRenderTransform(t,r,i,u.tF,d,c,e).slice()),n+=a;for(l=0,n=s[2];n>_[2];)e=a*++l,o.push(this.getRenderTransform(t,r,i,u.tF,d,c,e).slice()),n-=a}let x=(0,l.getUserProjection)();this.hitDetectionImageData_=(0,u._7)(e,o,this.renderedFeatures_,a.getStyleFunction(),s,r,i,(0,p.j)(r,this.renderedPixelRatio_),x?n:null)}t((0,u.F8)(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,t,r,i,n){if(!this.replayGroup_)return;let s=t.viewState.resolution,a=t.viewState.rotation,h=this.getLayer(),l={},o=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(e,s,a,r,function(e,t,r){let s=(0,g.getUid)(e),a=l[s];if(a){if(!0!==a&&r<a.distanceSq){if(0===r)return l[s]=!0,n.splice(n.lastIndexOf(a),1),i(e,h,t);a.geometry=t,a.distanceSq=r}}else{if(0===r)return l[s]=!0,i(e,h,t);n.push(l[s]={feature:e,layer:h,geometry:t,distanceSq:r,callback:i})}},o?t.declutter?.[o]?.all().map(e=>e.value):null)}handleFontsChanged(){let e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){let t,r=this.getLayer(),a=r.getSource();if(!a)return!1;let o=e.viewHints[i.A.ANIMATING],u=e.viewHints[i.A.INTERACTING],g=r.getUpdateWhileAnimating(),_=r.getUpdateWhileInteracting();if(this.ready&&!g&&o||!_&&u)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;let x=e.extent,y=e.viewState,f=y.projection,R=y.resolution,m=e.pixelRatio,C=r.getRevision(),D=r.getRenderBuffer(),E=r.getRenderOrder();void 0===E&&(E=p.Eo);let I=y.center.slice(),w=(0,h.buffer)(x,D*R),F=w.slice(),v=[w.slice()],A=f.getExtent();if(a.getWrapX()&&f.canWrapX()&&!(0,h.containsExtent)(A,e.extent)){let e=(0,h.getWidth)(A),t=Math.max((0,h.getWidth)(w)/2,e);w[0]=A[0]-t,w[2]=A[2]+t,(0,s.wrapX)(I,f);let r=(0,h.wrapX)(v[0],f);r[0]<A[0]&&r[2]<A[2]?v.push([r[0]+e,r[1],r[2]+e,r[3]]):r[0]>A[0]&&r[2]>A[2]&&v.push([r[0]-e,r[1],r[2]-e,r[3]])}if(this.ready&&this.renderedResolution_==R&&this.renderedRevision_==C&&this.renderedRenderOrder_==E&&!!e.declutter===this.renderedFrameDeclutter_&&(0,h.containsExtent)(this.wrappedRenderedExtent_,w))return(0,n.aI)(this.renderedExtent_,F)||(this.hitDetectionImageData_=null,this.renderedExtent_=F),this.renderedCenter_=I,this.replayGroupChanged=!1,!0;this.replayGroup_=null;let S=new d.A((0,p.gY)(R,m),w,R,m),G=(0,l.getUserProjection)();if(G){for(let e=0,t=v.length;e<t;++e){let t=v[e],r=(0,l.toUserExtent)(t,f);a.loadFeatures(r,(0,l.toUserResolution)(R,f),G)}t=(0,l.getTransformFromProjections)(G,f)}else for(let e=0,t=v.length;e<t;++e)a.loadFeatures(v[e],R,f);let W=(0,p.j)(R,m),L=!0,b=(e,i)=>{let n,s=e.getStyleFunction()||r.getStyleFunction();if(s&&(n=s(e,R)),n){let r=this.renderFeature(e,W,n,S,t,this.getLayer().getDeclutter(),i);L=L&&!r}},N=(0,l.toUserExtent)(w,f),P=a.getFeaturesInExtent(N);E&&P.sort(E);for(let e=0,t=P.length;e<t;++e)b(P[e],e);this.renderedFeatures_=P,this.ready=L;let T=S.finish(),j=new c.Ay(w,R,m,a.getOverlaps(),T,r.getRenderBuffer(),!!e.declutter);return this.renderedResolution_=R,this.renderedRevision_=C,this.renderedRenderOrder_=E,this.renderedFrameDeclutter_=!!e.declutter,this.renderedExtent_=F,this.wrappedRenderedExtent_=w,this.renderedCenter_=I,this.renderedProjection_=f,this.renderedPixelRatio_=m,this.replayGroup_=j,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,r,i,n,s,a){if(!r)return!1;let h=!1;if(Array.isArray(r))for(let l=0,o=r.length;l<o;++l)h=(0,p.nl)(i,e,r[l],t,this.boundHandleStyleImageChange_,n,s,a)||h;else h=(0,p.nl)(i,e,r,t,this.boundHandleStyleImageChange_,n,s,a);return h}}var y=r(43267);class f extends y.A{constructor(e){super(e)}createRenderer(){return new x(this)}}var R=f}}]);
//# sourceMappingURL=5210.a42b3f148835a7bb.js.map