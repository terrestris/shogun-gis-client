"use strict";(self.webpackChunk_terrestris_shogun_gis_client=self.webpackChunk_terrestris_shogun_gis_client||[]).push([["6804"],{33695:function(e,t,i){i.r(t),i.d(t,{ModifyEvent:function(){return w}});var r=i(54616),n=i(274),s=i(22772),o=i(5888),a=i(19487),d=i(30713),h=i(43354),l=i(55506),g=i(89267),u=i(85752),_=i(51117),c=i(29229),m=i(64923),f=i(58318),x=i(84143),p=i(38159),y=i(79027),C=i(48069),v=i(94092),S=i(29592),F=i(21807);let P=[0,0,0,0],E=[],T="modifyend";function M(e,t,i){let r;switch(t){case"LineString":r=e;break;case"MultiLineString":case"Polygon":r=e[i[0]];break;case"MultiPolygon":r=e[i[1]][i[0]]}return r}class w extends h.default{constructor(e,t,i){super(e),this.features=t,this.mapBrowserEvent=i}}class I extends S.default{constructor(e){let t;if(super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:g.primaryAction,this.defaultDeleteCondition_=function(e){return(0,g.altKeyOnly)(e)&&(0,g.singleClick)(e)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:g.always,this.vertexFeature_=null,this.vertexSegments_=null,this.lastCoordinate_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new y.A,this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new m.default({source:new x.default({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:function(){let e=(0,C.createEditingStyle)();return function(t,i){return e.Point}}(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.traceSource_=e.traceSource||e.source||null,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSegments_=null,this.hitDetection_=null,e.features?t=e.features:e.source&&(this.source_=e.source,t=new r.default(this.source_.getFeatures()),this.source_.addEventListener(p.A.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(p.A.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(n.A.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(n.A.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=void 0===e.snapToPointer?!this.hitDetection_:e.snapToPointer}setTrace(e){let t;t=e?!0===e?g.always:e:g.never,this.traceCondition_=t}addFeature_(e){let t=e.getGeometry();if(t){let i=this.SEGMENT_WRITERS_[t.getType()];i&&i(e,t)}let i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastCoordinate_),e.addEventListener(l.default.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new r.default;let i=this.featuresBeingModified_.getArray();for(let e=0,r=t.length;e<r;++e){let r=t[e].feature;r&&!i.includes(r)&&this.featuresBeingModified_.push(r)}0===this.featuresBeingModified_.getLength()?this.featuresBeingModified_=null:this.dispatchEvent(new w("modifystart",this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(l.default.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){let t=this.rBush_,i=[];t.forEach(function(t){e===t.feature&&i.push(t)});for(let e=i.length-1;e>=0;--e){let r=i[e];for(let e=this.dragSegments_.length-1;e>=0;--e)this.dragSegments_[e][0]===r&&this.dragSegments_.splice(e,1);t.remove(r)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){let t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){let i=t.getCoordinates();this.rBush_.insert(t.getExtent(),{feature:e,geometry:t,segment:[i,i]})}writeMultiPointGeometry_(e,t){let i=t.getCoordinates();for(let r=0,n=i.length;r<n;++r){let n=i[r],s={feature:e,geometry:t,depth:[r],index:r,segment:[n,n]};this.rBush_.insert(t.getExtent(),s)}}writeLineStringGeometry_(e,t){let i=t.getCoordinates();for(let r=0,n=i.length-1;r<n;++r){let n=i.slice(r,r+2),s={feature:e,geometry:t,index:r,segment:n};this.rBush_.insert((0,u.boundingExtent)(n),s)}}writeMultiLineStringGeometry_(e,t){let i=t.getCoordinates();for(let r=0,n=i.length;r<n;++r){let n=i[r];for(let i=0,s=n.length-1;i<s;++i){let s=n.slice(i,i+2),o={feature:e,geometry:t,depth:[r],index:i,segment:s};this.rBush_.insert((0,u.boundingExtent)(s),o)}}}writePolygonGeometry_(e,t){let i=t.getCoordinates();for(let r=0,n=i.length;r<n;++r){let n=i[r];for(let i=0,s=n.length-1;i<s;++i){let s=n.slice(i,i+2),o={feature:e,geometry:t,depth:[r],index:i,segment:s};this.rBush_.insert((0,u.boundingExtent)(s),o)}}}writeMultiPolygonGeometry_(e,t){let i=t.getCoordinates();for(let r=0,n=i.length;r<n;++r){let n=i[r];for(let i=0,s=n.length;i<s;++i){let s=n[i];for(let n=0,o=s.length-1;n<o;++n){let o=s.slice(n,n+2),a={feature:e,geometry:t,depth:[i,r],index:n,segment:o};this.rBush_.insert((0,u.boundingExtent)(o),a)}}}}writeCircleGeometry_(e,t){let i=t.getCenter(),r={feature:e,geometry:t,index:0,segment:[i,i]},n={feature:e,geometry:t,index:1,segment:[i,i]},s=[r,n];r.featureSegments=s,n.featureSegments=s,this.rBush_.insert((0,u.createOrUpdateFromCoordinate)(i),r);let o=t,a=(0,f.getUserProjection)();if(a&&this.getMap()){let e=this.getMap().getView().getProjection();o=o.clone().transform(a,e),o=(0,c.fromCircle)(o).transform(e,a)}this.rBush_.insert(o.getExtent(),n)}writeGeometryCollectionGeometry_(e,t){let i=t.getGeometriesArray();for(let t=0;t<i.length;++t){let r=i[t];(0,this.SEGMENT_WRITERS_[r.getType()])(e,r)}}createOrUpdateVertexFeature_(e,t,i,r){let n=this.vertexFeature_;return n?n.getGeometry().setCoordinates(e):(n=new s.default(new _.default(e)),this.vertexFeature_=n,this.overlay_.getSource().addFeature(n)),n.set("features",t),n.set("geometries",i),n.set("existing",r),n}handleEvent(e){let t;return!e.originalEvent||(this.lastPointerEvent_=e,e.map.getView().getInteracting()||e.type!=o.A.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(t=e.type==o.A.SINGLECLICK&&!!this.ignoreNextSingleClick_||this.removePoint()),e.type==o.A.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t)}findInsertVerticesAndUpdateDragSegments_(e){if(this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null,!this.vertexFeature_)return;let t=this.getMap().getView().getProjection(),i=[],r=this.vertexFeature_.getGeometry().getCoordinates(),n=(0,u.boundingExtent)([r]),s=this.rBush_.getInExtent(n),o={};s.sort(b);for(let n=0,a=s.length;n<a;++n){let a=s[n],h=a.segment,l=(0,v.getUid)(a.geometry),g=a.depth;if(g&&(l+="-"+g.join("-")),o[l]||(o[l]=[,,]),"Circle"===a.geometry.getType()&&1===a.index){let i=U(e,a,t);(0,d.equals)(i,r)&&!o[l][0]&&(this.dragSegments_.push([a,0]),o[l][0]=a);continue}if((0,d.equals)(h[0],r)&&!o[l][0]){this.dragSegments_.push([a,0]),o[l][0]=a;continue}if((0,d.equals)(h[1],r)&&!o[l][1]){if(o[l][0]&&0===o[l][0].index){let e=a.geometry.getCoordinates();switch(a.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":e=e[g[1]];case"Polygon":if(a.index!==e[g[0]].length-2)continue}}this.dragSegments_.push([a,1]),o[l][1]=a;continue}(0,v.getUid)(h)in this.vertexSegments_&&!o[l][0]&&!o[l][1]&&i.push(a)}return i}deactivateTrace_(){this.traceState_={active:!1}}updateTrace_(e){let t=this.traceState_;if(!t.active)return;if(-1===t.targetIndex){let i=e.map.getPixelFromCoordinate(t.startCoord);if((0,d.distance)(i,e.pixel)<this.pixelTolerance_)return}let i=(0,F.kh)(e.coordinate,t,e.map,this.pixelTolerance_);if(!(-1===t.targetIndex&&Math.sqrt(i.closestTargetDistance)/e.map.getView().getResolution()>this.pixelTolerance_)){if(t.targetIndex!==i.index){if(-1!==t.targetIndex){let e=t.targets[t.targetIndex];this.removeTracedCoordinates_(e.startIndex,e.endIndex)}else for(let e of this.traceSegments_){let t=e[0],i=t.geometry,r=e[1],n=i.getCoordinates();M(n,i.getType(),t.depth).splice(t.index+r,1),i.setCoordinates(n),0===r&&(t.index-=1)}let e=t.targets[i.index];this.addTracedCoordinates_(e,e.startIndex,i.endIndex)}else{let e=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(e,i.endIndex)}t.targetIndex=i.index,t.targets[t.targetIndex].endIndex=i.endIndex}}getTraceCandidates_(e){let t=this.getMap(),i=this.pixelTolerance_,r=t.getCoordinateFromPixel([e.pixel[0]-i,e.pixel[1]+i]),n=t.getCoordinateFromPixel([e.pixel[0]+i,e.pixel[1]-i]),s=(0,u.boundingExtent)([r,n]);return this.traceSource_.getFeaturesInExtent(s)}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_(),this.traceSegments_=null;return}let t=this.getTraceCandidates_(e);if(0===t.length)return;let i=(0,F.EW)(e.coordinate,t);i.length&&(this.traceState_={active:!0,startCoord:e.coordinate.slice(),targets:i,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){let i=e.startIndex<=e.endIndex;i===e.startIndex<=t?i&&t>e.endIndex||!i&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(i&&t<e.endIndex||!i&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let i=0;if(e<t){let r=Math.floor(t);r===t&&(r-=1),i=r-Math.ceil(e)+1}else{let r=Math.ceil(t);r===t&&(r+=1),i=Math.floor(e)-r+1}if(i>0)for(let e of this.traceSegments_){let t=e[0],r=t.geometry,n=e[1],s=e[0].index+1;1===n&&(s-=i);let o=r.getCoordinates();M(o,r.getType(),t.depth).splice(s,i),r.setCoordinates(o),1===n&&(t.index-=i)}}addTracedCoordinates_(e,t,i){if(t===i)return;let r=[];if(t<i){let n=Math.ceil(t),s=Math.floor(i);s===i&&(s-=1);for(let t=n;t<=s;++t)r.push((0,F.Hx)(e.coordinates,t))}else{let n=Math.floor(t),s=Math.ceil(i);s===i&&(s+=1);for(let t=n;t>=s;--t)r.push((0,F.Hx)(e.coordinates,t))}if(r.length)for(let e of this.traceSegments_){let t=e[0],i=t.geometry,n=e[1],s=t.index+1;0===n&&r.reverse();let o=i.getCoordinates();M(o,i.getType(),t.depth).splice(s,0,...r),i.setCoordinates(o),1===n&&(t.index+=r.length)}}updateGeometry_(e,t){let i,r=t[0],n=r.depth,s=r.segment,o=r.geometry,a=t[1];for(;e.length<o.getStride();)e.push(s[a][e.length]);switch(o.getType()){case"Point":i=e,s[0]=e,s[1]=e;break;case"MultiPoint":(i=o.getCoordinates())[r.index]=e,s[0]=e,s[1]=e;break;case"LineString":(i=o.getCoordinates())[r.index+a]=e,s[a]=e;break;case"MultiLineString":case"Polygon":(i=o.getCoordinates())[n[0]][r.index+a]=e,s[a]=e;break;case"MultiPolygon":(i=o.getCoordinates())[n[1]][n[0]][r.index+a]=e,s[a]=e;break;case"Circle":if(s[0]=e,s[1]=e,0===r.index)this.changingFeature_=!0,o.setCenter(e),this.changingFeature_=!1;else{this.changingFeature_=!0;let t=this.getMap().getView().getProjection(),i=(0,d.distance)((0,f.fromUserCoordinate)(o.getCenter(),t),(0,f.fromUserCoordinate)(e,t)),r=(0,f.getUserProjection)();if(r){let e=o.clone().transform(r,t);e.setRadius(i),i=e.transform(t,r).getRadius()}o.setRadius(i),this.changingFeature_=!1}}i&&this.setGeometryCoordinates_(o,i)}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([e])=>e));let t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],i=[],r=[],n=this.traceState_.active&&!this.traceSegments_?this.traceState_.startCoord:null;if(n)for(let t of(this.traceSegments_=[],this.dragSegments_)){let i=t[0];(0,d.distance)((0,d.closestOnSegment)(n,i.segment),n)/e.map.getView().getResolution()<1&&this.traceSegments_.push(t)}for(let e=0,n=this.dragSegments_.length;e<n;++e){let n=this.dragSegments_[e],s=n[0],o=s.feature;i.includes(o)||i.push(o);let a=s.geometry;r.includes(a)||r.push(a),this.updateGeometry_(t,n)}this.updateTrace_(e),this.createOrUpdateVertexFeature_(t,i,r,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;let t=e.coordinate,i=this.findInsertVerticesAndUpdateDragSegments_(t);if(i?.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,i),this.vertexFeature_)){let e=this.vertexFeature_.getGeometry().getCoordinates();for(let t=i.length-1;t>=0;--t)this.insertVertex_(i[t],e);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){let i=this.dragSegments_[t][0],r=i.geometry;if("Circle"===r.getType()){let t=r.getCenter(),n=i.featureSegments[0],s=i.featureSegments[1];n.segment[0]=t,n.segment[1]=t,s.segment[0]=t,s.segment[1]=t,this.rBush_.update((0,u.createOrUpdateFromCoordinate)(t),n);let o=r,a=(0,f.getUserProjection)();if(a){let t=e.map.getView().getProjection();o=o.clone().transform(a,t),o=(0,c.fromCircle)(o).transform(t,a)}this.rBush_.update(o.getExtent(),s)}else this.rBush_.update((0,u.boundingExtent)(i.segment),i)}return this.featuresBeingModified_&&(this.toggleTraceState_(e),this.dispatchEvent(new w(T,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastCoordinate_=e.coordinate,this.handlePointerAtPixel_(this.lastCoordinate_)}handlePointerAtPixel_(e){let t,i,r=this.getMap(),n=r.getPixelFromCoordinate(e),o=r.getView().getProjection();if(this.hitDetection_){let e="object"==typeof this.hitDetection_?e=>e===this.hitDetection_:void 0;r.forEachFeatureAtPixel(n,(e,r,n)=>{n&&"Point"===n.getType()&&(n=new _.default((0,f.toUserCoordinate)(n.getCoordinates(),o)));let a=n||e.getGeometry();if(a&&"Point"===a.getType()&&e instanceof s.default&&this.features_.getArray().includes(e)){i=a;let r=e.getGeometry().getFlatCoordinates().slice(0,2);t=[{feature:e,geometry:i,segment:[r,r]}]}return!0},{layerFilter:e})}if(!t){let i=(0,f.fromUserExtent)((0,u.createOrUpdateFromCoordinate)(e,P),o),n=r.getView().getResolution()*this.pixelTolerance_,s=(0,f.toUserExtent)((0,u.buffer)(i,n,P),o);t=this.rBush_.getInExtent(s)}if(t&&t.length>0){let s=t.sort(function(t,i){return G(e,t,o)-G(e,i,o)})[0],a=s.segment,h=U(e,s,o),l=r.getPixelFromCoordinate(h),g=(0,d.distance)(n,l);if(i||g<=this.pixelTolerance_){let i={};if(i[(0,v.getUid)(a)]=!0,this.snapToPointer_||(this.delta_[0]=h[0]-e[0],this.delta_[1]=h[1]-e[1]),"Circle"===s.geometry.getType()&&1===s.index)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(h,[s.feature],[s.geometry],this.snappedToVertex_);else{let e=r.getPixelFromCoordinate(a[0]),n=r.getPixelFromCoordinate(a[1]),o=(0,d.squaredDistance)(l,e),u=(0,d.squaredDistance)(l,n);if(g=Math.sqrt(Math.min(o,u)),this.snappedToVertex_=g<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(h=o>u?a[1]:a[0]),this.createOrUpdateVertexFeature_(h,[s.feature],[s.geometry],this.snappedToVertex_);let _={};_[(0,v.getUid)(s.geometry)]=!0;for(let e=1,r=t.length;e<r;++e){let r=t[e].segment;if((0,d.equals)(a[0],r[0])&&(0,d.equals)(a[1],r[1])||(0,d.equals)(a[0],r[1])&&(0,d.equals)(a[1],r[0])){let n=(0,v.getUid)(t[e].geometry);n in _||(_[n]=!0,i[(0,v.getUid)(r)]=!0)}else break}}this.vertexSegments_=i;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){let i,r=e.segment,n=e.feature,s=e.geometry,o=e.depth,a=e.index;for(;t.length<s.getStride();)t.push(0);switch(s.getType()){case"MultiLineString":case"Polygon":(i=s.getCoordinates())[o[0]].splice(a+1,0,t);break;case"MultiPolygon":(i=s.getCoordinates())[o[1]][o[0]].splice(a+1,0,t);break;case"LineString":(i=s.getCoordinates()).splice(a+1,0,t);break;default:return!1}this.setGeometryCoordinates_(s,i);let d=this.rBush_;d.remove(e),this.updateSegmentIndices_(s,a,o,1);let h={segment:[r[0],t],feature:n,geometry:s,depth:o,index:a};d.insert((0,u.boundingExtent)(h.segment),h),this.dragSegments_.push([h,1]);let l={segment:[t,r[1]],feature:n,geometry:s,depth:o,index:a+1};return d.insert((0,u.boundingExtent)(l.segment),l),this.dragSegments_.push([l,0]),!0}updatePointer_(e){return e&&this.findInsertVerticesAndUpdateDragSegments_(e),this.vertexFeature_?.getGeometry().getCoordinates()}getPoint(){let e=this.vertexFeature_?.getGeometry().getCoordinates();return e?(0,f.toUserCoordinate)(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(e=>"Circle"===e.getType()||e.getType().endsWith("Point")))return!1;let e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent((0,u.boundingExtent)([e])).some(({segment:t})=>(0,d.equals)(t[0],e)||(0,d.equals)(t[1],e))}removePoint(e){if(e&&(e=(0,f.fromUserCoordinate)(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=o.A.POINTERDRAG){let e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_.map(([e])=>e));let t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new w(T,this.featuresBeingModified_,e)),this.featuresBeingModified_=null,t}return!1}removeVertex_(){let e,t,i,r,n,s,o,a,d,h,l,g=this.dragSegments_,_={},c=!1;for(n=g.length-1;n>=0;--n)h=(i=g[n])[0],l=(0,v.getUid)(h.feature),h.depth&&(l+="-"+h.depth.join("-")),l in _||(_[l]={}),0===i[1]?(_[l].right=h,_[l].index=h.index):1==i[1]&&(_[l].left=h,_[l].index=h.index+1);for(l in _){switch(d=_[l].right,o=_[l].left,(a=(s=_[l].index)-1)<0&&(a=0),e=t=(r=(h=void 0!==o?o:d).geometry).getCoordinates(),c=!1,r.getType()){case"MultiLineString":t[h.depth[0]].length>2&&(t[h.depth[0]].splice(s,1),c=!0);break;case"LineString":t.length>2&&(t.splice(s,1),c=!0);break;case"MultiPolygon":e=e[h.depth[1]];case"Polygon":(e=e[h.depth[0]]).length>4&&(s==e.length-1&&(s=0),e.splice(s,1),c=!0,0===s&&(e.pop(),e.push(e[0]),a=e.length-1))}if(c){this.setGeometryCoordinates_(r,t);let e=[];if(void 0!==o&&(this.rBush_.remove(o),e.push(o.segment[0])),void 0!==d&&(this.rBush_.remove(d),e.push(d.segment[1])),void 0!==o&&void 0!==d){let t={depth:h.depth,feature:h.feature,geometry:h.geometry,index:a,segment:e};this.rBush_.insert((0,u.boundingExtent)(t.segment),t)}this.updateSegmentIndices_(r,s,h.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),g.length=0}}return c}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(e=>"Circle"===e.getType()||e.getType().endsWith("Point")))return!1;let e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent((0,u.boundingExtent)([e])).some(({segment:t})=>!((0,d.equals)(t[0],e)||(0,d.equals)(t[1],e)))}insertPoint(e){let t=e?(0,f.fromUserCoordinate)(e,this.getMap().getView().getProjection()):this.vertexFeature_?.getGeometry().getCoordinates();return!!t&&this.findInsertVerticesAndUpdateDragSegments_(t).reduce((e,i)=>e||this.insertVertex_(i,t),!1)}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,i,r){this.rBush_.forEachInExtent(e.getExtent(),function(n){n.geometry===e&&(void 0===i||void 0===n.depth||(0,a.aI)(n.depth,i))&&n.index>t&&(n.index+=r)})}}function b(e,t){return e.index-t.index}function G(e,t,i){let r=t.geometry;if("Circle"===r.getType()){let n=r;if(1===t.index){let t=(0,f.getUserProjection)();t&&(n=n.clone().transform(t,i));let r=Math.sqrt((0,d.squaredDistance)(n.getCenter(),(0,f.fromUserCoordinate)(e,i)))-n.getRadius();return r*r}}let n=(0,f.fromUserCoordinate)(e,i);return E[0]=(0,f.fromUserCoordinate)(t.segment[0],i),E[1]=(0,f.fromUserCoordinate)(t.segment[1],i),(0,d.squaredDistanceToSegment)(n,E)}function U(e,t,i){let r=t.geometry;if("Circle"===r.getType()&&1===t.index){let t=r,n=(0,f.getUserProjection)();return n&&(t=t.clone().transform(n,i)),(0,f.toUserCoordinate)(t.getClosestPoint((0,f.fromUserCoordinate)(e,i)),i)}let n=(0,f.fromUserCoordinate)(e,i);return E[0]=(0,f.fromUserCoordinate)(t.segment[0],i),E[1]=(0,f.fromUserCoordinate)(t.segment[1],i),(0,f.toUserCoordinate)((0,d.closestOnSegment)(n,E),i)}t.default=I}}]);
//# sourceMappingURL=6804.228a10825bf8980b.js.map